!function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};var t=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=n((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t}));var o=function(e,n){return!n||"object"!==r(n)&&"function"!=typeof n?t(e):n},i=n((function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t})),a=n((function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,r)}e.exports=t}));var c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)};var s=function(e){if(Array.isArray(e))return e};var u=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}};var d=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r};var f=function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}};var l=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var p=function(e,t){return s(e)||u(e,t)||f(e,t)||l()};var h=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e},m=n((function(e){function t(n,r,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=t=Reflect.get:e.exports=t=function(e,t,n){var r=h(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},t(n,r,o||n)}e.exports=t}));var v=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")};var g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}},y=n((function(e){function t(n,r,o){return g()?e.exports=t=Reflect.construct:e.exports=t=function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&a(o,n.prototype),o},t.apply(null,arguments)}e.exports=t})),b=n((function(e){function t(n){var r="function"==typeof Map?new Map:void 0;return e.exports=t=function(e){if(null===e||!v(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return y(e,arguments,i(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),a(t,e)},t(n)}e.exports=t}));var $=function(e){if(Array.isArray(e))return d(e)};var _=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var w=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var k=function(e){return $(e)||_(e)||f(e)||w()};function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(e,t,n){return t&&C(e.prototype,t),n&&C(e,n),e};function x(){}var E=function(e){return e};function R(e){return e()}function T(){return Object.create(null)}function O(e){e.forEach(R)}function P(e){return"function"==typeof e}function D(e,t){return e!=e?t==t:e!==t||e&&"object"===r(e)||"function"==typeof e}function M(e){if(null==e)return x;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=e.subscribe.apply(e,n);return o.unsubscribe?function(){return o.unsubscribe()}:o}function N(e,t,n){e.$$.on_destroy.push(M(t,n))}function j(e,t,n,r){if(e){var o=A(e,t,n,r);return e[0](o)}}function A(e,t,n,r){return e[1]&&r?function(e,t){for(var n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function L(e,t,n,o){if(e[2]&&o){var i=e[2](o(n));if(void 0===t.dirty)return i;if("object"===r(i)){for(var a=[],c=Math.max(t.dirty.length,i.length),s=0;s<c;s+=1)a[s]=t.dirty[s]|i[s];return a}return t.dirty|i}return t.dirty}var I="undefined"!=typeof window,U=I?function(){return window.performance.now()}:function(){return Date.now()},z=I?function(e){return requestAnimationFrame(e)}:x,B=new Set;function F(e){B.forEach((function(t){t.c(e)||(B.delete(t),t.f())})),0!==B.size&&z(F)}function H(e,t){e.appendChild(t)}function q(e,t,n){e.insertBefore(t,n||null)}function G(e){e.parentNode.removeChild(e)}function W(e,t){for(var n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function K(e){return document.createElement(e)}function V(e){return document.createTextNode(e)}function J(){return V(" ")}function Y(){return V("")}function Q(e,t,n,r){return e.addEventListener(t,n,r),function(){return e.removeEventListener(t,n,r)}}function Z(e){return function(t){return t.preventDefault(),e.call(this,t)}}function X(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function ee(e){return Array.from(e.childNodes)}function te(e,t){t=""+t,e.data!==t&&(e.data=t)}function ne(e,t){(null!=t||e.value)&&(e.value=t)}function re(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function oe(e,t,n){e.classList[n?"add":"remove"](t)}function ie(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}var ae,ce=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e(this,t),this.e=K("div"),this.a=r,this.u(n)}return S(t,[{key:"m",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0;n<this.n.length;n+=1)q(e,this.n[n],t);this.t=e}},{key:"u",value:function(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}},{key:"p",value:function(e){this.d(),this.u(e),this.m(this.t,this.a)}},{key:"d",value:function(){this.n.forEach(G)}}]),t}(),se=new Set,ue=0;function de(e){for(var t=5381,n=e.length;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}function fe(e,t,n,r,o,i,a){for(var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,s=16.666/r,u="{\n",d=0;d<=1;d+=s){var f=t+(n-t)*i(d);u+=100*d+"%{".concat(a(f,1-f),"}\n")}var l=u+"100% {".concat(a(n,1-n),"}\n}"),p="__svelte_".concat(de(l),"_").concat(c),h=e.ownerDocument;se.add(h);var m=h.__svelte_stylesheet||(h.__svelte_stylesheet=h.head.appendChild(K("style")).sheet),v=h.__svelte_rules||(h.__svelte_rules={});v[p]||(v[p]=!0,m.insertRule("@keyframes ".concat(p," ").concat(l),m.cssRules.length));var g=e.style.animation||"";return e.style.animation="".concat(g?"".concat(g,", "):"").concat(p," ").concat(r,"ms linear ").concat(o,"ms 1 both"),ue+=1,p}function le(e,t){var n=(e.style.animation||"").split(", "),r=n.filter(t?function(e){return e.indexOf(t)<0}:function(e){return-1===e.indexOf("__svelte")}),o=n.length-r.length;o&&(e.style.animation=r.join(", "),(ue-=o)||z((function(){ue||(se.forEach((function(e){for(var t=e.__svelte_stylesheet,n=t.cssRules.length;n--;)t.deleteRule(n);e.__svelte_rules={}})),se.clear())})))}function pe(e){ae=e}function he(){if(!ae)throw new Error("Function called outside component initialization");return ae}function me(e){he().$$.on_mount.push(e)}function ve(e){he().$$.on_destroy.push(e)}function ge(e,t){he().$$.context.set(e,t)}function ye(e){return he().$$.context.get(e)}function be(e,t){var n=e.$$.callbacks[t.type];n&&n.slice().forEach((function(e){return e(t)}))}var $e=[],_e=[],we=[],ke=[],Ce=Promise.resolve(),Se=!1;function xe(e){we.push(e)}function Ee(e){ke.push(e)}var Re,Te=!1,Oe=new Set;function Pe(){if(!Te){Te=!0;do{for(var e=0;e<$e.length;e+=1){var t=$e[e];pe(t),De(t.$$)}for($e.length=0;_e.length;)_e.pop()();for(var n=0;n<we.length;n+=1){var r=we[n];Oe.has(r)||(Oe.add(r),r())}we.length=0}while($e.length);for(;ke.length;)ke.pop()();Se=!1,Te=!1,Oe.clear()}}function De(e){if(null!==e.fragment){e.update(),O(e.before_update);var t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(xe)}}function Me(e,t,n){e.dispatchEvent(ie("".concat(t?"intro":"outro").concat(n)))}var Ne,je=new Set;function Ae(){Ne={r:0,c:[],p:Ne}}function Le(){Ne.r||O(Ne.c),Ne=Ne.p}function Ie(e,t){e&&e.i&&(je.delete(e),e.i(t))}function Ue(e,t,n,r){if(e&&e.o){if(je.has(e))return;je.add(e),Ne.c.push((function(){je.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}var ze={duration:0};function Be(e,t,n,r){var o=t(e,n),i=r?0:1,a=null,c=null,s=null;function u(){s&&le(e,s)}function d(e,t){var n=e.b-i;return t*=Math.abs(n),{a:i,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function f(t){var n,r=o||ze,f=r.delay,l=void 0===f?0:f,p=r.duration,h=void 0===p?300:p,m=r.easing,v=void 0===m?E:m,g=r.tick,y=void 0===g?x:g,b=r.css,$={start:U()+l,b:t};t||($.group=Ne,Ne.r+=1),a?c=$:(b&&(u(),s=fe(e,i,t,h,l,v,b)),t&&y(0,1),a=d($,h),xe((function(){return Me(e,t,"start")})),n=function(t){if(c&&t>c.start&&(a=d(c,h),c=null,Me(e,a.b,"start"),b&&(u(),s=fe(e,i,a.b,a.duration,0,v,o.css))),a)if(t>=a.end)y(i=a.b,1-i),Me(e,a.b,"end"),c||(a.b?u():--a.group.r||O(a.group.c)),a=null;else if(t>=a.start){var n=t-a.start;i=a.a+a.d*v(n/a.duration),y(i,1-i)}return!(!a&&!c)},0===B.size&&z(F),new Promise((function(e){B.add({c:n,f:e})})))}return{run:function(e){P(o)?(Re||(Re=Promise.resolve()).then((function(){Re=null})),Re).then((function(){o=o(),f(e)})):f(e)},end:function(){u(),a=c=null}}}function Fe(e,t){var n,o=t.token={};function i(e,n,r,i){if(t.token===o){t.resolved=i;var a=t.ctx;void 0!==r&&((a=a.slice())[r]=i);var c=e&&(t.current=e)(a),s=!1;t.block&&(t.blocks?t.blocks.forEach((function(e,r){r!==n&&e&&(Ae(),Ue(e,1,1,(function(){t.blocks[r]=null})),Le())})):t.block.d(1),c.c(),Ie(c,1),c.m(t.mount(),t.anchor),s=!0),t.block=c,t.blocks&&(t.blocks[n]=c),s&&Pe()}}if((n=e)&&"object"===r(n)&&"function"==typeof n.then){var a=he();if(e.then((function(e){pe(a),i(t.then,1,t.value,e),pe(null)}),(function(e){pe(a),i(t.catch,2,t.error,e),pe(null)})),t.current!==t.pending)return i(t.pending,0),!0}else{if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved=e}}var He="undefined"!=typeof window?window:global;function qe(e,t,n){var r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function Ge(e){e&&e.c()}function We(e,t,n){var r=e.$$,o=r.fragment,i=r.on_mount,a=r.on_destroy,c=r.after_update;o&&o.m(t,n),xe((function(){var t=i.map(R).filter(P);a?a.push.apply(a,k(t)):O(t),e.$$.on_mount=[]})),c.forEach(xe)}function Ke(e,t){var n=e.$$;null!==n.fragment&&(O(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ve(e,t){-1===e.$$.dirty[0]&&($e.push(e),Se||(Se=!0,Ce.then(Pe)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Je(e,t,n,r,o,i){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[-1],c=ae;pe(e);var s=t.props||{},u=e.$$={fragment:null,ctx:null,props:i,update:x,not_equal:o,bound:T(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:T(),dirty:a},d=!1;if(u.ctx=n?n(e,s,(function(t,n){var r=!(arguments.length<=2)&&arguments.length-2?arguments.length<=2?void 0:arguments[2]:n;return u.ctx&&o(u.ctx[t],u.ctx[t]=r)&&(u.bound[t]&&u.bound[t](r),d&&Ve(e,t)),n})):[],u.update(),d=!0,O(u.before_update),u.fragment=!!r&&r(u.ctx),t.target){if(t.hydrate){var f=ee(t.target);u.fragment&&u.fragment.l(f),f.forEach(G)}else u.fragment&&u.fragment.c();t.intro&&Ie(e.$$.fragment),We(e,t.target,t.anchor),Pe()}pe(c)}var Ye=function(){function t(){e(this,t)}return S(t,[{key:"$destroy",value:function(){Ke(this,1),this.$destroy=x}},{key:"$on",value:function(e,t){var n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}}},{key:"$set",value:function(){}}]),t}(),Qe=n((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(e,t,n,r){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new k(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return S()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=$(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var d={};function f(){}function l(){}function p(){}var h={};h[i]=function(){return this};var m=Object.getPrototypeOf,v=m&&m(m(C([])));v&&v!==t&&n.call(v,i)&&(h=v);var g=p.prototype=f.prototype=Object.create(h);function y(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function b(e,t){var o;this._invoke=function(i,a){function c(){return new t((function(o,c){!function o(i,a,c,s){var d=u(e[i],e,a);if("throw"!==d.type){var f=d.arg,l=f.value;return l&&"object"===r(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){o("next",e,c,s)}),(function(e){o("throw",e,c,s)})):t.resolve(l).then((function(e){f.value=e,c(f)}),(function(e){return o("throw",e,c,s)}))}s(d.arg)}(i,a,o,c)}))}return o=o?o.then(c,c):c()}}function $(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,$(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function C(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return l.prototype=g.constructor=p,p.constructor=l,p[c]=l.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(b.prototype),b.prototype[a]=function(){return this},e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(s(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(g),g[c]="Generator",g[i]=function(){return this},g.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;w(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function Ze(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}var Xe=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Ze(i,r,o,a,c,"next",e)}function c(e){Ze(i,r,o,a,c,"throw",e)}a(void 0)}))}};var et=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},tt=function(){function t(n){var r=this;e(this,t),this._url=new URL("http://localhost"),Object.defineProperty(this,"href",{get:function(){return r._url.href.replace(/^http:/,r.protocol)},set:function(e){r._url.href=e.replace(/^\w+:/,"http:"),r.protocol=e.match(/^\w+:/)[0]}}),["host","pathname","password","searchParams","username"].forEach((function(e){Object.defineProperty(r,e,{get:function(){return r._url[e]},set:function(t){r._url[e]=t}})})),this.href=n}return S(t,[{key:"fromForm",value:function(e){var t=e.server.value;return e.nick.value.length&&this.searchParams.append("nick",e.nick.value),e.realname.value.length&&this.searchParams.append("realname",e.realname.value),this.searchParams.append("tls",e.tls.checked?"1":"0"),this.searchParams.append("tls_verify",e.tls_verify&&e.tls_verify.checked?"1":"0"),this.host=t.match(/:\d+$/)?t:t+":6667",this.password=e.password.value,this.username=e.username.value,this}},{key:"toString",value:function(){return this.href.replace(/^http:/,this.protocol)}}]),t}(),nt=n((function(e,t){var n;n=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function o(){}function i(t,n,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},o.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var c="";for(var s in i)i[s]&&(c+="; "+s,!0!==i[s]&&(c+="="+i[s].split(";")[0]));return document.cookie=t+"="+n+c}}function a(e,n){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],a=0;a<i.length;a++){var c=i[a].split("="),s=c.slice(1).join("=");n||'"'!==s.charAt(0)||(s=s.slice(1,-1));try{var u=t(c[0]);if(s=(r.read||r)(s,u)||t(s),n)try{s=JSON.parse(s)}catch(e){}if(o[u]=s,e===u)break}catch(e){}}return e?o[e]:o}}return o.set=i,o.get=function(e){return a(e,!1)},o.getJSON=function(e){return a(e,!0)},o.remove=function(t,n){i(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))},e.exports=n()})),rt=1e3,ot=1e6,it=1e3*ot;function at(e,t){for(;e;){if(t.tagName?e==t:e.matches&&e.matches(t))return e;e=e.parentNode}return null}function ct(e,t){var n=function n(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];var a=this;n.isQueued=!0,n.debounceTid&&clearTimeout(n.debounceTid),n.debounceTid=setTimeout((function(){e.apply(a,o),n.debounceTid=0}),t)};return n.debounceTid=0,n}function st(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"message",n=e.errors||e;return n&&n[0]?n[0][t]||"Unknown error.":""}function ut(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,r=Math.floor(6*e),o=6*e-r,i=n*(1-t),a=n*(1-o*t),c=n*(1-(1-o)*t),s=255,u=255,d=255;switch(r){case 0:s=n,u=c,d=i;break;case 1:s=a,u=n,d=i;break;case 2:s=i,u=n,d=c;break;case 3:s=i,u=a,d=n;break;case 4:s=c,u=i,d=n;break;case 5:s=n,u=i,d=a}return[Math.floor(255*s),Math.floor(255*u),Math.floor(255*d)]}function dt(e,t){var n=e<rt?[e,""]:e<ot?[e/rt,"k"]:e<it?[e/ot,"M"]:[e/it,"G"],r=String(Math.round(10*n[0])/10);return(r.match(/\./)?r:r+".0")+n[1]+(t||"")}function ft(e,t){return"array"==t?Array.isArray(e):"object"==t?"object"==r(e)&&null!==e:"undef"==t?null==e:r(e)==t}function lt(e){return Object.keys(e).filter((function(t){return e[t]})).sort().map((function(e){return"has-mode-"+e})).join(" ")}function pt(e,t,n){var r=":children"==t?e.children:e.querySelectorAll(t);if(!n)return[].slice.call(r,0);if(Array.isArray(n))return[].forEach.call(r,(function(e){return e.addEventListener(n[0],n[1])}));for(var o=[],i=0;i<r.length;i++)o.push(n(r[i],i));return o}function ht(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function mt(e,t,n){var r=document.querySelector(e);r.className=r.className.replace(t,(function(e,t){return t+n}))}function vt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(0==e.length)return"#000";for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+((n<<5)-n),n&=n;return"#"+ut(((n=Math.abs(n%t/t))+.618033988749)%1,.4,.7).map((function(e){return e.toString(16)})).join("")}function gt(e,t){return ft(t,"array")?t.find((function(t){return gt(e,t)}))||!1:e&&e.tagName&&e.tagName.toLowerCase()===t||!1}function yt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _t=function(){function t(){e(this,t),this.cookieName="convos_js",this._on={},this._props={}}return S(t,[{key:"emit",value:function(e){for(var t=this._on[e],n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(var i=0;i<(t||[]).length;i++){var a;(a=t[i])[0].apply(a,r)}return this}},{key:"on",value:function(e,t){var n=t?null:new Promise((function(e){t=e})),r=this._on[e]||(this._on[e]=[]),o=[t];r.push(o);var i=function(){var e=r.indexOf(o);-1!=e&&r.splice(e,1)};return n?n.finally(i):i}},{key:"prop",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=$t({},r,{defaultValue:n,name:t,type:e,value:n});switch(this._props[t]=o,o.updateable=-1!=["cookie","persist","rw"].indexOf(e),e){case"cookie":return this._cookieProp(o);case"persist":return this._localStorageProp(o);case"ro":return this._readOnlyProp(o);case"rw":return this._updateableProp(o)}throw"["+this.constructor.name+'] Unknown prop type "'+e+'" for prop "'+t+'".'}},{key:"subscribe",value:function(e){return e(this),this.on("update",e)}},{key:"update",value:function(e){var t=this;return Object.keys(e).forEach((function(n){var r=t._props[n];r&&(r.hasOwnProperty("prev")||(r.prev="ro"==r.type?void 0:r.value),r.updateable&&(r.value=e[n]))})),this._updatedTid||(this._updatedTid=setTimeout(this._delayedUpdate.bind(this),1)),this}},{key:"_cookie",value:function(e,t){var n=document.decodedB64JSONCookies||(document.decodedB64JSONCookies={});if(!n[this.cookieName])try{var r=nt.get(this.cookieName);n[this.cookieName]=JSON.parse(r?atob(r):"{}")}catch(t){console.error("[Reactive:cookie]",et({},e,t))}var o=n[this.cookieName]||{};if(1==arguments.length)return o[e];var i=this._props[e],a=i.key||e;t===i.defaultValue?delete o[a]:o[a]=t;var c=0==location.href.indexOf("https:");nt.set(this.cookieName,btoa(JSON.stringify(o)),{expires:365,SameSite:"Lax",secure:c})}},{key:"_cookieProp",value:function(e){var t=this._cookie(e.name);ft(t,"undef")||(e.value=t),ft(t,"undef")&&this._cookie(e.name,e.value),this._updateableProp(e)}},{key:"_delayedUpdate",value:function(){var e=this,t={};return Object.keys(this._props).forEach((function(n){var r=e._props[n];if(r.hasOwnProperty("prev")){var o=r.prev;delete r.prev,r.value!==o&&("cookie"==r.type&&e._cookie(n,r.value),"persist"==r.type&&e._localStorage(n,r.value),t[n]="ro"!=r.type)}})),delete this._updatedTid,Object.keys(t).length&&this.emit("update",this,t),t}},{key:"_localStorage",value:function(e,t){var n=this._props[e],r="convos:"+(n.key||e);if(2==arguments.length)return t===n.defaultValue?localStorage.removeItem(r):localStorage.setItem(r,JSON.stringify(t));try{return localStorage.hasOwnProperty(r)?JSON.parse(localStorage.getItem(r)):void 0}catch(e){return void console.error("[Reactive:localStorage]",et({},r,localStorage.getItem(r)),e)}}},{key:"_localStorageProp",value:function(e){var t=this._localStorage(e.name);ft(t,"undef")||(e.value=t),ft(t,"undef")&&this._localStorage(e.name,e.value),this._updateableProp(e)}},{key:"_readOnlyProp",value:function(e){if(void 0===e.value)throw"["+this.constructor.name+'] Read-only attribute "'+e.name+'" cannot be undefined';var t="function"==typeof e.value?e.value:function(){return e.value};Object.defineProperty(this,e.name,{get:t})}},{key:"_updateableProp",value:function(e){Object.defineProperty(this,e.name,{get:function(){return e.value}})}}]),t}();function wt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var kt=function(e,t){return e.name.localeCompare(t.name)},Ct=function(t){c(a,t);var n,r=(n=a,function(){var e,t=i(n);if(wt()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function a(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e(this,a),(t=r.call(this,n)).sorter=o.sorter||kt,t._sort(),t}return S(a,[{key:"filter",value:function(e){return Array.from(this.values()).filter(e)}},{key:"set",value:function(e,t){m(i(a.prototype),"set",this).call(this,e,t),this._sort()}},{key:"toArray",value:function(){return Array.from(this.values())}},{key:"_sort",value:function(){var e=this,t=Array.from(this.entries()),n=this.sorter;return this.clear(),t.sort((function(e,t){return n(e[1],t[1])})).forEach((function(t){var n=p(t,2),r=n[0],o=n[1];return m(i(a.prototype),"set",e).call(e,r,o)})),t}}]),a}(b(Map));function St(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var xt={0:"Jan",1:"Feb",2:"March",3:"Apr",4:"May",5:"Jun",6:"July",7:"Aug",8:"Sept",9:"Oct",10:"Nov",11:"Dec"},Et={H:"_getPaddedHours",M:"_getPaddedMinutes",S:"_getPaddedSeconds",b:"_getMonthAbbr",e:"getDate",Y:"getFullYear"},Rt=function(t){c(a,t);var n,r=(n=a,function(){var e,t=i(n);if(St()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function a(t){return e(this,a),"string"!=typeof t||t.match(/Z$/)||(t+="Z"),r.call(this,t||new Date)}return S(a,[{key:"format",value:function(e){var t=this;return e.replace(/%(\w)/g,(function(e,n){return Et[n]?t[Et[n]]():n}))}},{key:"getHumanDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.format("%b %e"),n=new a,r=this.getYear()==n.getYear();return r&&!e.year||(t+=", "+this.getFullYear()),t}},{key:"setDate",value:function(e,t){return t?m(i(a.prototype),"setUTCDate",this).call(this,e):m(i(a.prototype),"setDate",this).call(this,e),this}},{key:"setFullYear",value:function(e,t){return t?m(i(a.prototype),"setUTCFullYear",this).call(this,e):m(i(a.prototype),"setFullYear",this).call(this,e),this}},{key:"setHours",value:function(e,t){return t?m(i(a.prototype),"setUTCHours",this).call(this,e):m(i(a.prototype),"setHours",this).call(this,e),this}},{key:"setMilliseconds",value:function(e,t){return t?m(i(a.prototype),"setUTCMilliseconds",this).call(this,e):m(i(a.prototype),"setMilliseconds",this).call(this,e),this}},{key:"setMinutes",value:function(e,t){return t?m(i(a.prototype),"setUTCMinutes",this).call(this,e):m(i(a.prototype),"setMinutes",this).call(this,e),this}},{key:"setMonth",value:function(e,t){return t?m(i(a.prototype),"setUTCMonth",this).call(this,e):m(i(a.prototype),"setMonth",this).call(this,e),this}},{key:"setSeconds",value:function(e,t){return t?m(i(a.prototype),"setUTCSeconds",this).call(this,e):m(i(a.prototype),"setSeconds",this).call(this,e),this}},{key:"setTime",value:function(e){return m(i(a.prototype),"setTime",this).call(this,e),this}},{key:"setYear",value:function(e){return this.setYear(e),this}},{key:"toEpoch",value:function(){return this.getTime()/1e3}},{key:"_getMonthAbbr",value:function(){return xt[this.getMonth()]||""}},{key:"_getPaddedHours",value:function(){return String(this.getHours()).padStart(2,"0")}},{key:"_getPaddedMinutes",value:function(){return String(this.getMinutes()).padStart(2,"0")}},{key:"_getPaddedSeconds",value:function(){return String(this.getSeconds()).padStart(2,"0")}}]),a}(b(Date));function Tt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Ot=function(t){c(a,t);var n,r=(n=a,function(){var e,t=i(n);if(Tt()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function a(t){var n;return e(this,a),(n=r.call(this)).prop("ro","api",t.api),n.prop("ro","defaultParams",t.defaultParams||{}),n.prop("ro","id",t.id),n.prop("ro","req",{body:null,headers:{}}),n.prop("ro","res",{body:{},headers:{}}),n.prop("rw","err",null),n.prop("rw","status","pending"),n}return S(a,[{key:"error",value:function(e,t){if(e)return this.update({err:Array.isArray(e)?e:[{message:e,source:t}],status:"error"});if(!this.err||!this.err.length)return"";var n=this.err[0],r=n.path&&n.path.match(/\w$/)&&n.path.split("/").pop();return r?r+": "+n.message:n.message}},{key:"perform",value:function(e){var t=this;return this._promise||(this._promise=new Promise((function(n){t.api.spec(t.id).then((function(n){if(!n)throw'Unknown operationId "'+t.id+'".';var r=t._paramsToRequest(n,e||t.defaultParams),o=p(r,2),i=o[0],a=o[1];if(!i)throw a;return t.update({status:"loading"}).emit("start",a),ft(a.body,"object")&&"function"!=typeof a.body.has&&(a.body=JSON.stringify(a.body)),fetch(i,a)})).then((function(e){return Promise.all([e,e.json()])})).then((function(e){var r=p(e,2),o=r[0],i=r[1];delete t._promise,n(t.parse(o,i))})).catch((function(e){delete t._promise,n(t.error(Array.isArray(e)?e:'Failed fetching operationId "'+t.id+'": '+e,"fetch"))}))})))}},{key:"is",value:function(e){return this.status==e}},{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.body;this.res.body=t||e,this.res.status=e.status||"201",e.headers&&(this.res.headers=e.headers);var n=null;return String(this.res.status).match(/^[23]/)||(n=t&&t.errors?t.errors:[{message:e.statusText||"Unknown error."}]),this.update({err:n,status:n?"error":"success"})}},{key:"reset",value:function(){return this.res.body={},this.res.headers={},this.res.status=0,this.update({err:null,status:"pending"})}},{key:"_extractValue",value:function(e,t){if(t.schema&&"form"==(e.tagName||"").toLowerCase())return Object.keys(t.schema.properties).reduce((function(t,n){var r=e[n];return r&&("checkbox"!=r.type||r.checked)?(t[n]=r.value,t):t}),{});if(e[t.name]&&e[t.name].tagName)return e[t.name].value;if(t.schema){var n={};return Object.keys(t.schema.properties).forEach((function(t){n[t]=e[t]})),n}return e[t.name]}},{key:"_hasProperty",value:function(e,t){return"body"==t.in||("formData"==t.in?e.formData.has(t.name):"form"==(e.tagName||"").toLowerCase()?!!e[t.name]:e.hasOwnProperty(t.name))}},{key:"_paramsToRequest",value:function(e,t){var n=this,r={headers:this.req.headers,method:e.method},o=new URL(e.url),i=[];return(e.parameters||[]).forEach((function(e){if(!n._hasProperty(t,e)&&e.required)i.push({message:"Missing property.",path:"/"+e.name});else{if(!n._hasProperty(t,e)&&!e.required)return;if("path"==e.in){var a=new RegExp("(%7B|\\{)"+ht(e.name)+"(%7D|\\})","i");o.pathname=o.pathname.replace(a,encodeURIComponent(n._extractValue(t,e)))}else if("query"==e.in)o.searchParams.set(e.name,n._extractValue(t,e));else if("formData"==e.in)delete r.headers["Content-Type"],r.body=t.formData;else if("body"==e.in)r.body=n._extractValue(t,e);else{if("header"!=e.in)throw"[Api] Parameter in:"+e.in+" is not supported.";r.header[e.name]=n._extractValue(t,e.name)}}})),i.length?[null,i]:[o,r]}}]),a}(_t);function Pt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Dt=function e(t,n,r){var o=e.singletons[t]||(e.singletons[t]=new Mt);return n?o.operation(n,r):o};Dt.singletons={};var Mt=function(t){c(s,t);var n,r,a=(n=s,function(){var e,t=i(n);if(Pt()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function s(){var t;return e(this,s),(t=a.call(this)).prop("rw","protocol",location.protocol||"http"),t.prop("rw","url",""),t}return S(s,[{key:"operation",value:function(e,t){var n=new Ot({api:this,id:e,defaultParams:t});return n.req.headers={"Content-Type":"application/json"},n}},{key:"spec",value:(r=Xe(Qe.mark((function e(t){var n,r,o=this;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ops||!t){e.next=2;break}return e.abrupt("return",this._ops[t]);case 2:if(!this._spec){e.next=4;break}return e.abrupt("return",this._spec);case 4:return e.next=6,fetch(this.url);case 6:return n=e.sent,e.next=9,n.json();case 9:if(r=e.sent,this._ops={},this._spec=r,Object.keys(r.paths).forEach((function(e){Object.keys(r.paths[e]).forEach((function(t){var n=r.paths[e][t],i=n.operationId;i&&(n.method=t.toUpperCase(),n.url=o.protocol+"//"+r.host+r.basePath+e+".json",n.parameters=(n.parameters||[]).map((function(e){return o._resolveRef(e)})),o._ops[i]=n)}))})),!this._ops||!t){e.next=15;break}return e.abrupt("return",this._ops[t]);case 15:if(!this._spec){e.next=17;break}return e.abrupt("return",this._spec);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"toFunction",value:function(){var e=this;return function(t,n){return t?e.operation(t,n):e}}},{key:"_resolveRef",value:function(e){var t=this,n=e;if(e.$ref){var r=e.$ref.replace(/^#\//,"").split("/");for(n=this._spec;r.length;)n=n[r.shift()]}return ft(n,"object")&&Object.keys(n).forEach((function(e){n[e]=t._resolveRef(n[e])})),n}}]),s}(_t),Nt={b:"channel_ban",C:"ctcp_block",c:"colour_filter",e:"ban_exemption",F:"enable_forwarding",f:"forward",g:"free_invite",I:"invite_exemption",j:"join_throttle",k:"password",l:"join_limit",L:"large_ban_list",m:"moderated",n:"prevent_external_send",P:"permanent",p:"privat",Q:"block_forwarded_users",q:"quiet",r:"block_unidentified",s:"secret",S:"secure_connection_only",t:"ops_topic"},jt={a:"&",h:"%",o:"@",q:"~",v:"+"},At={a:"admin",B:"bot",h:"half_operator",i:"invisible",I:"whois_hide_online",o:"operator",p:"whois_hide_channels",R:"privmsg_from_registered_only",r:"registered",S:"service_bot",T:"ctcp_block",t:"vhost",v:"voice",W:"whois_notifications",x:"cloaked_hostname",z:"secure_connection",Z:"secure_connection_only"},Lt=function(){var e={base:"https://twemoji.maxcdn.com/v/12.1.5/",ext:".png",size:"72x72",className:"emoji",convert:{fromCodePoint:function(e){var t="string"==typeof e?parseInt(e,16):e;if(t<65536)return c(t);return c(55296+((t-=65536)>>10),56320+(1023&t))},toCodePoint:v},onerror:function(){this.parentNode&&this.parentNode.replaceChild(s(this.alt,!1),this)},parse:function(t,n){n&&"function"!=typeof n||(n={callback:n});return("string"==typeof t?l:f)(t,{callback:n.callback||u,attributes:"function"==typeof n.attributes?n.attributes:h,base:"string"==typeof n.base?n.base:e.base,ext:n.ext||e.ext,size:n.folder||(r=n.size||e.size,"number"==typeof r?r+"x"+r:r),className:n.className||e.className,onerror:n.onerror||e.onerror});var r},replace:m,test:function(e){n.lastIndex=0;var t=n.test(e);return n.lastIndex=0,t}},t={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},n=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,r=/\uFE0F/g,o=String.fromCharCode(8205),i=/[&<>'"]/g,a=/^(?:iframe|noframes|noscript|script|select|style|textarea)$/,c=String.fromCharCode;return e;function s(e,t){return document.createTextNode(t?e.replace(r,""):e)}function u(e,t){return"".concat(t.base,t.size,"/",e,t.ext)}function d(e){return v(e.indexOf(o)<0?e.replace(r,""):e)}function f(e,t){for(var r,o,i,c,u,f,l,p,h,m,v,g,y,b=function e(t,n){for(var r,o,i=t.childNodes,c=i.length;c--;)3===(o=(r=i[c]).nodeType)?n.push(r):1!==o||"ownerSVGElement"in r||a.test(r.nodeName.toLowerCase())||e(r,n);return n}(e,[]),$=b.length;$--;){for(i=!1,c=document.createDocumentFragment(),f=(u=b[$]).nodeValue,p=0;l=n.exec(f);){if((h=l.index)!==p&&c.appendChild(s(f.slice(p,h),!0)),g=d(v=l[0]),p=h+v.length,y=t.callback(g,t),g&&y){for(o in(m=new Image).onerror=t.onerror,m.setAttribute("draggable","false"),r=t.attributes(v,g))r.hasOwnProperty(o)&&0!==o.indexOf("on")&&!m.hasAttribute(o)&&m.setAttribute(o,r[o]);m.className=t.className,m.alt=v,m.src=y,i=!0,c.appendChild(m)}m||c.appendChild(s(v,!1)),m=null}i&&(p<f.length&&c.appendChild(s(f.slice(p),!0)),u.parentNode.replaceChild(c,u))}return e}function l(e,t){return m(e,(function(e){var n,r,o=e,a=d(e),c=t.callback(a,t);if(a&&c){for(r in o="<img ".concat('class="',t.className,'" ','draggable="false" ','alt="',e,'"',' src="',c,'"'),n=t.attributes(e,a))n.hasOwnProperty(r)&&0!==r.indexOf("on")&&-1===o.indexOf(" "+r+"=")&&(o=o.concat(" ",r,'="',n[r].replace(i,p),'"'));o=o.concat("/>")}return o}))}function p(e){return t[e]}function h(){return null}function m(e,t){return String(e).replace(n,t)}function v(e,t){for(var n=[],r=0,o=0,i=0;i<e.length;)r=e.charCodeAt(i++),o?(n.push((65536+(o-55296<<10)+(r-56320)).toString(16)),o=0):55296<=r&&r<=56319?o=r:n.push(r.toString(16));return n.join(t||"-")}}(),It=Object.prototype.hasOwnProperty,Ut=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),zt=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n},Bt={arrayToObject:zt,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],o=0;o<t.length;++o)for(var i=t[o],a=i.obj[i.prop],c=Object.keys(a),s=0;s<c.length;++s){var u=c[s],d=a[u];"object"===r(d)&&null!==d&&-1===n.indexOf(d)&&(t.push({obj:a,prop:u}),n.push(d))}return function(e){for(var t;e.length;){var n=e.pop();if(t=n.obj[n.prop],Array.isArray(t)){for(var r=[],o=0;o<t.length;++o)void 0!==t[o]&&r.push(t[o]);n.obj[n.prop]=r}}return t}(t)},decode:function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},encode:function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),n="",r=0;r<t.length;++r){var o=t.charCodeAt(r);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?n+=t.charAt(r):o<128?n+=Ut[o]:o<2048?n+=Ut[192|o>>6]+Ut[128|63&o]:o<55296||o>=57344?n+=Ut[224|o>>12]+Ut[128|o>>6&63]+Ut[128|63&o]:(r+=1,o=65536+((1023&o)<<10|1023&t.charCodeAt(r)),n+=Ut[240|o>>18]+Ut[128|o>>12&63]+Ut[128|o>>6&63]+Ut[128|63&o])}return n},isBuffer:function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,n,o){if(!n)return t;if("object"!==r(n)){if(Array.isArray(t))t.push(n);else{if("object"!==r(t))return[t,n];(o.plainObjects||o.allowPrototypes||!It.call(Object.prototype,n))&&(t[n]=!0)}return t}if("object"!==r(t))return[t].concat(n);var i=t;return Array.isArray(t)&&!Array.isArray(n)&&(i=zt(t,o)),Array.isArray(t)&&Array.isArray(n)?(n.forEach((function(n,i){It.call(t,i)?t[i]&&"object"===r(t[i])?t[i]=e(t[i],n,o):t.push(n):t[i]=n})),t):Object.keys(n).reduce((function(t,r){var i=n[r];return It.call(t,r)?t[r]=e(t[r],i,o):t[r]=i,t}),i)}},Ft=(String.prototype.replace,Date.prototype.toISOString,Object.prototype.hasOwnProperty),Ht={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:Bt.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},qt=function(e,t,n){if(e){var r=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,i=/(\[[^[\]]*])/.exec(r),a=i?r.slice(0,i.index):r,c=[];if(a){if(!n.plainObjects&&Ft.call(Object.prototype,a)&&!n.allowPrototypes)return;c.push(a)}for(var s=0;null!==(i=o.exec(r))&&s<n.depth;){if(s+=1,!n.plainObjects&&Ft.call(Object.prototype,i[1].slice(1,-1))&&!n.allowPrototypes)return;c.push(i[1])}return i&&c.push("["+r.slice(i.index)+"]"),function(e,t,n){for(var r=t,o=e.length-1;o>=0;--o){var i,a=e[o];if("[]"===a)i=(i=[]).concat(r);else{i=n.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,s=parseInt(c,10);!isNaN(s)&&a!==c&&String(s)===c&&s>=0&&n.parseArrays&&s<=n.arrayLimit?(i=[])[s]=r:i[c]=r}r=i}return r}(c,t,n)}},Gt=function(e,t){var n=t?Bt.assign({},t):{};if(null!==n.decoder&&void 0!==n.decoder&&"function"!=typeof n.decoder)throw new TypeError("Decoder has to be a function.");if(n.ignoreQueryPrefix=!0===n.ignoreQueryPrefix,n.delimiter="string"==typeof n.delimiter||Bt.isRegExp(n.delimiter)?n.delimiter:Ht.delimiter,n.depth="number"==typeof n.depth?n.depth:Ht.depth,n.arrayLimit="number"==typeof n.arrayLimit?n.arrayLimit:Ht.arrayLimit,n.parseArrays=!1!==n.parseArrays,n.decoder="function"==typeof n.decoder?n.decoder:Ht.decoder,n.allowDots="boolean"==typeof n.allowDots?n.allowDots:Ht.allowDots,n.plainObjects="boolean"==typeof n.plainObjects?n.plainObjects:Ht.plainObjects,n.allowPrototypes="boolean"==typeof n.allowPrototypes?n.allowPrototypes:Ht.allowPrototypes,n.parameterLimit="number"==typeof n.parameterLimit?n.parameterLimit:Ht.parameterLimit,n.strictNullHandling="boolean"==typeof n.strictNullHandling?n.strictNullHandling:Ht.strictNullHandling,""===e||null==e)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof e?function(e,t){for(var n={},r=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=t.parameterLimit===1/0?void 0:t.parameterLimit,i=r.split(t.delimiter,o),a=0;a<i.length;++a){var c,s,u=i[a],d=u.indexOf("]="),f=-1===d?u.indexOf("="):d+1;-1===f?(c=t.decoder(u,Ht.decoder),s=t.strictNullHandling?null:""):(c=t.decoder(u.slice(0,f),Ht.decoder),s=t.decoder(u.slice(f+1),Ht.decoder)),Ft.call(n,c)?n[c]=[].concat(n[c]).concat(s):n[c]=s}return n}(e,n):e,o=n.plainObjects?Object.create(null):{},i=Object.keys(r),a=0;a<i.length;++a){var c=i[a],s=qt(c,r[c],n);o=Bt.merge(o,s,n)}return Bt.compact(o)};function Wt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Kt=new(function(n){c(u,n);var a,s=(a=u,function(){var e,t=i(a);if(Wt()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function u(){var n;return e(this,u),(n=s.call(this)).prop("ro","basePath",(function(){return n._basePath})),n.prop("ro","hash",(function(){return(n._location.hash||"").replace(/^#/,"")})),n.prop("ro","path",(function(){return n._path})),n.prop("ro","params",(function(){return n._params})),n.prop("ro","query",(function(){return n._query})),n.prop("rw","activeMenu",""),n.prop("rw","baseUrl",""),n.prop("rw","component",null),n.prop("rw","match",""),n.prop("rw","requireLogin",!1),n.prop("rw","state",{}),n.prop("rw","title",document.title||""),n.prop("persist","lastUrl",""),n._history=window.history,n._location=window.location,n._onClick=n._onClick.bind(t(n)),n._onpopstate=n._onpopstate.bind(t(n)),n._basePath="",n._params={},n._path="/",n._query={},n._routes=[],n}return S(u,[{key:"conversationPath",value:function(e){var t=["","chat"];return e.connection_id&&t.push(e.connection_id),e.conversation_id&&t.push(e.conversation_id),t.map((function(e){return encodeURIComponent(e)})).join("/")}},{key:"go",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.replace){var r=[!0,this.state];n=r[0],t=r[1]}0==e.indexOf(this.baseUrl)&&(e=e.substr(this.baseUrl.length));var o=this.baseUrl+e;if(o==this._location.href)return this;this._history[n?"replaceState":"pushState"](t,this.title,o),this.render(o,t)}},{key:"param",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.params;if(n.hasOwnProperty(e))return n[e];var r=this.query;return r.hasOwnProperty(e)?r[e]:t}},{key:"render",value:function(e,t){var n=this;this._started||(window.addEventListener("click",this._onClick),window.addEventListener("popstate",this._onpopstate),this._started=!0),e||(e=this._location.href),t||(t=this.state),this._urlToProps(e),this._params={};for(var o=function(e){var r=n._routes[e],o=n._path.match(r.re);if(!o)return"continue";for(var i=0;i<r.names.length;i++)n._params[r.names[i]]=decodeURIComponent(o[i+1]);n.update({activeMenu:"",match:r.path,state:t}),r.cb(n);var a=document.createEvent("CustomEvent");return a.initCustomEvent("routerender",!1,!1,{}),setTimeout((function(){return document.dispatchEvent(a)}),1),{v:n}},i=0;i<this._routes.length;i++){var a=o(i);switch(a){case"continue":continue;default:if("object"===r(a))return a.v}}throw console.log({abs:e,routes:this._routes}),'[Route] No route for "'+e+'".'}},{key:"subscribe",value:function(e){return e(this),this.on("update",e)}},{key:"to",value:function(e,t){var n=[],r=[];e.split("/").forEach((function(e,t){var o=e;0==e.indexOf("*")?(o="(.*)",n.push(String(e.slice(1)||t))):0==e.indexOf(":")&&(o="([^/]+)",n.push(String(e.slice(1)||t))),r.push(o)})),this._routes.push({cb:t,names:n,path:e,re:new RegExp("^"+r.join("/")+"$")})}},{key:"update",value:function(e){return e.baseUrl&&(e.baseUrl=e.baseUrl.replace(/\/+$/,""),this._basePath=new URL(e.baseUrl).pathname.replace(/\/+$/,"")),m(i(u.prototype),"update",this).call(this,e),e.baseUrl&&this._urlToProps(location.href),this}},{key:"urlFor",value:function(e){return e.match(/^\w+:/)||e.match(/^#/)?e:this.basePath+e}},{key:"urlToForm",value:function(e){var t=this;Object.keys(this.query).forEach((function(n){var r=t.query[n],o=e[n];o&&o.tagName&&("checkbox"==o.type?o.checked=!!r:o.value=r,o.syncValue&&o.syncValue())}))}},{key:"wsUrlFor",value:function(e){return(e.match(/^\w+:/)?e:this.baseUrl+e).replace(/^http/,"ws")}},{key:"_onClick",value:function(e){if(!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){var t=e.target&&e.target.closest("a");if(t&&t.href){if("_self"==t.target)if((0==t.href.indexOf("/")?this.baseUrl+t.href:t.href)==location.href)return location.reload();if(!t.hasAttribute("download")&&!t.hasAttribute("target")){var n=t&&t.href.match(/#activeMenu:(\w*)/);if(n){if(at(e.target,".sidebar-left")&&!t)return;this.update({activeMenu:n[1]==this.activeMenu?"":n[1]}),e.preventDefault()}var r=t.getAttribute("href")||"";0==r.indexOf(this.baseUrl)&&(r=r.substr(this.baseUrl.length)),0==r.indexOf(this.basePath)&&(r=r.substr(this.basePath.length)),0==r.indexOf("/")&&(this.go(r,{},t.hasAttribute("replace")),e.preventDefault())}}}}},{key:"_onpopstate",value:function(e){this.render(this._location.href,e.state)}},{key:"_pathWithoutPrefix",value:function(e){return 0==e.indexOf(this.basePath)?e.substr(this.basePath.length):e}},{key:"_urlToProps",value:function(e){var t=e.substr(this.baseUrl.length).split("#")[0].split("?");this._query=2==t.length?Gt(t.pop()):{},this._path=t[0]}}]),u}(_t)),Vt={},Jt={},Yt=new RegExp("\\b[a-z]{2,5}://\\S+","g"),Qt={":confused:":":/",":disappointed:":":(",":grin:":";D",":heart:":"&lt;3",":slight_smile:":":)",":smiley:":":D",":stuck_out_tongue:":":P",":wink:":";)"},Zt=new RegExp("(^|\\s)(:\\w+:|"+Object.keys(Qt).map((function(e){return ht(Qt[e])})).join("|")+")(?=\\W|$)","gi");function Xt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single";return window.__emojiList&&(window.__emojiList.forEach((function(e){if(":"==(e.shortname||"")[0]){if(Qt[e.shortname]&&(Jt[Qt[e.shortname]]=e),Jt[e.shortname]=e,e.category){var t=":"+e.category;Vt[t]||(Vt[t]=[]),Vt[t].push(e)}e.shortname.match(/(_|:)\w/g).forEach((function(t){Vt[t]||(Vt[t]=[]),Vt[t].push(e)})),delete e.category,delete e.html,delete e.order,delete e.unicode}})),delete window.__emojiList),"group"==t?Vt[e]||[]:Jt[e]||{}}function en(e){var t={};return[sn,an,cn,nn,on,rn,tn].forEach((function(n){e=n(e,t)})),e}function tn(e){return e.replace(/^&gt;\s(.*)/,(function(e,t){return"<blockquote>"+t+"</blockquote>"}))}function nn(e){return e.replace(/(\\?)`([^`]+)`/g,(function(e,t,n){return t?e.replace(/^\\/,""):"<code>"+n+"</code>"}))}function rn(e){return Lt.parse(e.replace(Zt,(function(e,t,n){return t+(Xt(n).emoji||n)})))}function on(e){return e.replace(/(^|\s)(\\?)(\*+)(\w[^<]*?)\3/g,(function(e,t,n,r,o){return 1==r.length?n?e.replace(/^\\/,""):t+"<em>"+o+"</em>":2==r.length?n?e.replace(/^\\/,""):t+"<strong>"+o+"</strong>":3==r.length?n?e.replace(/^\\/,""):t+"<em><strong>"+o+"</strong></em>":e}))}function an(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.replace(/\[([a-zA-Z][^\]]+)\]\(([^)]+)\)/g,(function(e,n,r){var o=r.match(/^\s*(\w+):/)||["",""];if(o[1]&&-1==["http","https","mailto"].indexOf(o[1]))return e;t.mdLinks=!0;var i=r.substring(0,1),a=-1!=["/","#"].indexOf(i)?"":' target="_blank"';return'<a href="'+Kt.urlFor(r)+'"'+a+">"+n+"</a>"}))}function cn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.mdLinks?e:e.replace(Yt,(function(e){var t=e.match(/^(.*?)(&\w+;|\W)?$/);return'<a href="'+t[1]+'" target="_blank">'+t[1]+"</a>"+(t[2]||"")})).replace(/mailto:(\S+)/,(function(e,t){return-1!=e.indexOf('">')?e:'<a href="'+e+'" target="_blank">'+t+"</a>"}))}function sn(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))}var un={en:{"Test %1":"Test %1"}};function dn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=String(un.en[e]||e);return o.replace(/(%?)%(\d+)/g,(function(e,t,r){return"%"==t?t+r:n[r-1]}))}function fn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return en(dn.apply(void 0,[e].concat(n)))}function ln(e,t){return t.is("not_found")?"":e.frozen?dn(e.frozen):e==t?dn("Connection messages."):(t.frozen?dn(t.frozen):t.topic)||t.is_private&&dn("Private conversation.")||dn("No topic is set.")}function pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pn(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var vn=new(function(t){c(a,t);var n,r=(n=a,function(){var e,t=i(n);if(mn()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function a(){var t;return e(this,a),(t=r.call(this)).Notification=window.Notification||{permission:"denied"},t.prop("persist","notificationCloseDelay",5e3),t.prop("persist","wantNotifications",null),t.prop("ro","appHasFocus",(function(){return document.hasFocus()})),t.prop("rw","desktopAccess",t.Notification.permission),t}return S(a,[{key:"requestDesktopAccess",value:function(){var e=this;return this.Notification.requestPermission?(this.Notification.requestPermission((function(t){return e.update({desktopAccess:t})})),this):this.update({desktopAccess:this.Notification.permission})}},{key:"show",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.title||(n.title=document.title),!this.wantNotifications)return this._showInConsole(e,n);if("granted"!=this.desktopAccess)return this.showInApp(e,n);var r=new Notification(n.title,hn({},n,{body:e}));return r.onclick=function(e){return t._onClick(e,r,n)},setTimeout((function(){return r.close()}),this.notificationCloseDelay),r}},{key:"showInApp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.title||(t.title=document.title);var n=document.createElement("div"),r=hn({},t,{body:e,close:function(){n.remove(),r.closed=!0},target:"app"});return n.className="notify-notification fade-in",n.innerHTML='<a href="#close" class="notify-notification__close"></a><h6 class="notify-notification__title"></h6><div class="notify-notification__content"></div>',n.querySelector("a").addEventListener("click",(function(e){e.preventDefault(),r.close()})),n.querySelector("h6").textContent=t.title,n.querySelector("div").textContent=e,-1==t.closeAfter?n.querySelector("a").remove():setTimeout((function(){return r.close()}),t.closeAfter||this.notificationCloseDelay),setTimeout((function(){return n.classList.add("is-visible")}),1),document.body.insertBefore(n,document.body.querySelector(".notify-notification")),r}},{key:"_onClick",value:function(e,t,n){t.close(),window.focus(),this.emit("click",hn({},n,{sourceEvent:e}))}},{key:"_showInConsole",value:function(e,t){return console.info("[Notify]",e,t),hn({},t,{body:e,close:function(){},target:"console"})}}]),a}(_t));function gn(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return yn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yn(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var _n=function e(t){return e.singletons[t]||(e.singletons[t]=new kn)};_n.singletons={};var wn=[];wn[WebSocket.CONNECTING]="connecting",wn[WebSocket.OPEN]="open",wn[WebSocket.CLOSING]="closing",wn[WebSocket.CLOSED]="closed";var kn=function(t){c(a,t);var n,r=(n=a,function(){var e,t=i(n);if($n()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function a(t){var n;return e(this,a),(n=r.call(this)).prop("persist","debug",""),n.prop("ro","readyState",(function(){return n.ws.readyState})),n.prop("ro","readyStateHuman",(function(){return wn[n.ws.readyState]})),n.prop("ro","waiting",new Map),n.prop("rw","closed",0),n.prop("rw","error",""),n.prop("rw","keepaliveInterval",1e4),n.prop("rw","url",""),n.id=0,n.queue=[],n.keepClosed=!0,n._resetWebSocket(),n}return S(a,[{key:"close",value:function(e,t){if("number"!=typeof e){var n=[1e3,e];e=n[0],t=n[1]}return this.ws.close&&this.ws.close(e,t),this.keepClosed=!0,this._keepAliveStop(),this._reconnectStop(),this._resetWebSocket(),this}},{key:"deflateMessage",value:function(e){return JSON.stringify(e)}},{key:"deleteWaitingMessage",value:function(e){this.waiting.delete(e),this.update({waiting:!0})}},{key:"getWaitingMessages",value:function(e){var t=this;return 0==arguments.length?Array.from(this.waiting.values()):e.map((function(e){return t.waiting.get(e)}))}},{key:"inflateMessage",value:function(e){return JSON.parse(e)}},{key:"is",value:function(e){return this.ws.readyState==WebSocket[e.toUpperCase()]}},{key:"open",value:function(){var e=this;if(this.ws.close)return this;try{if(!this.url)throw"Can't open WebSocket connection without URL.";this.ws=new WebSocket(this.url),this.ws.onclose=function(t){return e._onClose(t)},this.ws.onerror=function(t){return e._onError(t)},this.ws.onmessage=function(t){return e._onMessage(t)},this.ws.onopen=function(t){return e._onOpen(t)},this.keepClosed=!1,this._keepAliveStart(),this._reconnectStop(),this.update({error:"",readyState:!0})}catch(e){this._onError(e.message?e:{message:String(e)})}return this}},{key:"reconnectIn",value:function(e){return 1008!==e.code&&1011!==e.code&&(this.closed<=1?1e3:this.closed>5?1e4:2*this.closed*1e3)}},{key:"send",value:function(e){var t=e.id||String(++this.id);return this.queue.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bn(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{id:t})),this.open(),this._dequeue(),this.on("message_"+t)}},{key:"_dequeue",value:function(){var e=this.queue;for(e.length&&this.update({waiting:!0});e.length;){if(this.ws.readyState!=WebSocket.OPEN)return;var t=e.shift();this.ws.send(this.deflateMessage(t)),t.waitingForResponse=!0,t.ts||(t.ts=new Rt),this.waiting.set(t.id,t)}}},{key:"_keepAliveStart",value:function(){var e=this;this._keepAliveStop(),this.keepaliveTid=setInterval((function(){return e.ws.readyState==WebSocket.OPEN&&e.ws.send("{}")}),this.keepaliveInterval)}},{key:"_keepAliveStop",value:function(){this.keepaliveTid&&clearTimeout(this.keepaliveTid),delete this.keepaliveTid}},{key:"_onClose",value:function(e){this.debug&&console.log("[Socket:close]",(new Rt).toISOString(),e);var t,n=gn(this.waiting);try{for(n.s();!(t=n.n()).done;){var r=p(t.value,2),o=r[0],i=r[1];Object.keys(i).length<=1&&this.waiting.delete(o),i.waitingForResponse=!1}}catch(e){n.e(e)}finally{n.f()}this._keepAliveStop(),this._resetWebSocket(),this.update({closed:this.closed+1,readyState:!0,waiting:!0}),this._reconnectStart(this.reconnectIn(e))}},{key:"_onError",value:function(e){var t=String(e.message||e);t&&0!=t.indexOf("[")||(t="Could not connect."),this.debug&&console.log("[Socket:error]",(new Rt).toISOString(),t,e),this.update({error:t})}},{key:"_onMessage",value:function(e){var t=this.inflateMessage(e.data);if(t.id&&(this.emit("message_"+t.id,t),this.waiting.delete(t.id)),this.emit("message",t),this.update({waiting:!0}),t.errors&&!t.id){var n,r=gn(this.waiting.keys());try{for(r.s();!(n=r.n()).done;){var o=n.value;this.emit("message_"+o,t)}}catch(e){r.e(e)}finally{r.f()}this.waiting.clear()}}},{key:"_onOpen",value:function(e){this.debug&&console.log("[Socket:open]",(new Rt).toISOString(),e),this.update({closed:0,error:"",readyState:!0}),this._dequeue()}},{key:"_reconnectStart",value:function(e){var t=this;return this._reconnectStop(),this.debug&&console.log("[Socket:reconnect]",(new Rt).toISOString(),e),!0===e?this.open():"number"!=typeof e?this.keepClosed=!0:void(this.reconnectTid=setTimeout((function(){return t.open()}),e))}},{key:"_reconnectStop",value:function(){this.reconnectTid&&clearTimeout(this.reconnectTid),delete this.reconnectTid}},{key:"_resetWebSocket",value:function(){this.ws={readyState:WebSocket.CLOSED}}}]),a}(_t);function Cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cn(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var En=new RegExp("^[#&]"),Rn=function(e,t){return t.modes.operator||!1-e.modes.operator||t.modes.voice||!1-e.modes.voice||e.name.localeCompare(t.name)},Tn=0,On=function(t){c(u,t);var n,r,a,s=(n=u,function(){var e,t=i(n);if(xn()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function u(t){var n;return e(this,u),(n=s.call(this)).prop("ro","_participants",new Ct([],{sorter:Rn})),n.prop("ro","color",vt(t.conversation_id||t.connection_id||"")),n.prop("ro","connection_id",t.connection_id||""),n.prop("ro","is_private",(function(){return n.conversation_id&&!En.test(n.name)})),n.prop("ro","nParticipants",(function(){return n.participants().length})),n.prop("ro","path",Kt.conversationPath(t)),n.prop("rw","errors",0),n.prop("rw","historyStartAt",null),n.prop("rw","historyStopAt",null),n.prop("rw","messages",[]),n.prop("rw","modes",{}),n.prop("rw","name",t.name||t.conversation_id||t.connection_id||"ERR"),n.prop("rw","status","pending"),n.prop("rw","topic",t.topic||""),n.prop("rw","unread",t.unread||0),t.hasOwnProperty("conversation_id")?(n.prop("ro","conversation_id",t.conversation_id),n.prop("ro","title",(function(){return[n.name,n.connection_id].join(" - ")})),n.prop("rw","frozen",t.frozen||"")):(n.prop("ro","frozen",(function(){return n._calculateFrozen()})),n.prop("ro","title",(function(){return n.name}))),t.conversation_id&&(n.prop("persist","wantNotifications",n.is_private,{key:t.conversation_id+":wantNotifications"}),n.prop("rw","userInput","")),n.socket=t.socket||_n("/events"),n._addOperations(),n}return S(u,[{key:"addMessage",value:function(e){return this._maybeIncreaseUnread(e),this._maybeNotify(e),this.addMessages("push",[e])}},{key:"addMessages",value:function(e,t){var n=0,r=t.length;switch(e){case"push":n=this.messages.length,r=(t=this.messages.concat(t)).length;break;case"unshift":t=t.concat(this.messages)}for(var o=n;o<r;o++){var i=t[o];if(!i.hasOwnProperty("markdown")){if(!i.from){var a=[!0,this.connection_id||"Convos","Convos"];i.internal=a[0],i.from=a[1],i.fromId=a[2]}i.fromId||(i.fromId=i.from.toLowerCase()),i.type||(i.type="notice"),i.vars&&(i.message=dn.apply(void 0,[i.message].concat(k(i.vars)))),i.id="msg_"+ ++Tn,i.color="Convos"==i.fromId?"inherit":vt(i.from.toLowerCase()),i.ts=new Rt(i.ts),i.embeds=(i.message.match(/https?:\/\/(\S+)/g)||[]).map((function(e){return e.replace(/(\W)?$/,"")})),i.markdown=en(i.message)}}return this.update({messages:t}),this}},{key:"is",value:function(e){return"connection"==e?!this.conversation_id:"conversation"==e?this.conversation_id&&!this.is("notifications"):"frozen"==e?this.frozen&&!0:"locked"==e?"Invalid password."==this.frozen:"not_found"==e?"Not found."==this.frozen:"notifications"!=e&&("private"==e?this.is_private:"search"!=e&&("unread"==e?this.unread&&!0:this.status==e))}},{key:"load",value:(a=Xe(Qe.mark((function e(){var t,n,r,o=arguments;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},!this._skipLoad(t)){e.next=3;break}return e.abrupt("return",this);case 3:return this.update({status:"loading"}),t.limit||(t.limit=t.around?30:40),e.next=7,this.messagesOp.perform(Sn({},t,{connection_id:this.connection_id,conversation_id:this.conversation_id}));case 7:return this.update({status:this.messagesOp.status}),n=this.messagesOp.res.body,r=[],(t.around||!t.after&&!t.before)&&(r.push.apply(r,this.messages.filter((function(e){return e.internal}))),this.update({messages:[]})),this.addMessages(t.before?"unshift":"push",n.messages||[]),this.addMessages("push",r),this._setEndOfStream(t,n),e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"findParticipant",value:function(e){return this._participants.get(this._participantId(ft(e,"undef")?"":e))}},{key:"participants",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.forEach((function(t){t.nick||(t.nick=t.name||"");var n=e._participantId(t.nick),r=e._participants.get(n);r&&(Object.keys(t).forEach((function(e){r[e]=t[e]})),t=r),t.modes||(t.modes={}),e._calculateModes(At,t.mode,t.modes),e._participants.set(n,Sn({name:t.nick},t,{color:vt(n),id:n,ts:new Rt}))})),t.length&&this.update({_participants:!0}),this._participants.toArray()}},{key:"send",value:function(e){return"string"==typeof e&&(e={message:e}),this.socket.send(Sn({method:"send",connection_id:this.connection_id,conversation_id:this.conversation_id||""},e))}},{key:"markAsRead",value:(r=Xe(Qe.mark((function e(){return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.markAsReadOp){e.next=2;break}return e.abrupt("return");case 2:return this.update({errors:0,unread:0}),e.next=5,this.markAsReadOp.perform({connection_id:this.connection_id,conversation_id:this.conversation_id});case 5:return e.abrupt("return",this.update({unread:0}));case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"update",value:function(e){return this._loadParticipants(),m(i(u.prototype),"update",this).call(this,e)}},{key:"wsEventRtc",value:function(e){"call"==e.type&&this.addMessage({highlight:!0,message:"%1 is calling.",vars:[e.from]}),"hangup"==e.type&&this.addMessage({message:"%1 ended the call.",vars:[e.from]}),this.emit("rtc",e)}},{key:"wsEventMode",value:function(e){e.nick?(this.participants([{nick:e.nick,mode:e.mode}]),this.addMessage({message:"%1 got mode %2 from %3.",vars:[e.nick,e.mode,e.from]})):this.update({modes:this._calculateModes(Nt,e.mode,this.modes)})}},{key:"wsEventNickChange",value:function(e){var t=this._participantId(e.old_nick);if(this._participants.has(t)&&e.old_nick!=e.new_nick){this._participants.delete(t),this.participants([{nick:e.new_nick}]);var n="me"==e.type?"You (%1) changed nick to %2.":"%1 changed nick to %2.";this.addMessage({message:n,vars:[e.old_nick,e.new_nick]})}}},{key:"wsEventPart",value:function(e){var t=this.findParticipant(e.nick);t&&!t.me&&(this._participants.delete(this._participantId(e.nick)),this.update({_participants:!0}),e.silent||this.addMessage(this._partMessage(e)))}},{key:"wsEventSentClear",value:function(e){e.errors||(this.update({messages:[]}),this.addMessage({message:"History was cleared for %1.",vars:[this.name]}))}},{key:"wsEventSentNames",value:function(e){this._updateParticipants(e);var t={message:"Participants (%1): %2",vars:[]},n=this._participants.toArray().map((function(e){return(jt[e.mode]||e.mode||"")+e.name}));n.length>1&&(t.message+=" and %3.",t.vars[2]=n.pop()),t.vars[0]=n.length,t.vars[1]=n.join(", "),this.addMessage(t)}},{key:"wsEventSentTopic",value:function(e){var t=e.topic?"Topic for %1 is: %2":"No topic is set for %1.";this.addMessage({message:t,vars:[this.name,e.topic]}),this.update({topic:e.topic})}},{key:"_addOperations",value:function(){this.prop("ro","messagesOp",Dt("/api","conversationMessages")),this.prop("ro","markAsReadOp",Dt("/api","markConversationAsRead"))}},{key:"_calculateModes",value:function(e,t,n){var r=(t||"").match(/^(\+|-)?(.*)/)||["","+",""],o=p(r,3),i=(o[0],o[1]);o[2].split("").forEach((function(t){n[e[t]||t]="-"!=i}))}},{key:"_calculateFrozen",value:function(){return""}},{key:"_loadParticipants",value:function(){if(!this.participantsLoaded&&this.conversation_id&&this.messagesOp&&!this.is("frozen")&&this.messagesOp.is("success"))return this.participantsLoaded=!0,this.is_private?this.send("/whois "+this.conversation_id):this.send("/names").then(this._updateParticipants.bind(this))}},{key:"_maybeIncreaseUnread",value:function(e){e.from&&!e.yourself&&-1!=["action","error","private"].indexOf(e.type)&&this.update({unread:this.unread+1})}},{key:"_maybeNotify",value:function(e){if(e.from&&!e.yourself&&(e.highlight||this.wantNotifications)&&-1!=["action","error","private"].indexOf(e.type)&&!vn.appHasFocus){var t=e.from==this.name?e.from:dn("%1 in %2",e.from,this.name);this.lastNotification=vn.show(e.message,{path:this.path,title:t})}}},{key:"_noop",value:function(){}},{key:"_participantId",value:function(e){return e.toLowerCase()}},{key:"_partMessage",value:function(e){var t={message:"%1 parted.",vars:[e.nick]};return e.kicker?(t.message="%1 was kicked by %2"+(e.message?": %3":""),t.vars.push(e.kicker),t.vars.push(e.message)):e.message&&(t.message+=" Reason: %2",t.vars.push(e.message)),t}},{key:"_realMessage",value:function(e){for(var t=-1==e?-1:1,n=this.messages,r=-1==e?this.messages.length-1:0;n[r];){if(!n[r].internal)return n[r];r+=t}return null}},{key:"_setEndOfStream",value:function(e,t){if(!e.before&&!t.after){var n=t.messages.slice(-1)[0];this.update({historyStopAt:new Rt(n&&n.ts)})}if(!e.after&&!t.before){var r=t.messages[0];this.update({historyStartAt:new Rt(r&&r.ts)})}t.messages&&t.messages.length<=1&&this.update({historyStartAt:new Rt,historyStopAt:new Rt})}},{key:"_skipLoad",value:function(e){return!(this.messagesOp&&!this.is("loading"))||(this.messages.length?e.around?!!this.messages.find((function(t){return t.ts.toISOString()==e.around})):!(!e.before||!this.historyStartAt)||!(!e.after||!this.historyStopAt):this.is("success"))}},{key:"_updateParticipants",value:function(e){this._participants.clear(),this.participants(e.participants),e.stopPropagation()}}]),u}(_t);function Pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pn(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Nn=function(e,t){return(e.is_private||0)-(t.is_private||0)||e.name.localeCompare(t.name)},jn=function(t){c(a,t);var n,r=(n=a,function(){var e,t=i(n);if(Mn()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function a(t){var n;e(this,a),(n=r.call(this,t)).prop("ro","conversations",new Ct([],{sorter:Nn})),n.prop("rw","on_connect_commands",t.on_connect_commands||""),n.prop("rw","state",t.state||"queued"),n.prop("rw","wanted_state",t.wanted_state||"connected"),n.prop("rw","url","string"==typeof t.url?new tt(t.url):t.url||new tt("convos://loopback"));var o=t.me||{},i=o.nick||n.url.searchParams.get("nick")||"";return n.prop("rw","nick",i),n.prop("rw","real_host",o.real_host||n.url.hostname),n.prop("rw","server_op",o.server_op||!1),n.participants((t.service_accounts||[]).map((function(e){return{nick:e}})).concat({nick:i})),n}return S(a,[{key:"ensureConversation",value:function(e){var t=this,n=this.conversations.get(e.conversation_id);return n?n.update(e):((n=new On(Dn({},e,{connection_id:this.connection_id}))).on("message",(function(e){return t.emit("message",e)})),n.on("update",(function(){return t.update({conversations:!0})})),this._addDefaultParticipants(n),this.conversations.set(n.conversation_id,n),this.update({conversations:!0}),this.emit("conversationadd",n),n)}},{key:"findConversation",value:function(e){return this.conversations.get(e.conversation_id)||null}},{key:"is",value:function(e){return this.state==e||m(i(a.prototype),"is",this).call(this,e)}},{key:"removeConversation",value:function(e){var t=this.findConversation(e)||e;return this.conversations.delete(t.conversation_id),this.emit("conversationremove",t),this.update({conversations:!0})}},{key:"send",value:function(e){"string"==typeof e&&(e={message:e});var t=new RegExp("^"+this.participants().map((function(e){return e.id})).join("|")+":","i");return 0==e.message.indexOf("/")||e.message.match(t)||(e.message="/quote "+e.message),m(i(a.prototype),"send",this).call(this,e)}},{key:"update",value:function(e){return e.url&&"string"==typeof e.url&&(e.url=new tt(e.url)),m(i(a.prototype),"update",this).call(this,e)}},{key:"wsEventConnection",value:function(e){this.update({state:e.state}),this.addMessage(e.message?{message:"Connection state changed to %1: %2",vars:[e.state,e.message]}:{message:"Connection state changed to %1.",vars:[e.state]})}},{key:"wsEventFrozen",value:function(e){var t=this.findConversation(e),n=t&&t.frozen;this.ensureConversation(e).participants([{nick:this.nick,me:!0}]),e.frozen&&(t||this).addMessage({message:e.frozen,vars:[]}),n&&!e.frozen&&t.addMessage({message:"Connected.",vars:[]})}},{key:"wsEventMe",value:function(e){this.wsEventNickChange(e),e.server_op&&this.addMessage({message:"You are an IRC operator.",vars:[],highlight:!0}),this.update(e)}},{key:"wsEventMessage",value:function(e){return e.yourself=e.from==this.nick,e.conversation_id?this.ensureConversation(e).addMessage(e):this.addMessage(e)}},{key:"wsEventNickChange",value:function(e){var t={old_nick:e.old_nick||this.nick,new_nick:e.new_nick||e.nick,type:e.type};e.old_nick==this.nick&&(t.me=!0),m(i(a.prototype),"wsEventNickChange",this).call(this,t),this.conversations.forEach((function(e){return e.wsEventNickChange(t)}))}},{key:"wsEventError",value:function(e){var t={message:st(e)||e.frozen||"Unknown error from %1.",sent:e,type:"error",vars:e.command||[e.message]},n=(e.message||"").match(/^\/j(oin)? (\S+)/);if(n)return this.ensureConversation(Dn({},e,{conversation_id:n[2]}));var r=e.conversation_id&&e.frozen?this.ensureConversation(e):this.findConversation(e)||this;r.update({errors:this.errors+1}),r.addMessage(t)}},{key:"wsEventJoin",value:function(e){var t=this.ensureConversation(e),n=e.nick||this.nick;n==this.nick||e.silent||t.addMessage({message:"%1 joined.",vars:[n]}),t.participants([{nick:n}])}},{key:"wsEventPart",value:function(e){if(e.nick==this.nick)return this.removeConversation(e);e.conversation_id||this.conversations.forEach((function(t){return t.wsEventPart(e)}))}},{key:"wsEventQuit",value:function(e){this.wsEventPart(e)}},{key:"wsEventRtc",value:function(e){}},{key:"wsEventSentJoin",value:function(e){this.wsEventJoin(e)}},{key:"wsEventSentList",value:function(e){var t=e.args||"/*/";this.addMessage(e.done?{message:"Found %1 of %2 conversations from %3.",vars:[e.conversations.length,e.n_conversations,t]}:{message:"Found %1 of %2 conversations from %3, but conversations are still loading.",vars:[e.conversations.length,e.n_conversations,t]})}},{key:"wsEventSentMode",value:function(e){var t=this.findConversation(e)||this,n=(e.command[1]||"").match(/(\W*)(\w)$/);if(!n)return console.log("[wsEventSentMode] Unable to handle message:",e);switch(n.shift(),n[1]){case"":return t.addMessage({message:"%s has mode %s",vars:[e.conversation_id,e.mode]});case"k":return t.addMessage({message:"+"==n[0]?"Key was set.":"Key was unset."});case"b":return this._wsEventSentModeB(e,n)}}},{key:"_wsEventSentModeB",value:function(e,t){var n=this.findConversation(e)||this;if(e.banlist)e.banlist.length||n.addMessage({message:"Ban list is empty."}),e.banlist.forEach((function(e){n.addMessage({message:"Ban mask %1 set by %2 at %3.",vars:[e.mask,e.by,new Date(1e3*e.ts).toLocaleString()]})}));else{var r="+"==t[0]?"set":"removed";n.addMessage({message:"Ban mask %1 ".concat(r,"."),vars:[e.command[2]]})}}},{key:"wsEventSentQuery",value:function(e){this.ensureConversation(e)}},{key:"wsEventSentWhois",value:function(e){var t="%1 (%2@%3, %4)",n=[e.nick,e.user,e.host,e.name],r=Object.keys(e.channels).sort().map((function(t){return(jt[e.channels[t].mode]||"")+t}));e.channels=r,e.idle_for&&r.length?(t+=" has been idle for %5s in %6.",n.push(e.idle_for),n.push(r.join(", "))):e.idle_for&&!r.length?(t+="has been idle for %5s, and is not in any channels.",n.push(e.idle_for)):r.length?(t+=" is active in %5.",n.push(r.join(", "))):t+=" is not in any channels.",(this.findConversation(e)||this).addMessage({message:t,vars:n,sent:e})}},{key:"_addDefaultParticipants",value:function(e){var t=[{nick:this.nick,me:!0}];e.is_private&&t.push({nick:e.name}),e.participants(t)}},{key:"_addOperations",value:function(){this.prop("ro","markAsReadOp",Dt("/api","markConnectionAsRead")),this.prop("ro","messagesOp",Dt("/api","connectionMessages"))}},{key:"_calculateFrozen",value:function(){switch(this.state){case"connected":return"";case"disconnected":return"Disconnected.";case"unreachable":return"Unreachable.";default:return"Connecting..."}}}]),a}(On);function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ln(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var In=function(t){c(a,t);var n,r=(n=a,function(){var e,t=i(n);if(Ln()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function a(t){return e(this,a),r.call(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{connection_id:"",conversation_id:"notifications",is_private:!0,name:"Notifications"}))}return S(a,[{key:"addMessage",value:function(e){return this.update({unread:this.unread+1}),this.addMessages("push",[e])}},{key:"is",value:function(e){return"notifications"==e||m(i(a.prototype),"is",this).call(this,e)}},{key:"send",value:function(){return Promise.resolve({})}},{key:"_addOperations",value:function(){this.prop("ro","messagesOp",Dt("/api","notificationMessages")),this.prop("ro","markAsReadOp",Dt("/api","markNotificationsAsRead"))}}]),a}(On);function Un(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Un(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Un(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Fn=function(t){c(s,t);var n,r,a=(n=s,function(){var e,t=i(n);if(Bn()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function s(t){var n;return e(this,s),(n=a.call(this,zn({},t,{connection_id:"",conversation_id:"search",is_private:!0,name:"Search"}))).prop("rw","query",""),n.update({status:"success"}),n}return S(s,[{key:"is",value:function(e){return"conversation"!=e&&("search"==e||m(i(s.prototype),"is",this).call(this,e))}},{key:"load",value:(r=Xe(Qe.mark((function e(t){var n,r;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.is("loading")){e.next=2;break}return e.abrupt("return",this);case 2:if((n=zn({},t)).match=t.match||t.message,null==n.match&&(n.match=""),n.match=n.match.replace(/\s*conversation:(\S+)\s*/,(function(e,t){return[" ",n.conversation_id=t][0]})).replace(/\s*from:(\S+)\s*/,(function(e,t){return[" ",n.from=t][0]})).replace(/\s*([&#]\S+)\s*/,(function(e,t){return[" ",n.conversation_id=t][0]})),n.match=n.match.trim(),n.match.match(/\S/)){e.next=9;break}return e.abrupt("return",this.update({messages:[]}).addMessages([{message:'Search query "%1" does not contain anything to search for.',vars:[t.message]}]));case 9:return this.update({messages:[],query:n.match,status:"loading"}),e.next=12,this.messagesOp.perform(n);case 12:return r=this.messagesOp.res.body,this.addMessages(n.before?"unshift":"push",r.messages||[]),e.abrupt("return",this.update({status:this.messagesOp.status}));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"send",value:function(e){return"string"==typeof e&&(e={message:e}),this.emit("send",e),Promise.resolve(e)}},{key:"_addOperations",value:function(){this.prop("ro","messagesOp",Dt("/api","searchMessages")),this.prop("ro","markAsReadOp",null)}},{key:"_loadParticipants",value:function(){}}]),s}(On);function Hn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hn(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Wn=function(t){c(s,t);var n,r,a=(n=s,function(){var e,t=i(n);if(Gn()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function s(t){var n;return e(this,s),(n=a.call(this)).prop("ro","connections",new Ct),n.prop("ro","notifications",new In({})),n.prop("ro","search",new Fn({})),n.prop("ro","roles",new Set),n.prop("ro","unread",(function(){return n._calculateUnread()})),n.prop("rw","activeConversation",n.notifications),n.prop("rw","email",""),n.prop("rw","forced_connection",!1),n.prop("rw","default_connection","irc://chat.freenode.net:6697/%23convos"),n.prop("rw","highlightKeywords",[]),n.prop("rw","rtc",{}),n.prop("rw","status","pending"),n.prop("persist","ignoreStatuses",!1),n.socket=t.socket||_n("/events"),n.socket.on("message",(function(e){return n._dispatchMessage(e)})),n.socket.on("update",(function(e){return n._onConnectionChange(e)})),n}return S(s,[{key:"conversations",value:function(e){var t=[];return this.connections.toArray().forEach((function(n){n.conversations.toArray().forEach((function(n){e&&!e(n)||t.push(n)}))})),t}},{key:"ensureConversation",value:function(e,t){var n=this;if(e.conversation_id){var r=this.ensureConversation({connection_id:e.connection_id},!0);return this._maybeUpgradeActiveConversation(r.ensureConversation(e))}var o=this.findConversation(e);return o?o.update(e):((o=new jn(qn({},e))).on("conversationadd",(function(e){return n._maybeUpgradeActiveConversation(e)})),o.on("conversationremove",(function(e){return e==n.activeConversation&&n.setActiveConversation(e)})),o.on("update",(function(e){return n.update({connections:!0})})),this.connections.set(o.connection_id,o),this.update({connections:!0}),t?o:this._maybeUpgradeActiveConversation(o))}},{key:"findConversation",value:function(e){var t=this.connections.get(e.connection_id);return e.conversation_id?t&&t.findConversation(e)||null:t}},{key:"is",value:function(e){var t=this;return Array.isArray(e)?!!e.filter((function(e){return t.is(e)})).length:!!this.roles.has(e)||this.status==e}},{key:"load",value:(r=Xe(Qe.mark((function e(){var t,n,r=this;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.is("loading")){e.next=2;break}return e.abrupt("return",this);case 2:return this.update({status:"loading"}),e.next=5,this.socket.send({method:"load",object:"user",params:{connections:!0,conversations:!0}});case 5:if(!(t=e.sent).errors){e.next=9;break}return this.roles.add("anonymous"),e.abrupt("return",this.update({roles:!0,status:t.errors?"error":"success"}));case 9:return n=t.user||{},this.connections.clear(),(n.connections||[]).forEach((function(e){return r.ensureConversation(qn({},e,{status:"pending"}))})),(n.conversations||[]).forEach((function(e){return r.ensureConversation(qn({},e,{status:"pending"}))})),this.notifications.update({unread:n.unread||0}),this.roles.clear(),this.roles.add(n.email?"authenticated":"anonymous"),(n.roles||[]).forEach((function(e){return r.roles.add(e)})),e.abrupt("return",this.update({email:n.email||"",default_connection:n.default_connection||"",forced_connection:n.forced_connection||!1,highlightKeywords:n.highlight_keywords||[],roles:!0,rtc:n.rtc||{},status:t.errors?"error":"success"}));case 18:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"removeConversation",value:function(e){var t=this.findConversation({connection_id:e.connection_id});if(e.conversation_id)return t&&t.removeConversation(e);this.connections.delete(e.connection_id),t==this.activeConversation&&this.setActiveConversation(t),this.update({connections:!0})}},{key:"setActiveConversation",value:function(e){var t=!e.connection_id&&!e.conversation_id&&this.notifications;if(t)return this.update({activeConversation:t});if(t=this.findConversation(e))return this.update({activeConversation:t});var n=qn({},e,{connection_id:e.connection_id||"",frozen:"Not found."});return["conversation_id","name"].forEach((function(t){return e.hasOwnProperty(t)&&(n[t]=e[t])})),this.update({activeConversation:n.conversation_id?new On(n):new jn(n)})}},{key:"_calculateUnread",value:function(){var e=this.activeConversation;return this.notifications.unread+this.conversations((function(e){return e.is_private})).reduce((function(t,n){return t+(n==e?0:n.unread)}),0)}},{key:"_dispatchMessage",value:function(e){e.dispatchTo=("wsEvent_"+this._getEventNameFromMessage(e)).replace(/_(\w)/g,(function(e,t){return t.toUpperCase()})),e.bubbles=!0,e.stopPropagation=function(){e.bubbles=!1},e.silent=this.ignoreStatuses,this.emit(e.dispatchTo,e),e.highlight&&this.notifications.addMessage(e);var t=this.findConversation({connection_id:e.connection_id});if(t&&(t[e.dispatchTo]&&t[e.dispatchTo](e),e.bubbles)){var n=t.findConversation(e);n&&n[e.dispatchTo]&&n[e.dispatchTo](e)}}},{key:"_getEventNameFromMessage",value:function(e){return e.errors?"error":"state"==e.event?e.type:"sent"==e.event&&e.message.match(/\/\S+/)?(e.command=e.message.split(/\s+/).filter((function(e){return e.length})),e.command[0]=e.command[0].substring(1),"sent_"+e.command[0]):e.event}},{key:"_maybeUpgradeActiveConversation",value:function(e){var t=this.activeConversation;return e.connection_id&&e.connection_id!=t.connection_id||e.conversation_id&&e.conversation_id!=t.conversation_id||this.update({activeConversation:e}),e}},{key:"_onConnectionChange",value:function(e){if(e.is("open")&&this.is("pending"))return this.load();e.is("closed")&&(this.connections.forEach((function(e){return e.update({state:"unreachable"})})),this.is("loading")||this.update({status:"pending"}))}}]),s}(_t),Kn=!0,Vn=!0;function Jn(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Yn(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return o.apply(this,arguments);var i=function(e){var t=n(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=i,o.apply(this,[e,i])};var i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return i.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],i.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function Qn(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(Kn=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Zn(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(Vn=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Xn(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(Kn)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function er(e,t){Vn&&console.warn(e+" is deprecated, please use "+t+" instead.")}function tr(e){var t=e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=Jn(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=Jn(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=Jn(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=Jn(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n}function nr(e){return"[object Object]"===Object.prototype.toString.call(e)}function rr(e){return nr(e)?Object.keys(e).reduce((function(t,n){var r=nr(e[n]),o=r?rr(e[n]):e[n],i=r&&!Object.keys(o).length;return void 0===o||i?t:Object.assign(t,et({},n,o))}),{}):e}function or(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var i=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach((function(o){o.endsWith("Id")?e(t,t.get(n[o]),r):o.endsWith("Ids")&&n[o].forEach((function(n){e(t,t.get(n),r)}))})))}(e,n,o)}))})),o}var ir=Xn;function ar(e){var t=e&&e.navigator;if(t.mediaDevices){var n=tr(e),o=function(e){if("object"!==r(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var o="object"===r(e[n])?e[n]:{ideal:e[n]};void 0!==o.exact&&"number"==typeof o.exact&&(o.min=o.max=o.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==o.ideal){t.optional=t.optional||[];var a={};"number"==typeof o.ideal?(a[i("min",n)]=o.ideal,t.optional.push(a),(a={})[i("max",n)]=o.ideal,t.optional.push(a)):(a[i("",n)]=o.ideal,t.optional.push(a))}void 0!==o.exact&&"number"!=typeof o.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=o.exact):["min","max"].forEach((function(e){void 0!==o[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=o[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===r(e.audio)){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"===r(e.video)){var c=e.video.facingMode;c=c&&("object"===r(c)?c:{ideal:c});var s,u=n.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||u))if(delete e.video.facingMode,"environment"===c.exact||"environment"===c.ideal?s=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(s=["front"]),s)return t.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return s.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&s.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),ir("chrome: "+JSON.stringify(e)),i(e)}));e.video=o(e.video)}return ir("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){i(e,(function(e){t.webkitGetUserMedia(e,n,(function(e){r&&r(a(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var c=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return c(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(a(e))}))}))}}}}function cr(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function sr(e){if("object"===r(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var o;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var i=new Event("track");i.track=r.track,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],n.dispatchEvent(i)})),t.stream.getTracks().forEach((function(r){var o;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var i=new Event("track");i.track=r,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],n.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Yn(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function ur(e){if("object"===r(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var o=n.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){o.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"===r(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var c=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=c.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function dr(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],o=n[1],i=n[2];if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},c=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var s=function(e){o(c(a(e)))};return t.apply(this,[s,r])}return new Promise((function(n,r){t.apply(e,[function(e){n(c(a(e)))},r])})).then(o,i)}}}function fr(e){if("object"===r(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return or(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),Yn(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return or(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,o=arguments[0];return this.getSenders().forEach((function(e){e.track===o&&(t?r=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===o&&(n?r=!0:n=e),e.track===o})),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function lr(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var o=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(o)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),o.apply(this,arguments)}}function pr(e){if(e.RTCPeerConnection){var t=tr(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return lr(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var o=new e.MediaStream(t.getTracks());this._streams[t.id]=o,this._reverseStreams[o.id]=t,t=o}r.apply(this,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var i=this.getSenders().find((function(e){return e.track===t}));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var c=new e.MediaStream([t]);this._streams[n.id]=c,this._reverseStreams[c.id]=n,this.addStream(c)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=et({},t,(function(){var e=this,t=arguments,r=arguments.length&&"function"==typeof arguments[0];return r?n.apply(this,[function(n){var r=c(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return c(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var i=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),i.apply(this,arguments)):i.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(r){n._streams[r].getTracks().find((function(t){return e.track===t}))&&(t=n._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(o.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:n})}}function hr(e){var t=tr(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=et({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}function mr(e){Yn(e,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))}var vr=Object.freeze({__proto__:null,shimMediaStream:cr,shimOnTrack:sr,shimGetSendersWithDtmf:ur,shimGetStats:dr,shimSenderReceiverGetStats:fr,shimAddTrackRemoveTrackWithNative:lr,shimAddTrackRemoveTrack:pr,shimPeerConnection:hr,fixNegotiationNeeded:mr,shimGetUserMedia:ar,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,o=n.video&&n.video.height,i=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},r&&(n.video.mandatory.maxWidth=r),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});var gr=n((function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)n[(t=r[o].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===r(e.keyParams)?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],o=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substr(12),password:o.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" "),o=3;o<r.length;o++){var i=r[o],a=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){var c=t.parseRtpMap(a),s=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(c.parameters=s.length?t.parseFmtp(s[0]):{},c.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(c.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){var r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));var o=0;return n.codecs.forEach((function(e){e.maxptime>o&&(o=e.maxptime)})),o>0&&(r+="a=maxptime:"+o+"\r\n"),r+="a=rtcp-mux\r\n",n.headerExtensions&&n.headerExtensions.forEach((function(e){r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){var n,r=[],o=t.parseRtpParameters(e),i=-1!==o.fecMechanisms.indexOf("RED"),a=-1!==o.fecMechanisms.indexOf("ULPFEC"),c=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),s=c.length>0&&c[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===s&&(n=u[0][1]),o.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&n&&(t.rtx={ssrc:n}),r.push(t),i&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:s,mechanism:a?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&s&&r.push({ssrc:s});var d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=d}))),r},t.parseRtcpParameters=function(e){var n={},r=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var o=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=0===o.length;var i=t.matchPrefix(e,"a=rtcp-mux");return n.mux=i.length>0,n},t.parseMsid=function(e){var n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(n=r[0].substr(7).split(" "))[0],track:n[1]};var o=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return o.length>0?{stream:(n=o[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,r=t.parseMLine(e),o=t.matchPrefix(e,"a=max-message-size:");o.length>0&&(n=parseInt(o[0].substr(19),10)),isNaN(n)&&(n=65536);var i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:n};if(t.matchPrefix(e,"a=sctpmap:").length>0){var a=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){var o=void 0!==n?n:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,n,r,o){var i=t.writeRtpDescription(e.kind,n);if(i+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var a="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+a,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),i},t.getDirection=function(e,n){for(var r=t.splitLines(e),o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),r=0;r<n.length;r++)if(n[r].length<2||"="!==n[r].charAt(1))return!1;return!0},e.exports=t}));function yr(e,t,n,r,o){var i=gr.writeRtpDescription(e.kind,t);if(i+=gr.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=gr.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),i+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(r?r.id:"-")+" "+a+"\r\n";i+="a="+c,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+gr.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+gr.localCName+"\r\n"),i}function br(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},o=function(e,t,n,o){var i=r(e.parameters.apt,n),a=r(t.parameters.apt,o);return i&&a&&i.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(r){for(var i=0;i<t.codecs.length;i++){var a=t.codecs[i];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!o(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var o=t.headerExtensions[r];if(e.uri===o.uri){n.headerExtensions.push(o);break}}})),n}function $r(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function _r(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function wr(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var kr=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function r(t,n,r,o){var i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=o,e.setTimeout((function(){t._dispatchEvent("track",i)}))}var o=function(n){var r=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){r[e]=o[e].bind(o)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw wr("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o="string"==typeof r;return o&&(r=[r]),r=r.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")})),delete e.url,e.urls=o?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var i=n.iceCandidatePoolSize;i>0;i--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=gr.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},o.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var o=this._createIceAndDtlsTransports();r.iceTransport=o.iceTransport,r.dtlsTransport=o.dtlsTransport}return t||this.transceivers.push(r),r},o.prototype.addTrack=function(t,n){if(this._isClosed)throw wr("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw wr("InvalidAccessError","Track already exists.");for(var o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(r=this.transceivers[o]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},o.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},o.prototype.removeTrack=function(t){if(this._isClosed)throw wr("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw wr("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},o.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},o.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},o.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var o=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(o,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;o.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},o.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),o},o.prototype._gather=function(t,n){var r=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var i=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var i=new Event("icecandidate");i.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var s=gr.writeCandidate(a);i.candidate=Object.assign(i.candidate,gr.parseCandidate(s)),i.candidate.candidate=s,i.candidate.toJSON=function(){return{candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex,usernameFragment:i.candidate.usernameFragment}}}var u=gr.getMediaSections(r._localDescription.sdp);u[i.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+i.candidate.candidate+"\r\n",r._localDescription.sdp=gr.getDescription(r._localDescription.sdp)+u.join("");var d=r.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),c||r._dispatchEvent("icecandidate",i),d&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout((function(){i.forEach((function(e){o.onlocalcandidate(e)}))}),0)}},o.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},o.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},o.prototype._transceive=function(e,n,r){var o=br(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:gr.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),r&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},o.prototype.setLocalDescription=function(e){var t,n,r=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(wr("TypeError",'Unsupported type "'+e.type+'"'));if(!$r("setLocalDescription",e.type,r.signalingState)||r._isClosed)return Promise.reject(wr("InvalidStateError","Can not set local "+e.type+" in state "+r.signalingState));if("offer"===e.type)t=gr.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=gr.parseRtpParameters(e);r.transceivers[t].localCapabilities=n})),r.transceivers.forEach((function(e,t){r._gather(e.mid,t)}));else if("answer"===e.type){t=gr.splitSections(r._remoteDescription.sdp),n=t.shift();var o=gr.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var i=r.transceivers[t],a=i.iceGatherer,c=i.iceTransport,s=i.dtlsTransport,u=i.localCapabilities,d=i.remoteCapabilities;if(!(gr.isRejected(e)&&0===gr.matchPrefix(e,"a=bundle-only").length)&&!i.rejected){var f=gr.getIceParameters(e,n),l=gr.getDtlsParameters(e,n);o&&(l.role="server"),r.usingBundle&&0!==t||(r._gather(i.mid,t),"new"===c.state&&c.start(a,f,o?"controlling":"controlled"),"new"===s.state&&s.start(l));var p=br(u,d);r._transceive(i,p.codecs.length>0,!1)}}))}return r._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?r._updateSignalingState("have-local-offer"):r._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(o){var i=this;if(-1===["offer","answer"].indexOf(o.type))return Promise.reject(wr("TypeError",'Unsupported type "'+o.type+'"'));if(!$r("setRemoteDescription",o.type,i.signalingState)||i._isClosed)return Promise.reject(wr("InvalidStateError","Can not set remote "+o.type+" in state "+i.signalingState));var a={};i.remoteStreams.forEach((function(e){a[e.id]=e}));var c=[],s=gr.splitSections(o.sdp),u=s.shift(),d=gr.matchPrefix(u,"a=ice-lite").length>0,f=gr.matchPrefix(u,"a=group:BUNDLE ").length>0;i.usingBundle=f;var l=gr.matchPrefix(u,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!l&&l.substr(14).split(" ").indexOf("trickle")>=0,s.forEach((function(r,s){var l=gr.splitLines(r),p=gr.getKind(r),h=gr.isRejected(r)&&0===gr.matchPrefix(r,"a=bundle-only").length,m=l[0].substr(2).split(" ")[2],v=gr.getDirection(r,u),g=gr.parseMsid(r),y=gr.getMid(r)||gr.generateIdentifier();if(h||"application"===p&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))i.transceivers[s]={mid:y,kind:p,protocol:m,rejected:!0};else{var b,$,_,w,k,C,S,x,E;!h&&i.transceivers[s]&&i.transceivers[s].rejected&&(i.transceivers[s]=i._createTransceiver(p,!0));var R,T,O=gr.parseRtpParameters(r);h||(R=gr.getIceParameters(r,u),(T=gr.getDtlsParameters(r,u)).role="client"),S=gr.parseRtpEncodingParameters(r);var P=gr.parseRtcpParameters(r),D=gr.matchPrefix(r,"a=end-of-candidates",u).length>0,M=gr.matchPrefix(r,"a=candidate:").map((function(e){return gr.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===o.type||"answer"===o.type)&&!h&&f&&s>0&&i.transceivers[s]&&(i._disposeIceAndDtlsTransports(s),i.transceivers[s].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[s].iceTransport=i.transceivers[0].iceTransport,i.transceivers[s].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[s].rtpSender&&i.transceivers[s].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[s].rtpReceiver&&i.transceivers[s].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==o.type||h){if("answer"===o.type&&!h){$=(b=i.transceivers[s]).iceGatherer,_=b.iceTransport,w=b.dtlsTransport,k=b.rtpReceiver,C=b.sendEncodingParameters,x=b.localCapabilities,i.transceivers[s].recvEncodingParameters=S,i.transceivers[s].remoteCapabilities=O,i.transceivers[s].rtcpParameters=P,M.length&&"new"===_.state&&(!d&&!D||f&&0!==s?M.forEach((function(e){_r(b.iceTransport,e)})):_.setRemoteCandidates(M)),f&&0!==s||("new"===_.state&&_.start($,R,"controlling"),"new"===w.state&&w.start(T)),!br(b.localCapabilities,b.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,i._transceive(b,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!k||"sendrecv"!==v&&"sendonly"!==v?delete b.rtpReceiver:(E=k.track,g?(a[g.stream]||(a[g.stream]=new e.MediaStream),n(E,a[g.stream]),c.push([E,k,a[g.stream]])):(a.default||(a.default=new e.MediaStream),n(E,a.default),c.push([E,k,a.default])))}}else{(b=i.transceivers[s]||i._createTransceiver(p)).mid=y,b.iceGatherer||(b.iceGatherer=i._createIceGatherer(s,f)),M.length&&"new"===b.iceTransport.state&&(!D||f&&0!==s?M.forEach((function(e){_r(b.iceTransport,e)})):b.iceTransport.setRemoteCandidates(M)),x=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(x.codecs=x.codecs.filter((function(e){return"rtx"!==e.name}))),C=b.sendEncodingParameters||[{ssrc:1001*(2*s+2)}];var N,j=!1;if("sendrecv"===v||"sendonly"===v){if(j=!b.rtpReceiver,k=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,p),j)E=k.track,g&&"-"===g.stream||(g?(a[g.stream]||(a[g.stream]=new e.MediaStream,Object.defineProperty(a[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(E,"id",{get:function(){return g.track}}),N=a[g.stream]):(a.default||(a.default=new e.MediaStream),N=a.default)),N&&(n(E,N),b.associatedRemoteMediaStreams.push(N)),c.push([E,k,N])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===b.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),b.associatedRemoteMediaStreams=[]);b.localCapabilities=x,b.remoteCapabilities=O,b.rtpReceiver=k,b.rtcpParameters=P,b.sendEncodingParameters=C,b.recvEncodingParameters=S,i._transceive(i.transceivers[s],!1,j)}}})),void 0===i._dtlsRole&&(i._dtlsRole="offer"===o.type?"active":"passive"),i._remoteDescription={type:o.type,sdp:o.sdp},"offer"===o.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(a).forEach((function(t){var n=a[t];if(n.getTracks().length){if(-1===i.remoteStreams.indexOf(n)){i.remoteStreams.push(n);var o=new Event("addstream");o.stream=n,e.setTimeout((function(){i._dispatchEvent("addstream",o)}))}c.forEach((function(e){var t=e[0],o=e[1];n.id===e[2].id&&r(i,t,o,[n])}))}})),c.forEach((function(e){e[2]||r(i,e[0],e[1],[])})),e.setTimeout((function(){i&&i.transceivers&&i.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},o.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},o.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},o.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},o.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(wr("InvalidStateError","Can not call createOffer after close"));var r=n.transceivers.filter((function(e){return"audio"===e.kind})).length,o=n.transceivers.filter((function(e){return"video"===e.kind})).length,i=arguments[0];if(i){if(i.mandatory||i.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==i.offerToReceiveAudio&&(r=!0===i.offerToReceiveAudio?1:!1===i.offerToReceiveAudio?0:i.offerToReceiveAudio),void 0!==i.offerToReceiveVideo&&(o=!0===i.offerToReceiveVideo?1:!1===i.offerToReceiveVideo?0:i.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--r<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));r>0||o>0;)r>0&&(n._createTransceiver("audio"),r--),o>0&&(n._createTransceiver("video"),o--);var a=gr.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(r,o){var i=r.track,a=r.kind,c=r.mid||gr.generateIdentifier();r.mid=c,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(o,n.usingBundle));var s=e.RTCRtpSender.getCapabilities(a);t<15019&&(s.codecs=s.codecs.filter((function(e){return"rtx"!==e.name}))),s.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),s.headerExtensions.forEach((function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=r.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];i&&t>=15019&&"video"===a&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=s,r.sendEncodingParameters=u})),"max-compat"!==n._config.bundlePolicy&&(a+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){a+=yr(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),a+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,a+="a="+gr.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(a+="a=end-of-candidates\r\n"))}));var c=new e.RTCSessionDescription({type:"offer",sdp:a});return Promise.resolve(c)},o.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(wr("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(wr("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var r=gr.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var o=gr.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,i){if(!(i+1>o)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?r+="m=application 0 DTLS/SCTP 5000\r\n":r+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var a;if(e.stream)"audio"===e.kind?a=e.stream.getAudioTracks()[0]:"video"===e.kind&&(a=e.stream.getVideoTracks()[0]),a&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var c=br(e.localCapabilities,e.remoteCapabilities);!c.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=yr(e,c,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}}));var i=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(i)},o.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(r,o){if(!n._remoteDescription)return o(wr("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var i=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){i=a;break}var c=n.transceivers[i];if(!c)return o(wr("OperationError","Can not add ICE candidate"));if(c.rejected)return r();var s=Object.keys(e.candidate).length>0?gr.parseCandidate(e.candidate):{};if("tcp"===s.protocol&&(0===s.port||9===s.port))return r();if(s.component&&1!==s.component)return r();if((0===i||i>0&&c.iceTransport!==n.transceivers[0].iceTransport)&&!_r(c.iceTransport,s))return o(wr("OperationError","Can not add ICE candidate"));var u=e.candidate.trim();0===u.indexOf("a=")&&(u=u.substr(2)),(t=gr.getMediaSections(n._remoteDescription.sdp))[i]+="a="+(s.type?u:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=gr.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var d=0;d<n.transceivers.length&&(n.transceivers[d].rejected||(n.transceivers[d].iceTransport.addRemoteCandidate({}),(t=gr.getMediaSections(n._remoteDescription.sdp))[d]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=gr.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));d++);r()}))},o.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw wr("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var i=["createOffer","createAnswer"];return i.forEach((function(e){var t=o.prototype[e];o.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(i=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=o.prototype[e];o.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=o.prototype[e];o.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),o};function Cr(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}function Sr(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function xr(e){var t=tr(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=kr(e,t.version);e.RTCPeerConnection=function(e){var n,o;return e&&e.iceServers&&(e.iceServers=(n=e.iceServers,t.version,o=!1,(n=JSON.parse(JSON.stringify(n))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&er("RTCIceServer.url","RTCIceServer.urls");var n="string"==typeof t;return n&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!o?(o=!0,!0):t&&!o})),delete e.url,e.urls=n?t[0]:t,!!t.length}}))),Xn("ICE servers after filtering:",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype}function Er(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var Rr=Object.freeze({__proto__:null,shimPeerConnection:xr,shimReplaceTrack:Er,shimGetUserMedia:Cr,shimGetDisplayMedia:Sr});function Tr(e){var t=tr(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){er("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===r(e)&&"object"===r(e.audio)&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},o&&o.prototype.getSettings){var c=o.prototype.getSettings;o.prototype.getSettings=function(){var e=c.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var s=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===r(e)&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function Or(e){"object"===r(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Pr(e){var t=tr(e);if("object"===r(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=et({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]})),t.version<68){var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),n=e[0],r=e[1],a=e[2];return i.apply(this,[n||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=o[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))}))}return e})).then(r,a)}}}function Dr(e){if("object"===r(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function Mr(e){if("object"===r(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),Yn(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Nr(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;er("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})}function jr(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Ar(e){if("object"===r(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var o=r.sender,i=o.getParameters();"encodings"in i||(i.encodings=e.sendEncodings,this.setParametersPromises.push(o.setParameters(i).catch((function(){}))))}return r})}}function Lr(e){if("object"===r(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}function Ir(e){if("object"===r(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,n=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(n,e)})).finally((function(){n.setParametersPromises=[]})):t.apply(this,arguments)}}}var Ur=Object.freeze({__proto__:null,shimOnTrack:Or,shimPeerConnection:Pr,shimSenderGetStats:Dr,shimReceiverGetStats:Mr,shimRemoveStream:Nr,shimRTCDataChannel:jr,shimAddTransceiver:Ar,shimCreateOffer:Lr,shimCreateAnswer:Ir,shimGetUserMedia:Tr,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function zr(e){if("object"===r(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return o&&o.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}}function Br(e){if("object"===r(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function Fr(e){if("object"===r(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,o=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=o.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=c.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}}function Hr(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(qr(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function qr(e){return e&&void 0!==e.video?Object.assign({},e,{video:rr(e.video)}):e}function Gr(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var i=e.iceServers[o];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(er("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,r.push(i)):r.push(e.iceServers[o])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}function Wr(e){"object"===r(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Kr(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}}function Vr(e){"object"!==r(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Jr=Object.freeze({__proto__:null,shimLocalStreamsAPI:zr,shimRemoteStreamsAPI:Br,shimCallbacksAPI:Fr,shimGetUserMedia:Hr,shimConstraints:qr,shimRTCIceServerUrls:Gr,shimTrackEventTransceiver:Wr,shimCreateOfferLegacy:Kr,shimAudioContext:Vr});function Yr(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===r(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),o=gr.parseCandidate(e.candidate),i=Object.assign(n,o);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Yn(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function Qr(e){if(e.RTCPeerConnection){var t=tr(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=gr.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=gr.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n},o=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},i=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var o=gr.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?r=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),c=e.sdpSemantics;"plan-b"===c&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var s,u=r(arguments[0]),d=o(u),f=i(arguments[0],u);s=0===d&&0===f?Number.POSITIVE_INFINITY:0===d||0===f?Math.max(d,f):Math.min(d,f);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return s}}),this._sctp=l}return a.apply(this,arguments)}}}function Zr(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},Yn(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],o=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function Xr(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}}function eo(e){if(e.RTCPeerConnection){var t=tr(e);if(!("chrome"===t.browser&&t.version>=71)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),n.apply(this,arguments)}}}}var to=Object.freeze({__proto__:null,shimRTCIceCandidate:Yr,shimMaxMessageSize:Qr,shimSendThrowTypeError:Zr,shimConnectionState:Xr,removeAllowExtmapMixed:eo});!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=Xn,o=tr(t),i={browserDetails:o,commonShim:to,extractVersion:Jn,disableLog:Qn,disableWarnings:Zn};switch(o.browser){case"chrome":if(!vr||!hr||!n.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(null===o.version)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=vr,ar(t),cr(t),hr(t),sr(t),pr(t),ur(t),dr(t),fr(t),mr(t),Yr(t),Xr(t),Qr(t),Zr(t),eo(t);break;case"firefox":if(!Ur||!Pr||!n.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=Ur,Tr(t),Pr(t),Or(t),Nr(t),Dr(t),Mr(t),jr(t),Ar(t),Lr(t),Ir(t),Yr(t),Xr(t),Qr(t),Zr(t);break;case"edge":if(!Rr||!xr||!n.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),i.browserShim=Rr,Cr(t),Sr(t),xr(t),Er(t),Qr(t),Zr(t);break;case"safari":if(!Jr||!n.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=Jr,Gr(t),Kr(t),Fr(t),zr(t),Br(t),Wr(t),Hr(t),Vr(t),Yr(t),Qr(t),Zr(t),eo(t);break;default:r("Unsupported browser!")}}({window:window});function no(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var ro=function(t){c(u,t);var n,r,a,s=(n=u,function(){var e,t=i(n);if(no()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function u(t){var n;return e(this,u),(n=s.call(this,t)).prop("ro","id",yt()),n.prop("ro","localStream",t.localStream),n.prop("ro","peerConfig",t.peerConfig),n.prop("ro","target",t.target),n.prop("rw","info",n._infoTemplate()),n.prop("rw","remoteStream",null),n.prop("rw","role",""),n.signalQueue=[],n}return S(u,[{key:"call",value:(a=Xe(Qe.mark((function e(){var t,n;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._throwifStarted(),this.update({role:"caller"}),t=this._pc(),e.next=5,t.createOffer();case 5:n=e.sent,t.setLocalDescription(n),this.emit("signal",{offer:n.sdp,target:this.target}),this._processSignalQueue();case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"hangup",value:function(){this.pc&&this.pc.close(),this.update({role:""}),this.emit("hangup")}},{key:"refreshInfo",value:(r=Xe(Qe.mark((function e(){var t,n;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pc){e.next=8;break}return e.t1=Array,e.next=4,this.pc.getStats();case 4:e.t2=e.sent.values(),e.t0=e.t1.from.call(e.t1,e.t2),e.next=9;break;case 8:e.t0=[];case 9:return t=e.t0,n=this._infoTemplate(),t.forEach((function(e){if("local-candidate"==e.type)n.localAddress=e.address||"";else if("remote-candidate"==e.type)n.remoteAddress=e.address||"";else if("candidate-pair"==e.type)n.bytesReceived=e.bytesReceived,n.bytesSent=e.bytesSent;else if("inbound-rtp"==e.type){var t=e.kind||e.mediaType||"unknown";["bitrateMean","discardedPackets","framerateMean","framesDecoded","jitter","nackCount","packetsLost","packetsReceived"].forEach((function(r){n[t].inbound[r]=e[r]||0}))}else if("outbound-rtp"==e.type){var r=e.kind||e.mediaType||"unknown";["bitrateMean","droppedFrames","framerateMean","framesEncoded","nackCount","packetsSent"].forEach((function(t){n[r].outbound[t]=e[t]||0}))}})),e.abrupt("return",this.update({info:n}));case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"signal",value:function(e){var t=e.offer?"unshift":"push";this.signalQueue[t](e),this._processSignalQueue()}},{key:"_infoTemplate",value:function(){return{bytesReceived:0,bytesSent:0,iceConnectionState:this.pc&&this.pc.iceConnectionState||"",iceGatheringState:this.pc&&this.pc.iceGatheringState||"",localAddress:"",remoteAddress:"",signalingState:this.pc&&this.pc.signalingState||"",audio:{inbound:{},outbound:{}},video:{inbound:{},outbound:{}}}}},{key:"_onIceCandidate",value:function(e){var t=e.candidate;t&&this.emit("signal",{ice:t.candidate,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,target:this.target})}},{key:"_onTrack",value:function(e){var t=this,n=e.streams,r=e.track;r.onended=function(e){return t.refreshInfo()},r.onmute=function(e){return t.refreshInfo()},r.onunmute=function(e){return t.refreshInfo()},this.update({remoteStream:n[0]||null})}},{key:"_pc",value:function(){var e=this;if(this.pc)return this.pc;var t=new RTCPeerConnection(this.peerConfig);return this.localStream.getTracks().forEach((function(n){return t.addTrack(n,e.localStream)})),t.onicecandidate=function(t){return e._onIceCandidate(t)},t.oniceconnectionstatechange=function(t){return e.refreshInfo()},t.onicegatheringstatechange=function(t){return e.refreshInfo()},t.onremovetrack=function(t){return e.refreshInfo()},t.onsignalingstatechange=function(t){return e.refreshInfo()},t.ontrack=function(t){return e._onTrack(t)},this.pc=t}},{key:"_processSignalQueue",value:function(){var e=this;this.signalQueue=this.signalQueue.filter((function(t,n){return t.ice?!e._processIceSignalIceCandiate(t):t.answer?!e._processSignalAnswer(t):!!t.offer&&!e._processSignalOffer(t)})),this.signalQueue=[]}},{key:"_processSignalAnswer",value:function(e){var t=this._pc();return"have-local-offer"!=t.signalingState?(console.error("[processSignalAnswer] signalingState =",t.signalingState),!1):(t.setRemoteDescription(new RTCSessionDescription({sdp:e.answer,type:"answer"})),!0)}},{key:"_processIceSignalIceCandiate",value:function(e){return this._pc().addIceCandidate(new RTCIceCandidate({candidate:e.ice,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex})),!0}},{key:"_processSignalOffer",value:function(e){var t=this;this._throwifStarted(),this.update({role:"callee"});var n=this._pc();return"stable"!=n.signalingState?(console.error("[processSignalOffer] signalingState =",n.signalingState),!1):(n.setRemoteDescription(new RTCSessionDescription({sdp:e.offer,type:"offer"})),n.createAnswer().then((function(e){n.setLocalDescription(e),t.emit("signal",{answer:e.sdp,target:t.target})})),!0)}},{key:"_throwifStarted",value:function(){if(this.role)throw"[WebRTCPeerConnection] Already started "+this.target+" as "+this.role}}]),u}(_t);function oo(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var io=new(function(t){c(a,t);var n,r=(n=a,function(){var e,t=i(n);if(oo()){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return o(this,e)});function a(){var t;return e(this,a),(t=r.call(this)).prop("cookie","colorScheme","auto"),t.prop("cookie","theme","convos"),t.prop("persist","expandUrlToMedia",!0),t.prop("persist","version",""),t.prop("ro","colorSchemeOptions",["Auto","Light","Dark"].map((function(e){return[e.toLowerCase(),e]}))),t.prop("ro","isWide",(function(){return t.width>800})),t.prop("ro","themeOptions",(function(){return Array.from(t._themeMap.entries())})),t.prop("rw","height",0),t.prop("rw","osColorScheme",""),t.prop("rw","width",0),t._themeMap=new Map([]),t}return S(a,[{key:"activateTheme",value:function(e,t){this._themeMap.size||this.loadThemes(),e||(e=this.theme),t||(t=this.colorScheme);for(var n,r=["auto"==t?this.osColorScheme:t,"normal","light"],o=0;o<r.length&&!(n=document.getElementById("theme_alt__"+r[o]+"-"+e));o++);return pt(document,'link[rel*="style"][title]',(function(e){n||(n=e),e.disabled=!0,e.disabled=e.href!=n.href,e.setAttribute("media",e==n?"":"none"),e.setAttribute("rel",e==n?"stylesheet":"alternate stylesheet")})),this.update({colorScheme:t,theme:e})}},{key:"hasColorSchemes",value:function(e){return pt(document,'link[id$="-'+e+'"]').length>1}},{key:"loadThemes",value:function(){var e=this;pt(document,'link[rel="alternate stylesheet"][title]',(function(t){var n=t.title.replace(/\s\([a-z]+\)$/,"");e._themeMap.set(t.id.replace(/^theme_alt__[a-z]+-/,""),n)})),this._matchMedia||(this._matchMedia=window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):{addListener:function(){}},this._matchMedia.addListener((function(t){return e.update({osColorScheme:t.matches?"dark":"light"}).activateTheme()})),this.update({osColorScheme:this._matchMedia.matches?"dark":"light"}))}},{key:"settings",value:function(e,t){return 2==arguments.length?this._settingsSet(e,t):this._settingsGet(e)}},{key:"showFullscreen",value:function(e){var t,n,r,o,i=this,a=(t=document.body,n="fullscreen-wrapper",r=function(e){e.addEventListener("click",(function(t){return t.target==e&&e.hide()})),e.hide=function(){a.classList.add("hidden"),i.emit("hidemediawrapper",a)}},(o=t&&t.querySelector("."+n.split(" ").join(".")))||((o=document.createElement("div")).className=n,t&&t.appendChild(o),r&&r(o),o));return function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(a),e?(a.classList.remove("hidden"),a.appendChild(e.cloneNode(!0)),a):a.hide()}},{key:"_settingsGet",value:function(e){if("app_mode"==e)return document.body.classList.contains("for-app");if("notify_enabled"==e)return document.body.classList.contains("notify-enabled");"organization_name"==e&&(e="contactorganization"),"organization_url"==e&&(e="contactnetworkaddress");var t=this._settingsEl(e);if(!t)throw'Cannot get settings for "'+e+'".';var n={no:!1,yes:!0};return"contact"==e?atob(t.content||""):n.hasOwnProperty(t.content)?n[t.content]:t.content}},{key:"_settingsEl",value:function(e){return document.querySelector('meta[name="convos:'+e+'"]')||document.querySelector('meta[name="'+e+'"]')}},{key:"_settingsSet",value:function(e,t){if("app_mode"==e)return mt("body",/(for-)(app|cms)/,t?"app":"cms");if("notify_enabled"==e)return mt("body",/(notify-)(disabled)/,t?"enabled":"disabled");"organization_name"==e&&(e="contactorganization"),"organization_url"==e&&(e="contactnetworkaddress");var n=this._settingsEl(e);n&&("contact"==e&&(t=btoa(t)),"boolean"==typeof t&&(t=t?"yes":"no"),n.content=t)}}]),a}(_t)),ao=function(){return io.settings.apply(io,arguments)};function co(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function so(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var uo=function(n){c(f,n);var r,a,s,u,d=(r=f,function(){var e,t=i(r);if(so()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function f(n){var r;return e(this,f),(r=d.call(this)).prop("ro","enabled",(function(){return!!(r.peerConfig.ice_servers||[]).length})),r.prop("rw","conversation",null),r.prop("rw","localStream",{id:""}),r.prop("rw","peerConfig",{}),r.prop("persist","constraints",{audio:!0,video:!0}),r.prop("rw","cameras",[]),r.prop("rw","microphones",[]),r.prop("rw","speakers",[]),r.prop("rw","videoQuality","640x360"),r.prop("ro","videoQualityOptions",[["Lo-def","320x180"],["Standard","640x360"],["HD","1280x720"]]),r.connections={},r.unsubscribe={},r.call=r.call.bind(t(r)),r.hangup=r.hangup.bind(t(r)),window.addEventListener("beforeunload",r.hangup),r}return S(f,[{key:"call",value:(u=Xe(Qe.mark((function e(t,n){var r,o=this;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localStream.id){e.next=3;break}return e.next=3,this.hangup();case 3:return n||(n=this.constraints),this.unsubscribe.conversationRtc=t.on("rtc",(function(e){return o._onSignal(e)})),this.update({constraints:n,conversation:t}),e.next=8,navigator.mediaDevices.getUserMedia(n);case 8:r=e.sent,this.update({localStream:r}),this._send("call",{}),this._getDevices();case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"hangup",value:(s=Xe(Qe.mark((function e(){return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localStream.id){e.next=2;break}return e.abrupt("return");case 2:this._send("hangup",{}),this._mapPc((function(e){return e.hangup()})),this.localStream.getTracks&&this.localStream.getTracks().forEach((function(e){return e.stop()})),this.unsubscribe.conversationRtc&&this.unsubscribe.conversationRtc(),this.update({localStream:{id:""}});case 7:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"id",value:function(e){var t=String(e&&e.id||e||"").toLowerCase().replace(/\W/g,"-");return t?"uuid-"+t:""}},{key:"isMuted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio",n=this.peerConnections({target:e}).map((function(e){return e.remoteStream}))[0]||this.localStream;if(!n.id)return!0;var r="audio"==t?n.getAudioTracks():n.getVideoTracks();return!r.length||r.filter((function(e){return e.enabled})).length!=r.length}},{key:"mute",value:function(e,t,n){var r=this.peerConnections({target:e}).map((function(e){return e.remoteStream}))[0]||this.localStream;("audio"==t?r.getAudioTracks():r.getVideoTracks()).forEach((function(e){e.enabled=void 0===n?!e.enabled:!n})),this.emit("update",this,{})}},{key:"peerConnections",value:function(e){return this._mapPc((function(t){return e.target?t.target==e.target&&t:e.remoteStream?!!t.remoteStream&&t:t})).filter(Boolean)}},{key:"render",value:function(){var e=this;this._renderRtcConversation(this.id(this.localStream),this.localStream),this.peerConnections({remoteStream:!0}).forEach((function(t){e._renderRtcConversation(e.id(t),t.remoteStream)})),this.localStream.id||pt(document,".fullscreen-wrapper [data-rtc-id]",(function(){return io.showFullscreen(null)}))}},{key:"_connection",value:function(e){var t=this,n=e.from;if(this.connections[n]&&-1!=["call","hangup"].indexOf(e.type)&&(this.connections[n].hangup(),delete this.connections[n]),this.connections[n])return this.connections[n];var r=this._normalizedPeerConfig(this.peerConfig),o=new ro({localStream:this.localStream,target:n,peerConfig:r});return o.on("hangup",(function(){return delete t.connections[n]})),o.on("signal",(function(e){return t._send("signal",e)})),o.on("update",(function(){return t.emit("update",t,{})})),this.emit("connection",this.connections[n]=o),o}},{key:"_ensureEventListenersOnButtons",value:function(e){var t=this;e._addEventListenersToButtonsDone||(e._addEventListenersToButtonsDone=!0,pt(e,".rtc-conversation__name",["click",function(e){return t._toggleInfo(e)}]),pt(e,".rtc-conversation__hangup",["click",function(e){return t.hangup()}]),pt(e,".rtc-conversation__zoom",["click",function(e){return t._toggleZoomed(e)}]),pt(e,".rtc-conversation__mute-audio",["click",function(e){return t._toggleMuted(e,"audio")}]),pt(e,".rtc-conversation__mute-video",["click",function(e){return t._toggleMuted(e,"video")}]))}},{key:"_getDevices",value:(a=Xe(Qe.mark((function e(){var t;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={cameras:[],microphones:[],speakers:[],unknown:[]},e.next=3,navigator.mediaDevices.enumerateDevices();case 3:e.sent.forEach((function(e){var n="audioinput"==e.kind?"microphones":"audiooutput"==e.kind?"speakers":"videoinput"==e.kind?"cameras":"unknown";t[n].push({id:e.deviceId,name:e.label||e.text||e.deviceId})})),this.update(t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_mapPc",value:function(e){var t=this;return Object.keys(this.connections).map((function(n){return e(t.connections[n])}))}},{key:"_normalizedPeerConfig",value:function(){var e,t=(e=this.peerConfig,JSON.parse(JSON.stringify(e)));return t.iceServers=t.ice_servers||[],delete t.ice_servers,t.iceServers.forEach((function(e){e.credential_type&&(e.credentialType=e.credential_type),delete e.credential_type})),t}},{key:"_onSignal",value:function(e){return"signal"==e.type?this._connection(e).signal(e):"call"==e.type?this._connection(e).call(e):"hangup"==e.type?this._connection(e).hangup(e):void 0}},{key:"_renderRtcConversation",value:function(e,t){var n=this;pt(document,'[data-rtc-id="'+(e||"uuid-missing")+'"]',(function(e){var r=n.constraints.video;e.classList[r?"remove":"add"]("has-audio-only"),e.classList[r?"add":"remove"]("has-video"),n._renderVideoEl(e.querySelector("video"),t),n._ensureEventListenersOnButtons(e)}))}},{key:"_renderVideoEl",value:function(e,t){if(e.width=parseInt(this.videoQuality.split("x")[0],10),e.height=parseInt(this.videoQuality.split("x")[1],10),e.srcObject!=t){if(t==this.localStream){var n=[!0,0];e.muted=n[0],e.volume=n[1]}e.setAttribute("autoplay",""),e.setAttribute("playsinline",""),e.oncanplay=function(){e.parentNode.className=e.parentNode.className.replace(/has-state-\d+/,"has-state-"+e.readyState)},e.srcObject=e.classList.contains("is-disabled")?null:t}}},{key:"_send",value:function(e,t){this.conversation&&this.conversation.send(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?co(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):co(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{method:"rtc",event:e}))}},{key:"_toggleInfo",value:function(e){e.preventDefault();var t,n,r=pt(e.target.closest("[data-rtc-id]"),".rtc-conversation__info")[0];r&&(t=r,"is-visible"===(n="toggle")?t.hasAttribute("hidden"):("toggle"===n&&(n=t.hasAttribute("hidden")),n?t.removeAttribute("hidden"):t.setAttribute("hidden","")))}},{key:"_toggleMuted",value:function(e,t){var n=e.target.closest("[data-rtc-id]").dataset.rtcId;e.preventDefault(),this.mute(n,t);var r=this.isMuted(n,t)?"add":"remove";pt(document,'[data-rtc-id="'+n+'"] .rtc-conversation__mute-'+t,(function(e){return e.classList[r]("is-active")}))}},{key:"_toggleZoomed",value:function(e){var t=this;e.preventDefault();var n=e.target.closest(".btn"),r=n.classList.contains("is-active"),o=n.closest("[data-rtc-id]"),i='[data-rtc-id="'+o.dataset.rtcId+'"] .rtc-conversation__zoom';if(pt(document,i,(function(e){return e.classList[r?"remove":"add"]("is-active")})),r)pt(document,".fullscreen-wrapper [data-rtc-id]",(function(){return io.showFullscreen(null)}));else{var a=io.showFullscreen(o),c=a.querySelector("[data-rtc-id]");c.classList.add("has-focus"),c.classList.remove("is-local");var s=o.parentNode.querySelector(".rtc-conversation.is-local").cloneNode(!0);a.appendChild(s),pt(o.parentNode,"video",(function(e){return e.classList.add("is-disabled")})),io.on("hidemediawrapper").then((function(){pt(o.parentNode,"video",(function(e){return e.classList.remove("is-disabled")})),t.render()})),this.render()}}}]),f}(_t);function fo(e){var t=e-1;return t*t*t+1}function lo(e,t){var n=t.delay,r=void 0===n?0:n,o=t.duration,i=void 0===o?400:o,a=t.easing,c=void 0===a?E:a,s=+getComputedStyle(e).opacity;return{delay:r,duration:i,easing:c,css:function(e){return"opacity: ".concat(e*s)}}}function po(e,t){var n=t.delay,r=void 0===n?0:n,o=t.duration,i=void 0===o?400:o,a=t.easing,c=void 0===a?fo:a,s=t.x,u=void 0===s?0:s,d=t.y,f=void 0===d?0:d,l=t.opacity,p=void 0===l?0:l,h=getComputedStyle(e),m=+h.opacity,v="none"===h.transform?"":h.transform,g=m*(1-p);return{delay:r,duration:i,easing:c,css:function(e,t){return"\n\t\t\ttransform: ".concat(v," translate(").concat((1-e)*u,"px, ").concat((1-e)*f,"px);\n\t\t\topacity: ").concat(m-g*t)}}}function ho(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function mo(e){var t,n,r,o,i;return{c:function(){X(t=K("i"),"class",n=e[3](e[2],e[1],bo)),X(t,"style",r=$o(e[2],e[1],e[0])),t.hidden=o=!e[2]},m:function(n,r,o){q(n,t,r),o&&i(),i=Q(t,"click",e[6])},p:function(e,i){var a=p(i,1)[0];6&a&&n!==(n=e[3](e[2],e[1],bo))&&X(t,"class",n),7&a&&r!==(r=$o(e[2],e[1],e[0]))&&X(t,"style",r),4&a&&o!==(o=!e[2])&&(t.hidden=o)},i:x,o:x,d:function(e){e&&G(t),i()}}}var vo={brand:"fab",regular:"far",solid:"fas"},go={batman:"https://www.gravatar.com/avatar/ab1839667863f31e359d98364cfdef61",marcusr:"https://www.gravatar.com/avatar/6c056546d802b1a9ac186ab63f9fb632"},yo=["fas fa-anchor","fas fa-atom","fas fa-award","fas fa-balance-scale","fas fa-baseball-ball","fas fa-basketball-ball","fas fa-bicycle","fas fa-bolt","fas fa-book-reader","fas fa-candy-cane","fas fa-carrot","fas fa-cat","fas fa-chess-knight","fas fa-child","fas fa-coffee","fas fa-cookie-bite","fas fa-crow","fas fa-dice","fas fa-dog","fas fa-dove","fas fa-feather","fas fa-fish","fas fa-gem","fas fa-ghost","fas fa-hard-hat","fas fa-hat-cowboy","fas fa-hat-wizard","fas fa-hiking","fas fa-horse-head","fas fa-horse","fas fa-id-badge","fas fa-igloo","fas fa-mask","fas fa-meteor","fas fa-paint-brush","fas fa-paw","fas fa-pepper-hot","fas fa-pizza-slice","fas fa-portrait","fas fa-puzzle-piece","fas fa-rainbow","fas fa-robot","fas fa-rocket","fas fa-running","fas fa-seedling","fas fa-skating","fas fa-skiing","fas fa-smile","fas fa-snowboarding","fas fa-snowflake","fas fa-snowman","fas fa-swimmer","fas fa-umbrella","fas fa-user-astronaut","fas fa-user-graduate","fas fa-user-ninja","fas fa-user-secret","fas fa-walking","fas fa-yin-yang"],bo=!1;function $o(e,t,n,r){var o=[],i="color:",a=e.match(/^pick:(.+)$/);return a&&go[a[1]]&&(i="background-color:",o.push('background-image:url("'+go[a[1]]+'")')),n&&o.push(i+n),o.join(";")}function _o(e,t,n){var r=t.class,o=void 0===r?"":r,i=t.animation,a=void 0===i?"":i,c=t.color,s=void 0===c?"":c,u=t.family,d=void 0===u?"":u,f=t.name;return e.$set=function(e){"class"in e&&n(4,o=e.class),"animation"in e&&n(5,a=e.animation),"color"in e&&n(0,s=e.color),"family"in e&&n(1,d=e.family),"name"in e&&n(2,f=e.name)},[s,d,f,function(e,t,n){var r=[],i=e.match(/^pick:(.+)$/);if(i){if("Convos"==i[1])return"fas fa-info-circle";if(go[i[1]])return"fas fa-contributor for-"+i[1].toLowerCase();r.push(function(e){if(e.match(/^\d+$/)&&console.log(yo[e]),e.match(/^\d+$/))return yo[e];for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t),t&=t;return t=Math.abs(t),yo[t%yo.length]}(i[1]))}else r.push(vo[t]||"fas"),r.push("fa-"+e);return a&&r.push(a.split(" ").map((function(e){return"fa-"+e}))),o&&r.push(o.split(" ")),r.join(" ")},o,a,function(t){be(e,t)}]}var wo=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(ho()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,_o,mo,D,{class:4,animation:5,color:0,family:1,name:2}),r}return s}(Ye);function ko(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Co(e){var t,n,r,o,i,a=new wo({props:{animation:e[4],name:e[0]}}),c=e[14].default,s=j(c,e,e[13],null);return{c:function(){t=K("button"),Ge(a.$$.fragment),n=J(),s&&s.c(),X(t,"class",r=e[5].join(" ")),t.disabled=e[6],X(t,"type",e[3]),X(t,"data-tooltip",e[2]),oe(t,"has-tooltip",!!e[2].length)},m:function(r,c,u){q(r,t,c),We(a,t,null),H(t,n),s&&s.m(t,null),o=!0,u&&i(),i=Q(t,"click",e[15])},p:function(e,n){var i=p(n,1)[0],u={};16&i&&(u.animation=e[4]),1&i&&(u.name=e[0]),a.$set(u),s&&s.p&&8192&i&&s.p(A(c,e,e[13],null),L(c,e[13],i,null)),(!o||32&i&&r!==(r=e[5].join(" ")))&&X(t,"class",r),(!o||64&i)&&(t.disabled=e[6]),(!o||8&i)&&X(t,"type",e[3]),(!o||4&i)&&X(t,"data-tooltip",e[2]),36&i&&oe(t,"has-tooltip",!!e[2].length)},i:function(e){o||(Ie(a.$$.fragment,e),Ie(s,e),o=!0)},o:function(e){Ue(a.$$.fragment,e),Ue(s,e),o=!1},d:function(e){e&&G(t),Ke(a),s&&s.d(e),i()}}}function So(e,t,n){var r,o=x,i=function(){return o(),o=M(g,(function(e){return n(11,r=e)})),g};e.$$.on_destroy.push((function(){return o()}));var a="",c=t.class,s=void 0===c?"":c,u=[],d=!1,f=0,l=t.disabled,p=void 0!==l&&l,h=t.icon,m=void 0===h?"":h,v=t.op,g=void 0===v?new Ot({api:!1,id:""}):v;i();var y=t.tooltip,b=void 0===y?"":y,$=t.type,_=void 0===$?"":$;function w(e){e&&n(10,f=(new Rt).toEpoch()),n(4,a=e?"spin":""),n(9,d=e)}var k,C=t.$$slots,S=void 0===C?{}:C,E=t.$$scope;return e.$set=function(e){"class"in e&&n(7,s=e.class),"disabled"in e&&n(8,p=e.disabled),"icon"in e&&n(0,m=e.icon),"op"in e&&i(n(1,g=e.op)),"tooltip"in e&&n(2,b=e.tooltip),"type"in e&&n(3,_=e.type),"$$scope"in e&&n(13,E=e.$$scope)},e.$$.update=function(){2048&e.$$.dirty&&r.is("loading")&&w(!0),3072&e.$$.dirty&&(r.is("loading")||setTimeout((function(){return w(!1)}),700-((new Rt).toEpoch()-f))),129&e.$$.dirty&&n(5,u=["btn","for-"+(m||"default")].concat(s)),768&e.$$.dirty&&n(6,k=p||d)},[m,g,b,_,a,u,k,s,p,d,f,r,w,E,S,function(t){be(e,t)}]}var xo=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(ko()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,So,Co,D,{class:7,disabled:8,icon:0,op:1,tooltip:2,type:3}),r}return s}(Ye);function Eo(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Ro(e){var t,n,r,o,i,a=new wo({props:{name:"pick:Convos",color:"inherit"}});return{c:function(){Ge(a.$$.fragment),t=J(),(n=K("b")).textContent="".concat(e[2].format("%H:%M")),r=J(),(o=K("a")).textContent="".concat(dn("Convos")),X(n,"class","message__ts"),X(o,"href","/settings/account"),X(o,"class","message__from"),X(o,"color","inherit")},m:function(e,c){We(a,e,c),q(e,t,c),q(e,n,c),q(e,r,c),q(e,o,c),i=!0},p:x,i:function(e){i||(Ie(a.$$.fragment,e),i=!0)},o:function(e){Ue(a.$$.fragment,e),i=!1},d:function(e){Ke(a,e),e&&G(t),e&&G(n),e&&G(r),e&&G(o)}}}function To(e){var t,n,r,o,i,a=!e[0]&&Ro(e),c=e[4].default,s=j(c,e,e[3],null);return{c:function(){t=K("div"),a&&a.c(),n=J(),r=K("div"),s&&s.c(),X(r,"class","message__text"),X(t,"class",o="message is-type-"+e[1])},m:function(e,o){q(e,t,o),a&&a.m(t,null),H(t,n),H(t,r),s&&s.m(r,null),i=!0},p:function(e,r){var u=p(r,1)[0];e[0]?a&&(Ae(),Ue(a,1,1,(function(){a=null})),Le()):a?(a.p(e,u),Ie(a,1)):((a=Ro(e)).c(),Ie(a,1),a.m(t,n)),s&&s.p&&8&u&&s.p(A(c,e,e[3],null),L(c,e[3],u,null)),(!i||2&u&&o!==(o="message is-type-"+e[1]))&&X(t,"class",o)},i:function(e){i||(Ie(a),Ie(s,e),i=!0)},o:function(e){Ue(a),Ue(s,e),i=!1},d:function(e){e&&G(t),a&&a.d(),s&&s.d(e)}}}function Oo(e,t,n){var r=t.same,o=void 0!==r&&r,i=t.type,a=void 0===i?"notice":i,c=new Rt,s=t.$$slots,u=void 0===s?{}:s,d=t.$$scope;return e.$set=function(e){"same"in e&&n(0,o=e.same),"type"in e&&n(1,a=e.type),"$$scope"in e&&n(3,d=e.$$scope)},[o,a,c,d,u]}var Po=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Eo()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Oo,To,D,{same:0,type:1}),r}return s}(Ye);function Do(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Mo(e){var t,n,r,o,i,a,c,s,u,d=e[1].unread+"",f=e[4].default,l=j(f,e,e[3],null),h=new wo({props:{name:"bars"}}),m=new wo({props:{name:"times"}});return{c:function(){t=K("header"),l&&l.c(),n=J(),r=K("a"),Ge(h.$$.fragment),o=J(),Ge(m.$$.fragment),i=J(),a=K("small"),c=V(d),X(a,"class","chat-header__unread"),a.hidden=s=!e[1].unread,X(r,"href","#activeMenu:nav"),X(r,"class","btn is-hamburger can-toggle"),oe(r,"is-toggled","nav"==e[0].activeMenu),X(t,"class","chat-header")},m:function(e,s){q(e,t,s),l&&l.m(t,null),H(t,n),H(t,r),We(h,r,null),H(r,o),We(m,r,null),H(r,i),H(r,a),H(a,c),u=!0},p:function(e,t){var n=p(t,1)[0];l&&l.p&&8&n&&l.p(A(f,e,e[3],null),L(f,e[3],n,null)),(!u||2&n)&&d!==(d=e[1].unread+"")&&te(c,d),(!u||2&n&&s!==(s=!e[1].unread))&&(a.hidden=s),1&n&&oe(r,"is-toggled","nav"==e[0].activeMenu)},i:function(e){u||(Ie(l,e),Ie(h.$$.fragment,e),Ie(m.$$.fragment,e),u=!0)},o:function(e){Ue(l,e),Ue(h.$$.fragment,e),Ue(m.$$.fragment,e),u=!1},d:function(e){e&&G(t),l&&l.d(e),Ke(h),Ke(m)}}}function No(e,t,n){var r,o;N(e,Kt,(function(e){return n(0,r=e)}));var i=ye("user");N(e,i,(function(e){return n(1,o=e)}));var a=t.$$slots,c=void 0===a?{}:a,s=t.$$scope;return e.$set=function(e){"$$scope"in e&&n(3,s=e.$$scope)},[r,o,i,s,c]}var jo=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Do()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,No,Mo,D,{}),r}return s}(Ye);function Ao(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return Lo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lo(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function Lo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Io=[];function Uo(e,t){return Uo[e]?Uo[e](t):[]}function zo(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Bo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fo(e,t,n){var r=e.slice();return r[34]=t[n],r[36]=n,r}function Ho(e){var t,n,r=(e[34].text||e[34].val)+"";return{c:function(){X(t=K("a"),"href","#index:"+e[36]),X(t,"tabindex","-1"),oe(t,"has-focus",e[36]==e[2])},m:function(o,i,a){q(o,t,i),t.innerHTML=r,a&&n(),n=Q(t,"click",Z(e[10]))},p:function(e,n){128&n[0]&&r!==(r=(e[34].text||e[34].val)+"")&&(t.innerHTML=r),4&n[0]&&oe(t,"has-focus",e[36]==e[2])},d:function(e){e&&G(t),n()}}}function qo(e){for(var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v=new wo({props:{name:"cloud-upload-alt"}}),g=new wo({props:{name:e[9]}}),y=e[7],b=[],$=0;$<y.length;$+=1)b[$]=Ho(Fo(e,y,$));return{c:function(){t=K("form"),n=K("textarea"),r=J(),o=K("label"),i=K("input"),a=J(),Ge(v.$$.fragment),s=J(),u=K("button"),Ge(g.$$.fragment),d=J(),f=K("div");for(var h=0;h<b.length;h+=1)b[h].c();X(n,"class","is-primary-input"),X(n,"placeholder",e[8]),X(i,"type","file"),X(o,"class","upload is-hallow"),o.hidden=c=!e[0].is("conversation"),X(u,"type","buttton"),X(u,"class","btn chat-input__send"),X(f,"class",l="chat-input_autocomplete chat-input_autocomplete_"+e[3]),f.hidden=p=!e[7].length,X(t,"class","chat-input")},m:function(c,l,p){q(c,t,l),H(t,n),e[29](n),H(t,r),H(t,o),H(o,i),e[33](i),H(o,a),We(v,o,null),H(t,s),H(t,u),We(g,u,null),H(t,d),H(t,f);for(var y=0;y<b.length;y+=1)b[y].m(f,null);h=!0,p&&O(m),m=[Q(n,"change",e[30]),Q(n,"keydown",e[31]),Q(n,"keyup",e[32]),Q(i,"change",e[11]),Q(u,"click",e[1]),Q(t,"submit",Z(e[28]))]},p:function(e,t){(!h||256&t[0])&&X(n,"placeholder",e[8]),(!h||1&t[0]&&c!==(c=!e[0].is("conversation")))&&(o.hidden=c);var r={};if(512&t[0]&&(r.name=e[9]),g.$set(r),1156&t[0]){var i;for(y=e[7],i=0;i<y.length;i+=1){var a=Fo(e,y,i);b[i]?b[i].p(a,t):(b[i]=Ho(a),b[i].c(),b[i].m(f,null))}for(;i<b.length;i+=1)b[i].d(1);b.length=y.length}(!h||8&t[0]&&l!==(l="chat-input_autocomplete chat-input_autocomplete_"+e[3]))&&X(f,"class",l),(!h||128&t[0]&&p!==(p=!e[7].length))&&(f.hidden=p)},i:function(e){h||(Ie(v.$$.fragment,e),Ie(g.$$.fragment,e),h=!0)},o:function(e){Ue(v.$$.fragment,e),Ue(g.$$.fragment,e),h=!1},d:function(n){n&&G(t),e[29](null),e[33](null),Ke(v),Ke(g),W(b,n),O(m)}}}function Go(e,t,n){var r;N(e,Kt,(function(e){return n(20,r=e)}));var o=w,i=t.conversation,a=void 0===i?{}:i;var c,s,u=0,d="none",f=0,l=ye("api"),h=ye("user");function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.space||"";a.update({userInput:x[0]+e+r+x[3]}),n(4,c.selectionStart=n(4,c.selectionEnd=(x[0]+e+r).length,c),c),r.length&&n(5,f=c.selectionStart)}function v(e){var t=p(e,4),r=t[0],o=t[1],i=t[2];t[3];n(3,d=":"==o&&i.length?"emojis":"/"!=o||r.length?"@"==o&&i.length?"nicks":"#"==o||"&"==o?"conversations":"none":"commands"),n(2,u=0);var c=Uo(d,{conversation:a,query:o+i,user:h});return c.length&&c.unshift({val:o+i}),c}function g(e){if(!c)return["","","",""];var t="",n="";return[c.value.substring(0,e).replace(/(\S)(\S*)$/,(function(e,r,o){return t=r,n=o,""})),t,n,c.value.substring(e)]}function y(e){var t=C[u];t&&m(t.val,e)}function b(e,t){C.length&&(e.preventDefault(),n(2,u+=t),u<0&&n(2,u=C.length-1),u>=C.length&&n(2,u=0),y({space:""}))}function $(e){e.errors&&a&&e.conversation_id!=a.conversation_id&&a.addMessage(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bo(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{message:'Message "%1" failed: %2',type:"error",vars:[e.message,st(e.errors)]}))}function _(e){e.preventDefault&&e.preventDefault();var t={method:"send"};t.message=e.preventDefault?c.value:e.message,t.message=t.message.replace(/^\/close/i,"/part"),t.message=t.message.replace(/^\/j\b/i,"/join"),t.message=t.message.replace(/^\/raw/i,"/quote"),t.message.length&&a.send(t).then($),a.is("search")||a.update({userInput:""}),n(5,f=0)}function w(e){var t=e.target&&e.target.files||e.dataTransfer&&e.dataTransfer.files;if(t&&t.length){if(t.length>1)return console.log("Cannot upload more than one file.");var n=new FormData;n.append("file",t[0]),l("uploadFile").perform({formData:n}).then((function(e){var t=e.res.body;if(t.files&&t.files.length)return m(t.files[0].url);t.errors&&a.addMessage({message:"Could not upload file: %1",vars:[dn(st(t.errors))],type:"error"})}))}}var k={ArrowDown:function(e){return b(e,e.shiftKey?4:1)},ArrowUp:function(e){return b(e,e.shiftKey?-4:-1)},Tab:function(e){return b(e,e.shiftKey?-1:1)},Enter:function(e){C[u]?(e.preventDefault(),y({space:" "})):e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||_(e)},Fallback:function(e){},Release:function(e){1!=e.key.length&&-1==["ArrowLeft","ArrowRight","Backspace"].indexOf(e.key)||n(5,f=c.selectionStart)}};var C,S,x,E,R,T;return e.$set=function(e){"conversation"in e&&n(0,a=e.conversation)},e.$$.update=function(){32&e.$$.dirty[0]&&n(17,x=g(f)),131072&e.$$.dirty[0]&&n(7,C=v(x)||[]),1&e.$$.dirty[0]&&n(18,S=h.findConversation({connection_id:a.connection_id})),262144&e.$$.dirty[0]&&n(19,E=S&&S.nick),786433&e.$$.dirty[0]&&n(8,R=a.is("search")?"What are you looking for?":S&&S.is("unreachable")?dn("Connecting..."):dn("What is on your mind %1?",E)),1&e.$$.dirty[0]&&n(9,T=a.is("search")?"search":"paper-plane"),1048593&e.$$.dirty[0]&&r&&c&&a&&n(4,c.value=void 0===a.userInput?"":a.userInput,c),49&e.$$.dirty[0]&&f&&a.update({userInput:c.value})},[a,_,u,d,c,f,s,C,R,T,function(e){n(2,u=parseInt(e.target.closest("a").href.replace(/.*index:/,""),10)),y({space:" "}),c.focus()},w,k,o,function(){return s},function(e){a.update({userInput:e})},m,x,S,E,r,l,h,v,g,y,b,$,function(t){be(e,t)},function(e){_e[e?"unshift":"push"]((function(){n(4,c=e)}))},function(e){n(5,f=c.selectionStart)},function(e){return(k[e.key]||k.Fallback)(e)},function(e){return k.Release(e)},function(e){_e[e?"unshift":"push"]((function(){n(6,s=e)}))}]}Uo.commands=function(e){for(var t=e.query,n=[],r=0;r<Io.length;r++)if(0==Io[r].cmd.indexOf(t)){var o=Io[r].alias||Io[r].cmd,i=Io[r].example.replace(/</g,"&lt;");n.push({text:i,val:o})}return n},Uo.conversations=function(e){for(var t=e.conversation,n=e.query,r=e.user,o=r.findConversation({connection_id:t.connection_id}),i=o?o.conversations.toArray():r.conversations(),a=[],c=0;c<i.length&&!(-1!=i[c].name.toLowerCase().indexOf(n)&&(a.push({text:i[c].name,val:i[c].conversation_id}),a.length>=20));c++);return a},Uo.emojis=function(e){var t=e.query,n=[];return[":","_"].map((function(e){return e+t.slice(1,2)})).forEach((function(e){for(var r=Xt(e,"group"),o=0;o<r.length&&(r[o].shortname.indexOf(t)>=0&&n.push({val:r[o].emoji,text:en(r[o].emoji)}),!(n.length>=20));o++);})),n},Uo.nicks=function(e){var t,n=e.conversation,r=e.query,o=n.participants(),i=new RegExp("^"+ht(r.slice(1)),"i"),a=[],c=Ao(o);try{for(c.s();!(t=c.n()).done;){var s=t.value;if(a.length>=20)break;s.nick.match(i)&&a.push({val:s.nick})}}catch(e){c.e(e)}finally{c.f()}return a},Io.push({cmd:"/me",example:"/me <msg>",description:"Send message as an action."}),Io.push({cmd:"/say",example:"/say <msg>",description:'Used when you want to send a message starting with "/".'}),Io.push({cmd:"/topic",example:"/topic or /topic <new topic>",description:"Show current topic, or set a new one."}),Io.push({cmd:"/whois",example:"/whois <nick>",description:"Show information about a user."}),Io.push({cmd:"/query",example:"/query <nick>",description:"Open up a new chat window with nick."}),Io.push({cmd:"/msg",example:"/msg <nick> <msg>",description:"Send a direct message to nick."}),Io.push({cmd:"/names",example:"/names",description:"Show participants in the channel."}),Io.push({cmd:"/join",example:"/join <#channel>",description:"Join channel and open up a chat window."}),Io.push({cmd:"/nick",example:"/nick <nick>",description:"Change your wanted nick."}),Io.push({cmd:"/part",example:"/part",description:"Leave channel, and close window."}),Io.push({cmd:"/close",example:"/close <nick>",description:"Close conversation with nick, defaults to current active."}),Io.push({cmd:"/kick",example:"/kick <nick>",description:"Kick a user from the current channel."}),Io.push({cmd:"/mode",example:"/mode [+|-][b|o|v] <user>",description:"Change mode of yourself or a user"}),Io.push({cmd:"/reconnect",example:"/reconnect",description:"Restart the current connection."}),Io.push({cmd:"/clear",example:"/clear history <#channel> or /clear history <nick>",description:"Delete all history for the given conversation."}),Io.push({cmd:"/oper",example:"/oper <msg>",description:"Send server operator messages."}),Io.push({cmd:"/quote",example:"/quote <irc-command>",description:"Allow you to send any raw IRC message."});var Wo=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(zo()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Go,qo,D,{uploader:13,conversation:0,getUploadEl:14,setValue:15,add:16,sendMessage:1},[-1,-1]),r}return S(s,[{key:"uploader",get:function(){return this.$$.ctx[13]}},{key:"getUploadEl",get:function(){return this.$$.ctx[14]}},{key:"setValue",get:function(){return this.$$.ctx[15]}},{key:"add",get:function(){return this.$$.ctx[16]}},{key:"sendMessage",get:function(){return this.$$.ctx[1]}}]),s}(Ye);function Ko(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Vo(e){var t,n,r,o=e[9].default,i=j(o,e,e[8],null);return{c:function(){t=K("a"),i&&i.c(),X(t,"href",e[3]),X(t,"class",e[0]),X(t,"style",e[1]),oe(t,"has-path",e[4])},m:function(o,a,c){q(o,t,a),i&&i.m(t,null),e[11](t),n=!0,c&&r(),r=Q(t,"click",e[10])},p:function(e,r){var a=p(r,1)[0];i&&i.p&&256&a&&i.p(A(o,e,e[8],null),L(o,e[8],a,null)),(!n||8&a)&&X(t,"href",e[3]),(!n||1&a)&&X(t,"class",e[0]),(!n||2&a)&&X(t,"style",e[1]),17&a&&oe(t,"has-path",e[4])},i:function(e){n||(Ie(i,e),n=!0)},o:function(e){Ue(i,e),n=!1},d:function(n){n&&G(t),i&&i.d(n),e[11](null),r()}}}function Jo(e,t,n){var r;N(e,Kt,(function(e){return n(7,r=e)}));var o,i,a,c=t.class,s=void 0===c?"":c,u=t.href,d=void 0===u?"/":u,f=t.style,l=void 0===f?"":f,p=t.$$slots,h=void 0===p?{}:p,m=t.$$scope;return e.$set=function(e){"class"in e&&n(0,s=e.class),"href"in e&&n(5,d=e.href),"style"in e&&n(1,l=e.style),"$$scope"in e&&n(8,m=e.$$scope)},e.$$.update=function(){160&e.$$.dirty&&n(3,i=0==d.indexOf("/")?r.basePath+d:d),136&e.$$.dirty&&n(4,a=r.basePath+r.path==i.replace(/(#|\?).*/,""))},[s,l,o,i,a,d,function(){return o.focus()},r,m,h,function(t){be(e,t)},function(e){_e[e?"unshift":"push"]((function(){n(2,o=e)}))}]}var Yo=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Ko()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Jo,Vo,D,{class:0,href:5,style:1,focus:6}),r}return S(s,[{key:"focus",get:function(){return this.$$.ctx[6]}}]),s}(Ye);function Qo(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Zo(e,t,n){var r=e.slice();return r[8]=t[n],r}function Xo(e,t,n){var r=e.slice();return r[11]=t[n],r}function ei(e){for(var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g,y=e[3].nick+"",b=e[2].constraints.video&&ti(),$=new wo({props:{name:"pick:"+e[3].nick,family:"solid"}}),_=e[2].peerConnections({remoteStream:!0}),w=[],k=0;k<_.length;k+=1)w[k]=ri(Xo(e,_,k));var C=function(e){return Ue(w[e],1,1,(function(){w[e]=null}))};return{c:function(){t=K("div"),n=K("div"),r=K("video"),o=J(),i=K("div"),b&&b.c(),a=J(),(c=K("button")).innerHTML="<i></i>",s=J(),(u=K("button")).innerHTML="<i></i>",d=J(),f=K("span"),Ge($.$$.fragment),l=J(),p=K("span"),h=V(y),v=J();for(var g=0;g<w.length;g+=1)w[g].c();X(c,"class","btn rtc-conversation__hangup"),X(u,"class","btn rtc-conversation__mute-audio"),X(i,"class","rtc-conversation__actions"),X(f,"class","rtc-conversation__name"),X(n,"class","rtc-conversation is-local has-state-0"),X(n,"data-rtc-id",m=e[4].id(e[2].localStream)),X(t,"class","rtc-conversations")},m:function(e,m){q(e,t,m),H(t,n),H(n,r),H(n,o),H(n,i),b&&b.m(i,null),H(i,a),H(i,c),H(i,s),H(i,u),H(n,d),H(n,f),We($,f,null),H(f,l),H(f,p),H(p,h),H(t,v);for(var y=0;y<w.length;y+=1)w[y].m(t,null);g=!0},p:function(e,r){e[2].constraints.video?b||((b=ti()).c(),b.m(i,a)):b&&(b.d(1),b=null);var o={};if(8&r&&(o.name="pick:"+e[3].nick),$.$set(o),(!g||8&r)&&y!==(y=e[3].nick+"")&&te(h,y),(!g||4&r&&m!==(m=e[4].id(e[2].localStream)))&&X(n,"data-rtc-id",m),20&r){var c;for(_=e[2].peerConnections({remoteStream:!0}),c=0;c<_.length;c+=1){var s=Xo(e,_,c);w[c]?(w[c].p(s,r),Ie(w[c],1)):(w[c]=ri(s),w[c].c(),Ie(w[c],1),w[c].m(t,null))}for(Ae(),c=_.length;c<w.length;c+=1)C(c);Le()}},i:function(e){if(!g){Ie($.$$.fragment,e);for(var t=0;t<_.length;t+=1)Ie(w[t]);g=!0}},o:function(e){Ue($.$$.fragment,e),w=w.filter(Boolean);for(var t=0;t<w.length;t+=1)Ue(w[t]);g=!1},d:function(e){e&&G(t),b&&b.d(),Ke($),W(w,e)}}}function ti(e){var t,n,r;return{c:function(){(t=K("button")).innerHTML="<i></i>",n=J(),(r=K("button")).innerHTML="<i></i>",X(t,"class","btn rtc-conversation__zoom"),X(r,"class","btn rtc-conversation__mute-video")},m:function(e,o){q(e,t,o),q(e,n,o),q(e,r,o)},d:function(e){e&&G(t),e&&G(n),e&&G(r)}}}function ni(e){var t,n,r;return{c:function(){(t=K("button")).innerHTML="<i></i>",n=J(),(r=K("button")).innerHTML="<i></i>",X(t,"class","btn rtc-conversation__zoom"),X(r,"class","btn rtc-conversation__mute-video"),r.disabled=!0},m:function(e,o){q(e,t,o),q(e,n,o),q(e,r,o)},d:function(e){e&&G(t),e&&G(n),e&&G(r)}}}function ri(e){var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g,y,b,$,_,w,k,C,S,x,E,R,T,O,P,D,M,N,j,A,L,I,U,z,B,F,W,Y,Q,Z,ee,ne,re,oe,ie,ae,ce,se,ue,de,fe,le,pe,he,me,ve,ge=e[11].info.bytesReceived+"",ye=e[11].info.bytesSent+"",be=dn(e[11].info.signalingState||"unknown")+"",$e=dn(e[11].info.iceConnectionState||"unknown")+"",_e=dn(e[11].info.iceGatheringState||"unknown")+"",we=(e[11].info.localAddress||"0.0.0.0")+"",ke=(e[11].info.remoteAddress||"0.0.0.0")+"",Ce=Math.round(e[11].info.audio.outbound.framerateMean||0)+"",Se=Math.round(e[11].info.video.inbound.framerateMean||0)+"",xe=(e[11].info.audio.inbound.jitter||0)+"",Ee=(e[11].info.audio.outbound.packetsSent||0)+"",Re=(e[11].info.audio.inbound.packetsReceived||0)+"",Te=(e[11].info.audio.inbound.discardedPackets||0)+"",Oe=(e[11].info.audio.outbound.droppedFrames||0)+"",Pe=(e[11].info.audio.inbound.packetsLost||0)+"",De=Math.round(e[11].info.video.outbound.framerateMean||0)+"",Me=Math.round(e[11].info.video.inbound.framerateMean||0)+"",Ne=(e[11].info.video.inbound.jitter||0)+"",je=(e[11].info.video.outbound.packetsSent||0)+"",Ae=(e[11].info.video.inbound.packetsReceived||0)+"",Le=(e[11].info.video.inbound.discardedPackets||0)+"",ze=(e[11].info.video.outbound.droppedFrames||0)+"",Be=(e[11].info.video.inbound.packetsLost||0)+"",Fe=e[11].target+"",He=e[2].constraints.video&&ni(),qe=new wo({props:{name:"pick:"+e[11].target.toLowerCase(),family:"solid"}});return{c:function(){t=K("div"),n=K("video"),r=J(),o=K("pre"),i=V("Received: "),a=V(ge),c=V(" B\nSent: "),s=V(ye),u=V(" B\nSignalling state: "),d=V(be),f=V("\nICE connection state: "),l=V($e),p=V("\nICE gathering state: "),h=V(_e),m=V("\nLocal address: "),v=V(we),g=V("\nRemote address: "),y=V(ke),b=V("\n\nVideo:\n  Framerate: "),$=V(Ce),_=V("/"),w=V(Se),k=V("\n  Jitter: "),C=V(xe),S=V("\n  Sent: "),x=V(Ee),E=V("\n  Received: "),R=V(Re),T=V("\n  Discarded: "),O=V(Te),P=V("\n  Dropped: "),D=V(Oe),M=V("\n  Lost: "),N=V(Pe),j=V("\n\nAudio:\n  Framerate: "),A=V(De),L=V("/"),I=V(Me),U=V("\n  Jitter: "),z=V(Ne),B=V("\n  Sent: "),F=V(je),W=V("\n  Received: "),Y=V(Ae),Q=V("\n  Discarded: "),Z=V(Le),ee=V("\n  Dropped: "),ne=V(ze),re=V("\n  Lost: "),oe=V(Be),ie=J(),ae=K("div"),He&&He.c(),ce=J(),(se=K("button")).innerHTML="<i></i>",ue=J(),de=K("a"),Ge(qe.$$.fragment),fe=J(),le=K("span"),pe=V(Fe),he=J(),X(o,"class","rtc-conversation__info"),o.hidden=!0,X(se,"class","btn rtc-conversation__mute-audio"),se.disabled=!0,X(ae,"class","rtc-conversation__actions"),X(de,"href","#info"),X(de,"class","rtc-conversation__name"),X(t,"class","rtc-conversation is-remote has-state-0"),X(t,"data-rtc-id",me=e[4].id(e[11]))},m:function(e,G){q(e,t,G),H(t,n),H(t,r),H(t,o),H(o,i),H(o,a),H(o,c),H(o,s),H(o,u),H(o,d),H(o,f),H(o,l),H(o,p),H(o,h),H(o,m),H(o,v),H(o,g),H(o,y),H(o,b),H(o,$),H(o,_),H(o,w),H(o,k),H(o,C),H(o,S),H(o,x),H(o,E),H(o,R),H(o,T),H(o,O),H(o,P),H(o,D),H(o,M),H(o,N),H(o,j),H(o,A),H(o,L),H(o,I),H(o,U),H(o,z),H(o,B),H(o,F),H(o,W),H(o,Y),H(o,Q),H(o,Z),H(o,ee),H(o,ne),H(o,re),H(o,oe),H(t,ie),H(t,ae),He&&He.m(ae,null),H(ae,ce),H(ae,se),H(t,ue),H(t,de),We(qe,de,null),H(de,fe),H(de,le),H(le,pe),H(t,he),ve=!0},p:function(e,n){(!ve||4&n)&&ge!==(ge=e[11].info.bytesReceived+"")&&te(a,ge),(!ve||4&n)&&ye!==(ye=e[11].info.bytesSent+"")&&te(s,ye),(!ve||4&n)&&be!==(be=dn(e[11].info.signalingState||"unknown")+"")&&te(d,be),(!ve||4&n)&&$e!==($e=dn(e[11].info.iceConnectionState||"unknown")+"")&&te(l,$e),(!ve||4&n)&&_e!==(_e=dn(e[11].info.iceGatheringState||"unknown")+"")&&te(h,_e),(!ve||4&n)&&we!==(we=(e[11].info.localAddress||"0.0.0.0")+"")&&te(v,we),(!ve||4&n)&&ke!==(ke=(e[11].info.remoteAddress||"0.0.0.0")+"")&&te(y,ke),(!ve||4&n)&&Ce!==(Ce=Math.round(e[11].info.audio.outbound.framerateMean||0)+"")&&te($,Ce),(!ve||4&n)&&Se!==(Se=Math.round(e[11].info.video.inbound.framerateMean||0)+"")&&te(w,Se),(!ve||4&n)&&xe!==(xe=(e[11].info.audio.inbound.jitter||0)+"")&&te(C,xe),(!ve||4&n)&&Ee!==(Ee=(e[11].info.audio.outbound.packetsSent||0)+"")&&te(x,Ee),(!ve||4&n)&&Re!==(Re=(e[11].info.audio.inbound.packetsReceived||0)+"")&&te(R,Re),(!ve||4&n)&&Te!==(Te=(e[11].info.audio.inbound.discardedPackets||0)+"")&&te(O,Te),(!ve||4&n)&&Oe!==(Oe=(e[11].info.audio.outbound.droppedFrames||0)+"")&&te(D,Oe),(!ve||4&n)&&Pe!==(Pe=(e[11].info.audio.inbound.packetsLost||0)+"")&&te(N,Pe),(!ve||4&n)&&De!==(De=Math.round(e[11].info.video.outbound.framerateMean||0)+"")&&te(A,De),(!ve||4&n)&&Me!==(Me=Math.round(e[11].info.video.inbound.framerateMean||0)+"")&&te(I,Me),(!ve||4&n)&&Ne!==(Ne=(e[11].info.video.inbound.jitter||0)+"")&&te(z,Ne),(!ve||4&n)&&je!==(je=(e[11].info.video.outbound.packetsSent||0)+"")&&te(F,je),(!ve||4&n)&&Ae!==(Ae=(e[11].info.video.inbound.packetsReceived||0)+"")&&te(Y,Ae),(!ve||4&n)&&Le!==(Le=(e[11].info.video.inbound.discardedPackets||0)+"")&&te(Z,Le),(!ve||4&n)&&ze!==(ze=(e[11].info.video.outbound.droppedFrames||0)+"")&&te(ne,ze),(!ve||4&n)&&Be!==(Be=(e[11].info.video.inbound.packetsLost||0)+"")&&te(oe,Be),e[2].constraints.video?He||((He=ni()).c(),He.m(ae,ce)):He&&(He.d(1),He=null);var r={};4&n&&(r.name="pick:"+e[11].target.toLowerCase()),qe.$set(r),(!ve||4&n)&&Fe!==(Fe=e[11].target+"")&&te(pe,Fe),(!ve||4&n&&me!==(me=e[4].id(e[11])))&&X(t,"data-rtc-id",me)},i:function(e){ve||(Ie(qe.$$.fragment,e),ve=!0)},o:function(e){Ue(qe.$$.fragment,e),ve=!1},d:function(e){e&&G(t),He&&He.d(),Ke(qe)}}}function oi(e){for(var t,n,r,o,i,a,c,s,u=dn("Participants (%1)",e[0].participants().length)+"",d=e[0].participants(),f=[],l=0;l<d.length;l+=1)f[l]=ai(Zo(e,d,l));var p=function(e){return Ue(f[e],1,1,(function(){f[e]=null}))};return{c:function(){t=K("div"),n=K("nav"),r=K("h3"),o=V(u),i=J();for(var e=0;e<f.length;e+=1)f[e].c();a=J(),c=K("nav"),X(n,"class","sidebar-right__nav"),X(t,"class","sidebar-right")},m:function(e,u){q(e,t,u),H(t,n),H(n,r),H(r,o),H(n,i);for(var d=0;d<f.length;d+=1)f[d].m(n,null);H(n,a),H(n,c),s=!0},p:function(e,t){if((!s||1&t)&&u!==(u=dn("Participants (%1)",e[0].participants().length)+"")&&te(o,u),33&t){var r;for(d=e[0].participants(),r=0;r<d.length;r+=1){var i=Zo(e,d,r);f[r]?(f[r].p(i,t),Ie(f[r],1)):(f[r]=ai(i),f[r].c(),Ie(f[r],1),f[r].m(n,a))}for(Ae(),r=d.length;r<f.length;r+=1)p(r);Le()}},i:function(e){if(!s){for(var t=0;t<d.length;t+=1)Ie(f[t]);s=!0}},o:function(e){f=f.filter(Boolean);for(var t=0;t<f.length;t+=1)Ue(f[t]);s=!1},d:function(e){e&&G(t),W(f,e)}}}function ii(e){var t,n,r,o,i=e[8].nick+"",a=new wo({props:{name:"pick:"+e[8].id,family:"solid",color:e[8].color}});return{c:function(){Ge(a.$$.fragment),t=J(),n=K("span"),r=V(i)},m:function(e,i){We(a,e,i),q(e,t,i),q(e,n,i),H(n,r),o=!0},p:function(e,t){var n={};1&t&&(n.name="pick:"+e[8].id),1&t&&(n.color=e[8].color),a.$set(n),(!o||1&t)&&i!==(i=e[8].nick+"")&&te(r,i)},i:function(e){o||(Ie(a.$$.fragment,e),o=!0)},o:function(e){Ue(a.$$.fragment,e),o=!1},d:function(e){Ke(a,e),e&&G(t),e&&G(n)}}}function ai(e){var t;var n=new Yo({props:{href:"/chat/"+e[0].connection_id+"/"+e[8].id,class:"participant "+lt(e[8].modes),$$slots:{default:[ii]},$$scope:{ctx:e}}});return n.$on("click",(function(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e)[7].apply(t,[e[8]].concat(r))})),{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(t,r){e=t;var o={};1&r&&(o.href="/chat/"+e[0].connection_id+"/"+e[8].id),1&r&&(o.class="participant "+lt(e[8].modes)),16385&r&&(o.$$scope={dirty:r,ctx:e}),n.$set(o)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function ci(e){var t,n,r,o=e[0].participants().length,i=e[2].localStream.id&&ei(e),a=o&&oi(e);return{c:function(){i&&i.c(),t=J(),a&&a.c(),n=Y()},m:function(e,o){i&&i.m(e,o),q(e,t,o),a&&a.m(e,o),q(e,n,o),r=!0},p:function(e,r){var c=p(r,1)[0];e[2].localStream.id?i?(i.p(e,c),Ie(i,1)):((i=ei(e)).c(),Ie(i,1),i.m(t.parentNode,t)):i&&(Ae(),Ue(i,1,1,(function(){i=null})),Le()),1&c&&(o=e[0].participants().length),o?a?(a.p(e,c),Ie(a,1)):((a=oi(e)).c(),Ie(a,1),a.m(n.parentNode,n)):a&&(Ae(),Ue(a,1,1,(function(){a=null})),Le())},i:function(e){r||(Ie(i),Ie(a),r=!0)},o:function(e){Ue(i),Ue(a),r=!1},d:function(e){i&&i.d(e),e&&G(t),a&&a.d(e),e&&G(n)}}}function si(e,t,n){var r,o,i=x;e.$$.on_destroy.push((function(){return i()}));var a=ye("rtc");N(e,a,(function(e){return n(2,r=e)}));var c,s=ye("user"),u=t.conversation;function d(e,t){e.preventDefault(),u.send("/join "+t.id)}c=function(){return a.render()},he().$$.after_update.push(c);var f;return e.$set=function(e){"conversation"in e&&n(0,u=e.conversation)},e.$$.update=function(){1&e.$$.dirty&&(n(1,f=s.findConversation({connection_id:u.connection_id})),i(),i=M(f,(function(e){return n(3,o=e)})))},[u,f,r,o,a,d,s,function(e,t){return d(t,e)}]}var ui=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Qo()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,si,ci,D,{conversation:0}),r}return s}(Ye),di=function(){function t(){var n=this;e(this,t),this.dragAndDropEvents={drag:this._preventDefault.bind(this),dragend:this.stop.bind(this),dragenter:this.start.bind(this),dragleave:this.stop.bind(this),dragover:this.start.bind(this),dragstart:this._preventDefault.bind(this),drop:this.drop.bind(this)},this.pasteEvents={paste:this.paste.bind(this)},this.dropIndicatorEl=document.createElement("div"),this.dropIndicatorEl.className="drop-area hidden",this.removeDragOverDebounced=ct((function(){return n._removeDragOver()}),100)}return S(t,[{key:"attach",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;this.dropEl=e,this.uploadEl=t,this.targetEl=r,Object.keys(this.dragAndDropEvents).forEach((function(e){r.addEventListener(e,n.dragAndDropEvents[e])})),Object.keys(this.pasteEvents).forEach((function(e){document.addEventListener(e,n.pasteEvents[e])}))}},{key:"detach",value:function(){var e=this;Object.keys(this.dragAndDropEvents).forEach((function(t){e.targetEl.removeEventListener(t,e.dragAndDropEvents[t])})),Object.keys(this.pasteEvents).forEach((function(t){document.removeEventListener(t,e.pasteEvents[t])}))}},{key:"drop",value:function(e){this.stop(e),this.uploadEl&&this.uploadEl.uploader(e)}},{key:"paste",value:function(e){var t=(e.clipboardData||e.originalEvent.clipboardData).items;if(this.uploadEl)for(var n=0;n<t.length;n++)if("file"==t[n].kind)return this.uploadEl.uploader({dataTransfer:{files:[t[n].getAsFile()]}})}},{key:"stop",value:function(e){this._preventDefault(e),this.removeDragOverDebounced()}},{key:"start",value:function(e){if(this.dropEl){this._preventDefault(e);var t=this.dropIndicatorEl.style;t.height=this.dropEl.offsetHeight+"px",t.width=this.dropEl.offsetWidth+"px",t.top=this.dropEl.offsetTop+"px",t.left=this.dropEl.offsetLeft+"px",this.dropIndicatorEl.classList.remove("hidden"),this.dropEl.parentNode.appendChild(this.dropIndicatorEl)}}},{key:"_preventDefault",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"_removeDragOver",value:function(){this.dropIndicatorEl.classList.add("hidden")}}]),t}();function fi(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function li(e){var t,n,r,o,i,a,c,s=e[14].default,u=j(s,e,e[13],null);return{c:function(){t=K("main"),n=K("div"),u&&u.c(),xe((function(){return e[15].call(n)})),X(t,"class",o=e[1].join(" "))},m:function(o,s,d){var f;q(o,t,s),H(t,n),u&&u.m(n,null),r=function(e,t){"static"===getComputedStyle(e).position&&(e.style.position="relative");var n,r=document.createElement("object");return r.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;"),r.setAttribute("aria-hidden","true"),r.type="text/html",r.tabIndex=-1,r.onload=function(){(n=r.contentDocument.defaultView).addEventListener("resize",t)},/Trident/.test(navigator.userAgent)?(e.appendChild(r),r.data="about:blank"):(r.data="about:blank",e.appendChild(r)),{cancel:function(){n&&n.removeEventListener&&n.removeEventListener("resize",t),e.removeChild(r)}}}(n,e[15].bind(n)),a=!0,d&&c(),f=i=e[2].call(null,t,{scrollHeight:e[0]}),c=f&&P(f.destroy)?f.destroy:x},p:function(e,n){var r=p(n,1)[0];u&&u.p&&8192&r&&u.p(A(s,e,e[13],null),L(s,e[13],r,null)),(!a||2&r&&o!==(o=e[1].join(" ")))&&X(t,"class",o),i&&P(i.update)&&1&r&&i.update.call(null,{scrollHeight:e[0]})},i:function(e){a||(Ie(u,e),a=!0)},o:function(e){Ue(u,e),a=!1},d:function(e){e&&G(t),u&&u.d(e),r.cancel(),c()}}}function pi(e,t,n){var r,o=(r=he(),function(e,t){var n=r.$$.callbacks[e];if(n){var o=ie(e,t);n.slice().forEach((function(e){e.call(r,o)}))}}),i={scrollDelay:80,scrollOffset:80,scrollTop:0},a=!0,c=t.class,s=void 0===c?"":c,u=0,d=t.pos,f=void 0===d?"top":d;function l(e){n(3,f=e.scrollTop>u-e.offsetHeight-i.scrollOffset?"bottom":e.scrollTop<i.scrollOffset?"top":"middle"),i.pos=f,i.visibleEls=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,n=k(e.childNodes),r=[],o=0;o<n.length;)n[o].nodeType==Node.ELEMENT_NODE?(r.push([o,n[o]]),o++):n.splice(o,1);if(!n.length)return[];for(var i=t.scrollTop;r.length>1;){var a=Math.floor(r.length/2);r[a][1].offsetTop<=i?r.splice(0,a):r.splice(a)}r.length||r.push([0,n[0]]);for(var c=t.offsetHeight,s=r[0][0],u=s;u<n.length&&!(n[u].offsetTop>i+c);)u++;return n.slice(s,u).filter((function(e){return!e.getAttribute("aria-hidden")}))}(e.firstElementChild,e)}function p(e){i.scrollTid&&clearTimeout(i.scrollTid),i.scrollTid=setTimeout((function(){return h(e)}),i.scrollDelay)}function h(e){if(a)return(a=Math.abs(e.scrollTop-i.scrollTop)>40)&&(e.scrollTop=i.scrollTop),void(i.scrollTid&&clearTimeout(i.scrollTid));i.scrollTop=e.scrollTop,l(e),o("scrolled",i)}function m(e,t){var n=t.scrollHeight,r=i.scrollHeight!=n;i.scrollHeight=n,l(e),r&&o("rendered",i)}function v(e){return!ft(e,"undef")&&(-1==e&&(e=u),ft(e,"string")&&(e=i.infinityEl.querySelector(e)),e&&e.tagName&&(e=e.offsetTop),!ft(e,"undef")&&(!(e<0)&&(a=!0,i.infinityEl.scrollTop=e,i.scrollTop=i.infinityEl.scrollTop,!0)))}var g,y=t.$$slots,b=void 0===y?{}:y,$=t.$$scope;return e.$set=function(e){"class"in e&&n(4,s=e.class),"pos"in e&&n(3,f=e.pos),"$$scope"in e&&n(13,$=e.$$scope)},e.$$.update=function(){24&e.$$.dirty&&n(1,g=[s||"infinity-scroll"].concat(["has-pos-"+f])),e.$$.dirty},[u,g,function(e,t){return i.infinityEl=e,i.scrollTo=v,e.addEventListener("scroll",(function(){return p(e)})),l(e),m(e,t),{update:function(t){return m(e,t)}}},f,s,i,a,o,l,p,h,m,v,$,b,function(){u=this.offsetHeight,n(0,u)}]}var hi=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(fi()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,pi,li,D,{class:4,pos:3}),r}return s}(Ye),mi=n((function(e,t){var n,o;n=function(e){var t=[],n=Object.keys,o={},i={},a=!0,c=/^(no-?highlight|plain|text)$/i,s=/\blang(?:uage)?-([\w-]+)\b/i,u=/((^(<[^>]+>|\t|)+|(?:\n)))/gm,d="Could not find the language '{}', did you forget to load/include a language module?",f={classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:void 0},l="of and for in not or if then".split(" ");function p(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(e){return e.nodeName.toLowerCase()}function m(e){return c.test(e)}function v(e){var t,n={},r=Array.prototype.slice.call(arguments,1);for(t in e)n[t]=e[t];return r.forEach((function(e){for(t in e)n[t]=e[t]})),n}function g(e){var t=[];return function e(n,r){for(var o=n.firstChild;o;o=o.nextSibling)3===o.nodeType?r+=o.nodeValue.length:1===o.nodeType&&(t.push({event:"start",offset:r,node:o}),r=e(o,r),h(o).match(/br|hr|img|input/)||t.push({event:"stop",offset:r,node:o}));return r}(e,0),t}function y(e){return e.variants&&!e.cached_variants&&(e.cached_variants=e.variants.map((function(t){return v(e,{variants:null},t)}))),e.cached_variants?e.cached_variants:function e(t){return!!t&&(t.endsWithParent||e(t.starts))}(e)?[v(e,{starts:e.starts?v(e.starts):null})]:Object.isFrozen(e)?[v(e)]:[e]}function b(e,t){return t?Number(t):(n=e,-1!=l.indexOf(n.toLowerCase())?0:1);var n}function $(e){function t(e){return e&&e.source||e}function r(n,r){return new RegExp(t(n),"m"+(e.case_insensitive?"i":"")+(r?"g":""))}function o(e){var n,o,i={},a=[],c={},s=1;function u(e,t){i[s]=e,a.push([e,t]),s+=function(e){return new RegExp(e.toString()+"|").exec("").length-1}(t)+1}for(var d=0;d<e.contains.length;d++)u(o=e.contains[d],o.beginKeywords?"\\.?(?:"+o.begin+")\\.?":o.begin);e.terminator_end&&u("end",e.terminator_end),e.illegal&&u("illegal",e.illegal);var f=a.map((function(e){return e[1]}));return n=r(function(e,n){for(var r=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./,o=0,i="",a=0;a<e.length;a++){var c=o+=1,s=t(e[a]);for(a>0&&(i+=n),i+="(";s.length>0;){var u=r.exec(s);if(null==u){i+=s;break}i+=s.substring(0,u.index),s=s.substring(u.index+u[0].length),"\\"==u[0][0]&&u[1]?i+="\\"+String(Number(u[1])+c):(i+=u[0],"("==u[0]&&o++)}i+=")"}return i}(f,"|"),!0),c.lastIndex=0,c.exec=function(t){var r;if(0===a.length)return null;n.lastIndex=c.lastIndex;var o=n.exec(t);if(!o)return null;for(var s=0;s<o.length;s++)if(null!=o[s]&&null!=i[""+s]){r=i[""+s];break}return"string"==typeof r?(o.type=r,o.extra=[e.illegal,e.terminator_end]):(o.type="begin",o.rule=r),o},c}if(e.contains&&-1!=e.contains.indexOf("self")){if(!a)throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");e.contains=e.contains.filter((function(e){return"self"!=e}))}!function i(a,c){a.compiled||(a.compiled=!0,a.keywords=a.keywords||a.beginKeywords,a.keywords&&(a.keywords=function(e,t){var r={};return"string"==typeof e?o("keyword",e):n(e).forEach((function(t){o(t,e[t])})),r;function o(e,n){t&&(n=n.toLowerCase()),n.split(" ").forEach((function(t){var n=t.split("|");r[n[0]]=[e,b(n[0],n[1])]}))}}(a.keywords,e.case_insensitive)),a.lexemesRe=r(a.lexemes||/\w+/,!0),c&&(a.beginKeywords&&(a.begin="\\b("+a.beginKeywords.split(" ").join("|")+")\\b"),a.begin||(a.begin=/\B|\b/),a.beginRe=r(a.begin),a.endSameAsBegin&&(a.end=a.begin),a.end||a.endsWithParent||(a.end=/\B|\b/),a.end&&(a.endRe=r(a.end)),a.terminator_end=t(a.end)||"",a.endsWithParent&&c.terminator_end&&(a.terminator_end+=(a.end?"|":"")+c.terminator_end)),a.illegal&&(a.illegalRe=r(a.illegal)),null==a.relevance&&(a.relevance=1),a.contains||(a.contains=[]),a.contains=Array.prototype.concat.apply([],a.contains.map((function(e){return y("self"===e?a:e)}))),a.contains.forEach((function(e){i(e,a)})),a.starts&&i(a.starts,c),a.terminators=o(a))}(e)}function _(e,t,n,r){var i=t;function c(e,t){var n=y.case_insensitive?t[0].toLowerCase():t[0];return e.keywords.hasOwnProperty(n)&&e.keywords[n]}function s(e,t,n,r){if(!n&&""===t)return"";if(!e)return t;var o='<span class="'+(r?"":f.classPrefix);return(o+=e+'">')+t+(n?"":"</span>")}function u(){S+=null!=k.subLanguage?function(){var e="string"==typeof k.subLanguage;if(e&&!o[k.subLanguage])return p(x);var t=e?_(k.subLanguage,x,!0,C[k.subLanguage]):w(x,k.subLanguage.length?k.subLanguage:void 0);return k.relevance>0&&(R+=t.relevance),e&&(C[k.subLanguage]=t.top),s(t.language,t.value,!1,!0)}():function(){var e,t,n,r;if(!k.keywords)return p(x);for(r="",t=0,k.lexemesRe.lastIndex=0,n=k.lexemesRe.exec(x);n;)r+=p(x.substring(t,n.index)),(e=c(k,n))?(R+=e[1],r+=s(e[0],p(n[0]))):r+=p(n[0]),t=k.lexemesRe.lastIndex,n=k.lexemesRe.exec(x);return r+p(x.substr(t))}(),x=""}function l(e){S+=e.className?s(e.className,"",!0):"",k=Object.create(e,{parent:{value:k}})}function h(e){var t=e[0],n=e.rule;return n&&n.endSameAsBegin&&(n.endRe=new RegExp(t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"m")),n.skip?x+=t:(n.excludeBegin&&(x+=t),u(),n.returnBegin||n.excludeBegin||(x=t)),l(n),n.returnBegin?0:t.length}function m(e){var t=e[0],n=i.substr(e.index),r=function e(t,n){if(function(e,t){var n=e&&e.exec(t);return n&&0===n.index}(t.endRe,n)){for(;t.endsParent&&t.parent;)t=t.parent;return t}if(t.endsWithParent)return e(t.parent,n)}(k,n);if(r){var o=k;o.skip?x+=t:(o.returnEnd||o.excludeEnd||(x+=t),u(),o.excludeEnd&&(x=t));do{k.className&&(S+="</span>"),k.skip||k.subLanguage||(R+=k.relevance),k=k.parent}while(k!==r.parent);return r.starts&&(r.endSameAsBegin&&(r.starts.endRe=r.endRe),l(r.starts)),o.returnEnd?0:t.length}}var v={};function g(e,t){var r=t&&t[0];if(x+=e,null==r)return u(),0;if("begin"==v.type&&"end"==t.type&&v.index==t.index&&""===r)return x+=i.slice(t.index,t.index+1),1;if(v=t,"begin"===t.type)return h(t);if("illegal"===t.type&&!n)throw new Error('Illegal lexeme "'+r+'" for mode "'+(k.className||"<unnamed>")+'"');if("end"===t.type){var o=m(t);if(null!=o)return o}return x+=r,r.length}var y=E(e);if(!y)throw console.error(d.replace("{}",e)),new Error('Unknown language: "'+e+'"');$(y);var b,k=r||y,C={},S="";for(b=k;b!==y;b=b.parent)b.className&&(S=s(b.className,"",!0)+S);var x="",R=0;try{for(var T,O,P=0;k.terminators.lastIndex=P,T=k.terminators.exec(i);)O=g(i.substring(P,T.index),T),P=T.index+O;for(g(i.substr(P)),b=k;b.parent;b=b.parent)b.className&&(S+="</span>");return{relevance:R,value:S,illegal:!1,language:e,top:k}}catch(t){if(t.message&&-1!==t.message.indexOf("Illegal"))return{illegal:!0,relevance:0,value:p(i)};if(a)return{relevance:0,value:p(i),language:e,top:k,errorRaised:t};throw t}}function w(e,t){t=t||f.languages||n(o);var r={relevance:0,value:p(e)},i=r;return t.filter(E).filter(R).forEach((function(t){var n=_(t,e,!1);n.language=t,n.relevance>i.relevance&&(i=n),n.relevance>r.relevance&&(i=r,r=n)})),i.language&&(r.second_best=i),r}function k(e){return f.tabReplace||f.useBR?e.replace(u,(function(e,t){return f.useBR&&"\n"===e?"<br>":f.tabReplace?t.replace(/\t/g,f.tabReplace):""})):e}function C(e){var n,r,o,a,c,u=function(e){var t,n,r,o,i=e.className+" ";if(i+=e.parentNode?e.parentNode.className:"",n=s.exec(i)){var a=E(n[1]);return a||(console.warn(d.replace("{}",n[1])),console.warn("Falling back to no-highlight mode for this block.",e)),a?n[1]:"no-highlight"}for(t=0,r=(i=i.split(/\s+/)).length;t<r;t++)if(m(o=i[t])||E(o))return o}(e);m(u)||(f.useBR?(n=document.createElement("div")).innerHTML=e.innerHTML.replace(/\n/g,"").replace(/<br[ \/]*>/g,"\n"):n=e,c=n.textContent,o=u?_(u,c,!0):w(c),(r=g(n)).length&&((a=document.createElement("div")).innerHTML=o.value,o.value=function(e,n,r){var o=0,i="",a=[];function c(){return e.length&&n.length?e[0].offset!==n[0].offset?e[0].offset<n[0].offset?e:n:"start"===n[0].event?e:n:e.length?e:n}function s(e){i+="<"+h(e)+t.map.call(e.attributes,(function(e){return" "+e.nodeName+'="'+p(e.value).replace(/"/g,"&quot;")+'"'})).join("")+">"}function u(e){i+="</"+h(e)+">"}function d(e){("start"===e.event?s:u)(e.node)}for(;e.length||n.length;){var f=c();if(i+=p(r.substring(o,f[0].offset)),o=f[0].offset,f===e){a.reverse().forEach(u);do{d(f.splice(0,1)[0]),f=c()}while(f===e&&f.length&&f[0].offset===o);a.reverse().forEach(s)}else"start"===f[0].event?a.push(f[0].node):a.pop(),d(f.splice(0,1)[0])}return i+p(r.substr(o))}(r,g(a),c)),o.value=k(o.value),e.innerHTML=o.value,e.className=function(e,t,n){var r=t?i[t]:n,o=[e.trim()];return e.match(/\bhljs\b/)||o.push("hljs"),-1===e.indexOf(r)&&o.push(r),o.join(" ").trim()}(e.className,u,o.language),e.result={language:o.language,re:o.relevance},o.second_best&&(e.second_best={language:o.second_best.language,re:o.second_best.relevance}))}function S(){if(!S.called){S.called=!0;var e=document.querySelectorAll("pre code");t.forEach.call(e,C)}}var x={disableAutodetect:!0};function E(e){return e=(e||"").toLowerCase(),o[e]||o[i[e]]}function R(e){var t=E(e);return t&&!t.disableAutodetect}return e.highlight=_,e.highlightAuto=w,e.fixMarkup=k,e.highlightBlock=C,e.configure=function(e){f=v(f,e)},e.initHighlighting=S,e.initHighlightingOnLoad=function(){window.addEventListener("DOMContentLoaded",S,!1),window.addEventListener("load",S,!1)},e.registerLanguage=function(t,n){var r;try{r=n(e)}catch(e){if(console.error("Language definition for '{}' could not be registered.".replace("{}",t)),!a)throw e;console.error(e),r=x}o[t]=r,r.rawDefinition=n.bind(null,e),r.aliases&&r.aliases.forEach((function(e){i[e]=t}))},e.listLanguages=function(){return n(o)},e.getLanguage=E,e.requireLanguage=function(e){var t=E(e);if(t)return t;throw new Error("The '{}' language is required, but not loaded.".replace("{}",e))},e.autoDetection=R,e.inherit=v,e.debugMode=function(){a=!1},e.IDENT_RE="[a-zA-Z]\\w*",e.UNDERSCORE_IDENT_RE="[a-zA-Z_]\\w*",e.NUMBER_RE="\\b\\d+(\\.\\d+)?",e.C_NUMBER_RE="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",e.BINARY_NUMBER_RE="\\b(0b[01]+)",e.RE_STARTERS_RE="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",e.BACKSLASH_ESCAPE={begin:"\\\\[\\s\\S]",relevance:0},e.APOS_STRING_MODE={className:"string",begin:"'",end:"'",illegal:"\\n",contains:[e.BACKSLASH_ESCAPE]},e.QUOTE_STRING_MODE={className:"string",begin:'"',end:'"',illegal:"\\n",contains:[e.BACKSLASH_ESCAPE]},e.PHRASAL_WORDS_MODE={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},e.COMMENT=function(t,n,r){var o=e.inherit({className:"comment",begin:t,end:n,contains:[]},r||{});return o.contains.push(e.PHRASAL_WORDS_MODE),o.contains.push({className:"doctag",begin:"(?:TODO|FIXME|NOTE|BUG|XXX):",relevance:0}),o},e.C_LINE_COMMENT_MODE=e.COMMENT("//","$"),e.C_BLOCK_COMMENT_MODE=e.COMMENT("/\\*","\\*/"),e.HASH_COMMENT_MODE=e.COMMENT("#","$"),e.NUMBER_MODE={className:"number",begin:e.NUMBER_RE,relevance:0},e.C_NUMBER_MODE={className:"number",begin:e.C_NUMBER_RE,relevance:0},e.BINARY_NUMBER_MODE={className:"number",begin:e.BINARY_NUMBER_RE,relevance:0},e.CSS_NUMBER_MODE={className:"number",begin:e.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},e.REGEXP_MODE={className:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[e.BACKSLASH_ESCAPE,{begin:/\[/,end:/\]/,relevance:0,contains:[e.BACKSLASH_ESCAPE]}]},e.TITLE_MODE={className:"title",begin:e.IDENT_RE,relevance:0},e.UNDERSCORE_TITLE_MODE={className:"title",begin:e.UNDERSCORE_IDENT_RE,relevance:0},e.METHOD_GUARD={begin:"\\.\\s*"+e.UNDERSCORE_IDENT_RE,relevance:0},[e.BACKSLASH_ESCAPE,e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,e.PHRASAL_WORDS_MODE,e.COMMENT,e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE,e.HASH_COMMENT_MODE,e.NUMBER_MODE,e.C_NUMBER_MODE,e.BINARY_NUMBER_MODE,e.CSS_NUMBER_MODE,e.REGEXP_MODE,e.TITLE_MODE,e.UNDERSCORE_TITLE_MODE,e.METHOD_GUARD].forEach((function(e){!function e(t){Object.freeze(t);var n="function"==typeof t;return Object.getOwnPropertyNames(t).forEach((function(o){!t.hasOwnProperty(o)||null===t[o]||"object"!==r(t[o])&&"function"!=typeof t[o]||n&&("caller"===o||"callee"===o||"arguments"===o)||Object.isFrozen(t[o])||e(t[o])})),t}(e)})),e},o="object"===("undefined"==typeof window?"undefined":r(window))&&window||"object"===("undefined"==typeof self?"undefined":r(self))&&self,t.nodeType?o&&(o.hljs=n({})):n(t)}));var vi=/\r\n|\r|\n/g;function gi(e){var t=e.className;if(/hljs-/.test(t)){for(var n=yi(e.innerHTML),r=0,o="";r<n.length;r++){var i=n[r].length>0?n[r]:" ";o+='<span class="'.concat(t,'">').concat(i,"</span>\n")}e.innerHTML=o.trim()}}function yi(e){return 0===e.length?[]:e.split(vi)}function bi(e){return(e.trim().match(vi)||[]).length}document.addEventListener("copy",(function(e){var t,n=window.getSelection();(function(e){for(var t=e;t;){if(t.className&&-1!==t.className.indexOf("hljs-ln-code"))return!0;t=t.parentNode}return!1})(n.anchorNode)&&(t=-1!==window.navigator.userAgent.indexOf("Edge")?function(e){for(var t=e.toString(),n=e.anchorNode;"TD"!==n.nodeName;)n=n.parentNode;for(var r=e.focusNode;"TD"!==r.nodeName;)r=r.parentNode;var o=parseInt(n.dataset.lineNumber,10),i=parseInt(r.dataset.lineNumber,10);if(o!=i){var a=n.textContent,c=r.textContent;if(o>i){var s=o;o=i,i=s,s=a,a=c,c=s}for(;0!==t.indexOf(a);)a=a.slice(1);for(;-1===t.lastIndexOf(c);)c=c.slice(0,-1);for(var u=a,d=function(e){for(var t=e;"TABLE"!==t.nodeName;)t=t.parentNode;return t}(n),f=o+1;f<i;++f){var l=".".concat("hljs-ln-code","[").concat("data-line-number",'="').concat(f,'"]');u+="\n"+d.querySelector(l).textContent}return u+="\n"+c}return t}(n):n.toString(),e.clipboardData.setData("text/plain",t),e.preventDefault())}));var $i;mi.registerLanguage("css",(function(e){var t={begin:/(?:[A-Z\_\.\-]+|--[a-zA-Z0-9_-]+)\s*:/,returnBegin:!0,end:";",endsWithParent:!0,contains:[{className:"attribute",begin:/\S/,end:":",excludeEnd:!0,starts:{endsWithParent:!0,excludeEnd:!0,contains:[{begin:/[\w-]+\(/,returnBegin:!0,contains:[{className:"built_in",begin:/[\w-]+/},{begin:/\(/,end:/\)/,contains:[e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,e.CSS_NUMBER_MODE]}]},e.CSS_NUMBER_MODE,e.QUOTE_STRING_MODE,e.APOS_STRING_MODE,e.C_BLOCK_COMMENT_MODE,{className:"number",begin:"#[0-9A-Fa-f]+"},{className:"meta",begin:"!important"}]}}]};return{case_insensitive:!0,illegal:/[=\/|'\$]/,contains:[e.C_BLOCK_COMMENT_MODE,{className:"selector-id",begin:/#[A-Za-z0-9_-]+/},{className:"selector-class",begin:/\.[A-Za-z0-9_-]+/},{className:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[e.APOS_STRING_MODE,e.QUOTE_STRING_MODE]},{className:"selector-pseudo",begin:/:(:)?[a-zA-Z0-9\_\-\+\(\)"'.]+/},{begin:"@(page|font-face)",lexemes:"@[a-z-]+",keywords:"@page @font-face"},{begin:"@",end:"[{;]",illegal:/:/,returnBegin:!0,contains:[{className:"keyword",begin:/@\-?\w[\w]*(\-\w+)*/},{begin:/\s/,endsWithParent:!0,excludeEnd:!0,relevance:0,keywords:"and or not only",contains:[{begin:/[a-z-]+:/,className:"attribute"},e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,e.CSS_NUMBER_MODE]}]},{className:"selector-tag",begin:"[a-zA-Z-][a-zA-Z0-9_-]*",relevance:0},{begin:"{",end:"}",illegal:/\S/,contains:[e.C_BLOCK_COMMENT_MODE,t]}]}})),mi.registerLanguage("diff",(function(e){return{aliases:["patch"],contains:[{className:"meta",relevance:10,variants:[{begin:/^@@ +\-\d+,\d+ +\+\d+,\d+ +@@$/},{begin:/^\*\*\* +\d+,\d+ +\*\*\*\*$/},{begin:/^\-\-\- +\d+,\d+ +\-\-\-\-$/}]},{className:"comment",variants:[{begin:/Index: /,end:/$/},{begin:/={3,}/,end:/$/},{begin:/^\-{3}/,end:/$/},{begin:/^\*{3} /,end:/$/},{begin:/^\+{3}/,end:/$/},{begin:/^\*{15}$/}]},{className:"addition",begin:"^\\+",end:"$"},{className:"deletion",begin:"^\\-",end:"$"},{className:"addition",begin:"^\\!",end:"$"}]}})),mi.registerLanguage("dockerfile",(function(e){return{aliases:["docker"],case_insensitive:!0,keywords:"from maintainer expose env arg user onbuild stopsignal",contains:[e.HASH_COMMENT_MODE,e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,e.NUMBER_MODE,{beginKeywords:"run cmd entrypoint volume add copy workdir label healthcheck shell",starts:{end:/[^\\]$/,subLanguage:"bash"}}],illegal:"</"}})),mi.registerLanguage("go",(function(e){var t={keyword:"break default func interface select case map struct chan else goto package switch const fallthrough if range type continue for import return var go defer bool byte complex64 complex128 float32 float64 int8 int16 int32 int64 string uint8 uint16 uint32 uint64 int uint uintptr rune",literal:"true false iota nil",built_in:"append cap close complex copy imag len make new panic print println real recover delete"};return{aliases:["golang"],keywords:t,illegal:"</",contains:[e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE,{className:"string",variants:[e.QUOTE_STRING_MODE,e.APOS_STRING_MODE,{begin:"`",end:"`"}]},{className:"number",variants:[{begin:e.C_NUMBER_RE+"[i]",relevance:1},e.C_NUMBER_MODE]},{begin:/:=/},{className:"function",beginKeywords:"func",end:"\\s*(\\{|$)",excludeEnd:!0,contains:[e.TITLE_MODE,{className:"params",begin:/\(/,end:/\)/,keywords:t,illegal:/["']/}]}]}})),mi.registerLanguage("http",(function(e){return{aliases:["https"],illegal:"\\S",contains:[{begin:"^HTTP/[0-9\\.]+",end:"$",contains:[{className:"number",begin:"\\b\\d{3}\\b"}]},{begin:"^[A-Z]+ (.*?) HTTP/[0-9\\.]+$",returnBegin:!0,end:"$",contains:[{className:"string",begin:" ",end:" ",excludeBegin:!0,excludeEnd:!0},{begin:"HTTP/[0-9\\.]+"},{className:"keyword",begin:"[A-Z]+"}]},{className:"attribute",begin:"^\\w",end:": ",excludeEnd:!0,illegal:"\\n|\\s|=",starts:{end:"$",relevance:0}},{begin:"\\n\\n",starts:{subLanguage:[],endsWithParent:!0}}]}})),mi.registerLanguage("javascript",(function(e){var t="<>",n="</>",r={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/},o="[A-Za-z$_][0-9A-Za-z$_]*",i={keyword:"in of if for while finally var new function do return void else break catch instanceof with throw case default try this switch continue typeof delete let yield const export super debugger as async await static import from as",literal:"true false null undefined NaN Infinity",built_in:"eval isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent escape unescape Object Function Boolean Error EvalError InternalError RangeError ReferenceError StopIteration SyntaxError TypeError URIError Number Math Date String RegExp Array Float32Array Float64Array Int16Array Int32Array Int8Array Uint16Array Uint32Array Uint8Array Uint8ClampedArray ArrayBuffer DataView JSON Intl arguments require module console window document Symbol Set Map WeakSet WeakMap Proxy Reflect Promise"},a={className:"number",variants:[{begin:"\\b(0[bB][01]+)n?"},{begin:"\\b(0[oO][0-7]+)n?"},{begin:e.C_NUMBER_RE+"n?"}],relevance:0},c={className:"subst",begin:"\\$\\{",end:"\\}",keywords:i,contains:[]},s={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[e.BACKSLASH_ESCAPE,c],subLanguage:"xml"}},u={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[e.BACKSLASH_ESCAPE,c],subLanguage:"css"}},d={className:"string",begin:"`",end:"`",contains:[e.BACKSLASH_ESCAPE,c]};c.contains=[e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,s,u,d,a,e.REGEXP_MODE];var f=c.contains.concat([e.C_BLOCK_COMMENT_MODE,e.C_LINE_COMMENT_MODE]);return{aliases:["js","jsx","mjs","cjs"],keywords:i,contains:[{className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},{className:"meta",begin:/^#!/,end:/$/},e.APOS_STRING_MODE,e.QUOTE_STRING_MODE,s,u,d,e.C_LINE_COMMENT_MODE,e.COMMENT("/\\*\\*","\\*/",{relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+",contains:[{className:"type",begin:"\\{",end:"\\}",relevance:0},{className:"variable",begin:o+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),e.C_BLOCK_COMMENT_MODE,a,{begin:/[{,\n]\s*/,relevance:0,contains:[{begin:o+"\\s*:",returnBegin:!0,relevance:0,contains:[{className:"attr",begin:o,relevance:0}]}]},{begin:"("+e.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",contains:[e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE,e.REGEXP_MODE,{className:"function",begin:"(\\(.*?\\)|"+o+")\\s*=>",returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:o},{begin:/\(\s*\)/},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:i,contains:f}]}]},{className:"",begin:/\s/,end:/\s*/,skip:!0},{variants:[{begin:t,end:n},{begin:r.begin,end:r.end}],subLanguage:"xml",contains:[{begin:r.begin,end:r.end,skip:!0,contains:["self"]}]}],relevance:0},{className:"function",beginKeywords:"function",end:/\{/,excludeEnd:!0,contains:[e.inherit(e.TITLE_MODE,{begin:o}),{className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,contains:f}],illegal:/\[|%/},{begin:/\$[(.]/},e.METHOD_GUARD,{className:"class",beginKeywords:"class",end:/[{;=]/,excludeEnd:!0,illegal:/[:"\[\]]/,contains:[{beginKeywords:"extends"},e.UNDERSCORE_TITLE_MODE]},{beginKeywords:"constructor get set",end:/\{/,excludeEnd:!0}],illegal:/#(?!!)/}})),mi.registerLanguage("markdown",(function(e){return{aliases:["md","mkdown","mkd"],contains:[{className:"section",variants:[{begin:"^#{1,6}",end:"$"},{begin:"^.+?\\n[=-]{2,}$"}]},{begin:"<",end:">",subLanguage:"xml",relevance:0},{className:"bullet",begin:"^\\s*([*+-]|(\\d+\\.))\\s+"},{className:"strong",begin:"[*_]{2}.+?[*_]{2}"},{className:"emphasis",variants:[{begin:"\\*.+?\\*"},{begin:"_.+?_",relevance:0}]},{className:"quote",begin:"^>\\s+",end:"$"},{className:"code",variants:[{begin:"^```\\w*\\s*$",end:"^```[ ]*$"},{begin:"`.+?`"},{begin:"^( {4}|\\t)",end:"$",relevance:0}]},{begin:"^[-\\*]{3,}",end:"$"},{begin:"\\[.+?\\][\\(\\[].*?[\\)\\]]",returnBegin:!0,contains:[{className:"string",begin:"\\[",end:"\\]",excludeBegin:!0,returnEnd:!0,relevance:0},{className:"link",begin:"\\]\\(",end:"\\)",excludeBegin:!0,excludeEnd:!0},{className:"symbol",begin:"\\]\\[",end:"\\]",excludeBegin:!0,excludeEnd:!0}],relevance:10},{begin:/^\[[^\n]+\]:/,returnBegin:!0,contains:[{className:"symbol",begin:/\[/,end:/\]/,excludeBegin:!0,excludeEnd:!0},{className:"link",begin:/:\s*/,end:/$/,excludeBegin:!0}]}]}})),mi.registerLanguage("mojolicious",(function(e){return{subLanguage:"xml",contains:[{className:"meta",begin:"^__(END|DATA)__$"},{begin:"^\\s*%{1,2}={0,2}",end:"$",subLanguage:"perl"},{begin:"<%{1,2}={0,2}",end:"={0,1}%>",subLanguage:"perl",excludeBegin:!0,excludeEnd:!0}]}})),mi.registerLanguage("nginx",(function(e){var t={className:"variable",variants:[{begin:/\$\d+/},{begin:/\$\{/,end:/}/},{begin:"[\\$\\@]"+e.UNDERSCORE_IDENT_RE}]},n={endsWithParent:!0,lexemes:"[a-z/_]+",keywords:{literal:"on off yes no true false none blocked debug info notice warn error crit select break last permanent redirect kqueue rtsig epoll poll /dev/poll"},relevance:0,illegal:"=>",contains:[e.HASH_COMMENT_MODE,{className:"string",contains:[e.BACKSLASH_ESCAPE,t],variants:[{begin:/"/,end:/"/},{begin:/'/,end:/'/}]},{begin:"([a-z]+):/",end:"\\s",endsWithParent:!0,excludeEnd:!0,contains:[t]},{className:"regexp",contains:[e.BACKSLASH_ESCAPE,t],variants:[{begin:"\\s\\^",end:"\\s|{|;",returnEnd:!0},{begin:"~\\*?\\s+",end:"\\s|{|;",returnEnd:!0},{begin:"\\*(\\.[a-z\\-]+)+"},{begin:"([a-z\\-]+\\.)+\\*"}]},{className:"number",begin:"\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}(:\\d{1,5})?\\b"},{className:"number",begin:"\\b\\d+[kKmMgGdshdwy]*\\b",relevance:0},t]};return{aliases:["nginxconf"],contains:[e.HASH_COMMENT_MODE,{begin:e.UNDERSCORE_IDENT_RE+"\\s+{",returnBegin:!0,end:"{",contains:[{className:"section",begin:e.UNDERSCORE_IDENT_RE}],relevance:0},{begin:e.UNDERSCORE_IDENT_RE+"\\s",end:";|{",returnBegin:!0,contains:[{className:"attribute",begin:e.UNDERSCORE_IDENT_RE,starts:n}],relevance:0}],illegal:"[^\\s\\}]"}})),mi.registerLanguage("perl",(function(e){var t="getpwent getservent quotemeta msgrcv scalar kill dbmclose undef lc ma syswrite tr send umask sysopen shmwrite vec qx utime local oct semctl localtime readpipe do return format read sprintf dbmopen pop getpgrp not getpwnam rewinddir qqfileno qw endprotoent wait sethostent bless s|0 opendir continue each sleep endgrent shutdown dump chomp connect getsockname die socketpair close flock exists index shmgetsub for endpwent redo lstat msgctl setpgrp abs exit select print ref gethostbyaddr unshift fcntl syscall goto getnetbyaddr join gmtime symlink semget splice x|0 getpeername recv log setsockopt cos last reverse gethostbyname getgrnam study formline endhostent times chop length gethostent getnetent pack getprotoent getservbyname rand mkdir pos chmod y|0 substr endnetent printf next open msgsnd readdir use unlink getsockopt getpriority rindex wantarray hex system getservbyport endservent int chr untie rmdir prototype tell listen fork shmread ucfirst setprotoent else sysseek link getgrgid shmctl waitpid unpack getnetbyname reset chdir grep split require caller lcfirst until warn while values shift telldir getpwuid my getprotobynumber delete and sort uc defined srand accept package seekdir getprotobyname semop our rename seek if q|0 chroot sysread setpwent no crypt getc chown sqrt write setnetent setpriority foreach tie sin msgget map stat getlogin unless elsif truncate exec keys glob tied closedirioctl socket readlink eval xor readline binmode setservent eof ord bind alarm pipe atan2 getgrent exp time push setgrent gt lt or ne m|0 break given say state when",n={className:"subst",begin:"[$@]\\{",end:"\\}",keywords:t},r={begin:"->{",end:"}"},o={variants:[{begin:/\$\d/},{begin:/[\$%@](\^\w\b|#\w+(::\w+)*|{\w+}|\w+(::\w*)*)/},{begin:/[\$%@][^\s\w{]/,relevance:0}]},i=[e.BACKSLASH_ESCAPE,n,o],a=[o,e.HASH_COMMENT_MODE,e.COMMENT("^\\=\\w","\\=cut",{endsWithParent:!0}),r,{className:"string",contains:i,variants:[{begin:"q[qwxr]?\\s*\\(",end:"\\)",relevance:5},{begin:"q[qwxr]?\\s*\\[",end:"\\]",relevance:5},{begin:"q[qwxr]?\\s*\\{",end:"\\}",relevance:5},{begin:"q[qwxr]?\\s*\\|",end:"\\|",relevance:5},{begin:"q[qwxr]?\\s*\\<",end:"\\>",relevance:5},{begin:"qw\\s+q",end:"q",relevance:5},{begin:"'",end:"'",contains:[e.BACKSLASH_ESCAPE]},{begin:'"',end:'"'},{begin:"`",end:"`",contains:[e.BACKSLASH_ESCAPE]},{begin:"{\\w+}",contains:[],relevance:0},{begin:"-?\\w+\\s*\\=\\>",contains:[],relevance:0}]},{className:"number",begin:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",relevance:0},{begin:"(\\/\\/|"+e.RE_STARTERS_RE+"|\\b(split|return|print|reverse|grep)\\b)\\s*",keywords:"split return print reverse grep",relevance:0,contains:[e.HASH_COMMENT_MODE,{className:"regexp",begin:"(s|tr|y)/(\\\\.|[^/])*/(\\\\.|[^/])*/[a-z]*",relevance:10},{className:"regexp",begin:"(m|qr)?/",end:"/[a-z]*",contains:[e.BACKSLASH_ESCAPE],relevance:0}]},{className:"function",beginKeywords:"sub",end:"(\\s*\\(.*?\\))?[;{]",excludeEnd:!0,relevance:5,contains:[e.TITLE_MODE]},{begin:"-\\w\\b",relevance:0},{begin:"^__DATA__$",end:"^__END__$",subLanguage:"mojolicious",contains:[{begin:"^@@.*",end:"$",className:"comment"}]}];return n.contains=a,r.contains=a,{aliases:["pl","pm"],lexemes:/[\w\.]+/,keywords:t,contains:a}})),mi.registerLanguage("python",(function(e){var t={keyword:"and elif is global as in if from raise for except finally print import pass return exec else break not with class assert yield try while continue del or def lambda async await nonlocal|10",built_in:"Ellipsis NotImplemented",literal:"False None True"},n={className:"meta",begin:/^(>>>|\.\.\.) /},r={className:"subst",begin:/\{/,end:/\}/,keywords:t,illegal:/#/},o={begin:/\{\{/,relevance:0},i={className:"string",contains:[e.BACKSLASH_ESCAPE],variants:[{begin:/(u|b)?r?'''/,end:/'''/,contains:[e.BACKSLASH_ESCAPE,n],relevance:10},{begin:/(u|b)?r?"""/,end:/"""/,contains:[e.BACKSLASH_ESCAPE,n],relevance:10},{begin:/(fr|rf|f)'''/,end:/'''/,contains:[e.BACKSLASH_ESCAPE,n,o,r]},{begin:/(fr|rf|f)"""/,end:/"""/,contains:[e.BACKSLASH_ESCAPE,n,o,r]},{begin:/(u|r|ur)'/,end:/'/,relevance:10},{begin:/(u|r|ur)"/,end:/"/,relevance:10},{begin:/(b|br)'/,end:/'/},{begin:/(b|br)"/,end:/"/},{begin:/(fr|rf|f)'/,end:/'/,contains:[e.BACKSLASH_ESCAPE,o,r]},{begin:/(fr|rf|f)"/,end:/"/,contains:[e.BACKSLASH_ESCAPE,o,r]},e.APOS_STRING_MODE,e.QUOTE_STRING_MODE]},a={className:"number",relevance:0,variants:[{begin:e.BINARY_NUMBER_RE+"[lLjJ]?"},{begin:"\\b(0o[0-7]+)[lLjJ]?"},{begin:e.C_NUMBER_RE+"[lLjJ]?"}]},c={className:"params",begin:/\(/,end:/\)/,contains:["self",n,a,i,e.HASH_COMMENT_MODE]};return r.contains=[i,a,n],{aliases:["py","gyp","ipython"],keywords:t,illegal:/(<\/|->|\?)|=>/,contains:[n,a,{beginKeywords:"if",relevance:0},i,e.HASH_COMMENT_MODE,{variants:[{className:"function",beginKeywords:"def"},{className:"class",beginKeywords:"class"}],end:/:/,illegal:/[${=;\n,]/,contains:[e.UNDERSCORE_TITLE_MODE,c,{begin:/->/,endsWithParent:!0,keywords:"None"}]},{className:"meta",begin:/^[\t ]*@/,end:/$/},{begin:/\b(print|exec)\(/}]}})),mi.registerLanguage("scss",(function(e){var t={className:"variable",begin:"(\\$[a-zA-Z-][a-zA-Z0-9_-]*)\\b"},n={className:"number",begin:"#[0-9A-Fa-f]+"};e.CSS_NUMBER_MODE,e.QUOTE_STRING_MODE,e.APOS_STRING_MODE,e.C_BLOCK_COMMENT_MODE;return{case_insensitive:!0,illegal:"[=/|']",contains:[e.C_LINE_COMMENT_MODE,e.C_BLOCK_COMMENT_MODE,{className:"selector-id",begin:"\\#[A-Za-z0-9_-]+",relevance:0},{className:"selector-class",begin:"\\.[A-Za-z0-9_-]+",relevance:0},{className:"selector-attr",begin:"\\[",end:"\\]",illegal:"$"},{className:"selector-tag",begin:"\\b(a|abbr|acronym|address|area|article|aside|audio|b|base|big|blockquote|body|br|button|canvas|caption|cite|code|col|colgroup|command|datalist|dd|del|details|dfn|div|dl|dt|em|embed|fieldset|figcaption|figure|footer|form|frame|frameset|(h[1-6])|head|header|hgroup|hr|html|i|iframe|img|input|ins|kbd|keygen|label|legend|li|link|map|mark|meta|meter|nav|noframes|noscript|object|ol|optgroup|option|output|p|param|pre|progress|q|rp|rt|ruby|samp|script|section|select|small|span|strike|strong|style|sub|sup|table|tbody|td|textarea|tfoot|th|thead|time|title|tr|tt|ul|var|video)\\b",relevance:0},{className:"selector-pseudo",begin:":(visited|valid|root|right|required|read-write|read-only|out-range|optional|only-of-type|only-child|nth-of-type|nth-last-of-type|nth-last-child|nth-child|not|link|left|last-of-type|last-child|lang|invalid|indeterminate|in-range|hover|focus|first-of-type|first-line|first-letter|first-child|first|enabled|empty|disabled|default|checked|before|after|active)"},{className:"selector-pseudo",begin:"::(after|before|choices|first-letter|first-line|repeat-index|repeat-item|selection|value)"},t,{className:"attribute",begin:"\\b(src|z-index|word-wrap|word-spacing|word-break|width|widows|white-space|visibility|vertical-align|unicode-bidi|transition-timing-function|transition-property|transition-duration|transition-delay|transition|transform-style|transform-origin|transform|top|text-underline-position|text-transform|text-shadow|text-rendering|text-overflow|text-indent|text-decoration-style|text-decoration-line|text-decoration-color|text-decoration|text-align-last|text-align|tab-size|table-layout|right|resize|quotes|position|pointer-events|perspective-origin|perspective|page-break-inside|page-break-before|page-break-after|padding-top|padding-right|padding-left|padding-bottom|padding|overflow-y|overflow-x|overflow-wrap|overflow|outline-width|outline-style|outline-offset|outline-color|outline|orphans|order|opacity|object-position|object-fit|normal|none|nav-up|nav-right|nav-left|nav-index|nav-down|min-width|min-height|max-width|max-height|mask|marks|margin-top|margin-right|margin-left|margin-bottom|margin|list-style-type|list-style-position|list-style-image|list-style|line-height|letter-spacing|left|justify-content|initial|inherit|ime-mode|image-orientation|image-resolution|image-rendering|icon|hyphens|height|font-weight|font-variant-ligatures|font-variant|font-style|font-stretch|font-size-adjust|font-size|font-language-override|font-kerning|font-feature-settings|font-family|font|float|flex-wrap|flex-shrink|flex-grow|flex-flow|flex-direction|flex-basis|flex|filter|empty-cells|display|direction|cursor|counter-reset|counter-increment|content|column-width|column-span|column-rule-width|column-rule-style|column-rule-color|column-rule|column-gap|column-fill|column-count|columns|color|clip-path|clip|clear|caption-side|break-inside|break-before|break-after|box-sizing|box-shadow|box-decoration-break|bottom|border-width|border-top-width|border-top-style|border-top-right-radius|border-top-left-radius|border-top-color|border-top|border-style|border-spacing|border-right-width|border-right-style|border-right-color|border-right|border-radius|border-left-width|border-left-style|border-left-color|border-left|border-image-width|border-image-source|border-image-slice|border-image-repeat|border-image-outset|border-image|border-color|border-collapse|border-bottom-width|border-bottom-style|border-bottom-right-radius|border-bottom-left-radius|border-bottom-color|border-bottom|border|background-size|background-repeat|background-position|background-origin|background-image|background-color|background-clip|background-attachment|background-blend-mode|background|backface-visibility|auto|animation-timing-function|animation-play-state|animation-name|animation-iteration-count|animation-fill-mode|animation-duration|animation-direction|animation-delay|animation|align-self|align-items|align-content)\\b",illegal:"[^\\s]"},{begin:"\\b(whitespace|wait|w-resize|visible|vertical-text|vertical-ideographic|uppercase|upper-roman|upper-alpha|underline|transparent|top|thin|thick|text|text-top|text-bottom|tb-rl|table-header-group|table-footer-group|sw-resize|super|strict|static|square|solid|small-caps|separate|se-resize|scroll|s-resize|rtl|row-resize|ridge|right|repeat|repeat-y|repeat-x|relative|progress|pointer|overline|outside|outset|oblique|nowrap|not-allowed|normal|none|nw-resize|no-repeat|no-drop|newspaper|ne-resize|n-resize|move|middle|medium|ltr|lr-tb|lowercase|lower-roman|lower-alpha|loose|list-item|line|line-through|line-edge|lighter|left|keep-all|justify|italic|inter-word|inter-ideograph|inside|inset|inline|inline-block|inherit|inactive|ideograph-space|ideograph-parenthesis|ideograph-numeric|ideograph-alpha|horizontal|hidden|help|hand|groove|fixed|ellipsis|e-resize|double|dotted|distribute|distribute-space|distribute-letter|distribute-all-lines|disc|disabled|default|decimal|dashed|crosshair|collapse|col-resize|circle|char|center|capitalize|break-word|break-all|bottom|both|bolder|bold|block|bidi-override|below|baseline|auto|always|all-scroll|absolute|table|table-cell)\\b"},{begin:":",end:";",contains:[t,n,e.CSS_NUMBER_MODE,e.QUOTE_STRING_MODE,e.APOS_STRING_MODE,{className:"meta",begin:"!important"}]},{begin:"@(page|font-face)",lexemes:"@[a-z-]+",keywords:"@page @font-face"},{begin:"@",end:"[{;]",returnBegin:!0,keywords:"and or not only",contains:[{begin:"@[a-z-]+",className:"keyword"},t,e.QUOTE_STRING_MODE,e.APOS_STRING_MODE,n,e.CSS_NUMBER_MODE]}]}})),mi.registerLanguage("shell",(function(e){return{aliases:["console"],contains:[{className:"meta",begin:"^\\s{0,3}[/\\w\\d\\[\\]()@-]*[>%$#]",starts:{end:"$",subLanguage:"bash"}}]}})),mi.registerLanguage("xml",(function(e){var t={className:"symbol",begin:"&[a-z]+;|&#[0-9]+;|&#x[a-f0-9]+;"},n={begin:"\\s",contains:[{className:"meta-keyword",begin:"#?[a-z_][a-z1-9_-]+",illegal:"\\n"}]},r=e.inherit(n,{begin:"\\(",end:"\\)"}),o=e.inherit(e.APOS_STRING_MODE,{className:"meta-string"}),i=e.inherit(e.QUOTE_STRING_MODE,{className:"meta-string"}),a={endsWithParent:!0,illegal:/</,relevance:0,contains:[{className:"attr",begin:"[A-Za-z0-9\\._:-]+",relevance:0},{begin:/=\s*/,relevance:0,contains:[{className:"string",endsParent:!0,variants:[{begin:/"/,end:/"/,contains:[t]},{begin:/'/,end:/'/,contains:[t]},{begin:/[^\s"'=<>`]+/}]}]}]};return{aliases:["html","xhtml","rss","atom","xjb","xsd","xsl","plist","wsf","svg"],case_insensitive:!0,contains:[{className:"meta",begin:"<![a-z]",end:">",relevance:10,contains:[n,i,o,r,{begin:"\\[",end:"\\]",contains:[{className:"meta",begin:"<![a-z]",end:">",contains:[n,r,i,o]}]}]},e.COMMENT("\x3c!--","--\x3e",{relevance:10}),{begin:"<\\!\\[CDATA\\[",end:"\\]\\]>",relevance:10},t,{className:"meta",begin:/<\?xml/,end:/\?>/,relevance:10},{begin:/<\?(php)?/,end:/\?>/,subLanguage:"php",contains:[{begin:"/\\*",end:"\\*/",skip:!0},{begin:'b"',end:'"',skip:!0},{begin:"b'",end:"'",skip:!0},e.inherit(e.APOS_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0}),e.inherit(e.QUOTE_STRING_MODE,{illegal:null,className:null,contains:null,skip:!0})]},{className:"tag",begin:"<style(?=\\s|>)",end:">",keywords:{name:"style"},contains:[a],starts:{end:"</style>",returnEnd:!0,subLanguage:["css","xml"]}},{className:"tag",begin:"<script(?=\\s|>)",end:">",keywords:{name:"script"},contains:[a],starts:{end:"<\/script>",returnEnd:!0,subLanguage:["actionscript","javascript","handlebars","xml"]}},{className:"tag",begin:"</?",end:"/?>",contains:[{className:"name",begin:/[^\/><\s]+/,relevance:0},a]}]}})),mi.registerLanguage("yaml",(function(e){var t={className:"string",relevance:0,variants:[{begin:/'/,end:/'/},{begin:/"/,end:/"/},{begin:/\S+/}],contains:[e.BACKSLASH_ESCAPE,{className:"template-variable",variants:[{begin:"{{",end:"}}"},{begin:"%{",end:"}"}]}]};return{case_insensitive:!0,aliases:["yml","YAML","yaml"],contains:[{className:"attr",variants:[{begin:"\\w[\\w :\\/.-]*:(?=[ \t]|$)"},{begin:'"\\w[\\w :\\/.-]*":(?=[ \t]|$)'},{begin:"'\\w[\\w :\\/.-]*':(?=[ \t]|$)"}]},{className:"meta",begin:"^---s*$",relevance:10},{className:"string",begin:"[\\|>]([0-9]?[+-])?[ ]*\\n( *)[\\S ]+\\n(\\2[\\S ]+\\n?)*"},{begin:"<%[%=-]?",end:"[%-]?%>",subLanguage:"ruby",excludeBegin:!0,excludeEnd:!0,relevance:0},{className:"type",begin:"!"+e.UNDERSCORE_IDENT_RE},{className:"type",begin:"!!"+e.UNDERSCORE_IDENT_RE},{className:"meta",begin:"&"+e.UNDERSCORE_IDENT_RE+"$"},{className:"meta",begin:"\\*"+e.UNDERSCORE_IDENT_RE+"$"},{className:"bullet",begin:"\\-(?=[ ]|$)",relevance:0},e.HASH_COMMENT_MODE,{beginKeywords:"true false yes no null",keywords:{literal:"true false yes no null"}},{className:"number",begin:e.C_NUMBER_RE+"\\b"},t]}})),($i=mi).lineNumbersBlock=function(e,t){$i.highlightBlock(e,t),e.innerHTML=function(e,t){var n=(t=t||{singleLine:!1}).singleLine?0:1;return function e(t){var n=t.childNodes;for(var r in n)if(n.hasOwnProperty(r)){var o=n[r];bi(o.textContent)>0&&(o.childNodes.length>0?e(o):gi(o.parentNode))}}(e),function(e,t){var n=yi(e);if(""===n[n.length-1].trim()&&n.pop(),n.length>t){for(var r="",o=0,i=n.length;o<i;o++){var a=o+1;r+="<tr>"+'<td class="'.concat("hljs-ln-line"," ").concat("hljs-ln-numbers",'" ').concat("data-line-number",'="').concat(a,'">')+'<div class="'.concat("hljs-ln-n",'" ').concat("data-line-number",'="').concat(a,'"></div>')+"</td>"+'<td class="'.concat("hljs-ln-line"," ").concat("hljs-ln-code",'" ').concat("data-line-number",'="').concat(a,'">')+(n[o].length>0?n[o]:" ")+"</td></tr>"}return'<table class="'.concat("hljs-ln",'">').concat(r,"</table>")}return e}(e.innerHTML,n)}(e,t)};var _i=n((function(e){function t(e){for(var t=document.createElement("div"),n=[[e,t]],o=[];n.length;){var i=n.shift(),a=p(i,2),c=a[0],s=a[1],u=void 0,d=void 0,f=r(c);if(null===c||"undefined"==f?f="null":Array.isArray(c)&&(f="array"),"array"==f?((d=function(e){return e}).len=c.length,(u=document.createElement("div")).className="json-array "+(d.len?"has-items":"is-empty")):"object"==f?function(){var e=Object.keys(c).sort();(d=function(t){return e[t]}).len=e.length,(u=document.createElement("div")).className="json-object "+(d.len?"has-items":"is-empty")}():((u=document.createElement("span")).className="json-"+f,u.textContent="null"==f?"null":"boolean"!=f?c:c?"true":"false"),d){var l=document.createElement("span");if(l.className="json-type",l.textContent=d.len?f+"["+d.len+"]":"{}",s.appendChild(l),-1!=o.indexOf(c))t.classList.add("has-recursive-items"),u.classList.add("is-seen");else{for(var h=0;h<d.len;h++){var m=d(h),v=document.createElement("div"),g=document.createElement("span");g.className="json-key",g.textContent=m,v.appendChild(g),u.appendChild(v),n.push([c[m],v])}o.push(c)}}s.className="json-item "+u.className.replace(/^json-/,"contains-"),s.appendChild(u)}return t}try{e.exports={jsonhtmlify:t}}catch(e){window.jsonhtmlify=t}})).jsonhtmlify;function wi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ki(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wi(Object(n),!0).forEach((function(t){et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ci={},Si=function(e){var t=e.conversation,n=e.expandUrlToMedia,r=void 0!==n&&n,o=e.from,i=void 0===o?"Convos":o,a=e.groupBy,c=void 0===a?["fromId"]:a,s=e.waiting,u=void 0===s?[]:s,d=new Rt,f={};return t.messages.map((function(e,n){return(e=ki({color:"inherit",from:"Convos",fromId:"Convos",type:"notice",ts:d},e)).canToggleDetails="error"==e.type||"notice"==e.type,e.groupBy=c.map((function(t){return e[t]||""})).join(":"),e.index=n,e.isOnline=function(e,t){return!t.connection_id||("Convos"==e.fromId||(e.fromId==t.connection_id||!!t.findParticipant(e.fromId)))}(e,t),e.dayChanged=function(e,t){return t.ts&&e.ts.getDate()!=t.ts.getDate()}(e,f),e.embeds=function(e,t,n){var r="notice"!=e.type&&n?(e.embeds||[]).map((function(e){return Ci[e]||(Ci[e]=function(e){return Ei.apply(this,arguments)}(e))})):[];if(e.canToggleDetails){var o=["details",t.path,e.ts.valueOf()].join(":");r.unshift(Ci[o]||(Ci[o]=function(e,t){return xi.apply(this,arguments)}(o,e)))}return r.filter((function(e){return e}))}(e,t,r),e.className=Ri(e,f),f=e,e})).concat(function(e){e.conversation;var t=e.from,n=e.waiting,r={};return n.filter((function(e){return"send"==e.method&&e.message})).map((function(e,n){return(e=ki({color:"inherit",from:t,fromId:t.toLowerCase()},e)).canToggleDetails=!0,e.dayChanged=!1,e.groupBy="fromId",e.index=n,e.isOnline=!0,e.type=e.waitingForResponse?"notice":"error",e.embeds=[],e.className=Ri(e,r)+" is-waiting",e.markdown=e.waitingForResponse?e.message:fn('Could not send message "%1".',e.message),r=e,e}))}({conversation:t,from:i,waiting:u}))};function xi(){return(xi=Xe(Qe.mark((function e(t,n){var r;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ki({},n.sent||n),["bubbles","canToggleDetails","className","color","command","connection_id","dayChanged","embeds","event","groupBy","id","index","isOnline","markdown","method","stopPropagation"].forEach((function(e){return delete r[e]})),e.abrupt("return",{className:"for-jsonhtmlify hidden",html:_i(r).outerHTML});case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ei(){return(Ei=Xe(Qe.mark((function e(t){var n,r,o;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dt("/api","embed",{url:t}).perform();case 2:return n=e.sent,(r=n.res.body).html||(r.html=""),r.className=r.provider_name?"for-"+r.provider_name.toLowerCase():r.html?"for-unknown":"hidden",pt(o=document.createRange().createContextualFragment(r.html).firstChild,"img",[["error",function(e){return e.target.style.display="none"}]]),-1!=(o&&o.className||"").split(/\s+/).indexOf("le-paste")&&Ti(r,o),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ri(e,t){var n=["message"];return e.type&&n.push("is-type-"+e.type),e.highlight&&n.push("is-highlighted"),n.push(e.dayChanged||e.groupBy!=t.groupBy?"has-not-same-from":"has-same-from"),n.push(e.isOnline?"is-present":"is-not-present"),n.join(" ")}function Ti(e,t){var n=t.querySelector("pre");n&&(mi.lineNumbersBlock(n),e.html=t.outerHTML)}function Oi(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Pi(e,t,n){var r=e.slice();return r[32]=t[n],r}function Di(e,t,n){var r=e.slice();return r[29]=t[n],r[31]=n,r}function Mi(e){var t,n,r,o,i=[ji,Ni],a=[];function c(e,t){return e[9].localStream.id&&e[9].constraints.video?0:1}return t=c(e),n=a[t]=i[t](e),{c:function(){n.c(),r=Y()},m:function(e,n){a[t].m(e,n),q(e,r,n),o=!0},p:function(e,o){var s=t;(t=c(e))===s?a[t].p(e,o):(Ae(),Ue(a[s],1,1,(function(){a[s]=null})),Le(),(n=a[t])||(n=a[t]=i[t](e)).c(),Ie(n,1),n.m(r.parentNode,r))},i:function(e){o||(Ie(n),o=!0)},o:function(e){Ue(n),o=!1},d:function(e){a[t].d(e),e&&G(r)}}}function Ni(e){var t,n=new xo({props:{icon:"video",tooltip:dn("Call"),disabled:e[8]}});return n.$on("click",e[26]),{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};256&t[0]&&(r.disabled=e[8]),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function ji(e){var t,n=new xo({props:{icon:"video-slash",tooltip:dn("Hangup"),disabled:e[8]}});return n.$on("click",e[25]),{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};256&t[0]&&(r.disabled=e[8]),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function Ai(e){var t,n,r,o,i,a,c,s,u,d,f,l,p=dn(e[2].name)+"",h=ln(e[1],e[2])+"",m=e[9].enabled&&e[6].conversation_id&&Mi(e),v=new wo({props:{name:"tools"}}),g=new wo({props:{name:"times"}});return{c:function(){t=K("h1"),n=K("a"),r=V(p),i=J(),a=K("span"),c=V(h),s=J(),m&&m.c(),u=J(),d=K("a"),Ge(v.$$.fragment),Ge(g.$$.fragment),X(n,"href",o="#activeMenu:"+(e[2].connection_id?"settings":"nav")),X(n,"tabindex","-1"),X(a,"class","chat-header__topic"),X(d,"href",f="#activeMenu:"+(e[2].connection_id?"settings":"nav")),X(d,"class","btn has-tooltip can-toggle"),X(d,"data-tooltip",dn("Settings")),oe(d,"is-toggled","settings"==e[4].activeMenu)},m:function(e,o){q(e,t,o),H(t,n),H(n,r),q(e,i,o),q(e,a,o),H(a,c),q(e,s,o),m&&m.m(e,o),q(e,u,o),q(e,d,o),We(v,d,null),We(g,d,null),l=!0},p:function(e,t){(!l||4&t[0])&&p!==(p=dn(e[2].name)+"")&&te(r,p),(!l||4&t[0]&&o!==(o="#activeMenu:"+(e[2].connection_id?"settings":"nav")))&&X(n,"href",o),(!l||6&t[0])&&h!==(h=ln(e[1],e[2])+"")&&te(c,h),e[9].enabled&&e[6].conversation_id?m?(m.p(e,t),Ie(m,1)):((m=Mi(e)).c(),Ie(m,1),m.m(u.parentNode,u)):m&&(Ae(),Ue(m,1,1,(function(){m=null})),Le()),(!l||4&t[0]&&f!==(f="#activeMenu:"+(e[2].connection_id?"settings":"nav")))&&X(d,"href",f),16&t[0]&&oe(d,"is-toggled","settings"==e[4].activeMenu)},i:function(e){l||(Ie(m),Ie(v.$$.fragment,e),Ie(g.$$.fragment,e),l=!0)},o:function(e){Ue(m),Ue(v.$$.fragment,e),Ue(g.$$.fragment,e),l=!1},d:function(e){e&&G(t),e&&G(i),e&&G(a),e&&G(s),m&&m.d(e),e&&G(u),e&&G(d),Ke(v),Ke(g)}}}function Li(e){var t,n,r,o,i,a=new wo({props:{name:"spinner",animation:"spin"}});return{c:function(){t=K("div"),n=K("span"),Ge(a.$$.fragment),r=J(),(o=K("i")).textContent="".concat(dn("Loading...")),X(t,"class","message__status-line for-loading has-pos-top")},m:function(e,c){q(e,t,c),H(t,n),We(a,n,null),H(n,r),H(n,o),i=!0},p:x,i:function(e){i||(Ie(a.$$.fragment,e),i=!0)},o:function(e){Ue(a.$$.fragment,e),i=!1},d:function(e){e&&G(t),Ke(a)}}}function Ii(e){var t,n,r,o,i,a,c=dn("Started chatting on %1",e[6].historyStartAt.getHumanDate())+"",s=new wo({props:{name:"calendar-alt"}});return{c:function(){t=K("div"),n=K("span"),Ge(s.$$.fragment),r=J(),o=K("i"),i=V(c),X(t,"class","message__status-line for-start-of-history")},m:function(e,c){q(e,t,c),H(t,n),We(s,n,null),H(n,r),H(n,o),H(o,i),a=!0},p:function(e,t){(!a||64&t[0])&&c!==(c=dn("Started chatting on %1",e[6].historyStartAt.getHumanDate())+"")&&te(i,c)},i:function(e){a||(Ie(s.$$.fragment,e),a=!0)},o:function(e){Ue(s.$$.fragment,e),a=!1},d:function(e){e&&G(t),Ke(s)}}}function Ui(e){var t,n,r,o,i=[Bi,zi],a=[];function c(e,t){return e[6].is_private?0:1}return t=c(e),n=a[t]=i[t](e),{c:function(){n.c(),r=Y()},m:function(e,n){a[t].m(e,n),q(e,r,n),o=!0},p:function(e,o){var s=t;(t=c(e))===s?a[t].p(e,o):(Ae(),Ue(a[s],1,1,(function(){a[s]=null})),Le(),(n=a[t])||(n=a[t]=i[t](e)).c(),Ie(n,1),n.m(r.parentNode,r))},i:function(e){o||(Ie(n),o=!0)},o:function(e){Ue(n),o=!1},d:function(e){a[t].d(e),e&&G(r)}}}function zi(e){var t,n,r,o,i,a=new Po({props:{$$slots:{default:[Fi]},$$scope:{ctx:e}}}),c=[qi,Hi],s=[];function u(e,t){return 1==e[6].nParticipants?0:1}return n=u(e),r=s[n]=c[n](e),{c:function(){Ge(a.$$.fragment),t=J(),r.c(),o=Y()},m:function(e,r){We(a,e,r),q(e,t,r),s[n].m(e,r),q(e,o,r),i=!0},p:function(e,t){var i={};64&t[0]|32&t[1]&&(i.$$scope={dirty:t,ctx:e}),a.$set(i);var d=n;(n=u(e))===d?s[n].p(e,t):(Ae(),Ue(s[d],1,1,(function(){s[d]=null})),Le(),(r=s[n])||(r=s[n]=c[n](e)).c(),Ie(r,1),r.m(o.parentNode,o))},i:function(e){i||(Ie(a.$$.fragment,e),Ie(r),i=!0)},o:function(e){Ue(a.$$.fragment,e),Ue(r),i=!1},d:function(e){Ke(a,e),e&&G(t),s[n].d(e),e&&G(o)}}}function Bi(e){var t,n=new Po({props:{$$slots:{default:[Ki]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};64&t[0]|32&t[1]&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function Fi(e){var t,n=fn(e[6].topic?"Topic for %1 is: %2":"No topic is set for %1.",e[6].name,e[6].topic)+"";return{c:function(){t=new ce(n,null)},m:function(e,n){t.m(e,n)},p:function(e,r){64&r[0]&&n!==(n=fn(e[6].topic?"Topic for %1 is: %2":"No topic is set for %1.",e[6].name,e[6].topic)+"")&&t.p(n)},d:function(e){e&&t.d()}}}function Hi(e){var t,n=new Po({props:{same:!0,$$slots:{default:[Gi]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};64&t[0]|32&t[1]&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function qi(e){var t,n=new Po({props:{same:!0,$$slots:{default:[Wi]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};32&t[1]&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function Gi(e){var t,n=fn("There are %1 [participants](%2) in this conversation.",e[6].nParticipants,e[6].path+"#activeMenu:settings")+"";return{c:function(){t=new ce(n,null)},m:function(e,n){t.m(e,n)},p:function(e,r){64&r[0]&&n!==(n=fn("There are %1 [participants](%2) in this conversation.",e[6].nParticipants,e[6].path+"#activeMenu:settings")+"")&&t.p(n)},d:function(e){e&&t.d()}}}function Wi(e){var t,n=dn("You are the only participant in this conversation.")+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ki(e){var t,n=fn('This is a private conversation with "%1".',e[6].name)+"";return{c:function(){t=new ce(n,null)},m:function(e,n){t.m(e,n)},p:function(e,r){64&r[0]&&n!==(n=fn('This is a private conversation with "%1".',e[6].name)+"")&&t.p(n)},d:function(e){e&&t.d()}}}function Vi(e){var t,n,r,o,i,a,c=e[29].ts.getHumanDate()+"",s=new wo({props:{name:"calendar-alt"}});return{c:function(){t=K("div"),n=K("span"),Ge(s.$$.fragment),r=J(),o=K("i"),i=V(c),X(t,"class","message__status-line for-day-changed")},m:function(e,c){q(e,t,c),H(t,n),We(s,n,null),H(n,r),H(n,o),H(o,i),a=!0},p:function(e,t){(!a||32&t[0])&&c!==(c=e[29].ts.getHumanDate()+"")&&te(i,c)},i:function(e){a||(Ie(s.$$.fragment,e),a=!0)},o:function(e){Ue(s.$$.fragment,e),a=!1},d:function(e){e&&G(t),Ke(s)}}}function Ji(e){var t,n,r,o,i,a=dn("New messages")+"",c=new wo({props:{name:"comments"}});return{c:function(){t=K("div"),n=K("span"),Ge(c.$$.fragment),r=J(),o=V(a),X(t,"class","message__status-line for-last-read")},m:function(e,a){q(e,t,a),H(t,n),We(c,n,null),H(n,r),H(n,o),i=!0},p:x,i:function(e){i||(Ie(c.$$.fragment,e),i=!0)},o:function(e){Ue(c.$$.fragment,e),i=!1},d:function(e){e&&G(t),Ke(c)}}}function Yi(e){var t,n,r=new wo({props:{name:"error"==e[29].type?"exclamation-circle":"info-circle"}});return{c:function(){t=K("a"),Ge(r.$$.fragment),X(t,"href","#action:toggleDetails")},m:function(e,o){q(e,t,o),We(r,t,null),n=!0},p:function(e,t){var n={};32&t[0]&&(n.name="error"==e[29].type?"exclamation-circle":"info-circle"),r.$set(n)},i:function(e){n||(Ie(r.$$.fragment,e),n=!0)},o:function(e){Ue(r.$$.fragment,e),n=!1},d:function(e){e&&G(t),Ke(r)}}}function Qi(e){var t,n,r,o,i=new wo({props:{name:"times-circle"}}),a=new wo({props:{name:"sync-alt"}});return{c:function(){t=K("a"),Ge(i.$$.fragment),n=J(),r=K("a"),Ge(a.$$.fragment),X(t,"href","#action:remove"),X(t,"class","pull-right has-tooltip"),X(t,"data-tooltip",dn("Remove")),X(r,"href","#action:resend"),X(r,"class","pull-right has-tooltip "),X(r,"data-tooltip",dn("Resend"))},m:function(e,c){q(e,t,c),We(i,t,null),q(e,n,c),q(e,r,c),We(a,r,null),o=!0},p:x,i:function(e){o||(Ie(i.$$.fragment,e),Ie(a.$$.fragment,e),o=!0)},o:function(e){Ue(i.$$.fragment,e),Ue(a.$$.fragment,e),o=!1},d:function(e){e&&G(t),Ke(i),e&&G(n),e&&G(r),Ke(a)}}}function Zi(e){return{c:x,m:x,p:x,d:x}}function Xi(e){var t,n,r=e[35].html+"";return{c:function(){X(t=K("div"),"class",n="embed "+e[35].className)},m:function(e,n){q(e,t,n),t.innerHTML=r},p:function(e,o){32&o[0]&&r!==(r=e[35].html+"")&&(t.innerHTML=r),32&o[0]&&n!==(n="embed "+e[35].className)&&X(t,"class",n)},d:function(e){e&&G(t)}}}function ea(e){return{c:x,m:x,p:x,d:x}}function ta(e){var t,n,r={ctx:e,current:null,token:null,pending:ea,then:Xi,catch:Zi,value:35};return Fe(n=e[32],r),{c:function(){t=Y(),r.block.c()},m:function(e,n){q(e,t,n),r.block.m(e,r.anchor=n),r.mount=function(){return t.parentNode},r.anchor=t},p:function(t,o){if(e=t,r.ctx=e,32&o[0]&&n!==(n=e[32])&&Fe(n,r));else{var i=e.slice();i[35]=r.resolved,r.block.p(i,o)}},d:function(e){e&&G(t),r.block.d(e),r.token=null,r=null}}}function na(e){var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g,y,b,$,_,w,k,C,S=e[29].ts.toLocaleString()+"",x=e[29].from+"",E=e[29].markdown+"",R=e[29].dayChanged&&Vi(e),T=e[31]&&e[31]==e[6].messages.length-e[6].unread&&Ji(),O=new wo({props:{name:"pick:"+e[29].fromId,color:e[29].color}}),P=[Qi,Yi],D=[];function M(e,t){return!1===e[29].waitingForResponse?0:!e[29].waitingForResponse&&e[29].canToggleDetails?1:-1}~(m=M(e))&&(v=D[m]=P[m](e));for(var N=e[29].embeds,j=[],A=0;A<N.length;A+=1)j[A]=ta(Pi(e,N,A));return{c:function(){R&&R.c(),t=J(),T&&T.c(),n=J(),r=K("div"),Ge(O.$$.fragment),o=J(),i=K("div"),a=K("div"),c=V(S),u=J(),d=K("a"),f=V(x),p=J(),h=K("div"),v&&v.c(),g=J(),b=J();for(var m=0;m<j.length;m+=1)j[m].c();$=J(),X(i,"class","message__ts has-tooltip"),X(i,"data-content",s=e[29].ts.format("%H:%M")),X(d,"href",l="#action:join:"+e[29].from),X(d,"class","message__from"),re(d,"color",e[29].color),X(d,"tabindex","-1"),y=new ce(E,null),X(h,"class","message__text"),X(r,"class",_=e[29].className),X(r,"data-index",e[31]),X(r,"data-ts",w=e[29].ts.toISOString())},m:function(s,l,v){R&&R.m(s,l),q(s,t,l),T&&T.m(s,l),q(s,n,l),q(s,r,l),We(O,r,null),H(r,o),H(r,i),H(i,a),H(a,c),H(r,u),H(r,d),H(d,f),H(r,p),H(r,h),~m&&D[m].m(h,null),H(h,g),y.m(h),H(r,b);for(var _=0;_<j.length;_+=1)j[_].m(r,null);H(r,$),k=!0,v&&C(),C=Q(r,"click",e[13])},p:function(e,o){e[29].dayChanged?R?(R.p(e,o),Ie(R,1)):((R=Vi(e)).c(),Ie(R,1),R.m(t.parentNode,t)):R&&(Ae(),Ue(R,1,1,(function(){R=null})),Le()),e[31]&&e[31]==e[6].messages.length-e[6].unread?T?(T.p(e,o),Ie(T,1)):((T=Ji()).c(),Ie(T,1),T.m(n.parentNode,n)):T&&(Ae(),Ue(T,1,1,(function(){T=null})),Le());var a={};32&o[0]&&(a.name="pick:"+e[29].fromId),32&o[0]&&(a.color=e[29].color),O.$set(a),(!k||32&o[0])&&S!==(S=e[29].ts.toLocaleString()+"")&&te(c,S),(!k||32&o[0]&&s!==(s=e[29].ts.format("%H:%M")))&&X(i,"data-content",s),(!k||32&o[0])&&x!==(x=e[29].from+"")&&te(f,x),(!k||32&o[0]&&l!==(l="#action:join:"+e[29].from))&&X(d,"href",l),(!k||32&o[0])&&re(d,"color",e[29].color);var u=m;if((m=M(e))===u?~m&&D[m].p(e,o):(v&&(Ae(),Ue(D[u],1,1,(function(){D[u]=null})),Le()),~m?((v=D[m])||(v=D[m]=P[m](e)).c(),Ie(v,1),v.m(h,g)):v=null),(!k||32&o[0])&&E!==(E=e[29].markdown+"")&&y.p(E),32&o[0]){var p;for(N=e[29].embeds,p=0;p<N.length;p+=1){var b=Pi(e,N,p);j[p]?j[p].p(b,o):(j[p]=ta(b),j[p].c(),j[p].m(r,$))}for(;p<j.length;p+=1)j[p].d(1);j.length=N.length}(!k||32&o[0]&&_!==(_=e[29].className))&&X(r,"class",_),(!k||32&o[0]&&w!==(w=e[29].ts.toISOString()))&&X(r,"data-ts",w)},i:function(e){k||(Ie(R),Ie(T),Ie(O.$$.fragment,e),Ie(v),k=!0)},o:function(e){Ue(R),Ue(T),Ue(O.$$.fragment,e),Ue(v),k=!1},d:function(e){R&&R.d(e),e&&G(t),T&&T.d(e),e&&G(n),e&&G(r),Ke(O),~m&&D[m].d(),W(j,e),C()}}}function ra(e){var t,n=new Po({props:{type:"error",$$slots:{default:[ca]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};192&t[0]|32&t[1]&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function oa(e){var t,n=new Po({props:{type:"error",$$slots:{default:[sa]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};128&t[0]|32&t[1]&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function ia(e){var t,n,r,o,i,a,c,s,u=dn('Do you want to chat with "%1"?',e[6].conversation_id)+"",d=new xo({props:{type:"button",icon:"thumbs-up",$$slots:{default:[ua]},$$scope:{ctx:e}}});d.$on("click",e[27]);var f=new Yo({props:{href:"/chat",class:"btn",$$slots:{default:[da]},$$scope:{ctx:e}}});return{c:function(){(t=K("h2")).textContent="".concat(dn("You are not part of this conversation.")),n=J(),r=K("p"),o=V(u),i=J(),a=K("p"),Ge(d.$$.fragment),c=J(),Ge(f.$$.fragment)},m:function(e,u){q(e,t,u),q(e,n,u),q(e,r,u),H(r,o),q(e,i,u),q(e,a,u),We(d,a,null),H(a,c),We(f,a,null),s=!0},p:function(e,t){(!s||64&t[0])&&u!==(u=dn('Do you want to chat with "%1"?',e[6].conversation_id)+"")&&te(o,u);var n={};32&t[1]&&(n.$$scope={dirty:t,ctx:e}),d.$set(n);var r={};32&t[1]&&(r.$$scope={dirty:t,ctx:e}),f.$set(r)},i:function(e){s||(Ie(d.$$.fragment,e),Ie(f.$$.fragment,e),s=!0)},o:function(e){Ue(d.$$.fragment,e),Ue(f.$$.fragment,e),s=!1},d:function(e){e&&G(t),e&&G(n),e&&G(r),e&&G(i),e&&G(a),Ke(d),Ke(f)}}}function aa(e){var t,n,r,o,i,a,c,s,u=dn('Do you want to create the connection "%1"?',e[7].connection_id)+"",d=new Yo({props:{href:"/settings/connection?server="+encodeURIComponent(e[6].connection_id)+"&conversation="+encodeURIComponent(e[6].conversation_id),class:"btn",$$slots:{default:[fa]},$$scope:{ctx:e}}}),f=new Yo({props:{href:"/chat",class:"btn",$$slots:{default:[la]},$$scope:{ctx:e}}});return{c:function(){(t=K("h2")).textContent="".concat(dn("Connection does not exist.")),n=J(),r=K("p"),o=V(u),i=J(),a=K("p"),Ge(d.$$.fragment),c=J(),Ge(f.$$.fragment)},m:function(e,u){q(e,t,u),q(e,n,u),q(e,r,u),H(r,o),q(e,i,u),q(e,a,u),We(d,a,null),H(a,c),We(f,a,null),s=!0},p:function(e,t){(!s||128&t[0])&&u!==(u=dn('Do you want to create the connection "%1"?',e[7].connection_id)+"")&&te(o,u);var n={};64&t[0]&&(n.href="/settings/connection?server="+encodeURIComponent(e[6].connection_id)+"&conversation="+encodeURIComponent(e[6].conversation_id)),32&t[1]&&(n.$$scope={dirty:t,ctx:e}),d.$set(n);var r={};32&t[1]&&(r.$$scope={dirty:t,ctx:e}),f.$set(r)},i:function(e){s||(Ie(d.$$.fragment,e),Ie(f.$$.fragment,e),s=!0)},o:function(e){Ue(d.$$.fragment,e),Ue(f.$$.fragment,e),s=!1},d:function(e){e&&G(t),e&&G(n),e&&G(r),e&&G(i),e&&G(a),Ke(d),Ke(f)}}}function ca(e){var t,n=(ln(e[7],e[6]).replace(/\.$/,"")||dn(e[6].frozen))+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:function(e,r){192&r[0]&&n!==(n=(ln(e[7],e[6]).replace(/\.$/,"")||dn(e[6].frozen))+"")&&te(t,n)},d:function(e){e&&G(t)}}}function sa(e){var t,n=fn("Disconnected. Your connection %1 can be edited in [settings](%2).",e[7].name,"#activeMenu:settings")+"";return{c:function(){t=new ce(n,null)},m:function(e,n){t.m(e,n)},p:function(e,r){128&r[0]&&n!==(n=fn("Disconnected. Your connection %1 can be edited in [settings](%2).",e[7].name,"#activeMenu:settings")+"")&&t.p(n)},d:function(e){e&&t.d()}}}function ua(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Yes"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function da(e){var t,n,r=new wo({props:{name:"thumbs-down"}});return{c:function(){Ge(r.$$.fragment),(t=K("span")).textContent="".concat(dn("No"))},m:function(e,o){We(r,e,o),q(e,t,o),n=!0},p:x,i:function(e){n||(Ie(r.$$.fragment,e),n=!0)},o:function(e){Ue(r.$$.fragment,e),n=!1},d:function(e){Ke(r,e),e&&G(t)}}}function fa(e){var t,n,r,o=dn("Yes")+"",i=new wo({props:{name:"thumbs-up"}});return{c:function(){Ge(i.$$.fragment),t=J(),n=V(o)},m:function(e,o){We(i,e,o),q(e,t,o),q(e,n,o),r=!0},p:x,i:function(e){r||(Ie(i.$$.fragment,e),r=!0)},o:function(e){Ue(i.$$.fragment,e),r=!1},d:function(e){Ke(i,e),e&&G(t),e&&G(n)}}}function la(e){var t,n,r,o=dn("No")+"",i=new wo({props:{name:"thumbs-down"}});return{c:function(){Ge(i.$$.fragment),t=J(),n=V(o)},m:function(e,o){We(i,e,o),q(e,t,o),q(e,n,o),r=!0},p:x,i:function(e){r||(Ie(i.$$.fragment,e),r=!0)},o:function(e){Ue(i.$$.fragment,e),r=!1},d:function(e){Ke(i,e),e&&G(t),e&&G(n)}}}function pa(e){var t,n,r,o,i,a=new wo({props:{name:"spinner",animation:"spin"}});return{c:function(){t=K("div"),n=K("span"),Ge(a.$$.fragment),r=J(),(o=K("i")).textContent="".concat(dn("Loading...")),X(t,"class","message__status-line for-loading has-pos-bottom")},m:function(e,c){q(e,t,c),H(t,n),We(a,n,null),H(n,r),H(n,o),i=!0},p:x,i:function(e){i||(Ie(a.$$.fragment,e),i=!0)},o:function(e){Ue(a.$$.fragment,e),i=!1},d:function(e){e&&G(t),Ke(a)}}}function ha(e){var t,n,r,o,i,a,c=dn("Jump to %1",e[3].format("%b %e %H:%M"))+"",s=new wo({props:{name:"external-link-alt"}});return{c:function(){t=K("div"),n=K("a"),Ge(s.$$.fragment),r=J(),o=V(c),X(n,"href",i=e[2].path),X(t,"class","message__status-line for-jump-to-now")},m:function(e,i){q(e,t,i),H(t,n),We(s,n,null),H(n,r),H(n,o),a=!0},p:function(e,t){(!a||8&t[0])&&c!==(c=dn("Jump to %1",e[3].format("%b %e %H:%M"))+"")&&te(o,c),(!a||4&t[0]&&i!==(i=e[2].path))&&X(n,"href",i)},i:function(e){a||(Ie(s.$$.fragment,e),a=!0)},o:function(e){Ue(s.$$.fragment,e),a=!1},d:function(e){e&&G(t),Ke(s)}}}function ma(e){for(var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m=e[6].is("loading"),v=e[6].historyStartAt&&!e[6].is("not_found"),g=e[6].messages.length<10&&!e[6].is("not_found"),y=e[6].is("loading"),b=m&&Li(),$=v&&Ii(e),_=g&&Ui(e),w=e[5],k=[],C=0;C<w.length;C+=1)k[C]=na(Di(e,w,C));var S=function(e){return Ue(k[e],1,1,(function(){k[e]=null}))},x=[aa,ia,oa,ra],E=[];function R(e,t){return 192&t[0]&&(i=!(!e[7].is("not_found")||e[6].conversation_id)),i?0:(64&t[0]&&(a=!!e[6].is("not_found")),a?1:(128&t[0]&&(c=!(e[7].is("unreachable")||!e[7].frozen)),c?2:(64&t[0]&&(s=!(!e[6].frozen||e[6].is("locked"))),s?3:-1)))}~(u=R(e,[-1]))&&(d=E[u]=x[u](e));var T=y&&pa(),O=!e[6].historyStopAt&&e[6].messages.length&&ha(e);return{c:function(){b&&b.c(),t=J(),$&&$.c(),n=J(),_&&_.c(),r=J();for(var e=0;e<k.length;e+=1)k[e].c();o=J(),d&&d.c(),f=J(),T&&T.c(),l=J(),O&&O.c(),p=Y()},m:function(e,i){b&&b.m(e,i),q(e,t,i),$&&$.m(e,i),q(e,n,i),_&&_.m(e,i),q(e,r,i);for(var a=0;a<k.length;a+=1)k[a].m(e,i);q(e,o,i),~u&&E[u].m(e,i),q(e,f,i),T&&T.m(e,i),q(e,l,i),O&&O.m(e,i),q(e,p,i),h=!0},p:function(e,i){if(64&i[0]&&(m=e[6].is("loading")),m?b?(b.p(e,i),Ie(b,1)):((b=Li()).c(),Ie(b,1),b.m(t.parentNode,t)):b&&(Ae(),Ue(b,1,1,(function(){b=null})),Le()),64&i[0]&&(v=e[6].historyStartAt&&!e[6].is("not_found")),v?$?($.p(e,i),Ie($,1)):(($=Ii(e)).c(),Ie($,1),$.m(n.parentNode,n)):$&&(Ae(),Ue($,1,1,(function(){$=null})),Le()),64&i[0]&&(g=e[6].messages.length<10&&!e[6].is("not_found")),g?_?(_.p(e,i),Ie(_,1)):((_=Ui(e)).c(),Ie(_,1),_.m(r.parentNode,r)):_&&(Ae(),Ue(_,1,1,(function(){_=null})),Le()),8288&i[0]){var a;for(w=e[5],a=0;a<w.length;a+=1){var c=Di(e,w,a);k[a]?(k[a].p(c,i),Ie(k[a],1)):(k[a]=na(c),k[a].c(),Ie(k[a],1),k[a].m(o.parentNode,o))}for(Ae(),a=w.length;a<k.length;a+=1)S(a);Le()}var s=u;(u=R(e,i))===s?~u&&E[u].p(e,i):(d&&(Ae(),Ue(E[s],1,1,(function(){E[s]=null})),Le()),~u?((d=E[u])||(d=E[u]=x[u](e)).c(),Ie(d,1),d.m(f.parentNode,f)):d=null),64&i[0]&&(y=e[6].is("loading")),y?T?(T.p(e,i),Ie(T,1)):((T=pa()).c(),Ie(T,1),T.m(l.parentNode,l)):T&&(Ae(),Ue(T,1,1,(function(){T=null})),Le()),!e[6].historyStopAt&&e[6].messages.length?O?(O.p(e,i),Ie(O,1)):((O=ha(e)).c(),Ie(O,1),O.m(p.parentNode,p)):O&&(Ae(),Ue(O,1,1,(function(){O=null})),Le())},i:function(e){if(!h){Ie(b),Ie($),Ie(_);for(var t=0;t<w.length;t+=1)Ie(k[t]);Ie(d),Ie(T),Ie(O),h=!0}},o:function(e){Ue(b),Ue($),Ue(_),k=k.filter(Boolean);for(var t=0;t<k.length;t+=1)Ue(k[t]);Ue(d),Ue(T),Ue(O),h=!1},d:function(e){b&&b.d(e),e&&G(t),$&&$.d(e),e&&G(n),_&&_.d(e),e&&G(r),W(k,e),e&&G(o),~u&&E[u].d(e),e&&G(f),T&&T.d(e),e&&G(l),O&&O.d(e),e&&G(p)}}}function va(e){var t,n,r,o,i=new jo({props:{$$slots:{default:[Ai]},$$scope:{ctx:e}}}),a=new hi({props:{class:"main is-above-chat-input",$$slots:{default:[ma]},$$scope:{ctx:e}}});a.$on("rendered",e[14]),a.$on("scrolled",e[15]);var c={conversation:e[2]},s=new Wo({props:c});e[28](s);var u=new ui({props:{conversation:e[2]}});return{c:function(){Ge(i.$$.fragment),t=J(),Ge(a.$$.fragment),n=J(),Ge(s.$$.fragment),r=J(),Ge(u.$$.fragment)},m:function(e,c){We(i,e,c),q(e,t,c),We(a,e,c),q(e,n,c),We(s,e,c),q(e,r,c),We(u,e,c),o=!0},p:function(e,t){var n={};854&t[0]|32&t[1]&&(n.$$scope={dirty:t,ctx:e}),i.$set(n);var r={};236&t[0]|32&t[1]&&(r.$$scope={dirty:t,ctx:e}),a.$set(r);var o={};4&t[0]&&(o.conversation=e[2]),s.$set(o);var c={};4&t[0]&&(c.conversation=e[2]),u.$set(c)},i:function(e){o||(Ie(i.$$.fragment,e),Ie(a.$$.fragment,e),Ie(s.$$.fragment,e),Ie(u.$$.fragment,e),o=!0)},o:function(e){Ue(i.$$.fragment,e),Ue(a.$$.fragment,e),Ue(s.$$.fragment,e),Ue(u.$$.fragment,e),o=!1},d:function(o){Ke(i,o),o&&G(t),Ke(a,o),o&&G(n),e[28](null),Ke(s,o),o&&G(r),Ke(u,o)}}}function ga(e,t){e.preventDefault(),io.showFullscreen(t)}function ya(e,t,n){var r,o,i,a,c,s,u,d=x,f=function(){return d(),d=M(_,(function(e){return n(6,i=e)})),_},l=x,h=function(){return l(),l=M($,(function(e){return n(7,c=e)})),$};N(e,Kt,(function(e){return n(4,r=e)})),N(e,io,(function(e){return n(19,a=e)})),e.$$.on_destroy.push((function(){return d()})),e.$$.on_destroy.push((function(){return l()}));var m=ye("rtc");N(e,m,(function(e){return n(9,u=e)}));var v=ye("socket");N(e,v,(function(e){return n(20,s=e)}));var g=ye("user");N(e,g,(function(e){return n(18,o=e)}));var y,b=new di,$=g.notifications;h();var _=g.notifications;f();var w=new Rt,k="",C={};function S(e,t){if("activeMenu"==t[0])return!0;e.preventDefault();var n=e.target.closest(".message"),r=n&&T[n.dataset.index];return"join"==t[1]?_.send("/join "+r.from):"remove"==t[1]?v.deleteWaitingMessage(r.id):"resend"==t[1]?v.send(v.getWaitingMessages([r.id])[0]):"toggleDetails"==t[1]?pt(n,".embed.for-jsonhtmlify",(function(e){return e.classList.toggle("hidden")})):void 0}function E(e){var t=["connection_id","conversation_id"].map((function(t){return e.param(t)})),n=p(t,2),r=n[0],o=n[1];_.connection_id==r&&_.conversation_id==o||g.setActiveConversation({connection_id:r,conversation_id:o})}function R(e){var t;if(e.activeConversation!=_)return C.conversation&&C.conversation(),C.markAsRead&&C.markAsRead(),f(n(2,_=e.activeConversation)),h(n(1,$=e.findConversation({connection_id:_.connection_id})||_)),n(3,w=new Rt),C.conversation=_.subscribe((function(e){f(n(2,_=e))})),C.markAsRead=_.markAsRead.bind(_),Kt.update({title:_.title}),m.hangup(),t=Kt.hash,(k=!!String(t||"").match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)&&Kt.hash||"")?_.load({around:k}):_.historyStopAt?void 0:_.load({around:w.toISOString()})}me((function(){b.attach(document.querySelector(".main"),y)})),ve((function(){Object.keys(C).forEach((function(e){return C[e]()})),b.detach(),m.hangup()}));var T,O;return e.$$.update=function(){16&e.$$.dirty[0]&&E(r),262144&e.$$.dirty[0]&&R(o),1573056&e.$$.dirty[0]&&n(5,T=Si({conversation:i,expandUrlToMedia:a.expandUrlToMedia,from:c.nick,waiting:Array.from(s.waiting.values())})),64&e.$$.dirty[0]&&n(8,O=!!i.frozen),84&e.$$.dirty[0]&&(r.hash||i.historyStopAt||_.load({}))},[y,$,_,w,r,T,i,c,O,u,m,v,g,function(e){var t=e.target.closest("a");t&&e.target.closest(".embed")&&(t.target="_blank");var n=e.target.closest(".le-meta");if(n)return t||n.parentNode.classList.toggle("is-expanded");var r=t&&t.href.match(/#(activeMenu|action:[\w:]+)/);return r?S(e,r[1].split(":",3)):gt(e.target,"img")?ga(e,e.target):t&&t.classList.contains("le-thumbnail")?ga(t.querySelector("img")):void 0},function(e){var t=e.detail,n=t.infinityEl;(0,t.scrollTo)(Kt.hash?'.message[data-ts="'+Kt.hash+'"]':-1),function(e,t){var n=t&&Kt.hash&&e.querySelector('.message[data-ts="'+Kt.hash+'"]');pt(e,".has-focus",(function(e){return e.classList.remove("has-focus")})),n&&n.classList.add("has-focus")}(n,k==Kt.hash)},function(e){if(_.messages.length){var t=e.detail,n=(t.infinityEl,t.pos),r=t.visibleEls,o=r[0],i=r.slice(-1)[0];if("top"==n){var a=_.messages[0].ts.toISOString();Kt.go(_.path+"#"+a,{replace:!0}),_.historyStartAt||_.load({before:a})}else if("bottom"==n){var c=_.messages.slice(-1)[0].ts.toISOString();Kt.go(_.path+(_.historyStopAt?"":"#"+i.dataset.ts),{replace:!0}),_.historyStopAt||_.load({after:c})}else o&&o.dataset.ts&&Kt.go(_.path+"#"+o.dataset.ts,{replace:!0})}},k,C,o,a,s,b,S,E,R,function(e){return m.hangup()},function(e){return m.call(_,{audio:!0,video:!0})},function(){return _.send("/join "+i.conversation_id)},function(e){_e[e?"unshift":"push"]((function(){n(0,y=e)}))}]}var ba=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Oi()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,ya,va,D,{},[-1,-1]),r}return s}(Ye);function $a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var _a=function(e){return{}},wa=function(e){return{}};function ka(e){var t,n,r,o,i,a,c,s=new wo({props:{family:"regular",name:e[7]}});s.$on("click",e[14]);var u,d=e[9].label,f=j(d,e,e[8],wa),l=f||{c:function(){u=V("Label")},m:function(e,t){q(e,u,t)},d:function(e){e&&G(u)}};return{c:function(){t=K("div"),n=K("input"),r=J(),Ge(s.$$.fragment),o=J(),i=K("label"),l&&l.c(),X(n,"type","checkbox"),X(n,"id",e[4]),X(n,"name",e[3]),n.__value=e[1],n.value=n.__value,n.disabled=e[2],X(i,"for",e[4]),X(t,"class","checkbox"),oe(t,"has-focus",e[6]),oe(t,"is-disabled",e[2])},m:function(u,d,f){q(u,t,d),H(t,n),n.checked=e[0],e[11](n),H(t,r),We(s,t,null),H(t,o),H(t,i),l&&l.m(i,null),a=!0,f&&O(c),c=[Q(n,"change",e[10]),Q(n,"blur",e[12]),Q(n,"focus",e[13])]},p:function(e,r){var o=p(r,1)[0];(!a||16&o)&&X(n,"id",e[4]),(!a||8&o)&&X(n,"name",e[3]),(!a||2&o)&&(n.__value=e[1]),n.value=n.__value,(!a||4&o)&&(n.disabled=e[2]),1&o&&(n.checked=e[0]);var c={};128&o&&(c.name=e[7]),s.$set(c),f&&f.p&&256&o&&f.p(A(d,e,e[8],wa),L(d,e[8],o,_a)),(!a||16&o)&&X(i,"for",e[4]),64&o&&oe(t,"has-focus",e[6]),4&o&&oe(t,"is-disabled",e[2])},i:function(e){a||(Ie(s.$$.fragment,e),Ie(l,e),a=!0)},o:function(e){Ue(s.$$.fragment,e),Ue(l,e),a=!1},d:function(n){n&&G(t),e[11](null),Ke(s),l&&l.d(n),O(c)}}}function Ca(e,t,n){var r,o=t.checked,i=void 0!==o&&o,a=t.disabled,c=void 0!==a&&a,s=t.name,u=void 0===s?"":s,d=t.id,f=void 0===d?u?"form_"+u:yt():d,l=t.value,p=void 0===l?1:l,h=!1,m=t.$$slots,v=void 0===m?{}:m,g=t.$$scope;var y;return e.$set=function(e){"checked"in e&&n(0,i=e.checked),"disabled"in e&&n(2,c=e.disabled),"name"in e&&n(3,u=e.name),"id"in e&&n(4,f=e.id),"value"in e&&n(1,p=e.value),"$$scope"in e&&n(8,g=e.$$scope)},e.$$.update=function(){32&e.$$.dirty&&r&&!r.syncValue&&(n(5,r.syncValue=function(){var e;n(0,(e=[this.checked,this.value],i=e[0],p=e[1],e),i,(n(1,p),n(5,r)))},r),r.syncValue()),1&e.$$.dirty&&n(7,y=i?"check-square":"square")},[i,p,c,u,f,r,h,y,g,v,function(){i=this.checked,n(0,i),n(5,r)},function(e){_e[e?"unshift":"push"]((function(){n(5,r=e)}))},function(){n(6,h=!1)},function(){n(6,h=!0)},function(){c||n(0,i=!i)}]}var Sa=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if($a()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Ca,ka,D,{checked:0,disabled:2,name:3,id:4,value:1}),r}return s}(Ye);function xa(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Ea(e){var t,n,r,o=dn("Loading...")+"";return{c:function(){t=K("div"),n=K("div"),r=V(o),X(n,"class","progress__bar"),re(n,"width",e[2]+"%"),X(t,"class","progress")},m:function(e,o){q(e,t,o),H(t,n),H(n,r)},p:function(e,t){4&t&&re(n,"width",e[2]+"%")},d:function(e){e&&G(t)}}}function Ra(e){var t,n,r=dn(e[3].error())+"";return{c:function(){t=K("div"),n=V(r),X(t,"class","error")},m:function(e,r){q(e,t,r),H(t,n)},p:function(e,t){8&t&&r!==(r=dn(e[3].error())+"")&&te(n,r)},d:function(e){e&&G(t)}}}function Ta(e){var t,n,r;function o(e,r){return(null==t||8&r)&&(t=!!e[3].is("error")),t?Ra:((null==n||9&r)&&(n=!(!1===e[0]||!e[3].is("loading"))),n?Ea:void 0)}var i=o(e,-1),a=i&&i(e);return{c:function(){a&&a.c(),r=Y()},m:function(e,t){a&&a.m(e,t),q(e,r,t)},p:function(e,t){var n=p(t,1)[0];i===(i=o(e,n))&&a?a.p(e,n):(a&&a.d(1),(a=i&&i(e))&&(a.c(),a.m(r.parentNode,r)))},i:x,o:x,d:function(e){a&&a.d(e),e&&G(r)}}}function Oa(e,t,n){var r,o=x,i=function(){return o(),o=M(u,(function(e){return n(3,r=e)})),u};e.$$.on_destroy.push((function(){return o()}));var a=t.progress,c=void 0!==a&&a,s=t.op,u=void 0===s?new Ot({}):s;i();var d,f=0;return ve((function(){return d&&clearTimeout(d)})),e.$set=function(e){"progress"in e&&n(0,c=e.progress),"op"in e&&i(n(1,u=e.op))},e.$$.update=function(){9&e.$$.dirty&&function(e,t){if(d&&clearTimeout(d),e.is("loading")){if("number"==typeof t)return n(2,f=t);n(2,f=0),d=setInterval((function(){return n(2,++f)}),500)}}(r,c)},[c,u,f,r]}var Pa=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(xa()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Oa,Ta,D,{progress:0,op:1}),r}return s}(Ye);function Da(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Ma=function(e){return{}},Na=function(e){return{}};function ja(e){var t,n,r,o,i,a,c=e[8].label,s=j(c,e,e[7],Na),u=s||function(e){var t;return{c:function(){t=V("Label")},m:function(e,n){q(e,t,n)},d:function(e){e&&G(t)}}}();return{c:function(){t=K("div"),n=K("label"),u&&u.c(),r=J(),o=K("textarea"),X(n,"for",e[3]),X(o,"name",e[2]),X(o,"placeholder",e[4]),X(o,"id",e[3]),o.readOnly=e[5],X(t,"class","text-area"),t.hidden=e[1]},m:function(c,s,d){q(c,t,s),H(t,n),u&&u.m(n,null),H(t,r),H(t,o),e[9](o),ne(o,e[0]),i=!0,d&&a(),a=Q(o,"input",e[10])},p:function(e,r){var a=p(r,1)[0];s&&s.p&&128&a&&s.p(A(c,e,e[7],Na),L(c,e[7],a,Ma)),(!i||8&a)&&X(n,"for",e[3]),(!i||4&a)&&X(o,"name",e[2]),(!i||16&a)&&X(o,"placeholder",e[4]),(!i||8&a)&&X(o,"id",e[3]),(!i||32&a)&&(o.readOnly=e[5]),1&a&&ne(o,e[0]),(!i||2&a)&&(t.hidden=e[1])},i:function(e){i||(Ie(u,e),i=!0)},o:function(e){Ue(u,e),i=!1},d:function(n){n&&G(t),u&&u.d(n),e[9](null),a()}}}function Aa(e,t,n){var r,o=t.hidden,i=void 0!==o&&o,a=t.name,c=void 0===a?"":a,s=t.id,u=void 0===s?c?"form_"+c:yt():s,d=t.placeholder,f=void 0===d?"":d,l=t.readonly,p=void 0!==l&&l,h=t.value,m=void 0===h?"":h,v=t.$$slots,g=void 0===v?{}:v,y=t.$$scope;return e.$set=function(e){"hidden"in e&&n(1,i=e.hidden),"name"in e&&n(2,c=e.name),"id"in e&&n(3,u=e.id),"placeholder"in e&&n(4,f=e.placeholder),"readonly"in e&&n(5,p=e.readonly),"value"in e&&n(0,m=e.value),"$$scope"in e&&n(7,y=e.$$scope)},e.$$.update=function(){64&e.$$.dirty&&r&&!r.syncValue&&(n(6,r.syncValue=function(){n(0,m=this.value)},r),r.syncValue())},[m,i,c,u,f,p,r,y,g,function(e){_e[e?"unshift":"push"]((function(){n(6,r=e)}))},function(){m=this.value,n(0,m),n(6,r)}]}var La=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Da()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Aa,ja,D,{hidden:1,name:2,id:3,placeholder:4,readonly:5,value:0}),r}return s}(Ye);function Ia(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Ua=function(e){return{}},za=function(e){return{}},Ba=function(e){return{}},Fa=function(e){return{}};function Ha(e){var t,n,r,o,i,a,c,s,u=e[11].label,d=j(u,e,e[10],Fa),f=d||{c:function(){s=V("Label")},m:function(e,t){q(e,s,t)},d:function(e){e&&G(s)}},l=e[11].help,h=j(l,e,e[10],za);return{c:function(){t=K("div"),n=K("label"),f&&f.c(),r=J(),o=K("input"),i=J(),h&&h.c(),X(n,"for",e[4]),X(o,"type",e[7]),X(o,"name",e[3]),X(o,"id",e[4]),X(o,"autocomplete",e[1]),X(o,"placeholder",e[5]),o.readOnly=e[6],o.value=e[0],X(t,"class","text-field"),t.hidden=e[2],oe(t,"has-password","password"==e[7])},m:function(s,u,d){q(s,t,u),H(t,n),f&&f.m(n,null),H(t,r),H(t,o),e[13](o),H(t,i),h&&h.m(t,null),a=!0,d&&O(c),c=[Q(o,"input",e[9]),Q(o,"keyup",e[12])]},p:function(e,r){var i=p(r,1)[0];d&&d.p&&1024&i&&d.p(A(u,e,e[10],Fa),L(u,e[10],i,Ba)),(!a||16&i)&&X(n,"for",e[4]),(!a||128&i)&&X(o,"type",e[7]),(!a||8&i)&&X(o,"name",e[3]),(!a||16&i)&&X(o,"id",e[4]),(!a||2&i)&&X(o,"autocomplete",e[1]),(!a||32&i)&&X(o,"placeholder",e[5]),(!a||64&i)&&(o.readOnly=e[6]),(!a||1&i&&o.value!==e[0])&&(o.value=e[0]),h&&h.p&&1024&i&&h.p(A(l,e,e[10],za),L(l,e[10],i,Ua)),(!a||4&i)&&(t.hidden=e[2]),128&i&&oe(t,"has-password","password"==e[7])},i:function(e){a||(Ie(f,e),Ie(h,e),a=!0)},o:function(e){Ue(f,e),Ue(h,e),a=!1},d:function(n){n&&G(t),f&&f.d(n),e[13](null),h&&h.d(n),O(c)}}}function qa(e,t,n){var r,o=t.autocomplete,i=void 0===o?null:o,a=t.hidden,c=void 0!==a&&a,s=t.name,u=void 0===s?"":s,d=t.id,f=void 0===d?u?"form_"+u:yt():d,l=t.placeholder,p=void 0===l?"":l,h=t.readonly,m=void 0!==h&&h,v=t.type,g=void 0===v?"text":v,y=t.value,b=void 0===y?"":y,$=t.$$slots,_=void 0===$?{}:$,w=t.$$scope;return e.$set=function(e){"autocomplete"in e&&n(1,i=e.autocomplete),"hidden"in e&&n(2,c=e.hidden),"name"in e&&n(3,u=e.name),"id"in e&&n(4,f=e.id),"placeholder"in e&&n(5,p=e.placeholder),"readonly"in e&&n(6,m=e.readonly),"type"in e&&n(7,g=e.type),"value"in e&&n(0,b=e.value),"$$scope"in e&&n(10,w=e.$$scope)},e.$$.update=function(){256&e.$$.dirty&&r&&!r.syncValue&&(n(8,r.syncValue=function(){n(0,b=this.value)},r),r.syncValue())},[b,i,c,u,f,p,m,g,r,function(e){n(0,b=g.match(/^(number|range)$/)?parseInt(e.target.value,10):e.target.value)},w,_,function(t){be(e,t)},function(e){_e[e?"unshift":"push"]((function(){n(8,r=e)}))}]}var Ga=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Ia()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,qa,Ha,D,{autocomplete:1,hidden:2,name:3,id:4,placeholder:5,readonly:6,type:7,value:0}),r}return s}(Ye);function Wa(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Ka(e){var t,n;return{c:function(){X(t=K("input"),"type","hidden"),X(t,"name","connection_id"),t.value=n=e[0].connection_id},m:function(e,n){q(e,t,n)},p:function(e,r){1&r&&n!==(n=e[0].connection_id)&&(t.value=n)},d:function(e){e&&G(t)}}}function Va(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Host and port")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ja(e){var t,n=fn(e[6].forced_connection?"You cannot create custom connections.":"Example: %1","chat.freenode.net:6697")+"";return{c:function(){X(t=K("p"),"class","help"),X(t,"slot","help")},m:function(e,r){q(e,t,r),t.innerHTML=n},p:x,d:function(e){e&&G(t)}}}function Ya(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Qa(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Nickname")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Za(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Your name")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Xa(e){var t;return{c:function(){(t=K("p")).textContent="Visible in WHOIS response",X(t,"class","help"),X(t,"slot","help")},m:function(e,n){q(e,t,n)},d:function(e){e&&G(t)}}}function ec(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function tc(e){var t,n=new Ga({props:{name:"conversation_id",placeholder:dn("Ex: #convos"),$$slots:{label:[rc]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};2097152&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function nc(e){var t,n;function r(t){e[16].call(null,t)}var o={$$slots:{label:[oc]},$$scope:{ctx:e}};void 0!==e[5]&&(o.checked=e[5]);var i=new Sa({props:o});return _e.push((function(){return qe(i,"checked",r)})),{c:function(){Ge(i.$$.fragment)},m:function(e,t){We(i,e,t),n=!0},p:function(e,n){var r={};2097152&n&&(r.$$scope={dirty:n,ctx:e}),!t&&32&n&&(t=!0,r.checked=e[5],Ee((function(){return t=!1}))),i.$set(r)},i:function(e){n||(Ie(i.$$.fragment,e),n=!0)},o:function(e){Ue(i.$$.fragment,e),n=!1},d:function(e){Ke(i,e)}}}function rc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Conversation name")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function oc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Want to be connected")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ic(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Secure connection (TLS)")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ac(e){var t,n;function r(t){e[18].call(null,t)}var o={name:"tls_verify",$$slots:{label:[cc]},$$scope:{ctx:e}};void 0!==e[4]&&(o.checked=e[4]);var i=new Sa({props:o});return _e.push((function(){return qe(i,"checked",r)})),{c:function(){Ge(i.$$.fragment)},m:function(e,t){We(i,e,t),n=!0},p:function(e,n){var r={};2097152&n&&(r.$$scope={dirty:n,ctx:e}),!t&&16&n&&(t=!0,r.checked=e[4],Ee((function(){return t=!1}))),i.$set(r)},i:function(e){n||(Ie(i.$$.fragment,e),n=!0)},o:function(e){Ue(i.$$.fragment,e),n=!1},d:function(e){Ke(i,e)}}}function cc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Verify certificate (TLS)")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function sc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Show advanced settings")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function uc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Username")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function dc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Password")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function fc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("On-connect commands")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function lc(e){var t,n=new xo({props:{icon:"save",op:e[7],$$slots:{default:[hc]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};2097152&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function pc(e){var t,n,r=new xo({props:{icon:"save",op:e[9],$$slots:{default:[mc]},$$scope:{ctx:e}}}),o=new xo({props:{icon:"trash",type:"button",op:e[8],$$slots:{default:[vc]},$$scope:{ctx:e}}});return o.$on("click",e[10]),{c:function(){Ge(r.$$.fragment),t=J(),Ge(o.$$.fragment)},m:function(e,i){We(r,e,i),q(e,t,i),We(o,e,i),n=!0},p:function(e,t){var n={};2097152&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n);var i={};2097152&t&&(i.$$scope={dirty:t,ctx:e}),o.$set(i)},i:function(e){n||(Ie(r.$$.fragment,e),Ie(o.$$.fragment,e),n=!0)},o:function(e){Ue(r.$$.fragment,e),Ue(o.$$.fragment,e),n=!1},d:function(e){Ke(r,e),e&&G(t),Ke(o,e)}}}function hc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Create"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function mc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Update"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function vc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Delete"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function gc(e){var t,n,r,o,i,a,c,s,u,d,f,l,h,m,v,g,y,b,$,_,w,k,C,S,x,E,R,T,O=e[0].connection_id&&Ka(e),P=new Ga({props:{name:"server",placeholder:dn("Ex: chat.freenode.net:6697"),readonly:e[6].forced_connection,$$slots:{default:[Ya],help:[Ja],label:[Va]},$$scope:{ctx:e}}}),D=new Ga({props:{name:"nick",placeholder:dn("Ex: superman"),$$slots:{label:[Qa]},$$scope:{ctx:e}}}),M=new Ga({props:{name:"realname",placeholder:dn("Ex: Clark Kent"),$$slots:{default:[ec],help:[Xa],label:[Za]},$$scope:{ctx:e}}}),N=[nc,tc],j=[];function A(e,t){return e[0].url?0:1}function L(t){e[17].call(null,t)}d=A(e),f=j[d]=N[d](e);var I={name:"tls",$$slots:{label:[ic]},$$scope:{ctx:e}};void 0!==e[3]&&(I.checked=e[3]);var U=new Sa({props:I});_e.push((function(){return qe(U,"checked",L)}));var z=e[3]&&ac(e);function B(t){e[19].call(null,t)}var F={$$slots:{label:[sc]},$$scope:{ctx:e}};void 0!==e[2]&&(F.checked=e[2]);var W=new Sa({props:F});_e.push((function(){return qe(W,"checked",B)}));var V=new Ga({props:{name:"username",hidden:!e[2],$$slots:{label:[uc]},$$scope:{ctx:e}}}),Y=new Ga({props:{type:"password",name:"password",hidden:!e[2],$$slots:{label:[dc]},$$scope:{ctx:e}}}),ee=new La({props:{name:"on_connect_commands",placeholder:dn("Put each command on a new line."),hidden:!e[2],$$slots:{label:[fc]},$$scope:{ctx:e}}}),te=[pc,lc],ne=[];function re(e,t){return e[0].url?0:1}k=re(e),C=ne[k]=te[k](e);var oe=new Pa({props:{op:e[7]}}),ie=new Pa({props:{op:e[8]}}),ae=new Pa({props:{op:e[9]}});return{c:function(){t=K("form"),O&&O.c(),n=J(),r=K("input"),o=J(),i=K("input"),a=J(),Ge(P.$$.fragment),c=J(),Ge(D.$$.fragment),s=J(),Ge(M.$$.fragment),u=J(),f.c(),l=J(),Ge(U.$$.fragment),m=J(),z&&z.c(),v=J(),Ge(W.$$.fragment),y=J(),Ge(V.$$.fragment),b=J(),Ge(Y.$$.fragment),$=J(),Ge(ee.$$.fragment),_=J(),w=K("div"),C.c(),S=J(),Ge(oe.$$.fragment),x=J(),Ge(ie.$$.fragment),E=J(),Ge(ae.$$.fragment),X(r,"type","hidden"),X(r,"name","url"),X(i,"type","hidden"),X(i,"name","wanted_state"),X(w,"class","form-actions"),X(t,"method","post")},m:function(f,p,h){q(f,t,p),O&&O.m(t,null),H(t,n),H(t,r),H(t,o),H(t,i),H(t,a),We(P,t,null),H(t,c),We(D,t,null),H(t,s),We(M,t,null),H(t,u),j[d].m(t,null),H(t,l),We(U,t,null),H(t,m),z&&z.m(t,null),H(t,v),We(W,t,null),H(t,y),We(V,t,null),H(t,b),We(Y,t,null),H(t,$),We(ee,t,null),H(t,_),H(t,w),ne[k].m(w,null),H(t,S),We(oe,t,null),H(t,x),We(ie,t,null),H(t,E),We(ae,t,null),e[20](t),R=!0,h&&T(),T=Q(t,"submit",Z(e[11]))},p:function(e,r){var o=p(r,1)[0];e[0].connection_id?O?O.p(e,o):((O=Ka(e)).c(),O.m(t,n)):O&&(O.d(1),O=null);var i={};2097152&o&&(i.$$scope={dirty:o,ctx:e}),P.$set(i);var a={};2097152&o&&(a.$$scope={dirty:o,ctx:e}),D.$set(a);var c={};2097152&o&&(c.$$scope={dirty:o,ctx:e}),M.$set(c);var s=d;(d=A(e))===s?j[d].p(e,o):(Ae(),Ue(j[s],1,1,(function(){j[s]=null})),Le(),(f=j[d])||(f=j[d]=N[d](e)).c(),Ie(f,1),f.m(t,l));var u={};2097152&o&&(u.$$scope={dirty:o,ctx:e}),!h&&8&o&&(h=!0,u.checked=e[3],Ee((function(){return h=!1}))),U.$set(u),e[3]?z?(z.p(e,o),Ie(z,1)):((z=ac(e)).c(),Ie(z,1),z.m(t,v)):z&&(Ae(),Ue(z,1,1,(function(){z=null})),Le());var m={};2097152&o&&(m.$$scope={dirty:o,ctx:e}),!g&&4&o&&(g=!0,m.checked=e[2],Ee((function(){return g=!1}))),W.$set(m);var y={};4&o&&(y.hidden=!e[2]),2097152&o&&(y.$$scope={dirty:o,ctx:e}),V.$set(y);var b={};4&o&&(b.hidden=!e[2]),2097152&o&&(b.$$scope={dirty:o,ctx:e}),Y.$set(b);var $={};4&o&&($.hidden=!e[2]),2097152&o&&($.$$scope={dirty:o,ctx:e}),ee.$set($);var _=k;(k=re(e))===_?ne[k].p(e,o):(Ae(),Ue(ne[_],1,1,(function(){ne[_]=null})),Le(),(C=ne[k])||(C=ne[k]=te[k](e)).c(),Ie(C,1),C.m(w,null))},i:function(e){R||(Ie(P.$$.fragment,e),Ie(D.$$.fragment,e),Ie(M.$$.fragment,e),Ie(f),Ie(U.$$.fragment,e),Ie(z),Ie(W.$$.fragment,e),Ie(V.$$.fragment,e),Ie(Y.$$.fragment,e),Ie(ee.$$.fragment,e),Ie(C),Ie(oe.$$.fragment,e),Ie(ie.$$.fragment,e),Ie(ae.$$.fragment,e),R=!0)},o:function(e){Ue(P.$$.fragment,e),Ue(D.$$.fragment,e),Ue(M.$$.fragment,e),Ue(f),Ue(U.$$.fragment,e),Ue(z),Ue(W.$$.fragment,e),Ue(V.$$.fragment,e),Ue(Y.$$.fragment,e),Ue(ee.$$.fragment,e),Ue(C),Ue(oe.$$.fragment,e),Ue(ie.$$.fragment,e),Ue(ae.$$.fragment,e),R=!1},d:function(n){n&&G(t),O&&O.d(),Ke(P),Ke(D),Ke(M),j[d].d(),Ke(U),z&&z.d(),Ke(W),Ke(V),Ke(Y),Ke(ee),ne[k].d(),Ke(oe),Ke(ie),Ke(ae),e[20](null),T()}}}function yc(e,t,n){var r=t.conversation,o=void 0===r?{}:r,i=ye("api"),a=ye("user"),c=i("createConnection"),s=i("removeConnection"),u=i("updateConnection");[c,u].forEach((function(e){e.on("start",(function(e){e.body.on_connect_commands=e.body.on_connect_commands.split("\n").map((function(e){return e.trim()}))}))}));var d,f={},l=!1,p=!1,h=!1,m=!1;function v(){if(a.forced_connection&&n(1,d.server.value=a.default_connection,d),n(1,d.nick.value=a.email.replace(/@.*/,"").replace(/\W/g,"_"),d),n(3,p=!0),n(5,m=!0),!Kt.query.uri)return Kt.urlToForm(d);var e=new tt(Kt.query.uri),t=e.searchParams;e.host&&n(1,d.server.value=e.host,d),e.password&&n(1,d.password.value=e.password,d),e.username&&n(1,d.username.value=e.username,d),t.get("nick")&&n(1,d.nick.value=t.get("nick"),d),t.get("realname")&&n(1,d.realname.value=t.get("realname"),d),e.pathname&&d.conversation&&n(1,d.conversation.value=decodeURIComponent(e.pathname.split("/").filter((function(e){return e.length}))[0]||""),d),Number(t.get("tls")||0)&&n(3,p=!0),Number(t.get("tls_verify")||0)&&n(4,h=!0)}function g(){f.url&&(n(1,d.server.value=f.url.host,d),n(1,d.nick.value=f.url.searchParams.get("nick")||"",d),n(1,d.realname.value=f.url.searchParams.get("realname")||"",d),n(1,d.on_connect_commands.value=f.on_connect_commands.join("\n"),d),n(1,d.password.value=f.url.password,d),n(1,d.username.value=f.url.username,d),n(1,d.url.value=f.url.toString(),d),n(3,p="1"==f.url.searchParams.get("tls")),n(4,h="1"==f.url.searchParams.get("tls_verify")),n(5,m="connected"==f.wanted_state))}function y(){return(y=Xe(Qe.mark((function e(t){return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.perform(f);case 2:a.removeConversation(f),Kt.go("/settings/connection");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=Xe(Qe.mark((function e(t){var r;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.server.value){e.next=2;break}return e.abrupt("return");case 2:if(n(1,d.url.value=new tt("irc://localhost:6667").fromForm(t.target).toString(),d),!f.connection_id){e.next=10;break}return e.next=6,u.perform(t.target);case 6:n(0,f=a.ensureConversation(u.res.body)),g(),e.next=14;break;case 10:return e.next=12,c.perform(t.target);case 12:r=a.ensureConversation(c.res.body),Kt.go(r.path);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return me(Xe(Qe.mark((function e(){return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}return e.abrupt("return");case 2:return n(0,f=a.findConversation({connection_id:o.connection_id})||{}),e.abrupt("return",f.url?g():v());case 4:case"end":return e.stop()}}),e)})))),e.$set=function(e){"conversation"in e&&n(12,o=e.conversation)},e.$$.update=function(){34&e.$$.dirty&&d&&n(1,d.wanted_state.value=m?"connected":"disconnected",d)},[f,d,l,p,h,m,a,c,s,u,function(e){return y.apply(this,arguments)},function(e){return b.apply(this,arguments)},o,i,v,g,function(e){n(5,m=e)},function(e){n(3,p=e)},function(e){n(4,h=e)},function(e){n(2,l=e)},function(e){_e[e?"unshift":"push"]((function(){n(1,d=e)}))}]}var bc=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Wa()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,yc,gc,D,{conversation:12}),r}return s}(Ye);function $c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _c(e){var t;return{c:function(){(t=K("h1")).textContent="".concat(dn("Add connection"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function wc(e){var t,n,r,o=new jo({props:{$$slots:{default:[_c]},$$scope:{ctx:e}}}),i=new bc({});return{c:function(){Ge(o.$$.fragment),t=J(),n=K("main"),Ge(i.$$.fragment),X(n,"class","main")},m:function(e,a){We(o,e,a),q(e,t,a),q(e,n,a),We(i,n,null),r=!0},p:function(e,t){var n=p(t,1)[0],r={};1&n&&(r.$$scope={dirty:n,ctx:e}),o.$set(r)},i:function(e){r||(Ie(o.$$.fragment,e),Ie(i.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),Ue(i.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n),Ke(i)}}}function kc(e){return Kt.update({title:dn("Add connection")}),[]}var Cc=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if($c()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,kc,wc,D,{}),r}return s}(Ye);function Sc(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function xc(e,t,n){var r=e.slice();return r[28]=t[n],r[30]=n,r}var Ec=function(e){return{}},Rc=function(e){return{}};function Tc(e){var t,n,r,o,i=(e[28].length>1?e[28][1]:e[28][0])+"";function a(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e)[26].apply(t,[e[30]].concat(r))}return{c:function(){t=K("a"),n=V(i),X(t,"href",r="#"+e[30]+":"+e[28][0]),X(t,"class","select-field__option"),X(t,"tabindex","-1"),oe(t,"is-active",e[30]==e[6])},m:function(e,r,i){q(e,t,r),H(t,n),i&&o(),o=Q(t,"mouseover",a)},p:function(o,a){e=o,2048&a&&i!==(i=(e[28].length>1?e[28][1]:e[28][0])+"")&&te(n,i),2048&a&&r!==(r="#"+e[30]+":"+e[28][0])&&X(t,"href",r),64&a&&oe(t,"is-active",e[30]==e[6])},d:function(e){e&&G(t),o()}}}function Oc(e){for(var t,n,r,o,i,a,c,s,u,d,f,l=e[22].label,h=j(l,e,e[21],Rc),m=h||{c:function(){f=V("Label")},m:function(e,t){q(e,f,t)},d:function(e){e&&G(f)}},v=e[11],g=[],y=0;y<v.length;y+=1)g[y]=Tc(xc(e,v,y));return{c:function(){t=K("div"),n=K("label"),m&&m.c(),r=J(),o=K("input"),i=J(),a=K("input"),c=J(),s=K("div");for(var u=0;u<g.length;u+=1)g[u].c();X(n,"for",e[3]),X(o,"type","hidden"),X(o,"name",e[2]),X(a,"type","text"),X(a,"placeholder",e[4]),X(a,"id",e[3]),a.readOnly=e[5],X(a,"autocomplete","off"),X(s,"class","select-field__options"),X(t,"class","select-field text-field"),t.hidden=e[1],oe(t,"is-open",e[9]),oe(t,"is-readonly",e[5])},m:function(f,l,p){q(f,t,l),H(t,n),m&&m.m(n,null),H(t,r),H(t,o),e[23](o),ne(o,e[0]),H(t,i),H(t,a),e[25](a),H(t,c),H(t,s);for(var h=0;h<g.length;h+=1)g[h].m(s,null);e[27](t),u=!0,p&&O(d),d=[Q(o,"input",e[24]),Q(o,"keydown",e[12]),Q(a,"keydown",e[12]),Q(a,"keyup",e[13]),Q(a,"click",Z(e[14])),Q(s,"click",Z(e[14]))]},p:function(e,r){var i=p(r,1)[0];if(h&&h.p&&2097152&i&&h.p(A(l,e,e[21],Rc),L(l,e[21],i,Ec)),(!u||8&i)&&X(n,"for",e[3]),(!u||4&i)&&X(o,"name",e[2]),1&i&&ne(o,e[0]),(!u||16&i)&&X(a,"placeholder",e[4]),(!u||8&i)&&X(a,"id",e[3]),(!u||32&i)&&(a.readOnly=e[5]),2112&i){var c;for(v=e[11],c=0;c<v.length;c+=1){var d=xc(e,v,c);g[c]?g[c].p(d,i):(g[c]=Tc(d),g[c].c(),g[c].m(s,null))}for(;c<g.length;c+=1)g[c].d(1);g.length=v.length}(!u||2&i)&&(t.hidden=e[1]),512&i&&oe(t,"is-open",e[9]),32&i&&oe(t,"is-readonly",e[5])},i:function(e){u||(Ie(m,e),u=!0)},o:function(e){Ue(m,e),u=!1},d:function(n){n&&G(t),m&&m.d(n),e[23](null),e[25](null),W(g,n),e[27](null),O(d)}}}function Pc(e,t,n){var r,o,i,a=["ArrowDown","ArrowUp","Enter"],c=0,s=!1,u="",d=[],f=t.hidden,l=void 0!==f&&f,p=t.name,h=void 0===p?"":p,m=t.id,v=void 0===m?h?"form_"+h:yt():m,g=t.options,y=void 0===g?[]:g,b=t.placeholder,$=void 0===b?"":b,_=t.readonly,w=void 0!==_&&_,k=t.value,C=void 0===k?"":k;function S(e,t){var r=new RegExp("(?:^|\\s|-)"+ht(t),"i"),o=e.filter((function(e){return e[0]==t}));o.length||(o=e.filter((function(e){return e[0].match(r)})));for(var i=0;i<e.length;i++){var a=e[i];a.length>1&&-1!=o.indexOf(a)&&a[1].match(r)&&-1==e.map((function(e){return e[0]})).indexOf(a[0])&&o.push(a)}n(6,c=0),n(11,d=o)}function x(e){var t;if("keydown"==e.type)t=d.length&&d[c]||y.filter((function(e){return e[0]==C}))[0];else{var r=at(e.target,".select-field__option").href.replace(/^.*?#\d+:/,"");t=d.filter((function(e){return e[0]==r}))[0]||[]}t&&t.length||(t=[""]),n(0,C=t[0]),n(9,s=!1)}function E(e){var t=d.filter((function(t){return t[0]==e}))[0]||[];n(8,o.value=t.length>1?t[1]:t.length?t[0]:e,o)}function R(e){if(!w){var t=e&&e.target&&at(e.target,".select-field__option");return s||(n(6,c=d.map((function(e){return e[0]})).indexOf(C)),o.setSelectionRange(0,9999)),t?x(e):n(9,s=!s)}}me((function(){n(0,C=r.value),o.addEventListener("blur",(function(){setTimeout((function(){return document.activeElement.closest(".select-field__option")||n(9,s=!1)}),100),E(C)}))}));var T=t.$$slots,O=void 0===T?{}:T,P=t.$$scope;return e.$set=function(e){"hidden"in e&&n(1,l=e.hidden),"name"in e&&n(2,h=e.name),"id"in e&&n(3,v=e.id),"options"in e&&n(15,y=e.options),"placeholder"in e&&n(4,$=e.placeholder),"readonly"in e&&n(5,w=e.readonly),"value"in e&&n(0,C=e.value),"$$scope"in e&&n(21,P=e.$$scope)},e.$$.update=function(){if(512&e.$$.dirty&&0==s&&n(16,u=""),98304&e.$$.dirty&&S(y,u),128&e.$$.dirty&&r&&!r.syncValue&&(n(7,r.syncValue=function(){n(0,C=this.value)},r),r.syncValue()),33152&e.$$.dirty&&o&&!o.value&&o!=document.activeElement){var t=y.find((function(e){return e[0]==r.value}));t&&n(8,o.value=t[1]||t[0],o)}257&e.$$.dirty&&o&&E(C)},[C,l,h,v,$,w,c,r,o,s,i,d,function(e){if(-1!=a.indexOf(e.key)&&e.preventDefault(),"Tab"!=e.key){if(!s)return R(e);"ArrowDown"==e.key&&n(6,c++,c),"ArrowUp"==e.key&&n(6,c--,c),"Enter"==e.key&&x(e),c>=y.length&&n(6,c=0),c<0&&n(6,c=y.length-1)}else s&&x(e)},function(e){1!=e.key.length&&"Backspace"!=e.key||n(16,u=o.value)},R,y,u,a,S,x,E,P,O,function(e){_e[e?"unshift":"push"]((function(){n(7,r=e)}))},function(){C=this.value,n(0,C),n(7,r)},function(e){_e[e?"unshift":"push"]((function(){n(8,o=e)}))},function(e){n(6,c=e)},function(e){_e[e?"unshift":"push"]((function(){n(10,i=e)}))}]}var Dc=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Sc()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Pc,Oc,D,{hidden:1,name:2,id:3,options:15,placeholder:4,readonly:5,value:0}),r}return s}(Ye);function Mc(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Nc(e,t,n){var r=e.slice();return r[15]=t[n],r}function jc(e){var t;return{c:function(){(t=K("h1")).textContent="".concat(dn("Add conversation"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ac(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Connection")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Lc(e){var t,n,r=dn(e[0].conversations.length?"Refresh":"Load")+"";return{c:function(){t=K("span"),n=V(r)},m:function(e,r){q(e,t,r),H(t,n)},p:function(e,t){1&t&&r!==(r=dn(e[0].conversations.length?"Refresh":"Load")+"")&&te(n,r)},d:function(e){e&&G(t)}}}function Ic(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Conversation name")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Uc(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Add"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function zc(e){var t,n,r,o,i=e[0].error+"";return{c:function(){t=K("p"),n=V(e[1]),r=V(": "),o=V(i),X(t,"class","error")},m:function(e,i){q(e,t,i),H(t,n),H(t,r),H(t,o)},p:function(e,t){2&t&&te(n,e[1]),1&t&&i!==(i=e[0].error+"")&&te(o,i)},d:function(e){e&&G(t)}}}function Bc(e){var t,n,r;function o(e,t){return e[0].done?Hc:Fc}for(var i=o(e),a=i(e),c=e[0].conversations,s=[],u=0;u<c.length;u+=1)s[u]=qc(Nc(e,c,u));return{c:function(){t=K("p"),a.c(),n=J(),r=K("div");for(var e=0;e<s.length;e+=1)s[e].c();X(r,"class","conversation-add-list")},m:function(e,o){q(e,t,o),a.m(t,null),q(e,n,o),q(e,r,o);for(var i=0;i<s.length;i+=1)s[i].m(r,null)},p:function(e,n){if(i===(i=o(e))&&a?a.p(e,n):(a.d(1),(a=i(e))&&(a.c(),a.m(t,null))),65&n){var u;for(c=e[0].conversations,u=0;u<c.length;u+=1){var d=Nc(e,c,u);s[u]?s[u].p(d,n):(s[u]=qc(d),s[u].c(),s[u].m(r,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=c.length}},d:function(e){e&&G(t),a.d(),e&&G(n),e&&G(r),W(s,e)}}}function Fc(e){var t,n=dn("Showing %1 of %2 conversations, but the list is still loading.",e[0].conversations.length,e[0].n_conversations)+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:function(e,r){1&r&&n!==(n=dn("Showing %1 of %2 conversations, but the list is still loading.",e[0].conversations.length,e[0].n_conversations)+"")&&te(t,n)},d:function(e){e&&G(t)}}}function Hc(e){var t,n=dn("Showing %1 of %2 conversations.",e[0].conversations.length,e[0].n_conversations)+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:function(e,r){1&r&&n!==(n=dn("Showing %1 of %2 conversations.",e[0].conversations.length,e[0].n_conversations)+"")&&te(t,n)},d:function(e){e&&G(t)}}}function qc(e){var t,n,r,o,i,a,c,s,u,d,f,l,p=e[15].n_users+"",h=e[15].name+"",m=(e[15].topic||"No topic.")+"";return{c:function(){t=K("a"),n=K("span"),r=V(p),o=J(),i=K("b"),a=V(h),c=J(),s=K("i"),u=V(m),d=J(),X(n,"class","conversation-add-list__n-users"),X(i,"class","conversation-add-list__name"),X(s,"class","conversation-add-list__title"),X(t,"href",f="#add:"+e[15].name)},m:function(f,p,h){q(f,t,p),H(t,n),H(n,r),H(t,o),H(t,i),H(i,a),H(t,c),H(t,s),H(s,u),H(t,d),h&&l(),l=Q(t,"click",Z(e[6]))},p:function(e,n){1&n&&p!==(p=e[15].n_users+"")&&te(r,p),1&n&&h!==(h=e[15].name+"")&&te(a,h),1&n&&m!==(m=(e[15].topic||"No topic.")+"")&&te(u,m),1&n&&f!==(f="#add:"+e[15].name)&&X(t,"href",f)},d:function(e){e&&G(t),l()}}}function Gc(e){var t,n,r,o,i,a,c,s,u,d,f,l,h,m,v,g,y,b,$=new jo({props:{$$slots:{default:[jc]},$$scope:{ctx:e}}});function _(t){e[12].call(null,t)}var w={name:"connection_id",options:e[4],placeholder:dn("Select..."),$$slots:{label:[Ac]},$$scope:{ctx:e}};void 0!==e[1]&&(w.value=e[1]);var k=new Dc({props:w});_e.push((function(){return qe(k,"value",_)}));var C=new xo({props:{type:"button",icon:"sync-alt",disabled:!e[1]||!1===e[0].done,$$slots:{default:[Lc]},$$scope:{ctx:e}}});function S(t){e[13].call(null,t)}C.$on("click",e[7]);var x={name:"conversation_id",placeholder:dn("#room or nick"),autocomplete:"off",$$slots:{label:[Ic]},$$scope:{ctx:e}};void 0!==e[2]&&(x.value=e[2]);var E=new Ga({props:x});_e.push((function(){return qe(E,"value",S)})),E.$on("keyup",e[8]);var R=new xo({props:{icon:"comment",disabled:!e[1]||!e[2],$$slots:{default:[Uc]},$$scope:{ctx:e}}}),T=e[0].error&&zc(e),O=null!==e[0].done&&Bc(e);return{c:function(){Ge($.$$.fragment),t=J(),n=K("main"),(r=K("p")).textContent="".concat(dn("Enter the name of an exising conversation, or create a new conversation.")," \n    ").concat(dn("It is also possible to load in all existing conversations for a given connection.")),o=J(),i=K("form"),a=K("div"),Ge(k.$$.fragment),s=J(),u=K("div"),Ge(C.$$.fragment),d=J(),f=K("div"),Ge(E.$$.fragment),h=J(),m=K("div"),Ge(R.$$.fragment),v=J(),T&&T.c(),g=J(),O&&O.c(),X(u,"class","has-remaining-space"),X(a,"class","inputs-side-by-side"),X(m,"class","has-remaining-space"),X(f,"class","inputs-side-by-side"),X(i,"method","post"),X(n,"class","main")},m:function(c,l,p){We($,c,l),q(c,t,l),q(c,n,l),H(n,r),H(n,o),H(n,i),H(i,a),We(k,a,null),H(a,s),H(a,u),We(C,u,null),H(i,d),H(i,f),We(E,f,null),H(f,h),H(f,m),We(R,m,null),H(i,v),T&&T.m(i,null),H(i,g),O&&O.m(i,null),e[14](i),y=!0,p&&b(),b=Q(i,"submit",Z(e[6]))},p:function(e,t){var n=p(t,1)[0],r={};262144&n&&(r.$$scope={dirty:n,ctx:e}),$.$set(r);var o={};16&n&&(o.options=e[4]),262144&n&&(o.$$scope={dirty:n,ctx:e}),!c&&2&n&&(c=!0,o.value=e[1],Ee((function(){return c=!1}))),k.$set(o);var a={};3&n&&(a.disabled=!e[1]||!1===e[0].done),262145&n&&(a.$$scope={dirty:n,ctx:e}),C.$set(a);var s={};262144&n&&(s.$$scope={dirty:n,ctx:e}),!l&&4&n&&(l=!0,s.value=e[2],Ee((function(){return l=!1}))),E.$set(s);var u={};6&n&&(u.disabled=!e[1]||!e[2]),262144&n&&(u.$$scope={dirty:n,ctx:e}),R.$set(u),e[0].error?T?T.p(e,n):((T=zc(e)).c(),T.m(i,g)):T&&(T.d(1),T=null),null!==e[0].done?O?O.p(e,n):((O=Bc(e)).c(),O.m(i,null)):O&&(O.d(1),O=null)},i:function(e){y||(Ie($.$$.fragment,e),Ie(k.$$.fragment,e),Ie(C.$$.fragment,e),Ie(E.$$.fragment,e),Ie(R.$$.fragment,e),y=!0)},o:function(e){Ue($.$$.fragment,e),Ue(k.$$.fragment,e),Ue(C.$$.fragment,e),Ue(E.$$.fragment,e),Ue(R.$$.fragment,e),y=!1},d:function(r){Ke($,r),r&&G(t),r&&G(n),Ke(k),Ke(C),Ke(E),Ke(R),T&&T.d(),O&&O.d(),e[14](null),b()}}}function Wc(e,t,n){var r,o=ye("socket"),i=ye("user");N(e,i,(function(e){return n(10,r=e)}));var a,c,s={conversations:[],done:null,n_conversations:0},u="",d="";function f(e){return l.apply(this,arguments)}function l(){return(l=Xe(Qe.mark((function e(t){var r,i,a,l;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/list"+(d.length?" /"+d+"/":""),"click"==t.type&&s.done&&(r+=" refresh"),c&&clearTimeout(c),e.next=5,o.send({connection_id:u,message:r,method:"send"});case 5:i=e.sent,a=st(i),n(0,s=a?{conversations:[],done:!0,n_conversations:0,error:a}:i),(l=t.interval?t.interval+500:500)>2e3&&(l=2e3),a||i.done||(c=setTimeout((function(){return f({interval:l})}),l));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Kt.update({title:dn("Add conversation")}),me((function(){return Kt.urlToForm(a)}));var p,h=ct(f,250);return e.$$.update=function(){1024&e.$$.dirty&&n(4,p=Array.from(r.connections.keys()).map((function(e){return[e]}))),18&e.$$.dirty&&(u||n(1,u=p[0]?p[0][0]:""))},[s,u,d,a,p,i,function(e){var t=e&&e.target&&e.target.closest("a");t&&t.href&&n(2,d=t.href.replace(/.*#add:/,"")),u&&d&&i.findConversation({connection_id:u}).send("/join "+d)},f,h,c,r,o,function(e){n(1,u=e),n(4,p),n(10,r)},function(e){n(2,d=e)},function(e){_e[e?"unshift":"push"]((function(){n(3,a=e)}))}]}var Kc=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Mc()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Wc,Gc,D,{}),r}return s}(Ye);function Vc(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Jc(e){var t,n,r,o,i,a,c,s,u=fn("Yikes! we are so sorry for the inconvenience. Please submit an [issue](%1), if the problem does not go away.","https://github.com/nordaaker/convos/issues")+"",d=dn("Go to start page")+"",f=new wo({props:{name:"play"}});return{c:function(){t=K("p"),n=J(),r=K("p"),o=K("a"),Ge(f.$$.fragment),i=J(),a=V(d),X(o,"href",c=e[1].baseUrl),X(o,"target","_self"),X(o,"class","btn")},m:function(e,c){q(e,t,c),t.innerHTML=u,q(e,n,c),q(e,r,c),H(r,o),We(f,o,null),H(o,i),H(o,a),s=!0},p:function(e,t){(!s||2&t&&c!==(c=e[1].baseUrl))&&X(o,"href",c)},i:function(e){s||(Ie(f.$$.fragment,e),s=!0)},o:function(e){Ue(f.$$.fragment,e),s=!1},d:function(e){e&&G(t),e&&G(n),e&&G(r),Ke(f)}}}function Yc(e){var t,n,r,o,i,a,c,s,u=dn("Go to start page")+"",d=new wo({props:{name:"play"}});return{c:function(){(t=K("p")).textContent="".concat(dn("The Convos Team have been searching and searching, but the requested page could not be found.")),n=J(),r=K("p"),o=K("a"),Ge(d.$$.fragment),i=J(),a=V(u),X(o,"href",c=e[1].baseUrl),X(o,"target","_self"),X(o,"class","btn")},m:function(e,c){q(e,t,c),q(e,n,c),q(e,r,c),H(r,o),We(d,o,null),H(o,i),H(o,a),s=!0},p:function(e,t){(!s||2&t&&c!==(c=e[1].baseUrl))&&X(o,"href",c)},i:function(e){s||(Ie(d.$$.fragment,e),s=!0)},o:function(e){Ue(d.$$.fragment,e),s=!1},d:function(e){e&&G(t),e&&G(n),e&&G(r),Ke(d)}}}function Qc(e){var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g=dn("Downloaded Convos.")+"",y=dn("Started Convos.")+"",b=dn("Contact admin")+"",$=new wo({props:{name:"download"}}),_=new wo({props:{name:"rocket"}}),w=[Xc,Zc],k=[];function C(e,t){return e[2].error?0:1}u=C(e),d=k[u]=w[u](e);var S=new wo({props:{name:"paper-plane"}});return{c:function(){t=K("p"),Ge($.$$.fragment),n=J(),r=V(g),o=J(),i=K("p"),Ge(_.$$.fragment),a=J(),c=V(y),s=J(),d.c(),f=J(),l=K("p"),p=K("a"),Ge(S.$$.fragment),h=J(),m=V(b),X(p,"class","btn"),X(p,"href",ao("contact"))},m:function(e,d){q(e,t,d),We($,t,null),H(t,n),H(t,r),q(e,o,d),q(e,i,d),We(_,i,null),H(i,a),H(i,c),q(e,s,d),k[u].m(e,d),q(e,f,d),q(e,l,d),H(l,p),We(S,p,null),H(p,h),H(p,m),v=!0},p:function(e,t){var n=u;(u=C(e))===n?k[u].p(e,t):(Ae(),Ue(k[n],1,1,(function(){k[n]=null})),Le(),(d=k[u])||(d=k[u]=w[u](e)).c(),Ie(d,1),d.m(f.parentNode,f))},i:function(e){v||(Ie($.$$.fragment,e),Ie(_.$$.fragment,e),Ie(d),Ie(S.$$.fragment,e),v=!0)},o:function(e){Ue($.$$.fragment,e),Ue(_.$$.fragment,e),Ue(d),Ue(S.$$.fragment,e),v=!1},d:function(e){e&&G(t),Ke($),e&&G(o),e&&G(i),Ke(_),e&&G(s),k[u].d(e),e&&G(f),e&&G(l),Ke(S)}}}function Zc(e){var t,n,r,o,i=dn("Loading user data...")+"",a=new wo({props:{name:"spinner fa-spin"}});return{c:function(){t=K("p"),Ge(a.$$.fragment),n=J(),r=V(i)},m:function(e,i){q(e,t,i),We(a,t,null),H(t,n),H(t,r),o=!0},p:x,i:function(e){o||(Ie(a.$$.fragment,e),o=!0)},o:function(e){Ue(a.$$.fragment,e),o=!1},d:function(e){e&&G(t),Ke(a)}}}function Xc(e){var t,n,r,o,i=dn("Loading user data failed: %1",dn(e[2].error))+"",a=new wo({props:{name:"exclamation-triangle"}});return{c:function(){t=K("p"),Ge(a.$$.fragment),n=J(),r=V(i)},m:function(e,i){q(e,t,i),We(a,t,null),H(t,n),H(t,r),o=!0},p:function(e,t){(!o||4&t)&&i!==(i=dn("Loading user data failed: %1",dn(e[2].error))+"")&&te(r,i)},i:function(e){o||(Ie(a.$$.fragment,e),o=!0)},o:function(e){Ue(a.$$.fragment,e),o=!1},d:function(e){e&&G(t),Ke(a)}}}function es(e){var t,n,r,o,i,a,c,s=dn(e[5][e[0]])+"",u=[Qc,Yc,Jc],d=[];function f(e,t){return"loading"==e[0]?0:"not_found"==e[0]?1:2}return i=f(e),a=d[i]=u[i](e),{c:function(){t=K("main"),n=K("h2"),r=V(s),o=J(),a.c()},m:function(e,a){q(e,t,a),H(t,n),H(n,r),H(t,o),d[i].m(t,null),c=!0},p:function(e,n){var o=p(n,1)[0];(!c||1&o)&&s!==(s=dn(e[5][e[0]])+"")&&te(r,s);var l=i;(i=f(e))===l?d[i].p(e,o):(Ae(),Ue(d[l],1,1,(function(){d[l]=null})),Le(),(a=d[i])||(a=d[i]=u[i](e)).c(),Ie(a,1),a.m(t,null))},i:function(e){c||(Ie(a),c=!0)},o:function(e){Ue(a),c=!1},d:function(e){e&&G(t),d[i].d()}}}function ts(e,t,n){var r,o,i;N(e,Kt,(function(e){return n(1,r=e)}));var a=ye("socket");N(e,a,(function(e){return n(2,i=e)}));var c=ye("user");N(e,c,(function(e){return n(6,o=e)}));var s,u={loading:"Loading",not_found:"Not Found"};return e.$$.update=function(){66&e.$$.dirty&&n(0,s=function(e,t){var n=e.path.match(/\/err\/(\w+)/);return n?n[1]:!e.component||t.is("loading")?"loading":"not_found"}(r,o)),1&e.$$.dirty&&Kt.update({title:dn(u[s])})},[s,r,i,a,c,u]}var ns=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Vc()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,ts,es,D,{}),r}return s}(Ye);function rs(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function os(e,t,n){var r=e.slice();return r[2]=t[n],r}function is(e){var t,n,r,o,i,a,c,s=dn("Help")+"",u=ao("version")+"";return{c:function(){t=K("h1"),n=V(s),r=J(),o=K("small"),i=K("a"),a=V("v"),c=V(u),X(i,"href",e[0]),X(i,"target","_blank")},m:function(e,s){q(e,t,s),H(t,n),H(t,r),H(t,o),H(o,i),H(i,a),H(i,c)},p:x,d:function(e){e&&G(t)}}}function as(e){var t,n,r,o,i=e[2].example+"",a=dn(e[2].description)+"";return{c:function(){t=K("dt"),n=V(i),r=K("dd"),o=V(a)},m:function(e,i){q(e,t,i),H(t,n),q(e,r,i),H(r,o)},p:x,d:function(e){e&&G(t),e&&G(r)}}}function cs(e){var t;return{c:function(){t=V("Loading")},m:function(e,n){q(e,t,n)},d:function(e){e&&G(t)}}}function ss(e){var t;return{c:function(){t=V("Not found")},m:function(e,n){q(e,t,n)},d:function(e){e&&G(t)}}}function us(e){var t;return{c:function(){t=V("Unknown")},m:function(e,n){q(e,t,n)},d:function(e){e&&G(t)}}}function ds(e){for(var t,n,r,o,i,a,c,s,u,d,f,l,h,m,v,g,y,b,$,_,w,k,C,S,E,R,T,O,P,D,M,N,j,A,L,I,U,z,B,F,Y,Q,Z,ee,te,ne,re,oe,ie,ae,se,ue,de,fe,le,pe,he,me,ve,ge,ye,be,$e,_e,we,ke,Ce,Se,xe,Ee,Re,Te,Oe,Pe,De,Me,Ne,je,Ae,Le,ze,Be=fn('Got any questions? Come and talk to us in the "#convos" channel on https://freenode.net.')+"",Fe=fn("More information can also be found on https://convos.chat.")+"",He=fn('Using "*" around some text, will convert it into *italic*, **bold** or ***italic bold***.')+"",qe=fn("Using backticks around some text, will format it as a `code fragment`.")+"",Ve=fn('Any message starting with a-z is prefixed with "`/quote`", when sending from a connection conversation.')+"",Je=dn("Changelog for v%1",ao("version"))+"",Ye="Convos"!=ao("organization_name")&&"https://convos.chat"!=ao("organization_url"),Qe=dn("Contact admin")+"",Ze=new jo({props:{$$slots:{default:[is]},$$scope:{ctx:e}}}),Xe=Io,et=[],tt=0;tt<Xe.length;tt+=1)et[tt]=as(os(e,Xe,tt));var nt,rt,ot,it,at=Ye&&(it=ao("organization_name")+"",{c:function(){nt=K("li"),rt=K("a"),ot=V(it),X(rt,"href",ao("organization_url")),X(rt,"target","_blank")},m:function(e,t){q(e,nt,t),H(nt,rt),H(rt,ot)},p:x,d:function(e){e&&G(nt)}}),ct=new Yo({props:{href:"/err/loading",$$slots:{default:[cs]},$$scope:{ctx:e}}}),st=new Yo({props:{href:"/err/not_found",$$slots:{default:[ss]},$$scope:{ctx:e}}}),ut=new Yo({props:{href:"/err/unknown",$$slots:{default:[us]},$$scope:{ctx:e}}});return{c:function(){Ge(Ze.$$.fragment),t=J(),n=K("main"),r=K("p"),i=J(),c=J(),(s=K("h2")).textContent="".concat(dn("Shortcuts")),u=J(),d=K("dl"),(f=K("dt")).textContent="".concat(dn("shift+enter")),(l=K("dd")).textContent="".concat(dn("Shift focus between chat input and search in sidebar.")),(h=K("dt")).textContent="".concat(dn("Open conversation or connection settings")),(m=K("dd")).textContent="".concat(dn("Clicking on the icon next to the conversation name will take you to settings.")),v=J(),(g=K("h2")).textContent="".concat(dn("Autocomplete")),y=J(),(b=K("p")).textContent="".concat(dn("The following rules apply when typing a message:")),$=J(),_=K("dl"),(w=K("dt")).textContent="@nick",(k=K("dd")).textContent="".concat(dn('"@" followed by a character will show matching nicks in the current conversation.')),(C=K("dt")).textContent=":emoji_name",(S=K("dd")).textContent="".concat(dn('":" followed by a character will show matching emojis.')),(E=K("dt")).textContent="/command",(R=K("dd")).textContent="".concat(dn('"/" will show the available commands.')),(T=K("dt")).textContent="#conversation",(O=K("dd")).textContent="".concat(dn('"#" will show the matching conversation names.')),P=J(),(D=K("h2")).textContent="".concat(dn("Text formatting")),M=J(),(N=K("p")).textContent="".concat(dn("Convos supports some special way of formatting text:")),j=J(),A=K("dl"),(L=K("dt")).textContent="".concat(Object.keys(Qt).sort().map(e[1]).join(", ")),(I=K("dd")).textContent="".concat(dn("Will be automatically converted into emojis.")),(U=K("dt")).textContent="".concat(dn("> some text")),(z=K("dd")).textContent="".concat(dn('A line starting with ">" will be converted into a quote.')),(B=K("dt")).textContent="".concat(dn("*some text*, **some text**, ***some text***")),F=K("dd"),(Y=K("dt")).textContent="".concat(dn("`some fragment`")),Q=K("dd"),(Z=K("dt")).textContent="https://...",(ee=K("dd")).textContent="".concat(dn("URLs will be converted to links, and might be embedded in the chat.")),te=J(),(ne=K("h2")).textContent="".concat(dn("Available commands")),re=J(),oe=K("p"),ie=J(),ae=K("dl");for(var p=0;p<et.length;p+=1)et[p].c();se=J(),(ue=K("h2")).textContent="".concat(dn("Other resources")),de=J(),fe=K("ul"),le=K("li"),pe=K("a"),he=V(Je),me=J(),ve=K("li"),(ge=K("a")).textContent="".concat(dn("Project homepage")),ye=J(),be=K("li"),($e=K("a")).textContent="".concat(dn("Bug/issue tracker")),_e=J(),we=K("li"),(ke=K("a")).textContent="".concat(dn("Source code")),Ce=J(),at&&at.c(),Se=J(),xe=K("li"),Ee=K("a"),Re=V(Qe),Te=J(),(Oe=K("h2")).textContent="".concat(dn("Demo error pages")),Pe=J(),De=K("ul"),Me=K("li"),Ge(ct.$$.fragment),Ne=J(),je=K("li"),Ge(st.$$.fragment),Ae=J(),Le=K("li"),Ge(ut.$$.fragment),o=new ce(Be,i),a=new ce(Fe,null),X(s,"id","shortcuts"),X(g,"id","autocomplete"),X(D,"id","formatting"),X(ne,"id","commands"),X(ue,"id","resources"),X(pe,"href",e[0]),X(pe,"target","_blank"),X(ge,"href","https://convos.chat"),X(ge,"target","_blank"),X($e,"href","https://github.com/Nordaaker/convos/issues"),X($e,"target","_blank"),X(ke,"href","https://github.com/Nordaaker/convos"),X(ke,"target","_blank"),X(Ee,"href",ao("contact")),X(Ee,"target","_blank"),X(Oe,"id","fallback"),X(n,"class","main")},m:function(e,p){We(Ze,e,p),q(e,t,p),q(e,n,p),H(n,r),o.m(r),H(r,i),a.m(r),H(n,c),H(n,s),H(n,u),H(n,d),H(d,f),H(d,l),H(d,h),H(d,m),H(n,v),H(n,g),H(n,y),H(n,b),H(n,$),H(n,_),H(_,w),H(_,k),H(_,C),H(_,S),H(_,E),H(_,R),H(_,T),H(_,O),H(n,P),H(n,D),H(n,M),H(n,N),H(n,j),H(n,A),H(A,L),H(A,I),H(A,U),H(A,z),H(A,B),H(A,F),F.innerHTML=He,H(A,Y),H(A,Q),Q.innerHTML=qe,H(A,Z),H(A,ee),H(n,te),H(n,ne),H(n,re),H(n,oe),oe.innerHTML=Ve,H(n,ie),H(n,ae);for(var x=0;x<et.length;x+=1)et[x].m(ae,null);H(n,se),H(n,ue),H(n,de),H(n,fe),H(fe,le),H(le,pe),H(pe,he),H(fe,me),H(fe,ve),H(ve,ge),H(fe,ye),H(fe,be),H(be,$e),H(fe,_e),H(fe,we),H(we,ke),H(fe,Ce),at&&at.m(fe,null),H(fe,Se),H(fe,xe),H(xe,Ee),H(Ee,Re),H(n,Te),H(n,Oe),H(n,Pe),H(n,De),H(De,Me),We(ct,Me,null),H(De,Ne),H(De,je),We(st,je,null),H(De,Ae),H(De,Le),We(ut,Le,null),ze=!0},p:function(e,t){var n=p(t,1)[0],r={};if(32&n&&(r.$$scope={dirty:n,ctx:e}),Ze.$set(r),0&n){var o;for(Xe=Io,o=0;o<Xe.length;o+=1){var i=os(e,Xe,o);et[o]?et[o].p(i,n):(et[o]=as(i),et[o].c(),et[o].m(ae,null))}for(;o<et.length;o+=1)et[o].d(1);et.length=Xe.length}Ye&&at.p(e,n);var a={};32&n&&(a.$$scope={dirty:n,ctx:e}),ct.$set(a);var c={};32&n&&(c.$$scope={dirty:n,ctx:e}),st.$set(c);var s={};32&n&&(s.$$scope={dirty:n,ctx:e}),ut.$set(s)},i:function(e){ze||(Ie(Ze.$$.fragment,e),Ie(ct.$$.fragment,e),Ie(st.$$.fragment,e),Ie(ut.$$.fragment,e),ze=!0)},o:function(e){Ue(Ze.$$.fragment,e),Ue(ct.$$.fragment,e),Ue(st.$$.fragment,e),Ue(ut.$$.fragment,e),ze=!1},d:function(e){Ke(Ze,e),e&&G(t),e&&G(n),W(et,e),at&&at.d(),Ke(ct),Ke(st),Ke(ut)}}}function fs(e){var t="https://github.com/Nordaaker/convos/blob/"+ao("version")+"/Changes#L3";Kt.update({title:dn("Help")});return[t,function(e){return Qt[e]}]}var ls=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(rs()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,fs,ds,D,{}),r}return s}(Ye);function ps(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function hs(e){var t,n,r,o,i,a,c,s,u,d,f,l=dn("Contact admin")+"",p=new wo({props:{name:"paper-plane"}});return{c:function(){(t=K("h2")).textContent="".concat(dn("Sign up")),n=J(),(r=K("p")).textContent="".concat(dn("Convos is not open for public registration.")),o=J(),(i=K("p")).textContent="".concat(dn("Please ask your Convos admin for an invite link to sign up, or sign in if you already have an account.")),a=J(),c=K("div"),s=K("a"),Ge(p.$$.fragment),u=J(),d=V(l),X(s,"class","btn"),X(s,"href",ao("contact")),X(c,"class","form-actions")},m:function(e,l){q(e,t,l),q(e,n,l),q(e,r,l),q(e,o,l),q(e,i,l),q(e,a,l),q(e,c,l),H(c,s),We(p,s,null),H(s,u),H(s,d),f=!0},p:x,i:function(e){f||(Ie(p.$$.fragment,e),f=!0)},o:function(e){Ue(p.$$.fragment,e),f=!1},d:function(e){e&&G(t),e&&G(n),e&&G(r),e&&G(o),e&&G(i),e&&G(a),e&&G(c),Ke(p)}}}function ms(e){var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g=ao("first_user"),y=g&&{c:function(){(v=K("p")).textContent="".concat(dn('As you are the first user, you do not need any invitation link. Just fill in the form below, hit "Sign up" to start chatting.'))},m:function(e,t){q(e,v,t)},p:x,d:function(e){e&&G(v)}};function b(t){e[12].call(null,t)}var $={type:"email",name:"email",placeholder:dn("Ex: john@doe.com"),readonly:e[2],$$slots:{default:[_s],help:[$s],label:[gs]},$$scope:{ctx:e}};void 0!==e[0].formEmail&&($.value=e[0].formEmail);var _=new Ga({props:$});_e.push((function(){return qe(_,"value",b)}));var w=new Ga({props:{type:"password",name:"password",$$slots:{default:[Cs],help:[ks],label:[ws]},$$scope:{ctx:e}}}),k=new xo({props:{icon:"save",op:e[4],$$slots:{default:[Ss]},$$scope:{ctx:e}}}),C=new Pa({props:{op:e[4]}});return{c:function(){t=K("form"),(n=K("h2")).textContent="".concat(dn(ao("existing_user")?"Recover account":"Sign up")),r=J(),y&&y.c(),o=J(),i=K("input"),a=J(),c=K("input"),s=J(),Ge(_.$$.fragment),d=J(),Ge(w.$$.fragment),f=J(),l=K("div"),Ge(k.$$.fragment),p=J(),Ge(C.$$.fragment),X(i,"type","hidden"),X(i,"name","exp"),X(c,"type","hidden"),X(c,"name","token"),X(l,"class","form-actions"),X(t,"method","post")},m:function(u,v,g){q(u,t,v),H(t,n),H(t,r),y&&y.m(t,null),H(t,o),H(t,i),H(t,a),H(t,c),H(t,s),We(_,t,null),H(t,d),We(w,t,null),H(t,f),H(t,l),We(k,l,null),H(t,p),We(C,t,null),e[14](t),h=!0,g&&m(),m=Q(t,"submit",Z(e[13]))},p:function(e,t){g&&y.p(e,t);var n={};131072&t&&(n.$$scope={dirty:t,ctx:e}),!u&&1&t&&(u=!0,n.value=e[0].formEmail,Ee((function(){return u=!1}))),_.$set(n);var r={};131072&t&&(r.$$scope={dirty:t,ctx:e}),w.$set(r);var o={};131072&t&&(o.$$scope={dirty:t,ctx:e}),k.$set(o)},i:function(e){h||(Ie(_.$$.fragment,e),Ie(w.$$.fragment,e),Ie(k.$$.fragment,e),Ie(C.$$.fragment,e),h=!0)},o:function(e){Ue(_.$$.fragment,e),Ue(w.$$.fragment,e),Ue(k.$$.fragment,e),Ue(C.$$.fragment,e),h=!1},d:function(n){n&&G(t),y&&y.d(),Ke(_),Ke(w),Ke(k),Ke(C),e[14](null),m()}}}function vs(e){var t,n,r,o,i,a,c,s,u,d=dn("Contact admin")+"";return{c:function(){(t=K("h2")).textContent="".concat(dn("Invalid invite/recover URL")),n=J(),(r=K("p")).textContent="".concat(dn(410==ao("status")?"The link has expired.":"The link is invalid.")),o=J(),(i=K("p")).textContent="".concat(dn("Please ask your Convos admin for a new link.")),a=J(),c=K("p"),s=K("a"),u=V(d),X(s,"class","btn"),X(s,"href",ao("contact"))},m:function(e,d){q(e,t,d),q(e,n,d),q(e,r,d),q(e,o,d),q(e,i,d),q(e,a,d),q(e,c,d),H(c,s),H(s,u)},p:x,i:x,o:x,d:function(e){e&&G(t),e&&G(n),e&&G(r),e&&G(o),e&&G(i),e&&G(a),e&&G(c)}}}function gs(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("E-mail")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ys(e){var t,n=dn("Your email will be used if you forget your password.")+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function bs(e){var t,n=dn("Your email is from the invite link.")+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function $s(e){var t;var n=function(e,t){return e[2]?bs:ys}(e)(e);return{c:function(){t=K("p"),n.c(),X(t,"class","help"),X(t,"slot","help")},m:function(e,r){q(e,t,r),n.m(t,null)},p:function(e,t){n.p(e,t)},d:function(e){e&&G(t),n.d()}}}function _s(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ws(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Password")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ks(e){var t;return{c:function(){(t=K("p")).textContent="".concat(dn("Hint: Use a phrase from a book.")),X(t,"class","help"),X(t,"slot","help")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Cs(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ss(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn(ao("existing_user")?"Set new password":"Sign up"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function xs(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("E-mail")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Es(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Password")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Rs(e){var t,n=fn("Contact your [Convos admin](%1) if you have forgotten your password.",ao("contact"))+"";return{c:function(){X(t=K("p"),"class","help"),X(t,"slot","help")},m:function(e,r){q(e,t,r),t.innerHTML=n},p:x,d:function(e){e&&G(t)}}}function Ts(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Os(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Sign in"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ps(e){var t,n,r,o,i,a,c=!ao("first_user"),s=[vs,ms,hs],u=[];n=function(e,t){return ao("status")>=400?0:e[2]||ao("open_to_public")||ao("first_user")?1:2}(e),r=u[n]=s[n](e);var d=c&&function(e){var t,n,r,o,i,a,c,s,u,d,f;function l(t){e[15].call(null,t)}var p={type:"email",name:"email",placeholder:dn("Ex: john@doe.com"),$$slots:{label:[xs]},$$scope:{ctx:e}};void 0!==e[0].formEmail&&(p.value=e[0].formEmail);var h=new Ga({props:p});_e.push((function(){return qe(h,"value",l)}));var m=new Ga({props:{type:"password",name:"password",autocomplete:"current-password",$$slots:{default:[Ts],help:[Rs],label:[Es]},$$scope:{ctx:e}}}),v=new xo({props:{icon:"sign-in-alt",op:e[3],$$slots:{default:[Os]},$$scope:{ctx:e}}}),g=new Pa({props:{op:e[3]}});return{c:function(){t=K("main"),n=K("form"),(r=K("h2")).textContent="".concat(dn("Sign in")),o=J(),Ge(h.$$.fragment),a=J(),Ge(m.$$.fragment),c=J(),s=K("div"),Ge(v.$$.fragment),u=J(),Ge(g.$$.fragment),X(s,"class","form-actions"),X(n,"method","post"),X(t,"id","signin")},m:function(i,l,p){q(i,t,l),H(t,n),H(n,r),H(n,o),We(h,n,null),H(n,a),We(m,n,null),H(n,c),H(n,s),We(v,s,null),H(n,u),We(g,n,null),d=!0,p&&f(),f=Q(n,"submit",Z(e[16]))},p:function(e,t){var n={};131072&t&&(n.$$scope={dirty:t,ctx:e}),!i&&1&t&&(i=!0,n.value=e[0].formEmail,Ee((function(){return i=!1}))),h.$set(n);var r={};131072&t&&(r.$$scope={dirty:t,ctx:e}),m.$set(r);var o={};131072&t&&(o.$$scope={dirty:t,ctx:e}),v.$set(o)},i:function(e){d||(Ie(h.$$.fragment,e),Ie(m.$$.fragment,e),Ie(v.$$.fragment,e),Ie(g.$$.fragment,e),d=!0)},o:function(e){Ue(h.$$.fragment,e),Ue(m.$$.fragment,e),Ue(v.$$.fragment,e),Ue(g.$$.fragment,e),d=!1},d:function(e){e&&G(t),Ke(h),Ke(m),Ke(v),Ke(g),f()}}}(e);return{c:function(){t=K("main"),r.c(),o=J(),d&&d.c(),i=Y(),X(t,"id","signup")},m:function(e,r){q(e,t,r),u[n].m(t,null),q(e,o,r),d&&d.m(e,r),q(e,i,r),a=!0},p:function(e,t){var n=p(t,1)[0];r.p(e,n),c&&d.p(e,n)},i:function(e){a||(Ie(r),Ie(d),a=!0)},o:function(e){Ue(r),Ue(d),a=!1},d:function(e){e&&G(t),u[n].d(),e&&G(o),d&&d.d(e),e&&G(i)}}}function Ds(e,t,n){var r,o,i,a;N(e,Kt,(function(e){return n(6,o=e)}));var c=ye("api"),s=ye("user");N(e,s,(function(e){return n(5,r=e)}));var u=-1!=location.href.indexOf("email="),d=c("loginUser");N(e,d,(function(e){return n(7,i=e)}));var f,l=c("registerUser");function p(e){return h.apply(this,arguments)}function h(){return(h=Xe(Qe.mark((function e(t){return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.reset(),e.next=3,s.load();case 3:return e.abrupt("return",s.is("authenticated")?Kt.go("/"):location.reload());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){Kt.update({lastUrl:""}),p(l)}N(e,l,(function(e){return n(8,a=e)})),me((function(){f&&Kt.urlToForm(f)}));return e.$$.update=function(){32&e.$$.dirty&&function(e){var t=e.conversations()[0],n=Kt.lastUrl?Kt.lastUrl:t?t.path:"/settings/connection";!e.is("loading")&&e.is("authenticated")&&Kt.go(n)}(r),64&e.$$.dirty&&Kt.update({title:o.path.match(/register/)?dn("Register"):dn("Login")}),128&e.$$.dirty&&i.is("success")&&p(d),256&e.$$.dirty&&a.is("success")&&m()},[s,f,u,d,l,r,o,i,a,c,p,m,function(e){s.formEmail=e,n(0,s)},function(e){return l.perform(e.target)},function(e){_e[e?"unshift":"push"]((function(){n(1,f=e)}))},function(e){s.formEmail=e,n(0,s)},function(e){return d.perform(e.target)}]}var Ms=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(ps()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Ds,Ps,D,{}),r}return s}(Ye);function Ns(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function js(e,t,n){var r=e.slice();return r[10]=t[n],r[12]=n,r}function As(e){var t,n,r=new wo({props:{name:"bell"}});return{c:function(){t=K("a"),Ge(r.$$.fragment),X(t,"href","/settings/account"),X(t,"class","btn")},m:function(e,o){q(e,t,o),We(r,t,null),n=!0},i:function(e){n||(Ie(r.$$.fragment,e),n=!0)},o:function(e){Ue(r.$$.fragment,e),n=!1},d:function(e){e&&G(t),Ke(r)}}}function Ls(e){var t,n,r=new wo({props:{name:"search"}});return{c:function(){t=K("a"),Ge(r.$$.fragment),X(t,"href","/search"),X(t,"class","btn")},m:function(e,o){q(e,t,o),We(r,t,null),n=!0},i:function(e){n||(Ie(r.$$.fragment,e),n=!0)},o:function(e){Ue(r.$$.fragment,e),n=!1},d:function(e){e&&G(t),Ke(r)}}}function Is(e){var t,n,r,o,i,a,c,s,u,d,f=dn(e[1].name)+"",l=[Ls,As],p=[];function h(e,t){return 16&t&&(a=!!e[4].is("search")),a?0:1}return c=h(e,-1),s=p[c]=l[c](e),{c:function(){t=K("h1"),n=K("a"),r=K("span"),o=V(f),i=J(),s.c(),u=Y(),X(n,"href","#activeMenu:nav"),X(n,"tabindex","-1")},m:function(e,a){q(e,t,a),H(t,n),H(n,r),H(r,o),q(e,i,a),p[c].m(e,a),q(e,u,a),d=!0},p:function(e,t){(!d||2&t)&&f!==(f=dn(e[1].name)+"")&&te(o,f);var n=c;(c=h(e,t))!==n&&(Ae(),Ue(p[n],1,1,(function(){p[n]=null})),Le(),(s=p[c])||(s=p[c]=l[c](e)).c(),Ie(s,1),s.m(u.parentNode,u))},i:function(e){d||(Ie(s),d=!0)},o:function(e){Ue(s),d=!1},d:function(e){e&&G(t),e&&G(i),p[c].d(e),e&&G(u)}}}function Us(e){var t,n,r,o,i,a,c,s=[Fs,Bs,zs],u=[];function d(e,o){return 2&o&&(t=!!e[1].is("notifications")),t?0:(4&o&&(n=!!e[2].param("q")),n?1:(2&o&&(r=!!e[1].is("search")),r?2:-1))}return~(o=d(e,-1))&&(i=u[o]=s[o](e)),{c:function(){i&&i.c(),a=Y()},m:function(e,t){~o&&u[o].m(e,t),q(e,a,t),c=!0},p:function(e,t){var n=o;(o=d(e,t))===n?~o&&u[o].p(e,t):(i&&(Ae(),Ue(u[n],1,1,(function(){u[n]=null})),Le()),~o?((i=u[o])||(i=u[o]=s[o](e)).c(),Ie(i,1),i.m(a.parentNode,a)):i=null)},i:function(e){c||(Ie(i),c=!0)},o:function(e){Ue(i),c=!1},d:function(e){~o&&u[o].d(e),e&&G(a)}}}function zs(e){var t,n=new Po({props:{$$slots:{default:[Hs]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};8192&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function Bs(e){var t,n=new Po({props:{$$slots:{default:[qs]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};8196&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function Fs(e){var t;return{c:function(){(t=K("h2")).textContent="".concat(dn("No notifications."))},m:function(e,n){q(e,t,n)},p:x,i:x,o:x,d:function(e){e&&G(t)}}}function Hs(e){var t,n,r,o,i,a=fn("Search for messages sent by you or others the last %1 days by writing a message in the input field below.",90)+"",c=fn('You can enter a channel name, or use `"conversation:#channel"` to narrow down the search.')+"",s=fn('It is also possible to use `"from:some_nick"` to filter out messages from a given user.')+"";return{c:function(){n=J(),o=J(),t=new ce(a,n),r=new ce(c,o),i=new ce(s,null)},m:function(e,a){t.m(e,a),q(e,n,a),r.m(e,a),q(e,o,a),i.m(e,a)},p:x,d:function(e){e&&t.d(),e&&G(n),e&&r.d(),e&&G(o),e&&i.d()}}}function qs(e){var t,n=dn('No search results for "%1".',e[2].param("q"))+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:function(e,r){4&r&&n!==(n=dn('No search results for "%1".',e[2].param("q"))+"")&&te(t,n)},d:function(e){e&&G(t)}}}function Gs(e){var t,n,r,o,i,a,c=e[10].ts.getHumanDate()+"",s=new wo({props:{name:"calendar-alt"}});return{c:function(){t=K("div"),n=K("span"),Ge(s.$$.fragment),r=J(),o=K("i"),i=V(c),X(t,"class","message__status-line for-day-changed")},m:function(e,c){q(e,t,c),H(t,n),We(s,n,null),H(n,r),H(n,o),H(o,i),a=!0},p:function(e,t){(!a||8&t)&&c!==(c=e[10].ts.getHumanDate()+"")&&te(i,c)},i:function(e){a||(Ie(s.$$.fragment,e),a=!0)},o:function(e){Ue(s.$$.fragment,e),a=!1},d:function(e){e&&G(t),Ke(s)}}}function Ws(e){var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g,y=e[10].ts.toLocaleString()+"",b=dn("%1 in %2",e[10].from,e[10].conversation_id)+"",$=e[10].markdown+"",_=(!e[12]||e[10].dayChanged)&&Gs(e),w=new wo({props:{name:"pick:"+e[10].fromId,color:e[10].color}});return{c:function(){_&&_.c(),t=J(),n=K("div"),Ge(w.$$.fragment),r=J(),o=K("div"),i=K("div"),a=V(y),s=J(),u=K("a"),d=V(b),l=J(),p=K("div"),h=J(),X(o,"class","message__ts has-tooltip"),X(o,"data-content",c=e[10].ts.format("%H:%M")),X(u,"href",f=Qs(e[10])),X(u,"class","message__from"),re(u,"color",e[10].color),X(p,"class","message__text"),X(n,"class",m=e[10].className)},m:function(e,c,f){_&&_.m(e,c),q(e,t,c),q(e,n,c),We(w,n,null),H(n,r),H(n,o),H(o,i),H(i,a),H(n,s),H(n,u),H(u,d),H(n,l),H(n,p),p.innerHTML=$,H(n,h),v=!0,f&&g(),g=Q(n,"click",Zs)},p:function(e,r){!e[12]||e[10].dayChanged?_?(_.p(e,r),Ie(_,1)):((_=Gs(e)).c(),Ie(_,1),_.m(t.parentNode,t)):_&&(Ae(),Ue(_,1,1,(function(){_=null})),Le());var i={};8&r&&(i.name="pick:"+e[10].fromId),8&r&&(i.color=e[10].color),w.$set(i),(!v||8&r)&&y!==(y=e[10].ts.toLocaleString()+"")&&te(a,y),(!v||8&r&&c!==(c=e[10].ts.format("%H:%M")))&&X(o,"data-content",c),(!v||8&r)&&b!==(b=dn("%1 in %2",e[10].from,e[10].conversation_id)+"")&&te(d,b),(!v||8&r&&f!==(f=Qs(e[10])))&&X(u,"href",f),(!v||8&r)&&re(u,"color",e[10].color),(!v||8&r)&&$!==($=e[10].markdown+"")&&(p.innerHTML=$),(!v||8&r&&m!==(m=e[10].className))&&X(n,"class",m)},i:function(e){v||(Ie(_),Ie(w.$$.fragment,e),v=!0)},o:function(e){Ue(_),Ue(w.$$.fragment,e),v=!1},d:function(e){_&&_.d(e),e&&G(t),e&&G(n),Ke(w),g()}}}function Ks(e){var t,n,r,o,i,a=new wo({props:{name:"spinner",animation:"spin"}});return{c:function(){t=K("div"),n=K("span"),Ge(a.$$.fragment),r=J(),(o=K("i")).textContent="".concat(dn("Loading...")),X(t,"class","message__status-line for-loading")},m:function(e,c){q(e,t,c),H(t,n),We(a,n,null),H(n,r),H(n,o),i=!0},p:x,i:function(e){i||(Ie(a.$$.fragment,e),i=!0)},o:function(e){Ue(a.$$.fragment,e),i=!1},d:function(e){e&&G(t),Ke(a)}}}function Vs(e){for(var t,n,r,o,i=0==e[3].length&&!e[1].is("loading"),a=e[4].is("loading"),c=i&&Us(e),s=e[3],u=[],d=0;d<s.length;d+=1)u[d]=Ws(js(e,s,d));var f=function(e){return Ue(u[e],1,1,(function(){u[e]=null}))},l=a&&Ks();return{c:function(){c&&c.c(),t=J();for(var e=0;e<u.length;e+=1)u[e].c();n=J(),l&&l.c(),r=Y()},m:function(e,i){c&&c.m(e,i),q(e,t,i);for(var a=0;a<u.length;a+=1)u[a].m(e,i);q(e,n,i),l&&l.m(e,i),q(e,r,i),o=!0},p:function(e,o){if(10&o&&(i=0==e[3].length&&!e[1].is("loading")),i?c?(c.p(e,o),Ie(c,1)):((c=Us(e)).c(),Ie(c,1),c.m(t.parentNode,t)):c&&(Ae(),Ue(c,1,1,(function(){c=null})),Le()),8&o){var d;for(s=e[3],d=0;d<s.length;d+=1){var p=js(e,s,d);u[d]?(u[d].p(p,o),Ie(u[d],1)):(u[d]=Ws(p),u[d].c(),Ie(u[d],1),u[d].m(n.parentNode,n))}for(Ae(),d=s.length;d<u.length;d+=1)f(d);Le()}16&o&&(a=e[4].is("loading")),a?l?(l.p(e,o),Ie(l,1)):((l=Ks()).c(),Ie(l,1),l.m(r.parentNode,r)):l&&(Ae(),Ue(l,1,1,(function(){l=null})),Le())},i:function(e){if(!o){Ie(c);for(var t=0;t<s.length;t+=1)Ie(u[t]);Ie(l),o=!0}},o:function(e){Ue(c),u=u.filter(Boolean);for(var t=0;t<u.length;t+=1)Ue(u[t]);Ue(l),o=!1},d:function(e){c&&c.d(e),e&&G(t),W(u,e),e&&G(n),l&&l.d(e),e&&G(r)}}}function Js(e){var t,n={conversation:e[1]},r=new Wo({props:n});return e[9](r),{c:function(){Ge(r.$$.fragment)},m:function(e,n){We(r,e,n),t=!0},p:function(e,t){var n={};2&t&&(n.conversation=e[1]),r.$set(n)},i:function(e){t||(Ie(r.$$.fragment,e),t=!0)},o:function(e){Ue(r.$$.fragment,e),t=!1},d:function(t){e[9](null),Ke(r,t)}}}function Ys(e){var t,n,r,o,i=e[1].is("search"),a=new jo({props:{$$slots:{default:[Is]},$$scope:{ctx:e}}}),c=new hi({props:{class:e[5].join(" "),$$slots:{default:[Vs]},$$scope:{ctx:e}}});c.$on("rendered",Xs);var s=i&&Js(e);return{c:function(){Ge(a.$$.fragment),t=J(),Ge(c.$$.fragment),n=J(),s&&s.c(),r=Y()},m:function(e,i){We(a,e,i),q(e,t,i),We(c,e,i),q(e,n,i),s&&s.m(e,i),q(e,r,i),o=!0},p:function(e,t){var n=p(t,1)[0],o={};8210&n&&(o.$$scope={dirty:n,ctx:e}),a.$set(o);var u={};32&n&&(u.class=e[5].join(" ")),8222&n&&(u.$$scope={dirty:n,ctx:e}),c.$set(u),2&n&&(i=e[1].is("search")),i?s?(s.p(e,n),Ie(s,1)):((s=Js(e)).c(),Ie(s,1),s.m(r.parentNode,r)):s&&(Ae(),Ue(s,1,1,(function(){s=null})),Le())},i:function(e){o||(Ie(a.$$.fragment,e),Ie(c.$$.fragment,e),Ie(s),o=!0)},o:function(e){Ue(a.$$.fragment,e),Ue(c.$$.fragment,e),Ue(s),o=!1},d:function(e){Ke(a,e),e&&G(t),Ke(c,e),e&&G(n),s&&s.d(e),e&&G(r)}}}function Qs(e){var t=["","chat",e.connection_id,e.conversation_id].map(encodeURIComponent).join("/");return Kt.urlFor(t+"#"+e.ts.toISOString())}function Zs(e){e.target.closest("a")||(e.preventDefault(),Kt.go(e.target.closest(".message").querySelector("a").href))}var Xs=function(e){return e.detail.scrollTo(-1)};function eu(e,t,n){var r,o,i=x,a=function(){return i(),i=M(f,(function(e){return n(4,o=e)})),f};N(e,Kt,(function(e){return n(2,r=e)})),e.$$.on_destroy.push((function(){return i()}));var c,s,u,d=ye("user"),f=-1==r.path.indexOf("search")?d.notifications:d.search;function l(e){var t=e.message;return c&&c.setValue(t),Kt.go("/search?q="+encodeURIComponent(t),{replace:!0}),t?f.load({match:t}):f.update({messages:[]})}function p(e){var t=-1==e.path.indexOf("search")?d.notifications:d.search;return t!=f&&a(n(1,f=t.update({conversation_id:!0}))),f.is("search")?l({message:e.param("q")}):f.load()}return a(),me((function(){return d.search.on("send",l)})),ve((function(){return f.markAsRead()})),e.$$.update=function(){16&e.$$.dirty&&n(3,s=Si({conversation:o})),24&e.$$.dirty&&n(5,u=["main",s.length&&"has-results",o.is("search")&&"is-above-chat-input"].filter((function(e){return e}))),4&e.$$.dirty&&p(r)},[c,f,r,s,o,u,d,l,p,function(e){_e[e?"unshift":"push"]((function(){n(0,c=e)}))}]}var tu=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Ns()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,eu,Ys,D,{}),r}return s}(Ye);function nu(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ru(e){var t;return{c:function(){(t=K("h1")).textContent="".concat(dn("Account"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ou(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Email")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function iu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Notification keywords")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function au(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Enable notifications")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function cu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Ignore join/part messages")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function su(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Expand URL to media")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function uu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Theme")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function du(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Color scheme")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function fu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Password")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function lu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Repeat password")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function pu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Save settings"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function hu(e){var t,n,r,o,i,a,c,s,u,d,f,l,h,m,v,g,y,b,$,_,w,k,C,S=new jo({props:{$$slots:{default:[ru]},$$scope:{ctx:e}}}),x=new Ga({props:{type:"email",name:"email",value:e[7].email,readonly:!0,$$slots:{label:[ou]},$$scope:{ctx:e}}}),E=new Ga({props:{name:"highlight_keywords",placeholder:dn("whatever, keywords"),value:e[10],$$slots:{label:[iu]},$$scope:{ctx:e}}});function R(t){e[14].call(null,t)}var T={name:"notifications",$$slots:{label:[au]},$$scope:{ctx:e}};void 0!==e[4]&&(T.checked=e[4]);var O=new Sa({props:T});function P(t){e[15].call(null,t)}_e.push((function(){return qe(O,"checked",R)}));var D={name:"statuses",$$slots:{label:[cu]},$$scope:{ctx:e}};void 0!==e[5]&&(D.checked=e[5]);var M=new Sa({props:D});function N(t){e[16].call(null,t)}_e.push((function(){return qe(M,"checked",P)}));var j={name:"expand_url",$$slots:{label:[su]},$$scope:{ctx:e}};void 0!==e[1]&&(j.checked=e[1]);var A=new Sa({props:j});function L(t){e[17].call(null,t)}_e.push((function(){return qe(A,"checked",N)}));var I={name:"theme",options:io.themeOptions,$$slots:{label:[uu]},$$scope:{ctx:e}};void 0!==e[3]&&(I.value=e[3]);var U=new Dc({props:I});function z(t){e[18].call(null,t)}_e.push((function(){return qe(U,"value",L)}));var B={name:"color_scheme",readonly:e[6],options:io.colorSchemeOptions,$$slots:{label:[du]},$$scope:{ctx:e}};void 0!==e[2]&&(B.value=e[2]);var F=new Dc({props:B});_e.push((function(){return qe(F,"value",z)}));var W=new Ga({props:{type:"password",name:"password",autocomplete:"new-password",$$slots:{label:[fu]},$$scope:{ctx:e}}}),V=new Ga({props:{type:"password",name:"password_again",autocomplete:"new-password",$$slots:{label:[lu]},$$scope:{ctx:e}}}),Y=new xo({props:{icon:"save",op:e[9],$$slots:{default:[pu]},$$scope:{ctx:e}}}),ee=new Pa({props:{op:e[9]}});return{c:function(){Ge(S.$$.fragment),t=J(),n=K("main"),r=K("form"),Ge(x.$$.fragment),o=J(),Ge(E.$$.fragment),i=J(),Ge(O.$$.fragment),c=J(),Ge(M.$$.fragment),u=J(),Ge(A.$$.fragment),f=J(),Ge(U.$$.fragment),h=J(),Ge(F.$$.fragment),v=J(),Ge(W.$$.fragment),g=J(),Ge(V.$$.fragment),y=J(),(b=K("p")).textContent="".concat(dn("Leave the password fields empty to keep the current password.")),$=J(),_=K("div"),Ge(Y.$$.fragment),w=J(),Ge(ee.$$.fragment),X(_,"class","form-actions"),X(r,"method","post"),X(n,"class","main")},m:function(a,s,d){We(S,a,s),q(a,t,s),q(a,n,s),H(n,r),We(x,r,null),H(r,o),We(E,r,null),H(r,i),We(O,r,null),H(r,c),We(M,r,null),H(r,u),We(A,r,null),H(r,f),We(U,r,null),H(r,h),We(F,r,null),H(r,v),We(W,r,null),H(r,g),We(V,r,null),H(r,y),H(r,b),H(r,$),H(r,_),We(Y,_,null),H(r,w),We(ee,r,null),e[19](r),k=!0,d&&C(),C=Q(r,"submit",Z(e[11]))},p:function(e,t){var n=p(t,1)[0],r={};1048576&n&&(r.$$scope={dirty:n,ctx:e}),S.$set(r);var o={};128&n&&(o.value=e[7].email),1048576&n&&(o.$$scope={dirty:n,ctx:e}),x.$set(o);var i={};1048576&n&&(i.$$scope={dirty:n,ctx:e}),E.$set(i);var c={};1048576&n&&(c.$$scope={dirty:n,ctx:e}),!a&&16&n&&(a=!0,c.checked=e[4],Ee((function(){return a=!1}))),O.$set(c);var u={};1048576&n&&(u.$$scope={dirty:n,ctx:e}),!s&&32&n&&(s=!0,u.checked=e[5],Ee((function(){return s=!1}))),M.$set(u);var f={};1048576&n&&(f.$$scope={dirty:n,ctx:e}),!d&&2&n&&(d=!0,f.checked=e[1],Ee((function(){return d=!1}))),A.$set(f);var h={};1048576&n&&(h.$$scope={dirty:n,ctx:e}),!l&&8&n&&(l=!0,h.value=e[3],Ee((function(){return l=!1}))),U.$set(h);var v={};64&n&&(v.readonly=e[6]),1048576&n&&(v.$$scope={dirty:n,ctx:e}),!m&&4&n&&(m=!0,v.value=e[2],Ee((function(){return m=!1}))),F.$set(v);var g={};1048576&n&&(g.$$scope={dirty:n,ctx:e}),W.$set(g);var y={};1048576&n&&(y.$$scope={dirty:n,ctx:e}),V.$set(y);var b={};1048576&n&&(b.$$scope={dirty:n,ctx:e}),Y.$set(b)},i:function(e){k||(Ie(S.$$.fragment,e),Ie(x.$$.fragment,e),Ie(E.$$.fragment,e),Ie(O.$$.fragment,e),Ie(M.$$.fragment,e),Ie(A.$$.fragment,e),Ie(U.$$.fragment,e),Ie(F.$$.fragment,e),Ie(W.$$.fragment,e),Ie(V.$$.fragment,e),Ie(Y.$$.fragment,e),Ie(ee.$$.fragment,e),k=!0)},o:function(e){Ue(S.$$.fragment,e),Ue(x.$$.fragment,e),Ue(E.$$.fragment,e),Ue(O.$$.fragment,e),Ue(M.$$.fragment,e),Ue(A.$$.fragment,e),Ue(U.$$.fragment,e),Ue(F.$$.fragment,e),Ue(W.$$.fragment,e),Ue(V.$$.fragment,e),Ue(Y.$$.fragment,e),Ue(ee.$$.fragment,e),k=!1},d:function(r){Ke(S,r),r&&G(t),r&&G(n),Ke(x),Ke(E),Ke(O),Ke(M),Ke(A),Ke(U),Ke(F),Ke(W),Ke(V),Ke(Y),Ke(ee),e[19](null),C()}}}function mu(e,t){(t.wantNotifications||t.desktopAccess)&&e.wantNotifications&&e.show(dn("You have enabled notifications."))}function vu(e,t,n){var r,o;N(e,io,(function(e){return n(12,r=e)}));var i=ye("api"),a=ye("user");N(e,a,(function(e){return n(7,o=e)}));var c,s,u=i("updateUser"),d=io.expandUrlToMedia,f=a.highlightKeywords.join(", "),l=io.colorScheme,p=io.theme,h=vn.wantNotifications,m=a.ignoreStatuses;return Kt.update({title:dn("Account")}),u.on("start",(function(e){e.body.password||delete e.body.password,e.body.highlight_keywords=e.body.highlight_keywords.split(/[.,\s]+/).map((function(e){return e.trim()})),a.update({highlightKeywords:e.body.highlight_keywords})})),ve(vn.on("update",mu)),e.$$.update=function(){4104&e.$$.dirty&&n(6,s=!r.hasColorSchemes(p))},[c,d,l,p,h,m,s,o,a,u,f,function(e){var t=e.target,n=[t.password.value,t.password_again.value];if(h&&vn.requestDesktopAccess(),n.join("").length&&n[0]!=n[1])return u.error("Passwords does not match.");vn.update({wantNotifications:h}),io.update({expandUrlToMedia:d}),a.update({ignoreStatuses:m}),io.activateTheme(p,s?"":l),u.perform(e.target)},r,i,function(e){n(4,h=e)},function(e){n(5,m=e)},function(e){n(1,d=e)},function(e){n(3,p=e)},function(e){n(2,l=e)},function(e){_e[e?"unshift":"push"]((function(){n(0,c=e)}))}]}var gu=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(nu()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,vu,hu,D,{}),r}return s}(Ye);function yu(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function bu(e){var t;return{c:function(){(t=K("h1")).textContent="".concat(dn("Global settings"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function $u(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Organization name")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function _u(e){var t;return{c:function(){(t=K("p")).textContent="".concat(dn("Can be changed if you want to add a touch of your organization.")),X(t,"class","help"),X(t,"slot","help")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function wu(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ku(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Organization URL")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Cu(e){var t;return{c:function(){(t=K("p")).textContent="".concat(dn('Used together with "Organization name" to add a link to your organization on the login screen.')),X(t,"class","help"),X(t,"slot","help")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Su(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function xu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Admin email")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Eu(e){var t;return{c:function(){(t=K("p")).textContent="".concat(dn("This email can be used by users to get in touch with the Convos admin.")),X(t,"class","help"),X(t,"slot","help")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ru(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Tu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Default connection URL")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ou(e){var t;return{c:function(){(t=K("p")).textContent="".concat(dn("This is the default connection new users will connect to.")," \n        ").concat(dn('The path part is the default channel to join. "%%23convos" means "#convos".')),X(t,"class","help"),X(t,"slot","help")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Pu(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Du(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Force default connection")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Mu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Registration is open to public")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Nu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Save settings"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ju(e){var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g,y,b,$,_,w,k,C,S,x,E=e[1].blocks_pct+"",R=dn("Disk usage")+"",T=e[1].blocks_used+"",O=e[1].blocks_total+"",P=e[1].inodes_pct+"",D=dn("Inode usage")+"",M=e[1].inodes_used+"",N=e[1].inodes_total+"";return{c:function(){t=K("div"),(n=K("h2")).textContent="".concat(dn("Disk usage")),r=J(),o=K("div"),i=K("div"),a=V(E),c=V("%"),s=J(),u=K("p"),d=V(R),f=V(": "),l=V(T),p=V(" / "),h=V(O),m=J(),v=K("div"),g=K("div"),y=V(P),b=V("%"),$=J(),_=K("p"),w=V(D),k=V(": "),C=V(M),S=V(" / "),x=V(N),X(i,"class","progress__bar"),re(i,"width",e[1].blocks_pct+"%"),X(o,"class","progress"),X(u,"class","help"),X(g,"class","progress__bar"),re(g,"width",e[1].inodes_pct+"%"),X(v,"class","progress"),X(_,"class","help"),X(t,"id","disk-usage")},m:function(e,E){q(e,t,E),H(t,n),H(t,r),H(t,o),H(o,i),H(i,a),H(i,c),H(t,s),H(t,u),H(u,d),H(u,f),H(u,l),H(u,p),H(u,h),H(t,m),H(t,v),H(v,g),H(g,y),H(g,b),H(t,$),H(t,_),H(_,w),H(_,k),H(_,C),H(_,S),H(_,x)},p:function(e,t){2&t&&E!==(E=e[1].blocks_pct+"")&&te(a,E),2&t&&re(i,"width",e[1].blocks_pct+"%"),2&t&&T!==(T=e[1].blocks_used+"")&&te(l,T),2&t&&O!==(O=e[1].blocks_total+"")&&te(h,O),2&t&&P!==(P=e[1].inodes_pct+"")&&te(y,P),2&t&&re(g,"width",e[1].inodes_pct+"%"),2&t&&M!==(M=e[1].inodes_used+"")&&te(C,M),2&t&&N!==(N=e[1].inodes_total+"")&&te(x,N)},d:function(e){e&&G(t)}}}function Au(e){var t,n,r,o,i,a,c,s,u,d,f,l,h,m,v,g,y,b,$,_,w,k,C,S,x,E,R=fn("These settings control what users experience when they visit [%1](%1).",ao("base_url"))+"",T=new jo({props:{$$slots:{default:[bu]},$$scope:{ctx:e}}});function O(t){e[7].call(null,t)}var P={name:"organization_name",placeholder:dn("Nordaaker"),$$slots:{default:[wu],help:[_u],label:[$u]},$$scope:{ctx:e}};void 0!==e[0].organization_name&&(P.value=e[0].organization_name);var D=new Ga({props:P});function M(t){e[8].call(null,t)}_e.push((function(){return qe(D,"value",O)}));var N={name:"organization_url",placeholder:dn("https://convos.chat"),$$slots:{default:[Su],help:[Cu],label:[ku]},$$scope:{ctx:e}};void 0!==e[0].organization_url&&(N.value=e[0].organization_url);var j=new Ga({props:N});function A(t){e[9].call(null,t)}_e.push((function(){return qe(j,"value",M)}));var L={name:"contact",placeholder:dn("Ex: jhthorsen@cpan.org"),$$slots:{default:[Ru],help:[Eu],label:[xu]},$$scope:{ctx:e}};void 0!==e[0].contact&&(L.value=e[0].contact);var I=new Ga({props:L});function U(t){e[10].call(null,t)}_e.push((function(){return qe(I,"value",A)}));var z={name:"default_connection",placeholder:dn("irc://chat.freenode.net:6697/%%23convos"),$$slots:{default:[Pu],help:[Ou],label:[Tu]},$$scope:{ctx:e}};void 0!==e[0].default_connection&&(z.value=e[0].default_connection);var B=new Ga({props:z});_e.push((function(){return qe(B,"value",U)}));var F=new Sa({props:{name:"forced_connection",checked:e[0].forced_connection,$$slots:{label:[Du]},$$scope:{ctx:e}}}),W=new Sa({props:{name:"open_to_public",checked:e[0].open_to_public,$$slots:{label:[Mu]},$$scope:{ctx:e}}}),V=new xo({props:{icon:"save",op:e[2],$$slots:{default:[Nu]},$$scope:{ctx:e}}}),Y=new Pa({props:{op:e[2]}}),ee=e[1]&&ju(e);return{c:function(){Ge(T.$$.fragment),t=J(),n=K("main"),r=K("form"),(o=K("h2")).textContent="".concat(dn("Convos settings")),i=J(),a=K("p"),c=J(),Ge(D.$$.fragment),u=J(),Ge(j.$$.fragment),f=J(),Ge(I.$$.fragment),h=J(),Ge(B.$$.fragment),v=J(),Ge(F.$$.fragment),g=J(),(y=K("p")).textContent="".concat(dn("Tick this box if you want to prevent users from creating custom connections.")),b=J(),Ge(W.$$.fragment),$=J(),(_=K("p")).textContent="".concat(dn("Tick this box if you want users to be able to register without an invite URL.")),w=J(),k=K("div"),Ge(V.$$.fragment),C=J(),Ge(Y.$$.fragment),S=J(),ee&&ee.c(),X(y,"class","help"),X(_,"class","help"),X(k,"class","form-actions"),X(r,"id","convos-settings"),X(r,"method","post"),X(n,"class","main")},m:function(s,d,l){We(T,s,d),q(s,t,d),q(s,n,d),H(n,r),H(r,o),H(r,i),H(r,a),a.innerHTML=R,H(r,c),We(D,r,null),H(r,u),We(j,r,null),H(r,f),We(I,r,null),H(r,h),We(B,r,null),H(r,v),We(F,r,null),H(r,g),H(r,y),H(r,b),We(W,r,null),H(r,$),H(r,_),H(r,w),H(r,k),We(V,k,null),H(r,C),We(Y,r,null),H(n,S),ee&&ee.m(n,null),x=!0,l&&E(),E=Q(r,"submit",Z(e[3]))},p:function(e,t){var r=p(t,1)[0],o={};2048&r&&(o.$$scope={dirty:r,ctx:e}),T.$set(o);var i={};2048&r&&(i.$$scope={dirty:r,ctx:e}),!s&&1&r&&(s=!0,i.value=e[0].organization_name,Ee((function(){return s=!1}))),D.$set(i);var a={};2048&r&&(a.$$scope={dirty:r,ctx:e}),!d&&1&r&&(d=!0,a.value=e[0].organization_url,Ee((function(){return d=!1}))),j.$set(a);var c={};2048&r&&(c.$$scope={dirty:r,ctx:e}),!l&&1&r&&(l=!0,c.value=e[0].contact,Ee((function(){return l=!1}))),I.$set(c);var u={};2048&r&&(u.$$scope={dirty:r,ctx:e}),!m&&1&r&&(m=!0,u.value=e[0].default_connection,Ee((function(){return m=!1}))),B.$set(u);var f={};1&r&&(f.checked=e[0].forced_connection),2048&r&&(f.$$scope={dirty:r,ctx:e}),F.$set(f);var h={};1&r&&(h.checked=e[0].open_to_public),2048&r&&(h.$$scope={dirty:r,ctx:e}),W.$set(h);var v={};2048&r&&(v.$$scope={dirty:r,ctx:e}),V.$set(v),e[1]?ee?ee.p(e,r):((ee=ju(e)).c(),ee.m(n,null)):ee&&(ee.d(1),ee=null)},i:function(e){x||(Ie(T.$$.fragment,e),Ie(D.$$.fragment,e),Ie(j.$$.fragment,e),Ie(I.$$.fragment,e),Ie(B.$$.fragment,e),Ie(F.$$.fragment,e),Ie(W.$$.fragment,e),Ie(V.$$.fragment,e),Ie(Y.$$.fragment,e),x=!0)},o:function(e){Ue(T.$$.fragment,e),Ue(D.$$.fragment,e),Ue(j.$$.fragment,e),Ue(I.$$.fragment,e),Ue(B.$$.fragment,e),Ue(F.$$.fragment,e),Ue(W.$$.fragment,e),Ue(V.$$.fragment,e),Ue(Y.$$.fragment,e),x=!1},d:function(e){Ke(T,e),e&&G(t),e&&G(n),Ke(D),Ke(j),Ke(I),Ke(B),Ke(F),Ke(W),Ke(V),Ke(Y),ee&&ee.d(),E()}}}function Lu(e,t,n){var r,o=ye("api"),i=ye("user"),a=o("getSettings"),c=o("updateSettings"),s={};return c.on("start",(function(e){e.body.contact&&(e.body.contact="mailto:"+e.body.contact),e.body.forced_connection=!!e.body.forced_connection,e.body.open_to_public=!!e.body.open_to_public,ao("contact",e.body.contact),ao("open_to_public",e.body.open_to_public),ao("organization_name",e.body.organization_name),ao("organization_url",e.body.organization_url),i.update({default_connection:e.body.default_connection,forced_connection:e.body.forced_connection})})),Kt.update({title:dn("Global settings")}),me(Xe(Qe.mark((function e(){var t;return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.perform();case 2:(t=a.res.body).contact=t.contact.replace(/mailto:/,""),n(0,s=t);case 5:case"end":return e.stop()}}),e)})))),e.$$.update=function(){1&e.$$.dirty&&n(1,r=function(e){if(!e)return null;var t=e.block_size||1024;return{blocks_pct:Math.ceil(e.blocks_used/e.blocks_total*100),blocks_total:dt(t*e.blocks_total,"B"),blocks_used:dt(t*e.blocks_used,"B"),inodes_pct:Math.ceil(e.inodes_used/e.inodes_total*100),inodes_total:dt(e.inodes_total),inodes_used:dt(e.inodes_used)}}(s.disk_usage))},[s,r,c,function(e){c.perform(e.target)},o,i,a,function(e){s.organization_name=e,n(0,s)},function(e){s.organization_url=e,n(0,s)},function(e){s.contact=e,n(0,s)},function(e){s.default_connection=e,n(0,s)}]}var Iu=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(yu()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Lu,Au,D,{}),r}return s}(Ye);function Uu(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function zu(e,t,n){var r=e.slice();return r[11]=t[n],r}function Bu(e){var t,n=new wo({props:{name:"list"}}),r=new wo({props:{name:"times"}});return{c:function(){Ge(n.$$.fragment),Ge(r.$$.fragment)},m:function(e,o){We(n,e,o),We(r,e,o),t=!0},p:x,i:function(e){t||(Ie(n.$$.fragment,e),Ie(r.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),Ue(r.$$.fragment,e),t=!1},d:function(e){Ke(n,e),Ke(r,e)}}}function Fu(e){var t,n,r,o,i=dn(e[2]?"Account":"Users")+"",a=new Yo({props:{href:"/settings/users",class:"btn can-toggle "+(e[2]?"is-toggled":""),"data-tooltip":dn("See all users"),$$slots:{default:[Bu]},$$scope:{ctx:e}}});return{c:function(){t=K("h1"),n=V(i),r=J(),Ge(a.$$.fragment)},m:function(e,i){q(e,t,i),H(t,n),q(e,r,i),We(a,e,i),o=!0},p:function(e,t){(!o||4&t)&&i!==(i=dn(e[2]?"Account":"Users")+"")&&te(n,i);var r={};4&t&&(r.class="btn can-toggle "+(e[2]?"is-toggled":"")),524288&t&&(r.$$scope={dirty:t,ctx:e}),a.$set(r)},i:function(e){o||(Ie(a.$$.fragment,e),o=!0)},o:function(e){Ue(a.$$.fragment,e),o=!1},d:function(e){e&&G(t),e&&G(r),Ke(a,e)}}}function Hu(e){for(var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g,y,b,$,_,w,k,C=dn("Users")+"",S=e[1].length+"",x=new Ga({props:{type:"email",name:"email",placeholder:dn("user@example.com"),$$slots:{default:[Ku],help:[Wu],label:[Gu]},$$scope:{ctx:e}}}),E=e[3].url&&Vu(e),R=new xo({props:{icon:"save",op:e[6],$$slots:{default:[Ju]},$$scope:{ctx:e}}}),T=new Pa({props:{op:e[6]}}),O=new Pa({props:{op:e[5],progress:!0}}),P=e[1],D=[],M=0;M<P.length;M+=1)D[M]=Yu(zu(e,P,M));return{c:function(){t=K("form"),(n=K("h2")).textContent="".concat(dn("Invite or recover password")),r=J(),Ge(x.$$.fragment),o=J(),E&&E.c(),i=J(),a=K("div"),Ge(R.$$.fragment),c=J(),Ge(T.$$.fragment),s=J(),u=K("h2"),d=V(C),f=J(),l=K("small"),p=V("("),h=V(S),m=V(")"),v=J(),Ge(O.$$.fragment),g=J(),y=K("table"),(b=K("thead")).innerHTML="<tr><th>Email</th> \n          <th>Roles</th> \n          <th>Registered</th></tr>",$=J(),_=K("tbody");for(var e=0;e<D.length;e+=1)D[e].c();X(a,"class","form-actions"),X(t,"id","invite"),X(t,"method","post")},m:function(C,S,P){q(C,t,S),H(t,n),H(t,r),We(x,t,null),H(t,o),E&&E.m(t,null),H(t,i),H(t,a),We(R,a,null),H(t,c),We(T,t,null),q(C,s,S),q(C,u,S),H(u,d),H(u,f),H(u,l),H(l,p),H(l,h),H(l,m),q(C,v,S),We(O,C,S),q(C,g,S),q(C,y,S),H(y,b),H(y,$),H(y,_);for(var M=0;M<D.length;M+=1)D[M].m(_,null);w=!0,P&&k(),k=Q(t,"submit",Z(e[9]))},p:function(e,n){var r={};524288&n&&(r.$$scope={dirty:n,ctx:e}),x.$set(r),e[3].url?E?E.p(e,n):((E=Vu(e)).c(),E.m(t,i)):E&&(E.d(1),E=null);var o={};if(524288&n&&(o.$$scope={dirty:n,ctx:e}),R.$set(o),(!w||2&n)&&S!==(S=e[1].length+"")&&te(h,S),2&n){var a;for(P=e[1],a=0;a<P.length;a+=1){var c=zu(e,P,a);D[a]?D[a].p(c,n):(D[a]=Yu(c),D[a].c(),D[a].m(_,null))}for(;a<D.length;a+=1)D[a].d(1);D.length=P.length}},i:function(e){w||(Ie(x.$$.fragment,e),Ie(R.$$.fragment,e),Ie(T.$$.fragment,e),Ie(O.$$.fragment,e),w=!0)},o:function(e){Ue(x.$$.fragment,e),Ue(R.$$.fragment,e),Ue(T.$$.fragment,e),Ue(O.$$.fragment,e),w=!1},d:function(e){e&&G(t),Ke(x),E&&E.d(),Ke(R),Ke(T),e&&G(s),e&&G(u),e&&G(v),Ke(O,e),e&&G(g),e&&G(y),W(D,e),k()}}}function qu(e){var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m,v,g,y,b,$,_=dn("This will permanently remove user settings, chat logs, uploaded files and other user related data.")+"",w=fn("Please confirm by entering **%1** before hitting **%2**.",e[2].email,dn("Delete user"))+"",k=new Ga({props:{name:"email",value:e[2].email,readonly:!0,$$slots:{label:[Qu]},$$scope:{ctx:e}}}),C=new Ga({props:{name:"roles",value:e[2].roles.join(", "),placeholder:dn("admin, bot, ..."),$$slots:{default:[ed],help:[Xu],label:[Zu]},$$scope:{ctx:e}}}),S=new xo({props:{icon:"save",op:e[7],$$slots:{default:[td]},$$scope:{ctx:e}}}),x=new Pa({props:{op:e[7]}});function E(t){e[16].call(null,t)}var R={name:"email",$$slots:{label:[nd]},$$scope:{ctx:e}};void 0!==e[0]&&(R.value=e[0]);var T=new Ga({props:R});_e.push((function(){return qe(T,"value",E)}));var P=new xo({props:{icon:"trash",op:e[4],disabled:e[0]!=e[2].email,$$slots:{default:[rd]},$$scope:{ctx:e}}}),D=new Pa({props:{op:e[4]}});return{c:function(){t=K("form"),Ge(k.$$.fragment),n=J(),Ge(C.$$.fragment),r=J(),o=K("div"),Ge(S.$$.fragment),i=J(),Ge(x.$$.fragment),a=J(),(c=K("h2")).textContent="Delete account",s=J(),u=K("form"),d=K("p"),f=V(_),l=J(),h=J(),Ge(T.$$.fragment),v=J(),g=K("div"),Ge(P.$$.fragment),y=J(),Ge(D.$$.fragment),X(o,"class","form-actions"),X(t,"id","edit"),X(t,"method","post"),p=new ce(w,null),X(g,"class","form-actions"),X(u,"id","delete"),X(u,"method","post")},m:function(m,_,w){q(m,t,_),We(k,t,null),H(t,n),We(C,t,null),H(t,r),H(t,o),We(S,o,null),H(t,i),We(x,t,null),q(m,a,_),q(m,c,_),q(m,s,_),q(m,u,_),H(u,d),H(d,f),H(d,l),p.m(d),H(u,h),We(T,u,null),H(u,v),H(u,g),We(P,g,null),H(u,y),We(D,u,null),b=!0,w&&O($),$=[Q(t,"submit",Z(e[10])),Q(u,"submit",Z(e[8]))]},p:function(e,t){var n={};4&t&&(n.value=e[2].email),524288&t&&(n.$$scope={dirty:t,ctx:e}),k.$set(n);var r={};4&t&&(r.value=e[2].roles.join(", ")),524288&t&&(r.$$scope={dirty:t,ctx:e}),C.$set(r);var o={};524288&t&&(o.$$scope={dirty:t,ctx:e}),S.$set(o),(!b||4&t)&&w!==(w=fn("Please confirm by entering **%1** before hitting **%2**.",e[2].email,dn("Delete user"))+"")&&p.p(w);var i={};524288&t&&(i.$$scope={dirty:t,ctx:e}),!m&&1&t&&(m=!0,i.value=e[0],Ee((function(){return m=!1}))),T.$set(i);var a={};5&t&&(a.disabled=e[0]!=e[2].email),524288&t&&(a.$$scope={dirty:t,ctx:e}),P.$set(a)},i:function(e){b||(Ie(k.$$.fragment,e),Ie(C.$$.fragment,e),Ie(S.$$.fragment,e),Ie(x.$$.fragment,e),Ie(T.$$.fragment,e),Ie(P.$$.fragment,e),Ie(D.$$.fragment,e),b=!0)},o:function(e){Ue(k.$$.fragment,e),Ue(C.$$.fragment,e),Ue(S.$$.fragment,e),Ue(x.$$.fragment,e),Ue(T.$$.fragment,e),Ue(P.$$.fragment,e),Ue(D.$$.fragment,e),b=!1},d:function(e){e&&G(t),Ke(k),Ke(C),Ke(S),Ke(x),e&&G(a),e&&G(c),e&&G(s),e&&G(u),Ke(T),Ke(P),Ke(D),O($)}}}function Gu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("User email")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Wu(e){var t;return{c:function(){(t=K("p")).textContent="".concat(dn("Using this form, you can generate a forgotten password or invite link for a user.")),X(t,"class","help"),X(t,"slot","help")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ku(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Vu(e){var t,n,r,o,i,a,c,s,u,d,f,l,p,h,m=fn(e[3].existing?"Copy and send the link to your *existing* user.":"Copy and send the link to your *new* user.")+"",v=fn("The link is valid until **%1**.",new Date(e[3].expires).toLocaleString())+"",g=e[3].url+"";return{c:function(){(t=K("h3")).textContent="".concat(dn("A link was generated")),n=J(),r=K("p"),i=J(),c=J(),s=K("a"),u=V(g),f=J(),l=K("p"),(p=K("small")).textContent="".concat(dn("Tip: Clicking on the link will copy it to your clipboard.")),o=new ce(m,i),a=new ce(v,null),X(s,"href",d=e[3].url)},m:function(e,d,m){q(e,t,d),q(e,n,d),q(e,r,d),o.m(r),H(r,i),a.m(r),q(e,c,d),q(e,s,d),H(s,u),q(e,f,d),q(e,l,d),H(l,p),m&&h(),h=Q(s,"click",Z(id))},p:function(e,t){8&t&&m!==(m=fn(e[3].existing?"Copy and send the link to your *existing* user.":"Copy and send the link to your *new* user.")+"")&&o.p(m),8&t&&v!==(v=fn("The link is valid until **%1**.",new Date(e[3].expires).toLocaleString())+"")&&a.p(v),8&t&&g!==(g=e[3].url+"")&&te(u,g),8&t&&d!==(d=e[3].url)&&X(s,"href",d)},d:function(e){e&&G(t),e&&G(n),e&&G(r),e&&G(c),e&&G(s),e&&G(f),e&&G(l),h()}}}function Ju(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Generate link"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Yu(e){var t,n,r,o,i,a,c,s,u,d,f,l,p=e[11].email+"",h=e[11].roles.join(", ")+"",m=new Rt(e[11].registered).getHumanDate({year:!0})+"";return{c:function(){t=K("tr"),n=K("td"),r=K("a"),o=V(p),a=J(),c=K("td"),s=V(h),u=J(),d=K("td"),f=V(m),l=J(),X(r,"href",i="#"+e[11].uid)},m:function(e,i){q(e,t,i),H(t,n),H(n,r),H(r,o),H(t,a),H(t,c),H(c,s),H(t,u),H(t,d),H(d,f),H(t,l)},p:function(e,t){2&t&&p!==(p=e[11].email+"")&&te(o,p),2&t&&i!==(i="#"+e[11].uid)&&X(r,"href",i),2&t&&h!==(h=e[11].roles.join(", ")+"")&&te(s,h),2&t&&m!==(m=new Rt(e[11].registered).getHumanDate({year:!0})+"")&&te(f,m)},d:function(e){e&&G(t)}}}function Qu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Email")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Zu(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Roles")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Xu(e){var t;return{c:function(){(t=K("p")).textContent="".concat(dn("Roles must be separated by comma.")),X(t,"class","help"),X(t,"slot","help")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function ed(e){var t;return{c:function(){t=J()},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function td(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Save user"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function nd(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Confirm email")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function rd(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Delete user"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function od(e){var t,n,r,o,i,a=new jo({props:{$$slots:{default:[Fu]},$$scope:{ctx:e}}}),c=[qu,Hu],s=[];function u(e,t){return e[2]?0:1}return r=u(e),o=s[r]=c[r](e),{c:function(){Ge(a.$$.fragment),t=J(),n=K("main"),o.c(),X(n,"class","main")},m:function(e,o){We(a,e,o),q(e,t,o),q(e,n,o),s[r].m(n,null),i=!0},p:function(e,t){var i=p(t,1)[0],d={};524292&i&&(d.$$scope={dirty:i,ctx:e}),a.$set(d);var f=r;(r=u(e))===f?s[r].p(e,i):(Ae(),Ue(s[f],1,1,(function(){s[f]=null})),Le(),(o=s[r])||(o=s[r]=c[r](e)).c(),Ie(o,1),o.m(n,null))},i:function(e){i||(Ie(a.$$.fragment,e),Ie(o),i=!0)},o:function(e){Ue(a.$$.fragment,e),Ue(o),i=!1},d:function(e){Ke(a,e),e&&G(t),e&&G(n),s[r].d()}}}function id(e){var t=function(e){var t=document.createElement("textarea");t.value=e.textContent||e.value,t.style.opacity=0,t.style.position="absolute",document.body.appendChild(t);try{t.focus(),t.select(),document.execCommand("copy")}catch(e){t.value="",console.log("copyToClipboard() failed:",e)}return document.body.removeChild(t),t.value}(e.target);t&&vn.showInApp(t,{title:dn("Invite link copied")})}function ad(e,t,n){var r,o;N(e,Kt,(function(e){return n(12,r=e)}));var i=ye("api"),a=ye("user"),c=i("deleteUser"),s=i("getUsers"),u=i("inviteUser");N(e,u,(function(e){return n(13,o=e)}));var d,f,l=i("updateUser"),p="",h=[];function m(){return(m=Xe(Qe.mark((function e(t){return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),c.reset(),l.reset(),p==d.email){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,c.perform(t.target);case 7:if(c.is("success")){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,s.perform();case 11:Kt.go("/settings/users",{replace:!0});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){var r=e.hash;return n(0,p=""),t.filter((function(e){return e.uid==r}))[0]}return Kt.update({title:dn("Users")}),l.on("start",(function(e){n(2,d.roles=e.body.roles.split(/[.,\s]+/).map((function(e){return e.trim()})),d),e.body.roles=d.roles})),me(Xe(Qe.mark((function e(){return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.perform();case 2:n(1,h=s.res.body.users||[]);case 3:case"end":return e.stop()}}),e)})))),e.$$.update=function(){4098&e.$$.dirty&&n(2,d=v(r,h)),8192&e.$$.dirty&&n(3,f=o.res.body||{})},[p,h,d,f,c,s,u,l,function(e){return m.apply(this,arguments)},function(e){u.perform(e.target)},function(e){c.reset(),l.perform(e.target)},a,r,o,i,v,function(e){n(0,p=e)}]}var cd=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Uu()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,ad,od,D,{}),r}return s}(Ye);function sd(e){return function(t){for(var n=document.querySelectorAll(".js-remove"),r=0;r<n.length;r++)n[r].remove();var o=-1==[ns,Ms].indexOf(e);t.update({component:e,requireLogin:o}),o&&t.update({lastUrl:location.href})}}function ud(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function dd(e){var t,n,r,o,i,a=dn(e[0].conversation_id?"Conversation":"Connection")+"",c=new wo({props:{name:"times-circle"}});return{c:function(){t=K("a"),n=K("h2"),r=V(a),o=J(),Ge(c.$$.fragment),X(t,"href","#activeMenu:"),X(t,"class","sidebar__header for-settings")},m:function(e,a){q(e,t,a),H(t,n),H(n,r),H(t,o),We(c,t,null),i=!0},p:function(e,t){var n=p(t,1)[0];(!i||1&n)&&a!==(a=dn(e[0].conversation_id?"Conversation":"Connection")+"")&&te(r,a)},i:function(e){i||(Ie(c.$$.fragment,e),i=!0)},o:function(e){Ue(c.$$.fragment,e),i=!1},d:function(e){e&&G(t),Ke(c)}}}function fd(e,t,n){var r=t.conversation,o=void 0===r?{}:r;return e.$set=function(e){"conversation"in e&&n(0,o=e.conversation)},[o]}var ld=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(ud()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,fd,dd,D,{conversation:0}),r}return s}(Ye);function pd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function hd(e){var t,n,r=dn("Currently connecting to %1.",e[3])+"";return{c:function(){t=K("p"),n=V(r)},m:function(e,r){q(e,t,r),H(t,n)},p:function(e,t){8&t&&r!==(r=dn("Currently connecting to %1.",e[3])+"")&&te(n,r)},d:function(e){e&&G(t)}}}function md(e){var t,n,r=dn("Currently connected to %1.",e[3])+"";return{c:function(){t=K("p"),n=V(r)},m:function(e,r){q(e,t,r),H(t,n)},p:function(e,t){8&t&&r!==(r=dn("Currently connected to %1.",e[3])+"")&&te(n,r)},d:function(e){e&&G(t)}}}function vd(e){var t,n,r=dn("Currently disconnected from %1.",e[3])+"";return{c:function(){t=K("p"),n=V(r)},m:function(e,r){q(e,t,r),H(t,n)},p:function(e,t){8&t&&r!==(r=dn("Currently disconnected from %1.",e[3])+"")&&te(n,r)},d:function(e){e&&G(t)}}}function gd(e){var t;return{c:function(){(t=K("p")).textContent="".concat(dn("Connection not found."))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function yd(e){var t,n,r,o,i,a=new ld({props:{conversation:e[0]}});function c(e,t){return e[2].url?"disconnected"==e[2].state?vd:"connected"==e[2].state?md:hd:gd}var s=c(e),u=s(e),d=new bc({props:{conversation:e[0]}});return{c:function(){t=K("div"),Ge(a.$$.fragment),n=J(),u.c(),r=J(),Ge(d.$$.fragment),X(t,"class","sidebar-left")},m:function(e,o){q(e,t,o),We(a,t,null),H(t,n),u.m(t,null),H(t,r),We(d,t,null),i=!0},p:function(e,n){var o=p(n,1)[0],i={};1&o&&(i.conversation=e[0]),a.$set(i),s===(s=c(e))&&u?u.p(e,o):(u.d(1),(u=s(e))&&(u.c(),u.m(t,r)));var f={};1&o&&(f.conversation=e[0]),d.$set(f)},i:function(n){i||(Ie(a.$$.fragment,n),Ie(d.$$.fragment,n),xe((function(){o||(o=Be(t,po,e[1],!0)),o.run(1)})),i=!0)},o:function(n){Ue(a.$$.fragment,n),Ue(d.$$.fragment,n),o||(o=Be(t,po,e[1],!1)),o.run(0),i=!1},d:function(e){e&&G(t),Ke(a),u.d(),Ke(d),e&&o&&o.end()}}}function bd(e,t,n){var r,o=t.conversation,i=void 0===o?{}:o,a=t.transition,c=ye("user"),s={};return me(Xe(Qe.mark((function e(){return Qe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(2,s=c.findConversation({connection_id:i.connection_id})||{});case 1:case"end":return e.stop()}}),e)})))),e.$set=function(e){"conversation"in e&&n(0,i=e.conversation),"transition"in e&&n(1,a=e.transition)},e.$$.update=function(){4&e.$$.dirty&&n(3,r=s.real_host||s.url&&s.url.host)},[i,a,s,r]}var $d=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(pd()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,bd,yd,D,{conversation:0,transition:1}),r}return s}(Ye);function _d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function wd(e,t,n){var r=e.slice();return r[15]=t[n],r}function kd(e){var t,n=dn("You are not a channel operator in %1.",e[0].name)+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:function(e,r){1&r&&n!==(n=dn("You are not a channel operator in %1.",e[0].name)+"")&&te(t,n)},d:function(e){e&&G(t)}}}function Cd(e){var t,n=dn("You are channel operator in %1.",e[0].name)+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:function(e,r){1&r&&n!==(n=dn("You are channel operator in %1.",e[0].name)+"")&&te(t,n)},d:function(e){e&&G(t)}}}function Sd(e){var t,n=dn("Private conversation with %1.",e[0].name)+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:function(e,r){1&r&&n!==(n=dn("Private conversation with %1.",e[0].name)+"")&&te(t,n)},d:function(e){e&&G(t)}}}function xd(e){var t,n=dn("Conversation with %1 is frozen. Reason: %2",e[0].name,dn(e[0].frozen))+"";return{c:function(){t=V(n)},m:function(e,n){q(e,t,n)},p:function(e,r){1&r&&n!==(n=dn("Conversation with %1 is frozen. Reason: %2",e[0].name,dn(e[0].frozen))+"")&&te(t,n)},d:function(e){e&&G(t)}}}function Ed(e){var t,n,r,o,i,a,c,s,u,d,f,l=[Td,Rd],p=[];function h(e,t){return e[6]?0:1}function m(t){e[12].call(null,t)}c=h(e),s=p[c]=l[c](e);var v={type:"password",name:"password",readonly:!e[0].is("locked")&&!e[6],$$slots:{label:[Pd]},$$scope:{ctx:e}};void 0!==e[2]&&(v.value=e[2]);var g=new Ga({props:v});return _e.push((function(){return qe(g,"value",m)})),{c:function(){t=K("input"),r=J(),o=K("input"),a=J(),s.c(),u=J(),Ge(g.$$.fragment),X(t,"type","hidden"),X(t,"name","connection_id"),t.value=n=e[0].connection_id,X(o,"type","hidden"),X(o,"name","conversation_id"),o.value=i=e[0].conversation_id},m:function(e,n){q(e,t,n),q(e,r,n),q(e,o,n),q(e,a,n),p[c].m(e,n),q(e,u,n),We(g,e,n),f=!0},p:function(e,r){(!f||1&r&&n!==(n=e[0].connection_id))&&(t.value=n),(!f||1&r&&i!==(i=e[0].conversation_id))&&(o.value=i);var a=c;(c=h(e))===a?p[c].p(e,r):(Ae(),Ue(p[a],1,1,(function(){p[a]=null})),Le(),(s=p[c])||(s=p[c]=l[c](e)).c(),Ie(s,1),s.m(u.parentNode,u));var m={};65&r&&(m.readonly=!e[0].is("locked")&&!e[6]),262144&r&&(m.$$scope={dirty:r,ctx:e}),!d&&4&r&&(d=!0,m.value=e[2],Ee((function(){return d=!1}))),g.$set(m)},i:function(e){f||(Ie(s),Ie(g.$$.fragment,e),f=!0)},o:function(e){Ue(s),Ue(g.$$.fragment,e),f=!1},d:function(e){e&&G(t),e&&G(r),e&&G(o),e&&G(a),p[c].d(e),e&&G(u),Ke(g,e)}}}function Rd(e){var t,n,r,o,i=fn(e[3]||"No topic is set.")+"";return{c:function(){t=K("div"),(n=K("label")).textContent="".concat(dn("Topic")),r=J(),X(o=K("div"),"class","input"),X(t,"class","text-field")},m:function(e,a){q(e,t,a),H(t,n),H(t,r),H(t,o),o.innerHTML=i},p:function(e,t){8&t&&i!==(i=fn(e[3]||"No topic is set.")+"")&&(o.innerHTML=i)},i:x,o:x,d:function(e){e&&G(t)}}}function Td(e){var t,n;function r(t){e[11].call(null,t)}var o={name:"topic",placeholder:dn("No topic is set."),$$slots:{label:[Od]},$$scope:{ctx:e}};void 0!==e[3]&&(o.value=e[3]);var i=new La({props:o});return _e.push((function(){return qe(i,"value",r)})),{c:function(){Ge(i.$$.fragment)},m:function(e,t){We(i,e,t),n=!0},p:function(e,n){var r={};262144&n&&(r.$$scope={dirty:n,ctx:e}),!t&&8&n&&(t=!0,r.value=e[3],Ee((function(){return t=!1}))),i.$set(r)},i:function(e){n||(Ie(i.$$.fragment,e),n=!0)},o:function(e){Ue(i.$$.fragment,e),n=!1},d:function(e){Ke(i,e)}}}function Od(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Topic")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Pd(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Password")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Dd(e){var t,n;function r(t){e[13].call(null,t)}var o={$$slots:{label:[Md]},$$scope:{ctx:e}};void 0!==e[5]&&(o.checked=e[5]);var i=new Sa({props:o});return _e.push((function(){return qe(i,"checked",r)})),{c:function(){Ge(i.$$.fragment)},m:function(e,t){We(i,e,t),n=!0},p:function(e,n){var r={};262144&n&&(r.$$scope={dirty:n,ctx:e}),!t&&32&n&&(t=!0,r.checked=e[5],Ee((function(){return t=!1}))),i.$set(r)},i:function(e){n||(Ie(i.$$.fragment,e),n=!0)},o:function(e){Ue(i.$$.fragment,e),n=!1},d:function(e){Ke(i,e)}}}function Md(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Notify me on new messages")),X(t,"slot","label")},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Nd(e){var t,n=new xo({props:{icon:"save",$$slots:{default:[jd]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};262144&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function jd(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Update"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ad(e){var t;return{c:function(){(t=K("span")).textContent="".concat(dn("Leave"))},m:function(e,n){q(e,t,n)},p:x,d:function(e){e&&G(t)}}}function Ld(e){for(var t,n,r,o,i,a=dn("Participants (%1)",e[0].participants().length)+"",c=e[0].participants(),s=[],u=0;u<c.length;u+=1)s[u]=Ud(wd(e,c,u));var d=function(e){return Ue(s[e],1,1,(function(){s[e]=null}))};return{c:function(){t=K("nav"),n=K("h3"),r=V(a),o=J();for(var e=0;e<s.length;e+=1)s[e].c();X(t,"class","sidebar-left__nav")},m:function(e,a){q(e,t,a),H(t,n),H(n,r),H(t,o);for(var c=0;c<s.length;c+=1)s[c].m(t,null);i=!0},p:function(e,n){if((!i||1&n)&&a!==(a=dn("Participants (%1)",e[0].participants().length)+"")&&te(r,a),1&n){var o;for(c=e[0].participants(),o=0;o<c.length;o+=1){var u=wd(e,c,o);s[o]?(s[o].p(u,n),Ie(s[o],1)):(s[o]=Ud(u),s[o].c(),Ie(s[o],1),s[o].m(t,null))}for(Ae(),o=c.length;o<s.length;o+=1)d(o);Le()}},i:function(e){if(!i){for(var t=0;t<c.length;t+=1)Ie(s[t]);i=!0}},o:function(e){s=s.filter(Boolean);for(var t=0;t<s.length;t+=1)Ue(s[t]);i=!1},d:function(e){e&&G(t),W(s,e)}}}function Id(e){var t,n,r,o=e[15].nick+"";return{c:function(){t=K("span"),n=V(o),r=J()},m:function(e,o){q(e,t,o),H(t,n),q(e,r,o)},p:function(e,t){1&t&&o!==(o=e[15].nick+"")&&te(n,o)},d:function(e){e&&G(t),e&&G(r)}}}function Ud(e){var t,n=new Yo({props:{href:"/chat/"+e[0].connection_id+"/"+e[15].id,class:"participant "+lt(e[15].modes),$$slots:{default:[Id]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};1&t&&(r.href="/chat/"+e[0].connection_id+"/"+e[15].id),1&t&&(r.class="participant "+lt(e[15].modes)),262145&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function zd(e){var t,n,r,o,i,a,c,s,u,d,f,l,h,m,v=!e[0].is("private"),g=e[0].hasOwnProperty("wantNotifications"),y=!e[0].is("private"),b=new ld({props:{conversation:e[0]}});function $(e,t){return e[0].frozen?xd:((null==o||1&t)&&(o=!!e[0].is("private")),o?Sd:e[6]?Cd:kd)}var _=$(e,-1),w=_(e),k=v&&Ed(e),C=g&&Dd(e),S=y&&Nd(e),x=new xo({props:{type:"button",icon:"sign-out-alt",$$slots:{default:[Ad]},$$scope:{ctx:e}}});x.$on("click",e[7]);var E=!e[0].frozen&&Ld(e);return{c:function(){t=K("div"),Ge(b.$$.fragment),n=J(),r=K("p"),w.c(),i=J(),a=K("form"),k&&k.c(),c=J(),C&&C.c(),s=J(),u=K("div"),S&&S.c(),d=J(),Ge(x.$$.fragment),f=J(),E&&E.c(),X(u,"class","form-actions"),X(a,"method","post"),X(t,"class","sidebar-left")},m:function(o,l,p){q(o,t,l),We(b,t,null),H(t,n),H(t,r),w.m(r,null),H(t,i),H(t,a),k&&k.m(a,null),H(a,c),C&&C.m(a,null),H(a,s),H(a,u),S&&S.m(u,null),H(u,d),We(x,u,null),e[14](a),H(t,f),E&&E.m(t,null),h=!0,p&&m(),m=Q(a,"submit",Z(e[8]))},p:function(e,n){var o=p(n,1)[0],i={};1&o&&(i.conversation=e[0]),b.$set(i),_===(_=$(e,o))&&w?w.p(e,o):(w.d(1),(w=_(e))&&(w.c(),w.m(r,null))),1&o&&(v=!e[0].is("private")),v?k?(k.p(e,o),Ie(k,1)):((k=Ed(e)).c(),Ie(k,1),k.m(a,c)):k&&(Ae(),Ue(k,1,1,(function(){k=null})),Le()),1&o&&(g=e[0].hasOwnProperty("wantNotifications")),g?C?(C.p(e,o),Ie(C,1)):((C=Dd(e)).c(),Ie(C,1),C.m(a,s)):C&&(Ae(),Ue(C,1,1,(function(){C=null})),Le()),1&o&&(y=!e[0].is("private")),y?S?(S.p(e,o),Ie(S,1)):((S=Nd(e)).c(),Ie(S,1),S.m(u,d)):S&&(Ae(),Ue(S,1,1,(function(){S=null})),Le());var f={};262144&o&&(f.$$scope={dirty:o,ctx:e}),x.$set(f),e[0].frozen?E&&(Ae(),Ue(E,1,1,(function(){E=null})),Le()):E?(E.p(e,o),Ie(E,1)):((E=Ld(e)).c(),Ie(E,1),E.m(t,null))},i:function(n){h||(Ie(b.$$.fragment,n),Ie(k),Ie(C),Ie(S),Ie(x.$$.fragment,n),Ie(E),xe((function(){l||(l=Be(t,po,e[1],!0)),l.run(1)})),h=!0)},o:function(n){Ue(b.$$.fragment,n),Ue(k),Ue(C),Ue(S),Ue(x.$$.fragment,n),Ue(E),l||(l=Be(t,po,e[1],!1)),l.run(0),h=!1},d:function(n){n&&G(t),Ke(b),w.d(),k&&k.d(),C&&C.d(),S&&S.d(),Ke(x),e[14](null),E&&E.d(),n&&l&&l.end(),m()}}}function Bd(e,t,n){var r,o,i=t.conversation,a=t.transition,c=ye("user"),s="",u=i.topic,d=i.wantNotifications;function f(e){var t=c.findConversation({connection_id:e.connection_id}),n=e.findParticipant(t&&t.nick);return n&&n.modes.operator}return e.$set=function(e){"conversation"in e&&n(0,i=e.conversation),"transition"in e&&n(1,a=e.transition)},e.$$.update=function(){1&e.$$.dirty&&n(6,o=f(i)),33&e.$$.dirty&&i.update({wantNotifications:d}),17&e.$$.dirty&&r&&r.topic&&n(4,r.topic.value=i.topic||"",r)},[i,a,s,u,r,d,o,function(e){i.send("/part")},function(e){s&&(i.send(o?"/mode +k "+s:"/join "+i.name+" "+s),n(2,s="")),o&&u!=i.topic&&i.send("/topic "+u)},c,f,function(e){n(3,u=e)},function(e){n(2,s=e)},function(e){n(5,d=e)},function(e){_e[e?"unshift":"push"]((function(){n(4,r=e)}))}]}var Fd=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(_d()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,Bd,zd,D,{conversation:0,transition:1}),r}return s}(Ye);function Hd(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function qd(e,t,n){var r=e.slice();return r[20]=t[n],r}function Gd(e,t,n){var r=e.slice();return r[17]=t[n],r}function Wd(e){var t,n,r,o,i,a=pf(e[6],10)+"",c=new wo({props:{name:"bell"}});return{c:function(){Ge(c.$$.fragment),t=J(),n=K("small"),r=V(a),X(n,"class","chat-header__unread"),n.hidden=o=!e[6].unread},m:function(e,o){We(c,e,o),q(e,t,o),q(e,n,o),H(n,r),i=!0},p:function(e,t){(!i||64&t)&&a!==(a=pf(e[6],10)+"")&&te(r,a),(!i||64&t&&o!==(o=!e[6].unread))&&(n.hidden=o)},i:function(e){i||(Ie(c.$$.fragment,e),i=!0)},o:function(e){Ue(c.$$.fragment,e),i=!1},d:function(e){Ke(c,e),e&&G(t),e&&G(n)}}}function Kd(e){var t,n=new Yo({props:{href:"/settings/connection",$$slots:{default:[Vd]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};8388608&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function Vd(e){var t,n,r,o=new wo({props:{name:"exclamation-circle"}});return{c:function(){Ge(o.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("No conversations"))},m:function(e,i){We(o,e,i),q(e,t,i),q(e,n,i),r=!0},p:x,i:function(e){r||(Ie(o.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n)}}}function Jd(e){var t,n,r,o,i,a,c,s,u=(e[17].name||e[17].connection_id)+"",d=pf(e[17])+"",f=new wo({props:{name:"network-wired"}});return{c:function(){Ge(f.$$.fragment),t=J(),n=K("span"),r=V(u),o=J(),i=K("b"),a=V(d),X(i,"class","unread"),i.hidden=c=!e[17].unread},m:function(e,c){We(f,e,c),q(e,t,c),q(e,n,c),H(n,r),q(e,o,c),q(e,i,c),H(i,a),s=!0},p:function(e,t){(!s||16&t)&&u!==(u=(e[17].name||e[17].connection_id)+"")&&te(r,u),(!s||16&t)&&d!==(d=pf(e[17])+"")&&te(a,d),(!s||16&t&&c!==(c=!e[17].unread))&&(i.hidden=c)},i:function(e){s||(Ie(f.$$.fragment,e),s=!0)},o:function(e){Ue(f.$$.fragment,e),s=!1},d:function(e){Ke(f,e),e&&G(t),e&&G(n),e&&G(o),e&&G(i)}}}function Yd(e){var t,n,r,o,i,a,c,s,u=e[20].name+"",d=pf(e[20])+"",f=new wo({props:{name:e[20].is_private?"user":"user-friends"}});return{c:function(){Ge(f.$$.fragment),t=J(),n=K("span"),r=V(u),o=J(),i=K("b"),a=V(d),X(i,"class","unread"),i.hidden=c=!e[20].unread},m:function(e,c){We(f,e,c),q(e,t,c),q(e,n,c),H(n,r),q(e,o,c),q(e,i,c),H(i,a),s=!0},p:function(e,t){var n={};16&t&&(n.name=e[20].is_private?"user":"user-friends"),f.$set(n),(!s||16&t)&&u!==(u=e[20].name+"")&&te(r,u),(!s||16&t)&&d!==(d=pf(e[20])+"")&&te(a,d),(!s||16&t&&c!==(c=!e[20].unread))&&(i.hidden=c)},i:function(e){s||(Ie(f.$$.fragment,e),s=!0)},o:function(e){Ue(f.$$.fragment,e),s=!1},d:function(e){Ke(f,e),e&&G(t),e&&G(n),e&&G(o),e&&G(i)}}}function Qd(e){var t,n=new Yo({props:{href:e[20].path,class:ff(e[17],e[20]),$$slots:{default:[Yd]},$$scope:{ctx:e}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};16&t&&(r.href=e[20].path),16&t&&(r.class=ff(e[17],e[20])),8388624&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function Zd(e){for(var t,n,r,o=new Yo({props:{href:e[17].path,class:ff(e[17],e[17]),$$slots:{default:[Jd]},$$scope:{ctx:e}}}),i=e[17].conversations.toArray(),a=[],c=0;c<i.length;c+=1)a[c]=Qd(qd(e,i,c));var s=function(e){return Ue(a[e],1,1,(function(){a[e]=null}))};return{c:function(){Ge(o.$$.fragment),t=J();for(var e=0;e<a.length;e+=1)a[e].c();n=Y()},m:function(e,i){We(o,e,i),q(e,t,i);for(var c=0;c<a.length;c+=1)a[c].m(e,i);q(e,n,i),r=!0},p:function(e,t){var r={};if(16&t&&(r.href=e[17].path),16&t&&(r.class=ff(e[17],e[17])),8388624&t&&(r.$$scope={dirty:t,ctx:e}),o.$set(r),16&t){var c;for(i=e[17].conversations.toArray(),c=0;c<i.length;c+=1){var u=qd(e,i,c);a[c]?(a[c].p(u,t),Ie(a[c],1)):(a[c]=Qd(u),a[c].c(),Ie(a[c],1),a[c].m(n.parentNode,n))}for(Ae(),c=i.length;c<a.length;c+=1)s(c);Le()}},i:function(e){if(!r){Ie(o.$$.fragment,e);for(var t=0;t<i.length;t+=1)Ie(a[t]);r=!0}},o:function(e){Ue(o.$$.fragment,e),a=a.filter(Boolean);for(var t=0;t<a.length;t+=1)Ue(a[t]);r=!1},d:function(e){Ke(o,e),e&&G(t),W(a,e),e&&G(n)}}}function Xd(e){var t,n,r,o,i,a,c,s=pf(e[6])+"",u=new wo({props:{name:"bell"}});return{c:function(){Ge(u.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("Notifications")),r=J(),o=K("b"),i=V(s),X(o,"class","unread"),o.hidden=a=!e[6].unread},m:function(e,a){We(u,e,a),q(e,t,a),q(e,n,a),q(e,r,a),q(e,o,a),H(o,i),c=!0},p:function(e,t){(!c||64&t)&&s!==(s=pf(e[6])+"")&&te(i,s),(!c||64&t&&a!==(a=!e[6].unread))&&(o.hidden=a)},i:function(e){c||(Ie(u.$$.fragment,e),c=!0)},o:function(e){Ue(u.$$.fragment,e),c=!1},d:function(e){Ke(u,e),e&&G(t),e&&G(n),e&&G(r),e&&G(o)}}}function ef(e){var t,n,r,o=new wo({props:{name:"search"}});return{c:function(){Ge(o.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("Search"))},m:function(e,i){We(o,e,i),q(e,t,i),q(e,n,i),r=!0},p:x,i:function(e){r||(Ie(o.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n)}}}function tf(e){var t,n,r,o=new wo({props:{name:"comment"}});return{c:function(){Ge(o.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("Add conversation"))},m:function(e,i){We(o,e,i),q(e,t,i),q(e,n,i),r=!0},p:x,i:function(e){r||(Ie(o.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n)}}}function nf(e){var t,n,r,o=new wo({props:{name:"network-wired"}});return{c:function(){Ge(o.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("Add connection"))},m:function(e,i){We(o,e,i),q(e,t,i),q(e,n,i),r=!0},p:x,i:function(e){r||(Ie(o.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n)}}}function rf(e){var t,n,r,o=new wo({props:{name:"user-cog"}});return{c:function(){Ge(o.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("Account"))},m:function(e,i){We(o,e,i),q(e,t,i),q(e,n,i),r=!0},p:x,i:function(e){r||(Ie(o.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n)}}}function of(e){var t,n,r,o=new wo({props:{name:"question-circle"}});return{c:function(){Ge(o.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("Help"))},m:function(e,i){We(o,e,i),q(e,t,i),q(e,n,i),r=!0},p:x,i:function(e){r||(Ie(o.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n)}}}function af(e){var t,n,r=new Yo({props:{href:"/settings",$$slots:{default:[cf]},$$scope:{ctx:e}}}),o=new Yo({props:{href:"/settings/users",$$slots:{default:[sf]},$$scope:{ctx:e}}});return{c:function(){Ge(r.$$.fragment),t=J(),Ge(o.$$.fragment)},m:function(e,i){We(r,e,i),q(e,t,i),We(o,e,i),n=!0},p:function(e,t){var n={};8388608&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n);var i={};8388608&t&&(i.$$scope={dirty:t,ctx:e}),o.$set(i)},i:function(e){n||(Ie(r.$$.fragment,e),Ie(o.$$.fragment,e),n=!0)},o:function(e){Ue(r.$$.fragment,e),Ue(o.$$.fragment,e),n=!1},d:function(e){Ke(r,e),e&&G(t),Ke(o,e)}}}function cf(e){var t,n,r,o=new wo({props:{name:"tools"}});return{c:function(){Ge(o.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("Settings"))},m:function(e,i){We(o,e,i),q(e,t,i),q(e,n,i),r=!0},p:x,i:function(e){r||(Ie(o.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n)}}}function sf(e){var t,n,r,o=new wo({props:{name:"users"}});return{c:function(){Ge(o.$$.fragment),t=J(),(n=K("span")).textContent="".concat(dn("Users"))},m:function(e,i){We(o,e,i),q(e,t,i),q(e,n,i),r=!0},p:x,i:function(e){r||(Ie(o.$$.fragment,e),r=!0)},o:function(e){Ue(o.$$.fragment,e),r=!1},d:function(e){Ke(o,e),e&&G(t),e&&G(n)}}}function uf(e){var t,n,r,o,i=dn('Search for "%1"',e[5])+"",a=new wo({props:{name:"search"}});return{c:function(){Ge(a.$$.fragment),t=J(),n=K("span"),r=V(i)},m:function(e,i){We(a,e,i),q(e,t,i),q(e,n,i),H(n,r),o=!0},p:function(e,t){(!o||32&t)&&i!==(i=dn('Search for "%1"',e[5])+"")&&te(r,i)},i:function(e){o||(Ie(a.$$.fragment,e),o=!0)},o:function(e){Ue(a.$$.fragment,e),o=!1},d:function(e){Ke(a,e),e&&G(t),e&&G(n)}}}function df(e){for(var t,n,r,o,i,a,c,s,u,d,f,l,h,m,v,g,y,b,$,_,w,k,C,S,x,E,R,T,P,D,M=(e[4].email||dn("Account"))+"",N=e[4].is("admin"),j=new Yo({props:{href:"/chat",class:"sidebar__header__notification",$$slots:{default:[Wd]},$$scope:{ctx:e}}}),A=new wo({props:{name:"search"}}),L=!e[4].connections.size&&Kd(e),I=e[4].connections.toArray(),U=[],z=0;z<I.length;z+=1)U[z]=Zd(Gd(e,I,z));var B=function(e){return Ue(U[e],1,1,(function(){U[e]=null}))},F=new Yo({props:{href:"/chat",$$slots:{default:[Xd]},$$scope:{ctx:e}}}),Y=new Yo({props:{href:"/search",$$slots:{default:[ef]},$$scope:{ctx:e}}}),Z=new Yo({props:{href:"/settings/conversation",$$slots:{default:[tf]},$$scope:{ctx:e}}}),ee=new Yo({props:{href:"/settings/connection",$$slots:{default:[nf]},$$scope:{ctx:e}}}),re=new Yo({props:{href:"/settings/account",$$slots:{default:[rf]},$$scope:{ctx:e}}}),ie=new Yo({props:{href:"/help",$$slots:{default:[of]},$$scope:{ctx:e}}}),ae=N&&af(e),ce=new wo({props:{name:"power-off"}}),se=new Yo({props:{href:"/search?q="+encodeURIComponent(e[5]),class:"for-search hidden",$$slots:{default:[uf]},$$scope:{ctx:e}}});return{c:function(){t=K("div"),n=K("form"),r=K("input"),i=J(),Ge(j.$$.fragment),a=J(),c=K("label"),Ge(A.$$.fragment),s=J(),u=K("nav"),(d=K("h3")).textContent="".concat(dn("Conversations")),f=J(),L&&L.c(),l=J();for(var p=0;p<U.length;p+=1)U[p].c();h=J(),m=K("h3"),v=V(M),g=J(),Ge(F.$$.fragment),y=J(),Ge(Y.$$.fragment),b=J(),Ge(Z.$$.fragment),$=J(),Ge(ee.$$.fragment),_=J(),Ge(re.$$.fragment),w=J(),Ge(ie.$$.fragment),k=J(),ae&&ae.c(),C=J(),S=K("a"),Ge(ce.$$.fragment),x=J(),(E=K("span")).textContent="".concat(dn("Log out")),R=J(),Ge(se.$$.fragment),X(r,"type","text"),X(r,"id","search_input"),X(r,"class","is-primary-menu-item"),X(r,"placeholder",o=e[3]?dn("Search..."):dn("Convos")),X(c,"for","search_input"),X(n,"class","sidebar__header is-below"),oe(n,"has-focus",e[3]),X(S,"href",Kt.urlFor("/logout")),X(S,"target","_self"),X(u,"class","sidebar-left__nav"),oe(u,"is-filtering",e[1].length>0),X(t,"class","sidebar-left")},m:function(o,p,T){q(o,t,p),H(t,n),H(n,r),ne(r,e[1]),H(n,i),We(j,n,null),H(n,a),H(n,c),We(A,c,null),H(t,s),H(t,u),H(u,d),H(u,f),L&&L.m(u,null),H(u,l);for(var M=0;M<U.length;M+=1)U[M].m(u,null);H(u,h),H(u,m),H(m,v),H(u,g),We(F,u,null),H(u,y),We(Y,u,null),H(u,b),We(Z,u,null),H(u,$),We(ee,u,null),H(u,_),We(re,u,null),H(u,w),We(ie,u,null),H(u,k),ae&&ae.m(u,null),H(u,C),H(u,S),We(ce,S,null),H(S,x),H(S,E),H(u,R),We(se,u,null),e[16](u),P=!0,T&&O(D),D=[Q(r,"input",e[15]),Q(r,"blur",e[9]),Q(r,"focus",e[10]),Q(r,"keydown",e[11]),Q(n,"submit",hf),Q(u,"click",lf)]},p:function(e,t){var i=p(t,1)[0];(!P||8&i&&o!==(o=e[3]?dn("Search..."):dn("Convos")))&&X(r,"placeholder",o),2&i&&r.value!==e[1]&&ne(r,e[1]);var a={};if(8388672&i&&(a.$$scope={dirty:i,ctx:e}),j.$set(a),8&i&&oe(n,"has-focus",e[3]),e[4].connections.size?L&&(Ae(),Ue(L,1,1,(function(){L=null})),Le()):L?(L.p(e,i),Ie(L,1)):((L=Kd(e)).c(),Ie(L,1),L.m(u,l)),16&i){var c;for(I=e[4].connections.toArray(),c=0;c<I.length;c+=1){var s=Gd(e,I,c);U[c]?(U[c].p(s,i),Ie(U[c],1)):(U[c]=Zd(s),U[c].c(),Ie(U[c],1),U[c].m(u,h))}for(Ae(),c=I.length;c<U.length;c+=1)B(c);Le()}(!P||16&i)&&M!==(M=(e[4].email||dn("Account"))+"")&&te(v,M);var d={};8388672&i&&(d.$$scope={dirty:i,ctx:e}),F.$set(d);var f={};8388608&i&&(f.$$scope={dirty:i,ctx:e}),Y.$set(f);var m={};8388608&i&&(m.$$scope={dirty:i,ctx:e}),Z.$set(m);var g={};8388608&i&&(g.$$scope={dirty:i,ctx:e}),ee.$set(g);var y={};8388608&i&&(y.$$scope={dirty:i,ctx:e}),re.$set(y);var b={};8388608&i&&(b.$$scope={dirty:i,ctx:e}),ie.$set(b),16&i&&(N=e[4].is("admin")),N?ae?(ae.p(e,i),Ie(ae,1)):((ae=af(e)).c(),Ie(ae,1),ae.m(u,C)):ae&&(Ae(),Ue(ae,1,1,(function(){ae=null})),Le());var $={};32&i&&($.href="/search?q="+encodeURIComponent(e[5])),8388640&i&&($.$$scope={dirty:i,ctx:e}),se.$set($),2&i&&oe(u,"is-filtering",e[1].length>0)},i:function(n){if(!P){Ie(j.$$.fragment,n),Ie(A.$$.fragment,n),Ie(L);for(var r=0;r<I.length;r+=1)Ie(U[r]);Ie(F.$$.fragment,n),Ie(Y.$$.fragment,n),Ie(Z.$$.fragment,n),Ie(ee.$$.fragment,n),Ie(re.$$.fragment,n),Ie(ie.$$.fragment,n),Ie(ae),Ie(ce.$$.fragment,n),Ie(se.$$.fragment,n),xe((function(){T||(T=Be(t,po,e[0],!0)),T.run(1)})),P=!0}},o:function(n){Ue(j.$$.fragment,n),Ue(A.$$.fragment,n),Ue(L),U=U.filter(Boolean);for(var r=0;r<U.length;r+=1)Ue(U[r]);Ue(F.$$.fragment,n),Ue(Y.$$.fragment,n),Ue(Z.$$.fragment,n),Ue(ee.$$.fragment,n),Ue(re.$$.fragment,n),Ue(ie.$$.fragment,n),Ue(ae),Ue(ce.$$.fragment,n),Ue(se.$$.fragment,n),T||(T=Be(t,po,e[0],!1)),T.run(0),P=!1},d:function(n){n&&G(t),Ke(j),Ke(A),L&&L.d(),W(U,n),Ke(F),Ke(Y),Ke(Z),Ke(ee),Ke(re),Ke(ie),ae&&ae.d(),Ke(ce),Ke(se),e[16](null),n&&T&&T.end(),O(D)}}}function ff(e,t){var n=[t.conversation_id?"for-conversation":"for-connection"];return(t.frozen||"connected"!=e.state)&&n.push("is-frozen"),t.errors&&n.push("has-errors"),n.join(" ")}function lf(e){(e.target.className||"").match(/(network|user)/)&&setTimeout((function(){return Kt.update({activeMenu:"settings"})}),50)}function pf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;return e.unread>t?"60+":e.unread||0}var hf=function(e){return e.preventDefault()};function mf(e,t,n){var r,o,i;N(e,Kt,(function(e){return n(14,o=e)}));var a=t.transition,c=ye("user");N(e,c,(function(e){return n(4,r=e)}));var s=r.notifications;N(e,s,(function(e){return n(6,i=e)}));var u,d,f=0,l="",p=!1,h=[];function m(){pt(u,"a",(function(e){return e.classList.remove("has-focus")})),setTimeout((function(){if(u){n(1,l="");var e=document.activeElement;e&&at(e,u)&&pt(u,"a.has-path",(function(e){return e.focus()})),n(3,p=!1)}}),100)}function v(){if(u){n(12,f=0),n(3,p=!0),n(13,h=[]);var e=[l.match(/^\W+/)?"":"\\b\\W*"];e[0]&&e.push("");for(var t=function(t){var r=new RegExp(e[t]+ht(l),"i"),o={};if(pt(u,"a",(function(e,t){var i=e.classList;!l.length&&i.contains("has-path")&&n(12,f=t),i.remove("has-focus");var a=!l.length||!e.href.match(/\/search$/)&&!o[e.href]&&e.textContent.match(r);a&&h.push(e),e.classList[a?"remove":"add"]("hidden"),o[e.href]=!0})),h.length)return"break"},r=0;r<e.length;r++){if("break"===t(r))break}pt(u,".for-connection",(function(e){for(var t=e;(t=t.nextElementSibling)&&t.classList.contains("for-conversation");)if(!t.classList.contains("hidden"))return e.classList.remove("hidden")}));var o=u.querySelector(".for-search");o.classList[l?"remove":"add"]("hidden"),o.classList.contains("hidden")||h.push(o),pt(u,"h3",(function(e){for(var t=e;(t=t.nextElementSibling)&&!gt(t,"h3");)if(!t.classList.contains("hidden"))return e.classList.remove("hidden");e.classList.add("hidden")}))}}return e.$set=function(e){"transition"in e&&n(0,a=e.transition)},e.$$.update=function(){2&e.$$.dirty&&v(),2&e.$$.dirty&&n(5,d=l.replace(/^\//,"")),16388&e.$$.dirty&&u&&m(),12288&e.$$.dirty&&h[f]&&h[f].classList.add("has-focus")},[a,l,u,p,r,d,i,c,s,m,v,function(e){if(13==e.keyCode)return e.preventDefault(),m(),void(h[f]&&Kt.go(h[f].href));var t=38==e.keyCode?-1:40==e.keyCode?1:0;t&&(e.preventDefault(),h[f]&&h[f].classList.remove("has-focus"),n(12,f+=e.ctrlKey?4*t:t)),f<0&&n(12,f=h.length-1),f>=h.length&&n(12,f=0)},f,h,o,function(){l=this.value,n(1,l)},function(e){_e[e?"unshift":"push"]((function(){n(2,u=e)}))}]}var vf=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(Hd()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,mf,df,D,{transition:0}),r}return s}(Ye);function gf(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var yf=He.window;function bf(e){var t,n,r=e[3].component||ns;if(r)var o=new r({});return{c:function(){o&&Ge(o.$$.fragment),t=Y()},m:function(e,r){o&&We(o,e,r),q(e,t,r),n=!0},p:function(e,n){if(r!==(r=e[3].component||ns)){if(o){Ae();var i=o;Ue(i.$$.fragment,1,0,(function(){Ke(i,1)})),Le()}r?(Ge((o=new r({})).$$.fragment),Ie(o.$$.fragment,1),We(o,t.parentNode,t)):o=null}},i:function(e){n||(o&&Ie(o.$$.fragment,e),n=!0)},o:function(e){o&&Ue(o.$$.fragment,e),n=!1},d:function(e){e&&G(t),o&&Ke(o,e)}}}function $f(e){var t,n=new Ms({});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:x,i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function _f(e){var t,n,r,o,i,a=("nav"==e[3].activeMenu||e[6].isWide)&&"default"!=e[3].activeMenu&&wf(e),c="settings"==e[3].activeMenu&&kf(e),s=e[3].component;if(s)var u=new s({});var d=e[3].activeMenu&&!e[6].isWide&&Cf(e);return{c:function(){a&&a.c(),t=J(),c&&c.c(),n=J(),u&&Ge(u.$$.fragment),r=J(),d&&d.c(),o=Y()},m:function(e,s){a&&a.m(e,s),q(e,t,s),c&&c.m(e,s),q(e,n,s),u&&We(u,e,s),q(e,r,s),d&&d.m(e,s),q(e,o,s),i=!0},p:function(e,i){if("nav"!=e[3].activeMenu&&!e[6].isWide||"default"==e[3].activeMenu?a&&(Ae(),Ue(a,1,1,(function(){a=null})),Le()):a?(a.p(e,i),Ie(a,1)):((a=wf(e)).c(),Ie(a,1),a.m(t.parentNode,t)),"settings"==e[3].activeMenu?c?(c.p(e,i),Ie(c,1)):((c=kf(e)).c(),Ie(c,1),c.m(n.parentNode,n)):c&&(Ae(),Ue(c,1,1,(function(){c=null})),Le()),s!==(s=e[3].component)){if(u){Ae();var f=u;Ue(f.$$.fragment,1,0,(function(){Ke(f,1)})),Le()}s?(Ge((u=new s({})).$$.fragment),Ie(u.$$.fragment,1),We(u,r.parentNode,r)):u=null}e[3].activeMenu&&!e[6].isWide?d?(d.p(e,i),Ie(d,1)):((d=Cf(e)).c(),Ie(d,1),d.m(o.parentNode,o)):d&&(Ae(),Ue(d,1,1,(function(){d=null})),Le())},i:function(e){i||(Ie(a),Ie(c),u&&Ie(u.$$.fragment,e),Ie(d),i=!0)},o:function(e){Ue(a),Ue(c),u&&Ue(u.$$.fragment,e),Ue(d),i=!1},d:function(e){a&&a.d(e),e&&G(t),c&&c.d(e),e&&G(n),u&&Ke(u,e),e&&G(r),d&&d.d(e),e&&G(o)}}}function wf(e){var t,n=new vf({props:{transition:{duration:e[6].isWide?0:250,x:e[6].width}}});return{c:function(){Ge(n.$$.fragment)},m:function(e,r){We(n,e,r),t=!0},p:function(e,t){var r={};64&t&&(r.transition={duration:e[6].isWide?0:250,x:e[6].width}),n.$set(r)},i:function(e){t||(Ie(n.$$.fragment,e),t=!0)},o:function(e){Ue(n.$$.fragment,e),t=!1},d:function(e){Ke(n,e)}}}function kf(e){var t,n,r=e[4];function o(e){return{props:{conversation:e[5].activeConversation,transition:{duration:250,x:e[6].isWide?0:e[6].width}}}}if(r)var i=new r(o(e));return{c:function(){i&&Ge(i.$$.fragment),t=Y()},m:function(e,r){i&&We(i,e,r),q(e,t,r),n=!0},p:function(e,n){var a={};if(32&n&&(a.conversation=e[5].activeConversation),64&n&&(a.transition={duration:250,x:e[6].isWide?0:e[6].width}),r!==(r=e[4])){if(i){Ae();var c=i;Ue(c.$$.fragment,1,0,(function(){Ke(c,1)})),Le()}r?(Ge((i=new r(o(e))).$$.fragment),Ie(i.$$.fragment,1),We(i,t.parentNode,t)):i=null}else r&&i.$set(a)},i:function(e){n||(i&&Ie(i.$$.fragment,e),n=!0)},o:function(e){i&&Ue(i.$$.fragment,e),n=!1},d:function(e){e&&G(t),i&&Ke(i,e)}}}function Cf(e){var t,n,r,o;return{c:function(){(t=K("div")).textContent=" ",X(t,"class","overlay")},m:function(n,i,a){q(n,t,i),r=!0,a&&o(),o=Q(t,"click",e[14])},p:x,i:function(e){r||(xe((function(){n||(n=Be(t,lo,{duration:200},!0)),n.run(1)})),r=!0)},o:function(e){n||(n=Be(t,lo,{duration:200},!1)),n.run(0),r=!1},d:function(e){e&&G(t),e&&n&&n.end(),o()}}}function Sf(e){var t,n,r,o,i;xe(e[13]);var a=[_f,$f,bf],c=[];function s(e,t){return e[2]?0:e[3].requireLogin?1:2}return t=s(e),n=c[t]=a[t](e),{c:function(){n.c(),r=Y()},m:function(n,a,s){c[t].m(n,a),q(n,r,a),o=!0,s&&O(i),i=[Q(yf,"focus",e[12]),Q(yf,"resize",e[13])]},p:function(e,o){var i=p(o,1)[0],u=t;(t=s(e))===u?c[t].p(e,i):(Ae(),Ue(c[u],1,1,(function(){c[u]=null})),Le(),(n=c[t])||(n=c[t]=a[t](e)).c(),Ie(n,1),n.m(r.parentNode,r))},i:function(e){o||(Ie(n),o=!0)},o:function(e){Ue(n),o=!1},d:function(e){c[t].d(e),e&&G(r),O(i)}}}function xf(e,t,n){var r,o,i;N(e,Kt,(function(e){return n(3,r=e)})),N(e,io,(function(e){return n(6,i=e)}));var a=_n("/events"),c=new Wn({});N(e,c,(function(e){return n(5,o=e)}));var s=new uo({}),u=0,d=0,f={closed:!0};function l(e){if(e.is("open"))return f.close&&f.close();var t=!1===navigator.onLine?dn("You seem to be offline."):e.error?dn(e.error):e.is("connecting")?dn("Connecting to Convos..."):dn("Connection to Convos is %1.",dn(e.readyStateHuman));f.body!=t&&(f.close&&f.close(),f=vn.showInApp(t,{closeAfter:-1,title:dn("Status")}))}a.update({debug:"WebSocket"}),window.convosWebSockeet=a,Kt.update({baseUrl:ao("base_url")}),a.update({url:Kt.wsUrlFor("/events")}),(navigator.serviceWorker?navigator.serviceWorker.register(Kt.urlFor("/sw.js")).then((function(e){io.version!=ao("version")&&(io.update({version:ao("version")}),e.update())})):Promise.resolve({})).catch((function(e){return console.log("[registerServiceWorker]",e)})),function(e,t){e.to("/login",sd(Ms)),e.to("/register",sd(Ms)),e.to("/help",sd(ls)),e.to("/settings/account",sd(gu)),e.to("/settings/connection",sd(Cc)),e.to("/settings/conversation",sd(Kc)),e.to("/settings/users",sd(cd)),e.to("/settings",sd(Iu)),e.to("/search",sd(tu)),e.to("/chat",sd(tu)),e.to("/chat/:connection_id",sd(ba)),e.to("/chat/:connection_id/:conversation_id",sd(ba));var n=function(){};e.to("/doc/*",n),e.to("/file/*",n),e.to("/paste/*",n),e.to("/",sd(Ms)),e.to("*",sd(ns)),function(e,t){t.on("wsEventSentJoin",(function(t){e.go(e.conversationPath(t))})),t.on("wsEventSentPart",(function(n){var r=t.findConversation({connection_id:n.connection_id});if(!r)return e.go("/settings/connection");var o=r.conversations.toArray()[0];e.go(o?o.path:"/settings/conversation")}))}(e,t)}(Kt,c),function(e){var t=document,n=e.replace(/\W/g,"_");if(!t.getElementById(n)){var r=t.createElement("script"),o=[n,e];r.id=o[0],r.src=o[1],t.getElementsByTagName("head")[0].appendChild(r)}}(Kt.urlFor("/images/emojis.js")),ge("api",Dt("/api").update({url:Kt.urlFor("/api")}).toFunction()),ge("rtc",s),ge("socket",a),ge("user",c),vn.on("click",(function(e){return e.path&&Kt.go(e.path)})),a.on("update",l),c.on("update",(function(e,t){return t.hasOwnProperty("roles")&&Kt.render()})),c.on("update",(function(e,t){return t.hasOwnProperty("rtc")&&s.update({peerConfig:e.rtc})})),c.load(),io.activateTheme();var p,h;return e.$$.update=function(){8&e.$$.dirty&&n(2,p=!!(r.component&&r.requireLogin&&c.is("authenticated"))),32&e.$$.dirty&&n(4,h=o.activeConversation.connection_id?o.activeConversation.conversation_id?Fd:$d:null),3&e.$$.dirty&&io.update({height:u,width:d}),4&e.$$.dirty&&ao("app_mode",p),4&e.$$.dirty&&ao("notify_enabled",p),40&e.$$.dirty&&function(e,t){if(document){var n=ao("organization_name"),r=t.unread?"("+t.unread+") "+e.title:e.title;document.title="Convos"==n?dn("%1 - Convos",r):dn("%1 - Convos for %2",r,n)}}(r,o)},[u,d,p,r,h,o,i,a,c,f,s,l,function(){return c.email&&a.open()},function(){n(0,u=yf.innerHeight),n(1,d=yf.innerWidth)},function(){return r.update({activeMenu:""})}]}var Ef=function(n){c(s,n);var r,a=(r=s,function(){var e,t=i(r);if(gf()){var n=i(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)});function s(n){var r;return e(this,s),r=a.call(this),Je(t(r),n,xf,Sf,D,{}),r}return s}(Ye),Rf=document.querySelector("body");if(Rf.classList=Rf.className.replace(/no-js/,"has-js"),pt(document,"#hamburger_checkbox_toggle",(function(e){e.checked=!1})),document.querySelector('meta[name="convos:start_app"][content="yes"]')){document.querySelector(".footer-wrapper").remove(),document.querySelector("main").remove();new Ef({target:document.body})}else document.addEventListener("DOMContentLoaded",(function(e){pt(document,"pre",(function(e){return mi.lineNumbersBlock(e)}))}));function Tf(e){if(!("ontouchstart"in window)){var t=function(e){for(var t=0;t<e.length;t++){var n=document.querySelector(e[t]);if(n&&-1!=n.tabIndex)return n}return null},n=e&&t(["input.is-primary-menu-item","a.is-primary-menu-item"]),r=document.activeElement;if(gt(r,["a","input","textarea"])&&n&&r!=n)return n.focus();var o=t([".is-primary-input",'main input[type="text"], article input[type="text"]',"main a, article a"]);return o?o.focus():n?n.focus():void 0}}document.addEventListener("keydown",(function(e){27==e.keyCode&&(pt(document,".fullscreen-wrapper",(function(e){return e.click()})),Tf()),13==e.keyCode&&e.shiftKey&&(e.preventDefault(),Tf("toggle"))})),document.addEventListener("routerender",(function(){return Tf()}))}();
//# sourceMappingURL=convos.5fbb4785.js.map
